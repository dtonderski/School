(window.webpackJsonp=window.webpackJsonp||[]).push([["ChatMessageInput~RichTextEditor"],{"./src/lib/forEachGroup/index.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return i});var o=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(c){r=!0,i=c}finally{try{!o&&a.return&&a.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();const r=t=>t;function i(t,e,n){var i=Array.isArray(t)?[t.length,e=>t[e]]:[t.size,e=>t.get(e)],s=o(i,2);const a=s[0],c=s[1];var l=(e||{}).keyFn;const d=void 0===l?r:l;var u=e||{},p=u.start;let h=void 0===p?0:p;var g=u.end;let m=void 0===g?a:g;if((h=h<0?0:h)>=(m=m>a?a:m))return;let f=c(h),b=d(f,h),y=h;for(let o=h+1;o<m;o++){const t=c(o),e=d(t,o);if(e!==b){if(!1===n(f,b,y,o))return;b=e,y=o,f=t}}n(f,b,y,m)}},"./src/lib/linkMatchers/index.ts":function(t,e,n){"use strict";var o=n("./node_modules/linkify-it/index.js"),r=n.n(o),i=n("./node_modules/tlds/index.js"),s=n.n(i),a=n("./src/lib/linkMatchers/customLinks.ts"),c=n("./node_modules/lodash/values.js"),l=n.n(c);const d=t=>l()(a.b).includes(t.substring(1)),u=["//","ftp:","http:","https:","mailto:"],p=t=>((t,e)=>(e.forEach(e=>t.add(e,null)),t))(t,u);n.d(e,"c",function(){return h}),n.d(e,"d",function(){return m}),n.d(e,"g",function(){return f}),n.d(e,"a",function(){return E}),n.d(e,"b",function(){return S}),n.d(e,"e",function(){return C}),n.d(e,"f",function(){return O});const h=r()().tlds(s.a).set({fuzzyIP:!0}),g=r()().set({fuzzyIP:!0}).add(a.f.mention.prefix,a.f.mention.config),m=p(r()()).set({fuzzyLink:!1,fuzzyEmail:!1}).add(a.f.subreddit.prefix,a.f.subreddit.config).add(a.f.subredditFull.prefix,a.f.subreddit.config),f=p(r()()).set({fuzzyLink:!1,fuzzyEmail:!1}).add(a.f.profile.prefix,a.f.profile.config).add(a.f.profileFull.prefix,a.f.profile.config),b=r()().tlds(s.a).set({fuzzyIP:!0}).add(a.f.subreddit.prefix,a.f.subreddit.config).add(a.f.subredditFull.prefix,a.f.subreddit.config).add(a.f.profile.prefix,a.f.profile.config).add(a.f.profileFull.prefix,a.f.profile.config).add(a.f.mention.prefix,a.f.mention.config),y=h.normalize;h.normalize=(t=>{y.call(h,t),!t.schema&&t.url.startsWith("http:")&&(t.url=`https:${t.url.slice(5)}`)});const E=(t,e)=>{return(b.match(t)||[]).filter(t=>{const n=d(t.text);return!n||n&&e})},S=t=>{return[...f.match(t)||[],...g.match(t)||[]].map(t=>!d(t.text)&&t.text.replace(a.a,"")).filter(t=>t)},C=(t,e)=>{const n=t.match(e);if(n&&1===n.length&&0===n[0].index&&n[0].lastIndex===e.length)return n[0]},O=t=>{const e=h.match(t);if(e&&1===e.length&&0===e[0].index){const n=e[0];return n.lastIndex===t.length?n:((t,e)=>{const n=t.substring(e.lastIndex);if(/.*\/\/.*\/.*/.test(e.url)&&/^(\?|\!)+$/.test(n))return e.lastIndex+=n.length,e.url+=n,e})(t,n)}}},"./src/reddit/actions/postCreation/mediaUpload.ts":function(t,e,n){"use strict";var o=n("./node_modules/uuid/v4.js"),r=n.n(o),i=n("./src/app/strings/index.ts"),s=n("./src/lib/constants/index.ts"),a=n("./src/lib/formatApiError/index.ts"),c=n("./src/lib/makeActionCreator/index.ts"),l=n("./src/reddit/actions/toaster.ts"),d=n("./src/reddit/actions/upload.ts"),u=n("./src/lib/makeApiRequest/index.ts"),p=n("./src/lib/omitHeaders/index.ts"),h=n("./src/reddit/constants/headers.ts");var g=n("./src/reddit/helpers/correlationIdTracker.ts"),m=n("./src/reddit/helpers/imagePreview/index.ts"),f=n("./src/reddit/helpers/media/index.ts"),b=n("./src/reddit/models/Upload/index.ts"),y=n("./src/reddit/selectors/telemetry.ts"),E=n("./src/telemetry/index.ts");const S=async({state:t,uploadKey:e,assetId:n,isCanceled:o,fileSource:r,uploadDuration:i,correlationId:s})=>{const a=t.uploads[e],c=o||a.status===b.a.CANCELED,l=a.file,d=a.url,u=a.metadata,p=a.error,h=u.mimetype||l.type,g=h.startsWith("video/"),m=a.status===b.a.SUCCESS;let f="";p?f=JSON.stringify(p):c&&(f="canceled");const S={width:u.width,height:u.height,duration:u.videoDuration&&Math.round(1e3*u.videoDuration)};Object(E.a)(Object.assign({source:g?"videoupload":"imageupload",action:"upload",correlationId:s,noun:g?"video":"image"},(t=>Object.assign({},y.defaults(t),{screen:y.screen(t),profile:y.profile(t),subreddit:y.subreddit(t)}))(t),{actionInfo:Object.assign({},y.actionInfo(t),{success:m},f?{reason:f}:{}),media:Object.assign({mimetype:h,uploadDuration:i,source:r,fileName:l.name,size:l.size,type:g?"video":"image"},n?{id:n}:{},d?{url:d}:{},S)}))};var C=n("./src/reddit/helpers/trackers/postComposer.ts"),O=n("./src/reddit/models/Toast/index.ts"),x=n("./src/reddit/selectors/postCreations.ts"),v=n("./src/reddit/selectors/user.ts"),T=n("./src/reddit/actions/postCreation/constants.ts");n.d(e,"d",function(){return R}),n.d(e,"c",function(){return I}),n.d(e,"a",function(){return A}),n.d(e,"b",function(){return K});const k=Object(c.a)(T.v),j=Object(c.a)(T.w),w=Object(c.a)(T.u),R=t=>async(e,n)=>{e(k());const o=t.map(({url:t,uploadKey:n})=>{const o=Object(f.a)(Object(f.c)(t),"poster.png");return e(I(o,n))});await Promise.all(o);const r=n().uploads,i=t.map(({uploadKey:t})=>r[t]).find(t=>t.status!==b.a.SUCCESS);e(i?w(i.error):j())},B=(t,e)=>({error:e?{type:t,fields:[{field:"",msg:e}]}:{type:t}});const I=(t,e,n,o)=>async(r,a,{apiContext:c})=>{const l=Object(x.g)(a()),y=Date.now();let E=null,O=!1,T=!1,k=!1;const j=t=>{if(!k&&n&&O){k=!0;const o=a(),r=Date.now()-y,i=Object(g.c)(g.a.PostComposer);T?S({state:o,uploadKey:e,assetId:E,isCanceled:t,fileSource:n,uploadDuration:r,correlationId:i}):C.p(o,e)}};e.startsWith(b.b.RTE_MEDIA);await r(Object(d.k)(t,e,async g=>{O=!0,Object(d.j)(g.id,()=>{j(!0)});var b=await async function(t,e,n,o){const r=Object(v.R)(t),a=n&&n.allowedPostTypes,c=n&&n.name,l=await Object(f.g)(e)||e.type,d=Object(f.b)(e)||void 0;if(!d)return B("UNSUPPORTED_BROWSER");const u={localUrl:d,mimetype:l};if(!l||!Object(f.i)(l))return{error:{type:s.L}};if(l.startsWith("image/")){if(a&&!a.images){const t=Object(i.a)(r,"postCreation.mediaInput.imagesAreNotAllowed",{subredditName:c});return B(s.L,t)}if("image/gif"===l){if(e.size>s.Q)return B(s.G)}else if(e.size>s.S)return B(s.J);const t=await Object(m.a)(d);u.width=t.width,u.height=t.height}else if(l.startsWith("video/")){if(e.size>s.X)return B(s.Tb);let t;try{t=await Object(f.h)(d,!0)}catch(p){return B(s.L)}if(a){const e=a.videos,n=a.images;if(n&&!e&&t.duration>s.Y){const t=Object(i.a)(r,"postCreation.mediaInput.videoTooLongForImageOnlySubreddit",{subredditName:c});return B(s.L,t)}if(!n&&!e){const t=Object(i.a)(r,"postCreation.mediaInput.videosAreNotAllowed",{subredditName:c});return B(s.L,t)}}if(t.duration>s.W){const t=Object(i.a)(r,"postCreation.mediaInput.videoTooLongInGeneral");return B(s.L,t)}u.height=t.height,u.width=t.width,u.videoDuration=t.duration,u.videoFirstFrameUrl=t.firstFrame.dataUrl}return{metadata:u}}(a(),t,l);const y=b.error,S=b.metadata;if(y||!S)return{error:y};r(Object(d.l)({key:e,metadata:Object.assign({fileSource:n},S)})),T=!0,o&&o();const C=t.name,x=await(async(t,e,n)=>Object(u.b)(Object(p.a)(t,[h.a]),{endpoint:`${t.apiUrl}/api/media/asset.json`,method:s.ab.POST,data:{filepath:e,mimetype:n}}))(c(),C,S.mimetype);if(!x.ok)return{error:x.error||void 0};E=x.body.asset.asset_id;const k=x.body.asset.websocket_url;return{uploadLease:x.body.args,websocketUrl:k}},!0)),j(!1)},A=t=>async(e,n,{apiContext:o})=>{const r=n().uploads[t];r&&!Object(b.d)(r)&&await e(I(r.file,r.key,r.metadata.fileSource))},K=(t,e,n)=>async(o,s)=>{const c=t.map((t,i)=>new Promise(async i=>{const s=Object(b.e)(b.b.RTE_MEDIA,`${n}-${r()().slice(-6)}`);await o(I(t,s,e,()=>i(s))),i(s)})),d=await Promise.all(c);o(((t,e=3)=>async(n,o)=>{var r=o();const s=r.uploads,c=r.user.language,d=t.map(t=>s[t]).filter(t=>t.status===b.a.FAILED&&!t.metadata.mimetype).map(t=>t.error),u=d.length>e?e-1:d.length,p=d.length-u;d.slice(0,u).forEach(t=>n(Object(l.e)({duration:l.a,kind:O.b.Error,text:Object(a.a)(c,t)}))),p>0&&n(Object(l.e)({duration:l.a,kind:O.b.Error,text:Object(i.c)(c,"postCreation.cannotAddFiles",p)}))})(d))}},"./src/reddit/components/MakeGifToggle/index.m.less":function(t,e,n){t.exports={container:"_1iRy5EPCLqSx8I0k9OT0wW",content:"NfjQg3srQXRhyOxLBwXrS",toggleSwitch:"_1fUmirx6e9tUDs04TQq6A1",mCompactSwitch:"_3Cx_YBpXo1s1iy7oA-4s6R",mDisabled:"_1M5N6DrrQQCQJs3JctDSu8",hoverTooltip:"_9qS60cx9uxyt1k4eZF_0w",tooltipContentClass:"_21DP8j-B-UkVKGJONbrTmX"}},"./src/reddit/components/MakeGifToggle/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/react/index.js"),r=n.n(o),i=n("./src/lib/classNames/index.ts"),s=n("./src/reddit/components/RichTextEditor/HoverTooltip/index.tsx"),a=n("./src/reddit/controls/ToggleSwitch/index.tsx"),c=n("./src/reddit/i18n/utils.ts"),l=n("./src/reddit/layout/row/Inline/index.tsx"),d=n("./src/reddit/components/MakeGifToggle/index.m.less"),u=n.n(d);e.a=(t=>r.a.createElement(l.a,{className:Object(i.a)(u.a.container,t.disabled?u.a.mDisabled:null,t.isCompact?u.a.mCompactSwitch:null),onMouseDown:t=>t.preventDefault(),onClick:e=>{e.stopPropagation(),!t.disabled&&t.onClick()}},r.a.createElement(l.a,{className:u.a.content},r.a.createElement(a.a,{className:u.a.toggleSwitch,on:t.on}),r.a.createElement("label",null,Object(c.c)("Make GIF"))),t.tooltip?r.a.createElement(s.a,{className:u.a.hoverTooltip,tooltipContentClass:u.a.tooltipContentClass,text:t.tooltip}):null))},"./src/reddit/components/PostCreationForm/DivButton/index.m.less":function(t,e,n){t.exports={button:"ypAk-GyDXsczk_xkC7Eq_",disabled:"_3hBIa9WhGl-wxARDDgBvSE"}},"./src/reddit/components/PostCreationForm/DivButton/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/react/index.js"),r=n.n(o),i=n("./src/lib/classNames/index.ts"),s=n("./src/reddit/constants/keycodes.ts"),a=n("./src/reddit/components/PostCreationForm/DivButton/index.m.less"),c=n.n(a),l=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]])}return n};const d=(t,e,n)=>{!e&&n&&n(t)},u=(t,e,n)=>{e||(n&&n(t),t.defaultPrevented||t.which!==s.a.Enter&&t.which!==s.a.Space||t.currentTarget.click())};e.a=(t=>{var e=t.className,n=t.disabled,o=t.onClick,s=t.onKeyPress,a=t.setRef,p=t.tabIndex,h=l(t,["className","disabled","onClick","onKeyPress","setRef","tabIndex"]);return r.a.createElement("div",Object.assign({"aria-disabled":!!n,className:Object(i.a)(e,c.a.button,n?c.a.disabled:null),onClick:t=>d(t,n,o),onKeyPress:t=>u(t,n,s),role:"button",ref:a,tabIndex:p||0},h))})},"./src/reddit/components/ProgressBar/index.m.less":function(t,e,n){t.exports={innerBar:"Db3WJFTcyAR-IM0cIkpDG",outerBar:"i8kQtxHYBB8Sb3bPI4M_e"}},"./src/reddit/components/ProgressBar/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/react/index.js"),r=n.n(o),i=n("./src/lib/classNames/index.ts"),s=n("./src/reddit/components/ProgressBar/index.m.less"),a=n.n(s);e.a=(({className:t,innerBarClassName:e,percent:n})=>r.a.createElement("div",{className:Object(i.a)(a.a.outerBar,t)},r.a.createElement("div",{className:Object(i.a)(a.a.innerBar,e),style:{width:`${n.toFixed(2)}%`}})))},"./src/reddit/components/RichTextEditor/Blockquote/index.m.less":function(t,e,n){t.exports={BlockQuoteWrapper:"_3bqfSxMWo3yWv7j4N8hQy6",blockQuoteWrapper:"_3bqfSxMWo3yWv7j4N8hQy6"}},"./src/reddit/components/RichTextEditor/CodeBlock/index.m.less":function(t,e,n){t.exports={CodeBlockWrapper:"_2YrwxhRxsXvszOhYWDUhMh",codeBlockWrapper:"_2YrwxhRxsXvszOhYWDUhMh"}},"./src/reddit/components/RichTextEditor/DragController/helpers.ts":function(t,e,n){"use strict";var o=n("./node_modules/lodash/includes.js"),r=n.n(o);var i=n("./src/reddit/helpers/dom/index.ts"),s=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts");n.d(e,"b",function(){return h}),n.d(e,"c",function(){return g}),n.d(e,"a",function(){return m});const a=t=>t.className.indexOf("public-DraftEditor-content")>=0,c=t=>!!t.parentElement&&!!t.parentElement.parentElement&&a(t.parentElement.parentElement),l=t=>!(!t.dataset.block||!t.dataset.offsetKey),d=t=>{const e=t.dataset.offsetKey;return e?(t=>t.split("-")[0])(e):""},u=(t,e)=>{return((t,e)=>{const n=function(t,e){let n=0,o=t.length-1;for(;n<=o;){const r=o+n>>1,i=e(t[r]);if(i>0)n=r+1;else{if(!(i<0))return r;o=r-1}}return n}(t,t=>{const n=t.getBoundingClientRect();return e<n.top?-1:e>n.bottom?1:0});return t[Math.min(n,t.length-1)]})(t.querySelectorAll("[data-block][data-offset-key]"),e)},p=(t,e)=>{const n=Object(i.b)(t,l,a);return n||u(t,e)},h=(t,e)=>{const n=(t=>{const e=t.target;if(!(e instanceof HTMLElement))return;const n=Object(i.b)(e,a);if(!n)return;const o=p(e,t.clientY);if(!o)return;const r=Object(i.b)(o,c);return r?{editorContentElement:n,topLevelElement:r,blockElement:o}:void 0})(e);if(!n)return;const o=n.topLevelElement,r=n.blockElement,l=d(r),u=t.getCurrentContent(),h=u.getBlockForKey(l);if(!h)return;var g=((t,e,n,o)=>{let r=n,i=n;if(t.getType()===s.b.UNSTYLED)r=i=e;else if(Object(s.o)(t.getType())){r=i=e;const a=o.getBlockAfter(t.getKey());a&&Object(s.u)(a.getType())&&(i=n.nextElementSibling)}else Object(s.u)(t.getType())&&(r=n.previousElementSibling,i=e);return{upperElement:r,lowerElement:i}})(h,r,o,u);const m=g.upperElement,f=g.lowerElement;var b=((t,e,n)=>{const o=t.getBoundingClientRect(),r=e.getBoundingClientRect();let s,c;if(n>(o.top+r.bottom)/2){s=r.bottom,c=!1;const t=Object(i.b)(e,t=>!!t.nextElementSibling,a);t&&(s=(t.nextElementSibling.getBoundingClientRect().top+r.bottom)/2)}else{s=o.top,c=!0;const e=Object(i.b)(t,t=>!!t.previousElementSibling,a);e&&(s=(e.previousElementSibling.getBoundingClientRect().bottom+o.top)/2)}return{clientY:s,isBefore:c}})(m,f,e.clientY);const y=b.clientY,E=b.isBefore;let S=l;if(h.getType()!==s.b.UNSTYLED){const t=p(E?m:f,y);t&&(S=d(t))}return{clientY:y,isBefore:E,blockKey:S}},g=t=>t.items?!!Array.from(t.items).find(t=>"file"===t.kind):!(!t.files||!t.files.length)||r()(t.types,"Files"),m=t=>t.items?Array.from(t.items).map(t=>"file"===t.kind?t.getAsFile():null).filter(Boolean):t.files?Array.from(t.files):[]},"./src/reddit/components/RichTextEditor/DragController/index.m.less":function(t,e,n){t.exports={container:"_13Sj3UMDKkCCJTq88berCB",hideCaret:"_2BqK1CuzH2oWi2F9_cuFPQ",DropLine:"z5iuD3MVYcfS7tTihbvof",dropLine:"z5iuD3MVYcfS7tTihbvof",Tooltip:"_1z9S1KmnM79xn-UA0FnbP6",tooltip:"_1z9S1KmnM79xn-UA0FnbP6"}},"./src/reddit/components/RichTextEditor/HoverTooltip/index.m.less":function(t,e,n){t.exports={tooltip:"ki2VbfBhU-qxg1S6VyET6",above:"_8fNGSBGvr1Ds8PbrsUGzN",below:"_38gWvHp3NJkR5r5ftUfbFG",HoverTooltip:"Nb7NCPTlQuxN_WDPUg5Q2",hoverTooltip:"Nb7NCPTlQuxN_WDPUg5Q2"}},"./src/reddit/components/RichTextEditor/HoverTooltip/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/react/index.js"),r=n.n(o),i=n("./src/lib/classNames/index.ts"),s=n("./src/lib/lessComponent.tsx"),a=n("./src/reddit/components/RichTextEditor/HoverTooltip/index.m.less"),c=n.n(a),l=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]])}return n};e.a=s.a.wrapped(t=>{const e=t.children,n=t.className,o=t.renderBelow,s=t.text,a=t.tooltipContentClass,d=l(t,["children","className","renderBelow","text","tooltipContentClass"]);return r.a.createElement("div",Object.assign({},d,{className:Object(i.a)(c.a.container,n)}),s?r.a.createElement("div",{className:Object(i.a)(c.a.tooltip,a,o?c.a.below:c.a.above)},s):null,e)},"HoverTooltip",c.a)},"./src/reddit/components/RichTextEditor/LinksController/LinkDetailsPopup/index.m.less":function(t,e,n){t.exports={LinkDetailsBox:"_2F28OVOVlGo6WCT2l8lHzO",linkDetailsBox:"_2F28OVOVlGo6WCT2l8lHzO",Link:"_3vJCj_aXdDc-UXA9fDK-z-",link:"_3vJCj_aXdDc-UXA9fDK-z-",LinkButton:"_1NtBcR7JgjxkWLJrk3ddD3",linkButton:"_1NtBcR7JgjxkWLJrk3ddD3"}},"./src/reddit/components/RichTextEditor/LinksController/LinkEditorPopup/index.m.less":function(t,e,n){t.exports={EditForm:"_1iFkUjPC4J8jzWrDthDpcv",editForm:"_1iFkUjPC4J8jzWrDthDpcv",LinkEditorBox:"_3HMg7pEvqliZhuStFZ241S",linkEditorBox:"_3HMg7pEvqliZhuStFZ241S",Input:"_2rXi0UvEKRcI3WdI52LAx1",input:"_2rXi0UvEKRcI3WdI52LAx1",Label:"_2olni9Ucr8-t8W62nTkY_",label:"_2olni9Ucr8-t8W62nTkY_",HintAndButtonRow:"_2qiAR3ZyDGPSr9zmqhP_5Z",hintAndButtonRow:"_2qiAR3ZyDGPSr9zmqhP_5Z",InvalidUrlHint:"pKrgYGkHvjHPFkWO-Gnko",invalidUrlHint:"pKrgYGkHvjHPFkWO-Gnko",SubmitButton:"_8a_rf-Al8VNnUQ42WlvF",submitButton:"_8a_rf-Al8VNnUQ42WlvF"}},"./src/reddit/components/RichTextEditor/OrderedList/index.m.less":function(t,e,n){t.exports={OrderedListWrapper:"_1QXegNe8bOemD558m-vc9t",orderedListWrapper:"_1QXegNe8bOemD558m-vc9t"}},"./src/reddit/components/RichTextEditor/Paragraph/index.m.less":function(t,e,n){t.exports={ParagraphWrapper:"_3LuG0YVLLHE2azRNVaKz7O",paragraphWrapper:"_3LuG0YVLLHE2azRNVaKz7O"}},"./src/reddit/components/RichTextEditor/TextRendering/index.m.less":function(t,e,n){t.exports={H1:"_15ThA3NFuzpQTnPu0I3QKj",h1:"_15ThA3NFuzpQTnPu0I3QKj",H2:"_3R5icAd6cRzwpq-yhvQUoW",h2:"_3R5icAd6cRzwpq-yhvQUoW",H3:"_3UxnA7bFPnKoS0rKMO1UYe",h3:"_3UxnA7bFPnKoS0rKMO1UYe",H4:"_10CFPbxVR0HQhyRBkeExmO",h4:"_10CFPbxVR0HQhyRBkeExmO",H5:"_3bidJE2WceaRjyBA8LLfp3",h5:"_3bidJE2WceaRjyBA8LLfp3",H6:"_27N6aQ0-d-ntRM1JkDwGg7",h6:"_27N6aQ0-d-ntRM1JkDwGg7"}},"./src/reddit/components/RichTextEditor/Toolbar/FormatterButton/index.m.less":function(t,e,n){t.exports={FormatterButton:"alPx0QCb4Fws5307SrGWu",formatterButton:"alPx0QCb4Fws5307SrGWu",enabled:"_1H0LLEwUP5ys6cgxr9KhMa",active:"_32EiQr-Px2GJvCfigwwmuK"}},"./src/reddit/components/RichTextEditor/Toolbar/FormatterButton/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/react/index.js"),r=n.n(o),i=n("./src/lib/classNames/index.ts"),s=n("./src/lib/lessComponent.tsx"),a=n("./src/reddit/components/RichTextEditor/HoverTooltip/index.tsx"),c=n("./src/reddit/components/RichTextEditor/Toolbar/FormatterButton/index.m.less"),l=n.n(c);const d=t=>{t.preventDefault(),t.stopPropagation()};e.a=s.a.wrapped(t=>{const e=t.active,n=t.className,o=t.disabledTooltip;var s=t.enabled;const c=void 0===s||s,u=t.tooltip,p=t.Icon,h=t.onClick,g=t.tooltipBelow,m=t.children;return r.a.createElement("div",{"aria-label":u,"aria-selected":e,className:Object(i.a)(l.a.button,n,{[l.a.active]:!!e,[l.a.enabled]:c}),onMouseDown:d,onClick:function(t){d(t),c&&h&&h(t)},role:"button",tabIndex:-1},r.a.createElement(a.a,{text:(c?u:o)||"",tooltipContentClass:t.tooltipContentClass,renderBelow:g}),p?r.a.createElement(p,null):null,m)},"FormatterButton",l.a)},"./src/reddit/components/RichTextEditor/Toolbar/MarkdownButton/index.m.less":function(t,e,n){t.exports={LoadingIcon:"jOFrSZE7wRk_lVAP2pBvY",loadingIcon:"jOFrSZE7wRk_lVAP2pBvY",Text:"EVdFfF5K7kZFMaYpSHbLe",text:"EVdFfF5K7kZFMaYpSHbLe",Button:"_1Mg8ZhclDuQlkzEqVU21qu",button:"_1Mg8ZhclDuQlkzEqVU21qu"}},"./src/reddit/components/RichTextEditor/Toolbar/MarkdownButton/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/react/index.js"),r=n.n(o),i=n("./node_modules/react-redux/es/index.js"),s=n("./node_modules/reselect/es/index.js"),a=n("./src/app/strings/index.ts"),c=n("./src/lib/lessComponent.tsx"),l=n("./src/reddit/components/PostCreationForm/DivButton/index.tsx"),d=n("./src/reddit/controls/LoadingIcon/index.tsx"),u=n("./src/reddit/selectors/editorContent.ts"),p=n("./src/reddit/components/RichTextEditor/HoverTooltip/index.tsx"),h=n("./src/reddit/components/RichTextEditor/Toolbar/MarkdownButton/index.m.less"),g=n.n(h);const m=Object(a.e)("postCreation.toolbar.markdownMode"),f=Object(a.e)("postCreation.toolbar.switchToMarkdown"),b=c.a.wrapped(d.a,"LoadingIcon",g.a),y=c.a.span("Text",g.a),E=c.a.wrapped(l.a,"Button",g.a),S=Object(s.c)({isConverting:(t,e)=>Object(u.a)(t,e.draftKey)}),C=Object(i.b)(S);e.a=C(t=>{const e=m(t.language);return r.a.createElement(E,{"aria-label":e,tabIndex:-1,className:t.className,onClick:t.onClick},t.isConverting&&r.a.createElement(b,{sizePx:12}),!t.shouldHideTooltip&&r.a.createElement(p.a,{text:e}),r.a.createElement(y,null,f(t.language)))})},"./src/reddit/components/RichTextEditor/Toolbar/MediaInputButton/index.m.less":function(t,e,n){t.exports={ImageIcon:"_1jv-IJjyjDSSVuYe6CzeHv",imageIcon:"_1jv-IJjyjDSSVuYe6CzeHv",VideoIcon:"uo_2BSPFse-IQNQbclyKb",videoIcon:"uo_2BSPFse-IQNQbclyKb",HiddenInput:"_2keaDnXIlu9Yq2y-cC8zgu",hiddenInput:"_2keaDnXIlu9Yq2y-cC8zgu"}},"./src/reddit/components/RichTextEditor/Toolbar/formatterConfigs.m.less":function(t,e,n){t.exports={Icon:"_3UAl61hrkRAXX5JQ6m_q8R",icon:"_3UAl61hrkRAXX5JQ6m_q8R"}},"./src/reddit/components/RichTextEditor/Toolbar/formatterConfigs.tsx":function(t,e,n){"use strict";var o=n("./node_modules/react/index.js"),r=n.n(o),i=n("./src/app/strings/index.ts"),s=n("./src/lib/lessComponent.tsx"),a=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts"),c=n("./src/lib/classNames/index.ts"),l=n("./src/reddit/icons/svgs/FormattingBlockQuotes/index.m.less"),d=n.n(l);var u=t=>r.a.createElement("svg",{className:Object(c.a)(d.a.icon,t.className),style:t.style,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("polygon",{points:"8.63 4 5.36 4 2 9.8 2 16 9.2 16 9.2 9.24 6.75 9.24 8.63 4"}),r.a.createElement("polygon",{points:"15.56 9.24 17.39 4 14.16 4 10.8 9.8 10.8 16 18 16 18 9.24 15.56 9.24"})),p=n("./src/reddit/icons/svgs/FormattingBold/index.m.less"),h=n.n(p);var g=t=>r.a.createElement("svg",{className:Object(c.a)(h.a.icon,t.className),style:t.style,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("path",{d:"M12.44,9.72v0a3.07,3.07,0,0,0,2.67-3.22c0-2.84-2.42-3.46-5-3.46H4.51V17H10.4c2.61,0,5.09-1,5.09-3.86C15.49,10.91,14.14,10,12.44,9.72ZM7.54,5.38H9.85c1.65,0,2.31.61,2.31,1.7s-.74,1.68-2.35,1.68H7.54ZM10,14.65H7.54V10.95H9.89c1.7,0,2.59.61,2.59,1.83S11.72,14.65,10,14.65Z"})),m=n("./src/reddit/icons/svgs/FormattingCodeBlock/index.m.less"),f=n.n(m);var b=t=>r.a.createElement("svg",{className:Object(c.a)(f.a.icon,t.className),style:t.style,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("path",{d:"M15,2H13a1,1,0,0,0,0,2h2a1,1,0,0,1,1,1V15a1,1,0,0,1-1,1H5a1,1,0,0,1-1-1V13a1,1,0,0,0-2,0v2a3,3,0,0,0,3,3H15a3,3,0,0,0,3-3V5A3,3,0,0,0,15,2Z"}),r.a.createElement("path",{d:"M2.79,5a.71.71,0,0,0,.53-.2.74.74,0,0,0,.19-.54V4.08l0-.48H5.07V8.4H4.9a1,1,0,0,0-.69.18A.79.79,0,0,0,4,9.2a.79.79,0,0,0,.21.61A1,1,0,0,0,4.9,10H7.1a1,1,0,0,0,.69-.19A.79.79,0,0,0,8,9.2a.78.78,0,0,0-.21-.61A1,1,0,0,0,7.1,8.4H6.93V3.6H8.44l0,.48a1.19,1.19,0,0,0,.18.72.7.7,0,0,0,.56.2.75.75,0,0,0,.59-.2A1,1,0,0,0,10,4.14V4.08L9.93,2.9q0-.64-.18-.77A1.06,1.06,0,0,0,9.11,2H2.89a1.06,1.06,0,0,0-.63.13q-.16.13-.18.77L2,4.08v.06a.94.94,0,0,0,.19.65A.78.78,0,0,0,2.79,5Z"})),y=n("./src/reddit/icons/svgs/FormattingHeading/index.m.less"),E=n.n(y);var S=t=>r.a.createElement("svg",{className:Object(c.a)(E.a.icon,t.className),style:t.style,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("polygon",{points:"6.57 3 6.57 5.57 10.73 5.57 10.73 17 13.82 17 13.82 5.57 18 5.57 18 3 6.57 3"}),r.a.createElement("polygon",{points:"2 9.65 4.68 9.65 4.68 17 6.66 17 6.66 9.65 9.35 9.65 9.35 8 2 8 2 9.65"})),C=n("./src/reddit/icons/svgs/FormattingItalics/index.m.less"),O=n.n(C);var x=t=>r.a.createElement("svg",{className:Object(c.a)(O.a.icon,t.className),style:t.style,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("polygon",{points:"7.24 17 10.3 17 12.1 6.85 9.05 6.85 7.24 17"}),r.a.createElement("polygon",{points:"9.7 3 9.28 5.46 12.34 5.46 12.76 3 9.7 3"})),v=n("./src/reddit/icons/svgs/FormattingMonospace/index.m.less"),T=n.n(v);var k=t=>r.a.createElement("svg",{className:Object(c.a)(T.a.icon,t.className),style:t.style,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("path",{d:"M18.8,9.4l-3-4a1,1,0,1,0-1.6,1.2L16.75,10,14.2,13.4a1,1,0,1,0,1.6,1.2l3-4A1,1,0,0,0,18.8,9.4Z"}),r.a.createElement("path",{d:"M5.6,5.2a1,1,0,0,0-1.4.2l-3,4a1,1,0,0,0,0,1.2l3,4a1,1,0,0,0,1.6-1.2L3.25,10,5.8,6.6A1,1,0,0,0,5.6,5.2Z"}),r.a.createElement("path",{d:"M12.24,1A1,1,0,0,0,11,1.76l-4,16A1,1,0,1,0,9,18.24l4-16A1,1,0,0,0,12.24,1Z"})),j=n("./src/reddit/icons/svgs/FormattingOrderedList/index.tsx"),w=n("./src/reddit/icons/svgs/FormattingSpoiler/index.m.less"),R=n.n(w);var B=t=>r.a.createElement("svg",{className:Object(c.a)(R.a.icon,t.className),style:t.style,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("path",{d:"M10,1.5A8.5,8.5,0,1,0,18.5,10,8.51,8.51,0,0,0,10,1.5Zm.71,13-.15.12-.18.1-.18.05a.73.73,0,0,1-.2,0,1,1,0,0,1-.71-.29,1,1,0,0,1-.21-.32A1,1,0,0,1,9,13.83a1,1,0,0,1,.08-.38,1,1,0,0,1,.21-.32,1,1,0,0,1,.91-.28l.18.06.18.09.15.13a1,1,0,0,1,.29.7A1,1,0,0,1,10.71,14.54Zm-.22-3.6a.5.5,0,0,1-1,0l-1-4.67A.5.5,0,0,1,9,5.67h2a.5.5,0,0,1,.49.6Z"})),I=n("./src/reddit/icons/svgs/FormattingStrikethrough/index.m.less"),A=n.n(I);var K=t=>r.a.createElement("svg",{className:Object(c.a)(A.a.icon,t.className),style:t.style,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("path",{d:"M11.86,12a1.36,1.36,0,0,1,.7,1.19c0,1.07-1,1.59-2.42,1.59a4.12,4.12,0,0,1-3.75-2.36L4.08,13.79A6.21,6.21,0,0,0,10,17.2c3.86,0,5.55-2,5.55-4.22a4,4,0,0,0-.12-1Z"}),r.a.createElement("path",{d:"M17,9H11.61l-1.09-.31c-1.82-.51-2.85-.9-2.85-2,0-.82.71-1.39,2-1.39a4.13,4.13,0,0,1,3.41,2L15.2,5.65A6.23,6.23,0,0,0,9.69,2.8c-3,0-5,1.56-5,4.14A3.31,3.31,0,0,0,5.31,9H3a1,1,0,0,0,0,2H17a1,1,0,0,0,0-2Z"})),M=n("./src/reddit/icons/svgs/FormattingSuperscript/index.m.less"),_=n.n(M);var L=t=>r.a.createElement("svg",{className:Object(c.a)(_.a.icon,t.className),style:t.style,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("path",{d:"M6.94,3,2,17H4.83L5.9,13.89h4.75l1,3.11h3.11L9.86,3Zm-.28,8.67L8.29,6.92h0l1.6,4.75Z"}),r.a.createElement("path",{d:"M16.06,3H14.92L13,8.49h1.11l.42-1.22h1.86l.41,1.22H18ZM14.81,6.4l.64-1.86h0l.63,1.86Z"})),D=n("./src/reddit/icons/svgs/FormattingUnorderedList/index.m.less"),F=n.n(D);var N=t=>r.a.createElement("svg",{className:Object(c.a)(F.a.icon,t.className),style:t.style,viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("path",{d:"M17,9H8a1,1,0,0,0,0,2h9a1,1,0,0,0,0-2Z"}),r.a.createElement("path",{d:"M17,15H8a1,1,0,0,0,0,2h9a1,1,0,0,0,0-2Z"}),r.a.createElement("path",{d:"M8,5h9a1,1,0,0,0,0-2H8A1,1,0,0,0,8,5Z"}),r.a.createElement("path",{d:"M4.88,9.43a1.29,1.29,0,0,0-.13-.26,2.17,2.17,0,0,0-.19-.23,1.55,1.55,0,0,0-2.12,0,2.16,2.16,0,0,0-.19.23,2.2,2.2,0,0,0-.14.26A2.3,2.3,0,0,0,2,9.71,1.32,1.32,0,0,0,2,10a1.5,1.5,0,0,0,1.5,1.5,1.55,1.55,0,0,0,.57-.11A1.52,1.52,0,0,0,5,10a1.32,1.32,0,0,0,0-.29A1.27,1.27,0,0,0,4.88,9.43Z"}),r.a.createElement("path",{d:"M4.33,14.75l-.26-.14-.28-.08a1.42,1.42,0,0,0-.58,0l-.28.08-.26.14a2.16,2.16,0,0,0-.23.19A1.52,1.52,0,0,0,2,16a1.47,1.47,0,0,0,.44,1.06,1.52,1.52,0,0,0,.49.33,1.53,1.53,0,0,0,1.14,0,1.61,1.61,0,0,0,.49-.33A1.52,1.52,0,0,0,5,16a1.5,1.5,0,0,0-.44-1.06A2.06,2.06,0,0,0,4.33,14.75Z"}),r.a.createElement("path",{d:"M2.44,2.94A1.52,1.52,0,0,0,2,4a1.47,1.47,0,0,0,.44,1.06,1.59,1.59,0,0,0,.48.33,1.65,1.65,0,0,0,.58.11,1.55,1.55,0,0,0,.57-.11,1.5,1.5,0,0,0,.49-.33,1.5,1.5,0,0,0,0-2.12A1.55,1.55,0,0,0,2.44,2.94Z"})),P=n("./src/reddit/components/RichTextEditor/Toolbar/formatterConfigs.m.less"),U=n.n(P);n.d(e,"f",function(){return H}),n.d(e,"b",function(){return tt}),n.d(e,"e",function(){return et}),n.d(e,"j",function(){return nt}),n.d(e,"g",function(){return ot}),n.d(e,"i",function(){return rt}),n.d(e,"k",function(){return it}),n.d(e,"d",function(){return st}),n.d(e,"l",function(){return at}),n.d(e,"h",function(){return ct}),n.d(e,"a",function(){return lt}),n.d(e,"c",function(){return dt});const H=(t,e=0)=>n=>{const o=(t=>s.a.wrapped(t,"Icon",U.a))(t);return r.a.createElement(o,Object.assign({},n,{style:{padding:e}}))},V=H(u),z=H(g),W=H(b),q=H(S),G=H(x),Q=H(k),Y=H(j.a),J=H(B,1),Z=H(K),X=H(L),$=H(N),tt={type:"style",name:"bold",Icon:z,style:a.k.BOLD,tooltipTranslation:Object(i.e)("postCreation.toolbar.bold")},et={type:"style",name:"italics",Icon:G,style:a.k.ITALIC,tooltipTranslation:Object(i.e)("postCreation.toolbar.italics")},nt={type:"style",name:"strikethrough",Icon:Z,style:a.k.STRIKETHROUGH,tooltipTranslation:Object(i.e)("postCreation.toolbar.strikethrough")},ot={type:"style",name:"inline_code",Icon:Q,style:a.k.MONOSPACE,tooltipTranslation:Object(i.e)("postCreation.toolbar.monospace")},rt={type:"style",name:"spoiler",Icon:J,style:a.k.SPOILER,tooltipTranslation:Object(i.e)("postCreation.toolbar.spoiler")},it={type:"style",name:"superscript",Icon:X,style:a.k.SUPERSCRIPT,tooltipTranslation:Object(i.e)("postCreation.toolbar.superscript")},st={type:"block",name:"heading",Icon:q,block:a.b.H1,tooltipTranslation:Object(i.e)("postCreation.toolbar.heading")},at={type:"block",name:"unordered_list",Icon:$,block:a.i.UNORDERED,tooltipTranslation:Object(i.e)("postCreation.toolbar.unorderedList")},ct={type:"block",name:"ordered_list",Icon:Y,block:a.i.ORDERED,tooltipTranslation:Object(i.e)("postCreation.toolbar.orderedList")},lt={type:"block",name:"block_quote",Icon:V,block:a.e,tooltipTranslation:Object(i.e)("postCreation.toolbar.blockQuote")},dt={type:"block",name:"code_block",Icon:W,block:a.f,tooltipTranslation:Object(i.e)("postCreation.toolbar.codeBlock")}},"./src/reddit/components/RichTextEditor/Toolbar/index.m.less":function(t,e,n){t.exports={toolbarContent:"_2vR2-7URvDAFSwQjhcvJ7m",isSticky:"r7zyyy152ZTdiHhea0cIj",tooltip:"dMXy0l6Saub8-fPDkQvGC",SectionSpacer:"_2voJAi1L0g2QbtAFDHSOCK",sectionSpacer:"_2voJAi1L0g2QbtAFDHSOCK",Spacer:"uoedn0efWwCxoQUIxsJY3",spacer:"uoedn0efWwCxoQUIxsJY3"}},"./src/reddit/components/RichTextEditor/Toolbar/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/draft-js/lib/Draft.js"),r=n("./node_modules/react/index.js"),i=n.n(r),s=n("./src/app/strings/index.ts"),a=n("./src/lib/classNames/index.ts"),c=n("./src/lib/lessComponent.tsx"),l=n("./src/reddit/icons/svgs/FormattingHyperlink/index.tsx"),d=n("./src/reddit/icons/svgs/FormattingTable/index.m.less"),u=n.n(d);var p=t=>i.a.createElement("svg",{className:Object(a.a)(u.a.icon,t.className),viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},i.a.createElement("path",{d:"M17,2H3A1,1,0,0,0,2,3V17a1,1,0,0,0,1,1H17a1,1,0,0,0,1-1V3A1,1,0,0,0,17,2ZM4,6H9V9.8H4Zm7,0h5V9.8H11ZM4,11.8H9V16H4ZM11,16V11.8h5V16Z"})),h=n("./src/reddit/components/RichTextEditor/editorStateTransforms.ts"),g=n("./src/reddit/components/RichTextEditor/helpers/controlsState.ts"),m=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts"),f=n("./src/reddit/components/RichTextEditor/constants/editorChangeTypes.ts"),b=n("./src/reddit/components/RichTextEditor/helpers/common.ts"),y=n("./src/reddit/components/RichTextEditor/table/helpers.ts");var E=(t,e,n)=>{if(Object(m.v)(o.RichUtils.getCurrentBlockType(t)))return t;const r=t.getCurrentContent(),i=t.getSelection().getEndKey(),s=Object(y.l)(e,n),a=Object(b.f)(r,i,s,b.a.after,!0),c=o.EditorState.push(t,a,f.e);return o.EditorState.forceSelection(c,o.SelectionState.createEmpty(s[0].getKey()))},S=n("./src/reddit/components/RichTextEditor/Toolbar/FormatterButton/index.tsx"),C=n("./src/reddit/components/RichTextEditor/Toolbar/formatterConfigs.tsx"),O=n("./src/reddit/components/RichTextEditor/Toolbar/MarkdownButton/index.tsx"),x=n("./src/lib/constants/index.ts"),v=n("./src/reddit/icons/svgs/ImagePost/index.tsx"),T=n("./src/reddit/icons/svgs/Video/index.tsx"),k=n("./src/reddit/components/RichTextEditor/Toolbar/MediaInputButton/index.m.less"),j=n.n(k);const w=Object(s.e)("postCreation.toolbar.image"),R=Object(s.e)("postCreation.toolbar.video"),B=c.a.wrapped(v.a,"ImageIcon",j.a),I=c.a.wrapped(T.a,"VideoIcon",j.a),A=c.a.input("HiddenInput",j.a);class K extends r.Component{constructor(){super(...arguments),this.hiddenInputEl=null,this.onFileInputChange=(t=>{t.stopPropagation();const e=this.hiddenInputEl;e.files&&e.files.length&&(this.props.onFilesInput(Array.from(e.files)),e.value="")}),this.onButtonClick=(()=>{this.hiddenInputEl&&this.hiddenInputEl.click(),this.props.onClick()}),this.onHiddenInputClick=(t=>t.stopPropagation())}render(){var t=this.props;const e=t.controlsState,n=t.destSubreddit,o=t.language,r="image"===t.type,s=e.blocks[m.a];let a=!0;if(n&&n.allowedPostTypes){var c=n.allowedPostTypes;const t=c.images,e=c.videos;a=r?t:e}return i.a.createElement(S.a,{Icon:r?B:I,active:s.isActive,enabled:s.isEnabled&&a,tooltip:(r?w:R)(o),onClick:this.onButtonClick},i.a.createElement(A,{multiple:!0,innerRef:t=>this.hiddenInputEl=t,onChange:this.onFileInputChange,onClick:this.onHiddenInputClick,type:"file",accept:Array.from(r?x.a:x.b).join()}))}}var M=n("./src/reddit/components/RichTextEditor/Toolbar/index.m.less"),_=n.n(M);n.d(e,"c",function(){return U}),n.d(e,"g",function(){return z}),n.d(e,"f",function(){return W}),n.d(e,"h",function(){return q}),n.d(e,"e",function(){return G}),n.d(e,"a",function(){return Q}),n.d(e,"d",function(){return Y}),n.d(e,"b",function(){return J});const L=Object(s.e)("postCreation.toolbar.table"),D=Object(s.e)("postCreation.toolbar.link"),F=Object(C.f)(l.a),N=Object(C.f)(p),P=t=>i.a.createElement(S.a,Object.assign({},t,{tooltipContentClass:_.a.tooltip})),U=c.a.div("SectionSpacer",_.a),H=c.a.div("Spacer",_.a),V=(t,e,n,r,s,a)=>{const c=t.name,l=t.Icon,d=(0,t.tooltipTranslation)(a);if("style"===t.type){const o=t.style;return i.a.createElement(P,{Icon:l,active:e.styles[o].isActive,enabled:e.styles[o].isEnabled,key:c,tooltip:d,onClick:()=>{const t=Object(h.c)(o,n);r(t),s(c,((t,e)=>t.getCurrentInlineStyle().contains(e))(t,o))}})}{const a=t.block;return i.a.createElement(P,{Icon:l,active:e.blocks[a].isActive,enabled:e.blocks[a].isEnabled,key:c,tooltip:d,onClick:()=>{const t=Object(h.i)(a,n);r(t),s(c,((t,e)=>o.RichUtils.getCurrentBlockType(t)===e)(t,a))}})}},z=(t,e,n,o,r,i)=>t.map(t=>V(t,e,n,o,r,i)),W=[C.b,C.e],q=[C.j,C.g,C.k,C.i],G=[C.d,C.l,C.h,C.a,C.c],Q=t=>i.a.createElement(P,{Icon:F,active:t.controlsState.link.isActive,enabled:t.controlsState.link.isEnabled,tooltip:D(t.language),onClick:()=>{t.onLinkButtonClick(),t.trackOnClick("link",!0)}}),Y=t=>i.a.createElement(P,{Icon:N,active:t.controlsState.blocks[m.l].isActive,enabled:t.controlsState.blocks[m.l].isEnabled,tooltip:L(t.language),onClick:()=>{t.onChange(E(t.editorState,3,2)),t.trackOnClick("table",!0)}}),J=t=>{const e=t.className;var n=t.allowMediaUploads;const o=void 0!==n&&n,r=t.destSubreddit,s=t.editorState,c=t.isOverlay,l=t.language,d=t.onChange,u=t.onFilesSelect,p=t.readOnly,h=t.trackOnClick,m=t.onLinkButtonClick,f=t.onMarkdownButtonClick,b=Object(g.a)(s);return p&&Object(g.b)(b),i.a.createElement("div",{className:Object(a.a)(_.a.toolbarContent,e,{[_.a.isSticky]:!c})},z(W,b,s,d,h,l),i.a.createElement(Q,{language:l,controlsState:b,trackOnClick:h,onLinkButtonClick:m}),z(q,b,s,d,h,l),i.a.createElement(U,null),z(G,b,s,d,h,l),i.a.createElement(U,null),i.a.createElement(Y,{language:l,controlsState:b,editorState:s,trackOnClick:h,onChange:d}),o&&i.a.createElement(K,{destSubreddit:r,language:l,controlsState:b,onClick:()=>h("image_upload"),onFilesInput:u,type:"image"}),o&&i.a.createElement(K,{destSubreddit:r,language:l,controlsState:b,onClick:()=>h("video_upload"),onFilesInput:u,type:"video"}),i.a.createElement(H,null),i.a.createElement(O.a,{language:l,onClick:f}))}},"./src/reddit/components/RichTextEditor/Tooltip/getSelectionClientRect.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return r});var o=n("./node_modules/draft-js/lib/Draft.js");function r(){const t=window.getSelection();if(!t.rangeCount)return null;const e=Object(o.getVisibleSelectionRect)(window);return e||(!e&&t.focusNode&&t.focusNode===t.anchorNode?t.focusNode.getBoundingClientRect():null)}},"./src/reddit/components/RichTextEditor/Tooltip/index.m.less":function(t,e,n){t.exports={tooltipBox:"tVQ1dB4n0mAWdcQNxFq-K",triangle:"_2O2U-Vhc1mg9O7DOwp50Aa",triangleBack:"_3IfYYXUMUzn2OvoiMUNcaQ",triangleFront:"_3CtwSTtkmKXvzDo3TmCp9C",triangleBelow:"_1churYJpAwcb-tf0k1c46F"}},"./src/reddit/components/RichTextEditor/Tooltip/index.tsx":function(t,e,n){"use strict";n.d(e,"a",function(){return p}),n.d(e,"b",function(){return g});var o=n("./node_modules/react/index.js"),r=n.n(o),i=n("./src/lib/classNames/index.ts"),s=n("./src/reddit/helpers/dom/index.ts"),a=n("./src/reddit/components/RichTextEditor/Tooltip/index.m.less"),c=n.n(a);const l=8,d=16,u=15+d/2;var p;!function(t){t[t.None=0]="None",t[t.Above=1]="Above",t[t.Below=2]="Below"}(p||(p={}));const h=({isBelow:t=!1,style:e})=>r.a.createElement("div",{className:Object(i.a)(c.a.triangle,{[c.a.triangleBelow]:t}),style:e},r.a.createElement("div",{className:c.a.triangleBack}),r.a.createElement("div",{className:c.a.triangleFront}));class g extends o.Component{constructor(t){super(t),this.containerRef=null,this.updateContainerRef=(t=>this.containerRef=t),this.setTargetPosition=(t=>{t?this.updatePositioning(t):this.setState({positioning:null})}),this.state={positioning:null}}updatePositioning(t){if(!this.containerRef)return;const e=this.containerRef.offsetWidth,n=this.containerRef.offsetHeight,o=this.state.positioning;if(!t){if(!o)return;if(o.tooltipWidth===e&&o.tooltipHeight===n)return}const r=t?t.top:o.target.top,i=t?t.left:o.target.left,a=Object(s.e)(this.containerRef);let c,l;if(a){const t=a.getBoundingClientRect();c=i-t.left+a.scrollLeft,l=r-t.top+a.scrollTop}else{const t=document.documentElement,e=window.pageYOffset||t.scrollTop;c=i+(window.pageXOffset||t.scrollLeft),l=r+e}const d={target:{top:r,left:i},tooltipWidth:e,tooltipHeight:n,tooltip:{top:l,left:c}};this.adjustPositionForTriangle(d,a),this.setState({positioning:d})}adjustPositionForTriangle(t,e){const n=this.props.trianglePlacement;if(!n)return;const o=e?e.offsetWidth:document.documentElement.offsetWidth,r=o?Math.max(t.tooltip.left+t.tooltipWidth-o,0):0;t.tooltip.left-=r+u;const i=r+u-d/2;let s;n===p.Above?(t.tooltip.top+=l,s=-l):(t.tooltip.top-=t.tooltipHeight+l,s=t.tooltipHeight),t.triangle={top:s,left:i}}componentDidUpdate(t,e){t.targetPosition!==this.props.targetPosition?this.setTargetPosition(this.props.targetPosition||null):this.updatePositioning()}componentDidMount(){this.setTargetPosition(this.props.targetPosition||null),this.props.onSetPositionUpdater&&this.props.onSetPositionUpdater(this.setTargetPosition)}componentWillUnmount(){this.props.onSetPositionUpdater&&this.props.onSetPositionUpdater(null)}render(){const t=this.props.trianglePlacement,e=this.state.positioning,n=e&&void 0!==e.triangle&&r.a.createElement(h,{isBelow:t===p.Below,style:{top:e.triangle.top+"px",left:e.triangle.left+"px"}});return r.a.createElement("div",{className:Object(i.a)(c.a.tooltipBox,this.props.className),style:e?{left:e.tooltip.left,top:e.tooltip.top}:{},ref:this.updateContainerRef},e&&this.props.children&&r.a.createElement(r.a.Fragment,null,n,this.props.children))}}},"./src/reddit/components/RichTextEditor/UnorderedList/index.m.less":function(t,e,n){t.exports={UnorderedListWrapper:"vXDC2CysyRNVq3lFirKDs",unorderedListWrapper:"vXDC2CysyRNVq3lFirKDs"}},"./src/reddit/components/RichTextEditor/constants/draftEditorCommands.ts":function(t,e,n){"use strict";n.d(e,"c",function(){return o}),n.d(e,"e",function(){return r}),n.d(e,"g",function(){return i}),n.d(e,"h",function(){return s}),n.d(e,"b",function(){return a}),n.d(e,"d",function(){return c}),n.d(e,"f",function(){return l}),n.d(e,"a",function(){return d});const o="bold",r="italic",i="underline",s="undo",a="backspace",c="delete",l="split-block",d="adjust-depth"},"./src/reddit/components/RichTextEditor/constants/editorChangeTypes.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return o}),n.d(e,"e",function(){return r}),n.d(e,"d",function(){return i}),n.d(e,"b",function(){return s}),n.d(e,"c",function(){return a}),n.d(e,"f",function(){return c});const o="backspace-character",r="insert-fragment",i="insert-characters",s="change-block-data",a="change-block-type",c="remove-range"},"./src/reddit/components/RichTextEditor/editorStateTransforms.ts":function(t,e,n){"use strict";n.d(e,"c",function(){return u}),n.d(e,"i",function(){return p}),n.d(e,"b",function(){return m}),n.d(e,"f",function(){return f}),n.d(e,"h",function(){return b}),n.d(e,"g",function(){return y}),n.d(e,"d",function(){return E}),n.d(e,"e",function(){return S}),n.d(e,"a",function(){return C});var o=n("./node_modules/draft-js/lib/Draft.js"),r=n("./node_modules/immutable/dist/immutable.js"),i=n("./src/reddit/components/RichTextEditor/constants/draftEditorCommands.ts"),s=n("./src/reddit/components/RichTextEditor/constants/editorChangeTypes.ts"),a=n("./src/reddit/components/RichTextEditor/emotes/helpers.ts"),c=n("./src/reddit/components/RichTextEditor/helpers/modifiers.ts"),l=n("./src/reddit/components/RichTextEditor/helpers/styles.ts"),d=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts");const u=(t,e)=>{return e.getSelection().isCollapsed()?Object(l.a)(t,e):Object(l.b)(t,e)},p=(t,e)=>{const n=e.getCurrentContent(),r=e.getSelection(),i=r.getEndKey(),c=o.RichUtils.getCurrentBlockType(e)===t?d.n:t;let u=e,p=o.Modifier.setBlockType(n,r,c);const h=n.getBlockForKey(i).getLength();if(Object(d.r)(c)||Object(d.q)(c)){const t=o.SelectionState.createEmpty(r.getStartKey()).merge({focusKey:r.getEndKey(),focusOffset:h});u=Object(l.c)(u),p=((t,e)=>{const n=Object.keys(d.k).reduce((t,n)=>o.Modifier.removeInlineStyle(t,e,d.k[n]),t);return Object(a.h)(n,e)})(p,t)}if(Object(d.q)(c)||Object(d.p)(c)){const t=p.getBlockAfter(i);if(!t||t.getType()!==c&&t.getType()!==d.n){const t=o.SelectionState.createEmpty(i).merge({anchorOffset:h,focusOffset:h});p=o.Modifier.splitBlock(p,t),p=o.Modifier.setBlockType(p,p.getSelectionAfter(),d.n)}}return p=p.merge({selectionAfter:r}),o.EditorState.push(u,p,s.c)},h=(t,e)=>{const n=o.Modifier.setBlockType(t,e,d.n);return o.Modifier.replaceText(n,e,"",Object(r.OrderedSet)([]))},g=(t,e)=>o.EditorState.forceSelection(t,o.SelectionState.createEmpty(e)),m=t=>{const e=t.getCurrentContent(),n=t.getSelection(),i=c.d(e,n),a=i.getBlockAfter(n.getEndKey()),l=o.SelectionState.createEmpty(a.getKey()),u=o.Modifier.replaceText(o.Modifier.setBlockType(i,l,d.n),l,"",Object(r.OrderedSet)([])),p=o.EditorState.push(t,u,s.d);return g(p,a.getKey())},f=t=>{const e=t.getCurrentContent(),n=t.getSelection(),r=e.getBlockForKey(n.getEndKey()),s=r.set("depth",Math.max(r.getDepth()-1,0)),a=e.merge({blockMap:e.getBlockMap().merge({[r.getKey()]:s})});return o.EditorState.push(t,a,i.a)},b=t=>{const e=t.getCurrentContent(),n=t.getSelection(),r=e.getBlockForKey(n.getEndKey()).getKey(),i=o.EditorState.push(t,h(e,n),s.c);return g(i,r)},y=t=>{const e=t.getCurrentContent(),n=t.getSelection(),r=e.getBlockForKey(n.getEndKey()),i=r.getKey(),a=e.getBlockBefore(i).getKey(),c=o.SelectionState.createEmpty(i).merge({focusOffset:r.getText().length}),l=o.EditorState.push(t,h(((t,e)=>{const n=t.getBlockMap().remove(e);return t.merge({blockMap:n})})(e,a),c),s.c);return g(l,i)},E=t=>{const e=c.d(t.getCurrentContent(),t.getSelection());return o.EditorState.push(t,e,i.f)},S=t=>{const e=c.a(t.getCurrentContent(),t.getSelection(),"\n");return o.EditorState.push(t,e,s.d)},C=t=>{const e=t.getSelection(),n=c.a(t.getCurrentContent(),e," ");return o.EditorState.push(t,n,s.d)}},"./src/reddit/components/RichTextEditor/emotes/decorator.m.less":function(t,e,n){t.exports={emote:"Q7hqnjoPSXm7QyvW8qf57",sticker:"_1WD0TSe2_gY29FXmFjPCza"}},"./src/reddit/components/RichTextEditor/emotes/helpers.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return p}),n.d(e,"c",function(){return h}),n.d(e,"g",function(){return g}),n.d(e,"b",function(){return m}),n.d(e,"h",function(){return f}),n.d(e,"f",function(){return b}),n.d(e,"e",function(){return y}),n.d(e,"i",function(){return E}),n.d(e,"d",function(){return S});var o=n("./node_modules/draft-js/lib/Draft.js"),r=n("./node_modules/immutable/dist/immutable.js"),i=n("./src/lib/memoizeByReference/index.ts"),s=n("./src/reddit/components/RichTextEditor/constants/editorChangeTypes.ts"),a=n("./src/reddit/components/RichTextEditor/entity/entityTypes.ts"),c=n("./src/reddit/components/RichTextEditor/entity/getAllEntitiesInSelection.ts"),l=n("./src/reddit/components/RichTextEditor/helpers/common.ts"),d=n("./src/reddit/components/RichTextEditor/helpers/modifiers.ts"),u=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts");const p="⬛";function h(t,e){return t.createEntity(a.a.EMOTE,"IMMUTABLE",e)}function g(t,e){let n=e.getCurrentContent();const r=(n=h(n,t)).getLastCreatedEntityKey();n=Object(d.b)(n,e.getSelection(),p,void 0,r);const i=o.EditorState.push(e,n,s.d);return o.EditorState.forceSelection(i,i.getSelection())}function m(t,e){if(e.getStartKey()!==e.getEndKey())return!1;const n=t.getBlockForKey(e.getEndKey()).getType();return!(Object(u.q)(n)||Object(u.r)(n)||Object(u.t)(n))}function f(t,e){const n=Object(c.a)(t,e,e=>{const n=e.getEntity();return!!n&&t.getEntity(n).getType()===a.a.EMOTE});let r;for(;r=n.pop();){const e=o.SelectionState.createEmpty(r.blockKey).merge({anchorOffset:r.start,focusOffset:r.end});t=o.Modifier.removeRange(t,e,"backward")}return t}function b(t){const e=t.getSelection();if(!e.isCollapsed())return null;const n=t.getCurrentContent().getBlockForKey(e.getFocusKey()),o=n.getText(),r=n.getCharacterList();let i=e.getFocusOffset()-1;const s=[];for(;i>=0;){const t=o[i],e=r.get(i),n=e&&e.getEntity();if(!t.trim().length||n)return null;if(":"===t&&s.length>0)break;s.unshift(t),i--}return i>=0&&s.length?s.join("").toLowerCase():null}function y(t,e,n){t.findEntityRanges(t=>{const e=t.getEntity();return!!e&&n.getEntity(e).getType()===a.a.EMOTE},e)}const E=Object(i.a)(t=>{if(t.getBlockMap().size>1)return!1;const e=t.getFirstBlock();let n=0;return y(e,()=>n++,t),n<=3&&n===e.getLength()});function S(t,e){if(E(t.getCurrentContent())===E(e.getCurrentContent()))return t;const n=t.getCurrentContent(),i=n.getFirstBlock();return o.EditorState.set(t,{currentContent:o.Modifier.mergeBlockData(n,Object(l.b)(i),Object(r.Map)({_emote_modified:new Date}))})}},"./src/reddit/components/RichTextEditor/entity/applyEntityToContentBlock.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return r});var o=n("./node_modules/draft-js/lib/Draft.js");function r(t,e,n,r){let i=t.getCharacterList();return i=i.withMutations(t=>{for(let i=e;i<n;i++)t.set(i,o.CharacterMetadata.applyEntity(t.get(i),r))}),t.set("characterList",i)}},"./src/reddit/components/RichTextEditor/entity/cloneEntitiesInFragment.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return i}),n.d(e,"b",function(){return s});var o=n("./src/reddit/components/RichTextEditor/entity/applyEntityToContentBlock.ts"),r=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(c){r=!0,i=c}finally{try{!o&&a.return&&a.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function i(t,e,n,r,i){const s=t.createEntity(n.getType(),n.getMutability(),n.getData()),a=t.getLastCreatedEntityKey();return[s,Object(o.a)(e,r,i,a)]}function s(t,e,n=!1){const o=new Map;let s=e,a=t;return e.forEach((t,e)=>{t&&e&&t.findEntityRanges(t=>!!t.getEntity(),(n,r)=>{const i=t.getEntityAt(n),s=o.get(i)||[];s.push({start:n,end:r,blockKey:e}),o.set(i,s)})}),o.forEach((e,o)=>{const c=t.getEntity(o);(n?e.slice(1):e).forEach(({start:t,end:e,blockKey:n})=>{const o=s.get(n);var l=i(a,o,c,t,e),d=r(l,2);const u=d[0],p=d[1];a=u,s=s.set(n,p)})}),[a,s]}},"./src/reddit/components/RichTextEditor/entity/entityTypes.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return o}),n.d(e,"b",function(){return i});const o={COMMENT_LINK:"COMMENT_LINK",EMOTE:"EMOTE",LINK:"LINK",POST_LINK:"POST_LINK",SUBREDDIT_LINK:"SUBREDDIT_LINK",USER_LINK:"USER_LINK"},r=new Set([o.COMMENT_LINK,o.LINK,o.POST_LINK,o.SUBREDDIT_LINK,o.USER_LINK]),i=(t,e)=>{const n=t&&e.getEntity(t);return!!n&&(t=>r.has(t))(n.getType())}},"./src/reddit/components/RichTextEditor/entity/getAllEntitiesInSelection.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return r});var o=n("./src/reddit/components/RichTextEditor/helpers/forEachBlock.ts");function r(t,e,n){const r=[];return Object(o.a)(t,e,(t,o)=>{const i=e.getStartKey()===o?e.getStartOffset():0,s=e.getEndKey()===o?e.getEndOffset():t.getLength();t.findEntityRanges(n,(e,n)=>{i<=n&&s>=e&&r.push({blockKey:o,entityKey:t.getEntityAt(e),start:e,end:n})})}),r}},"./src/reddit/components/RichTextEditor/entity/getSelectionEntityInfo.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return r});var o=n("./node_modules/draft-js/lib/Draft.js");function r(t,e){const n=e.getFocusKey();if(n!==e.getAnchorKey())return;const r=t.getBlockForKey(n),i=e.getStartOffset(),s=e.getEndOffset(),a=r.getEntityAt(s)||(s>0?r.getEntityAt(s-1):null);if(!a)return;let c,l;if(r.findEntityRanges(t=>t.getEntity()===a,(t,e)=>{t<=i&&s<=e&&(c=t,l=e)}),"number"!=typeof c||"number"!=typeof l)return;const d=r.getText().slice(c,l);return{entitySelection:o.SelectionState.createEmpty(n).merge({anchorOffset:c,focusOffset:l}),entityKey:a,entityText:d}}},"./src/reddit/components/RichTextEditor/entity/link/decorator.m.less":function(t,e,n){t.exports={RegularLink:"_1FRfMxEAy__7c8vezYv9qP",regularLink:"_1FRfMxEAy__7c8vezYv9qP"}},"./src/reddit/components/RichTextEditor/entity/link/helpers.tsx":function(t,e,n){"use strict";n.d(e,"a",function(){return h}),n.d(e,"d",function(){return g}),n.d(e,"f",function(){return m}),n.d(e,"b",function(){return f}),n.d(e,"c",function(){return b}),n.d(e,"h",function(){return y}),n.d(e,"g",function(){return E}),n.d(e,"e",function(){return S});var o=n("./node_modules/draft-js/lib/Draft.js"),r=n("./src/lib/linkMatchers/index.ts"),i=n("./src/lib/linkMatchers/customLinks.ts"),s=n("./src/lib/memoizeByReference/index.ts"),a=n("./src/reddit/components/RichTextEditor/spoiler/helpers.ts"),c=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts"),l=n("./src/reddit/components/RichTextEditor/entity/entityTypes.ts"),d=n("./src/reddit/components/RichTextEditor/entity/getAllEntitiesInSelection.ts"),u=n("./src/reddit/components/RichTextEditor/entity/getSelectionEntityInfo.ts");const p=t=>`/r/${t}/`;function h(t,e,n){t.findEntityRanges(t=>{const e=t.getEntity();if(!e)return!1;const o=n.getEntity(e).getType();return o===l.a.LINK||o===l.a.SUBREDDIT_LINK||o===l.a.USER_LINK},e)}const g=Object(s.a)(function(t){const e=t.getCurrentContent(),n=t.getSelection();if(!n.isCollapsed())return;if(Object(c.q)(e.getBlockForKey(n.getStartKey()).getType()))return;const i=n.getFocusKey(),s=e.getBlockForKey(i),l=n.getFocusOffset(),d=s.getText(),u=d.lastIndexOf(" ",l-1)+1,p=d.slice(u,l);if(!p)return;const h=r.c.match(p);if(!h)return;const g=h[h.length-1],m=u+g.index,f=u+g.lastIndex;let b=-1;if(s.findEntityRanges(t=>!!t.getEntity(),(t,e)=>{t<l&&(b=e)}),b>=m)return;return s.getCharacterList().slice(m,f).find(a.b)?void 0:{selection:o.SelectionState.createEmpty(i).merge({anchorOffset:m,focusOffset:f}),url:g.url}});function m(t,e,n){const r=t.getSelection();let i=t.getCurrentContent();const s=(i=i.createEntity(l.a.LINK,"MUTABLE",{url:n})).getLastCreatedEntityKey();return i=(i=o.Modifier.applyEntity(i,e,s)).merge({selectionAfter:r}),o.EditorState.push(t,i,"apply-entity")}const f=Object(s.a)(function(t){const e=t.getCurrentContent(),n=Object(u.a)(e,t.getSelection());if(!n)return;const o=e.getEntity(n.entityKey);if(o.getType()!==l.a.LINK)return;const r=o.getData().url;return Object.assign({url:r},n)});const b=Object(s.a)(function(t){const e=t.getCurrentContent(),n=t.getSelection(),o=Object(u.a)(e,n);if(!o)return;const r=n.getFocusOffset(),s=e.getEntity(o.entityKey),a=("/"===o.entityText[0]?"/":"")+i.e;if(s.getType()!==l.a.SUBREDDIT_LINK||!o.entityText.startsWith(a)||r-o.entitySelection.getStartOffset()<a.length)return;const c=o.entityText.slice(a.length);return Object.assign({subredditName:c},o)});function y(t,e,n,r){let i="apply-entity",s=t.getCurrentContent(),a=t;const c=Object(u.a)(s,e);if(n)if(c){s.getEntity(c.entityKey).getData().url!==n&&(s=s.mergeEntityData(c.entityKey,{url:n})),void 0!==r&&c.entityText!==r&&(s=o.Modifier.replaceText(s,c.entitySelection,r,void 0,c.entityKey),i="insert-characters")}else{if(void 0===r)throw new Error("New link display text must be provided!");const t=(s=s.createEntity(l.a.LINK,"MUTABLE",{url:n})).getLastCreatedEntityKey();s=o.Modifier.replaceText(s,e,r,void 0,t),i="insert-characters"}else s=(s=o.Modifier.applyEntity(s,e,"")).merge({selectionAfter:t.getSelection()});return s===t.getCurrentContent()?t:a=o.EditorState.push(a,s,i)}function E(t,e){const n=b(t);if(!n)return t;const r=`${"/"===n.entityText[0]?"/":""}${i.e}${e}`,s=p(e),a=n.entitySelection.getStartOffset()+r.length;let c=y(t,n.entitySelection,s,r);return c=o.EditorState.forceSelection(c,n.entitySelection.merge({anchorOffset:a,focusOffset:a}))}function S(t,e){if(e.getStartKey()!==e.getEndKey())return!1;const n=t.getBlockForKey(e.getEndKey()).getType();return!Object(c.q)(n)&&!Object(c.t)(n)&&!Object(d.a)(t,e,e=>{const n=e.getEntity();return!!n&&t.getEntity(n).getType()!==l.a.LINK}).length}},"./src/reddit/components/RichTextEditor/helpers/common.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return o}),n.d(e,"h",function(){return a}),n.d(e,"e",function(){return c}),n.d(e,"c",function(){return l}),n.d(e,"f",function(){return d}),n.d(e,"b",function(){return u}),n.d(e,"i",function(){return p}),n.d(e,"d",function(){return h}),n.d(e,"g",function(){return g});var o,r=n("./node_modules/draft-js/lib/Draft.js"),i=n("./node_modules/immutable/dist/immutable.js"),s=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts");!function(t){t.before="before",t.after="after"}(o||(o={}));const a=(t,e)=>new r.ContentBlock(Object.assign({key:t||Object(r.genKey)()},e?{text:e,characterList:Object(i.List)(Object(i.Repeat)(r.CharacterMetadata.create(),e.length))}:{})),c=t=>t.props.children,l=t=>c(t).props.block,d=(t,e,n,i=o.after,c=!1,l=!1)=>{const d=[];let p=-1;if(t.getBlockMap().forEach((t,r)=>{i===o.after&&d.push(t),r===e&&(d.push(...n),p=d.length-1),i===o.before&&d.push(t)}),p>=0){if(c){const t=d[p+1];t&&t.getType()===s.n||d.splice(p+1,0,a())}if(l){const t=p-n.length,e=d[t];e&&e.getType()===s.n||d.splice(t+1,0,a())}}return t.merge({blockMap:r.BlockMapBuilder.createFromArray(d),selectionAfter:u(n[n.length-1],!1,!0)})},u=(t,e=!1,n=!1)=>{let o=r.SelectionState.createEmpty(t.getKey()).merge({hasFocus:n});return e&&(o=o.merge({anchorOffset:t.getLength(),focusOffset:t.getLength()})),o},p=(t,e)=>{let n=t.getBlockBefore(e),o=t.getBlockMap();return o.get(e)?(o=o.size>1?o.remove(e):o.set(e,a(e)),n=n||o.first(),t.merge({blockMap:o,selectionAfter:u(n,!0)})):t},h=(t,e)=>e.querySelector(`[data-block][data-offset-key="${t}-0-0"]`),g=t=>t.getType()===s.n&&!t.getText()},"./src/reddit/components/RichTextEditor/helpers/controlsState.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return m}),n.d(e,"b",function(){return f});var o=n("./node_modules/lodash/forEach.js"),r=n.n(o),i=n("./src/lib/forEachGroup/index.ts"),s=n("./src/lib/memoizeByReference/index.ts"),a=n("./src/reddit/components/RichTextEditor/emotes/helpers.ts"),c=n("./src/reddit/components/RichTextEditor/entity/link/helpers.tsx"),l=n("./src/reddit/components/RichTextEditor/media/helpers.ts"),d=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts"),u=n("./src/reddit/components/RichTextEditor/table/helpers.ts"),p=n("./src/reddit/components/RichTextEditor/helpers/forEachBlock.ts"),h=n("./src/reddit/components/RichTextEditor/helpers/styles.ts");const g=t=>{const e={};return r()(d.b,n=>e[n]={isActive:!1,isEnabled:t}),e},m=Object(s.a)(t=>{const e=t.getCurrentContent(),n=t.getSelection(),o=(t=>{const e=t.getCurrentContent(),n=t.getSelection();let o=g(!0),i=null;if(n.isCollapsed())i=e.getBlockForKey(n.getEndKey()).getType();else{let t=null;Object(p.a)(e,n,(e,n)=>{const r=e.getType();return Object(d.t)(r)?(o=g(!1),!1):(null===t&&(t=r),t!==r?(t=null,!1):void 0)}),i=t}return null!==i&&((Object(d.v)(i)||Object(d.t)(i))&&r()(o,t=>{t.isEnabled=!1}),o[i].isActive=!0),o})(t);return{giphy:{isActive:!1,isEnabled:o[d.a].isEnabled&&!Object(l.j)(e)},emote:{isActive:!1,isEnabled:Object(a.b)(e,n)},link:{isActive:!1,isEnabled:Object(c.e)(e,n)},blocks:o,styles:(t=>{const e=t.getCurrentContent(),n=t.getSelection(),o={};r()(d.k,t=>o[t]={isActive:!1,isEnabled:!1});const s=new Set(Object.keys(o));if(s.delete(d.k.HIGHLIGHT),n.isCollapsed()){const r=e.getBlockForKey(n.getEndKey()),i=r.getType();Object(d.q)(i)||Object(d.r)(i)||Object(d.t)(i)||s.forEach(t=>o[t].isEnabled=!0),t.getCurrentInlineStyle().forEach(t=>{t&&o[t]&&(o[t].isActive=!0)}),Object(u.i)(r)&&(o[d.k.BOLD]={isEnabled:!1,isActive:!1})}else Object(h.e)(e,n).forEach(t=>{s.delete(t),o[t]&&(o[t].isActive=!0,o[t].isEnabled=!0)}),Object(p.a)(e,n,(t,r)=>{if(!s.size)return!1;const a=n.getStartKey()===r?n.getStartOffset():0,c=n.getEndKey()===r?n.getEndOffset():t.getLength(),l=t.getType(),u=t.getCharacterList();Object(d.q)(l)||Object(d.r)(l)||Object(d.t)(l)||Object(i.a)(u,{start:a,end:c},(n,r,i,a)=>{const c=n.getStyle(),l=n.getEntity(),d=l?e.getEntity(l):null;if(s.forEach(e=>{const n=!o[e].isActive,r=Object(h.f)(c,t,d,e,n);r&&r!==c&&(o[e].isEnabled=!0,s.delete(e))}),!s.size)return!1})});return o})(t)}}),f=t=>{r()(t.blocks,t=>{t.isEnabled=!1}),r()(t.styles,t=>{t.isEnabled=!1}),t.link.isEnabled=!1}},"./src/reddit/components/RichTextEditor/helpers/forEachBlock.ts":function(t,e,n){"use strict";function o(t,e,n){const o=e.getStartKey(),r=e.getEndKey();if(o===r)return void n(t.getBlockForKey(o),o);let i=!1;t.getBlockMap().forEach((t,e)=>{if(e===o&&(i=!0),!i||!t||!e)return;const s=n(t,e);return e!==r&&s})}n.d(e,"a",function(){return o})},"./src/reddit/components/RichTextEditor/helpers/modifiers.ts":function(t,e,n){"use strict";var o=n("./node_modules/draft-js/lib/Draft.js"),r=n("./src/reddit/components/RichTextEditor/entity/cloneEntitiesInFragment.ts"),i=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(c){r=!0,i=c}finally{try{!o&&a.return&&a.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function s(t,e){const n=e.getStartKey();if(n!==e.getEndKey())return;const o=t.getBlockForKey(n),s=e.getStartOffset(),a=e.getEndOffset(),c=s>0?o.getEntityAt(s-1):null,l=o.getEntityAt(a);if(!c||!l||c!==l)return;const d=t.getEntity(l),u=o.getCharacterList().toSeq().skip(a).takeWhile(t=>!!t&&t.getEntity()===l).count();var p=Object(r.a)(t,o,d,a,a+u),h=i(p,2);const g=h[0],m=h[1];return g.merge({blockMap:g.getBlockMap().set(o.getKey(),m)})}function a(t,e,n){const r=s(t,e)||t;return o.Modifier.replaceWithFragment(r,e,n)}function c(t,e,n,r,i){let a=t;return-1!==n.indexOf("\n")&&(a=s(t,e)||a),o.Modifier.replaceText(a,e,n,r,i)}function l(t,e,n,r,i){let a=t;return-1!==n.indexOf("\n")&&(a=s(t,e)||a),o.Modifier.insertText(a,e,n,r,i)}function d(t,e){const n=s(t,e)||t;return o.Modifier.splitBlock(n,e)}n.d(e,"c",function(){return a}),n.d(e,"b",function(){return c}),n.d(e,"a",function(){return l}),n.d(e,"d",function(){return d})},"./src/reddit/components/RichTextEditor/helpers/sliceContiguousBlocks.ts":function(t,e,n){"use strict";var o=n("./node_modules/lodash/forEach.js"),r=n.n(o);e.a=((t,e)=>{const n=t.getBlocksAsArray(),o=e.getKey(),i=e.getType();let s=null,a=null,c=!1;if(r()(n,(t,e)=>{if(c||t.getKey()!==o||(c=!0),t.getType()===i)null===s&&(s=e),a=e;else{if(c)return!1;s=null,a=null}}),c)return a=a||0,{start:s=s||0,blocks:n.slice(s,a+1)}})},"./src/reddit/components/RichTextEditor/helpers/styles.ts":function(t,e,n){"use strict";n.d(e,"f",function(){return u}),n.d(e,"e",function(){return p}),n.d(e,"b",function(){return h}),n.d(e,"a",function(){return g}),n.d(e,"c",function(){return m}),n.d(e,"d",function(){return f});var o=n("./node_modules/draft-js/lib/Draft.js"),r=n("./node_modules/immutable/dist/immutable.js"),i=n("./src/lib/forEachGroup/index.ts"),s=n("./src/reddit/components/RichTextEditor/entity/entityTypes.ts"),a=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts"),c=n("./src/reddit/components/RichTextEditor/table/helpers.ts"),l=n("./src/reddit/components/RichTextEditor/helpers/forEachBlock.ts");const d=Object(r.OrderedSet)([]),u=(t,e,n,o,i=!0)=>{const l=e.getType();if(Object(a.q)(l)||Object(a.r)(l)||Object(a.t)(l))return;if(o===a.k.BOLD&&Object(c.i)(e))return;const u=n?n.getType():null;return(u===s.a.SUBREDDIT_LINK||u===s.a.USER_LINK)&&o!==a.k.SPOILER&&o!==a.k.MONOSPACE||u===s.a.EMOTE?void 0:o===a.k.MONOSPACE||o===a.k.SPOILER?i?Object(r.OrderedSet)([o]):d:(t.has(a.k.MONOSPACE)||t.has(a.k.SPOILER))&&i?Object(r.OrderedSet)([o]):!i||o!==a.k.SUPERSCRIPT&&o!==a.k.SUBSCRIPT?i?t.add(o):t.has(o)?t.delete(o):void 0:t.delete(a.k.SUBSCRIPT).delete(a.k.SUPERSCRIPT).add(o)},p=(t,e)=>{let n=null,o=!0;return Object(l.a)(t,e,(r,l)=>{const d=r.getType(),u=Object(c.i)(r);if(u||(o=!1),Object(a.q)(d)||Object(a.r)(d)||Object(a.t)(d))return!1;const p=e.getStartKey()===l?e.getStartOffset():0,h=e.getEndKey()===l?e.getEndOffset():r.getLength(),g=r.getCharacterList();Object(i.a)(g,{start:p,end:h},e=>{const o=e.getEntity();if(o&&t.getEntity(o).getType()===s.a.SUBREDDIT_LINK)return;let r=e.getStyle();return u&&(r=r.add(a.k.BOLD)),null===n?n=r.asMutable():n.intersect(r),!(n&&!n.size)&&void 0})}),null===n?[]:(o&&n.delete(a.k.BOLD),n.toJS())},h=(t,e)=>{const n=e.getCurrentContent(),r=e.getSelection();let s=n.getBlockMap();const c=-1===p(n,r).indexOf(t);Object(l.a)(n,r,(e,l)=>{if(!e||!l)return!1;const d=r.getStartKey()===l?r.getStartOffset():0,p=r.getEndKey()===l?r.getEndOffset():e.getLength(),h=e.getCharacterList(),g=h.withMutations(r=>{Object(i.a)(h,{start:d,end:p},(i,s,l,d)=>{const p=i.getStyle(),h=i.getEntity(),g=h?n.getEntity(h):null,m=u(p,e,g,t,c);if(m){const t=((t,e)=>o.CharacterMetadata.create({style:e,entity:e.has(a.k.SPOILER)?null:t.getEntity()}))(i,m);for(let e=l;e<d;e++)r.set(e,t)}})});if(g!==h){const t=e.set("characterList",g);s=s.set(l,t)}});const d=n.merge({blockMap:s,selectionAfter:r});return o.EditorState.push(e,d,"change-inline-style")},g=(t,e)=>{const n=e.getCurrentContent(),r=e.getSelection(),i=n.getBlockForKey(r.getStartKey()),s=i.getEntityAt(r.getStartOffset()),a=s?n.getEntity(s):null,c=e.getCurrentInlineStyle(),l=u(c,i,a,t,!c.has(t));let d=e;return l&&(d=o.EditorState.setInlineStyleOverride(d,l)),d},m=t=>o.EditorState.setInlineStyleOverride(t,d),f=(t,e)=>{const n=t.getSelection(),o=e.getSelection();return n.getStartOffset()>0||n.getFocusKey()===o.getFocusKey()||t.getCurrentInlineStyle().isEmpty()?t:m(t)}},"./src/reddit/components/RichTextEditor/index.m.less":function(t,e,n){t.exports={FocusableContent:"_3wl1bRnSzxHkKJfvqakrNI",focusableContent:"_3wl1bRnSzxHkKJfvqakrNI",editorWrapper:"_2baJGEALPiEMZpWB2iWQs7",hasInitialHeight:"_35E-zXyMmfsLI7nv_sBvFL",hasInitialMinHeight:"_18GfdTZmF2EPjYSkBDE0WI",noBorder:"HXDWn-rmYOwqGcGtz9AKm"}},"./src/reddit/components/RichTextEditor/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/draft-js/lib/Draft.js"),r=(n("./node_modules/draft-js/dist/Draft.css"),n("./node_modules/lodash/filter.js")),i=n.n(r),s=n("./node_modules/react/index.js"),a=n.n(s),c=n("./node_modules/react-redux/es/index.js"),l=n("./node_modules/reselect/es/index.js"),d=n("./node_modules/shallowequal/index.js"),u=n.n(d),p=n("./src/lib/classNames/index.ts"),h=n("./src/lib/fastdom/index.ts"),g=n("./src/lib/lessComponent.tsx"),m=n("./src/lib/logs/console.ts"),f=n("./src/telemetry/models/Media.ts"),b=n("./src/reddit/actions/economics/subredditPremium/thunkedActions.ts"),y=n("./src/reddit/actions/postCreation/mediaUpload.ts"),E=n("./src/reddit/featureFlags/index.ts"),S=n("./src/reddit/helpers/trackers/postComposer.ts"),C=n("./src/reddit/i18n/utils.ts"),O=n("./src/reddit/models/PostCreationForm/index.ts"),x=n("./src/reddit/models/Upload/index.ts"),v=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts");const T={BREAK_HEADER_ENTITY:"BREAK_HEADER_ENTITY",CONVERT_TO_LIST_ON_SPACE:"CONVERT_TO_LIST_ON_SPACE",EXEC_TABLE_ON_ENTER_HANDLER:"EXEC_TABLE_ON_ENTER_HANDLER",INSERT_LINE_BREAK:"INSERT_LINE_BREAK",LINKIFY_ON_ENTER:"LINKIFY_ON_ENTER",LINKIFY_ON_SPACE:"LINKIFY_ON_SPACE",MAKE_PLAIN_BLOCK:"MAKE_PLAIN_BLOCK",OPEN_LINK_TOOLTIP:"OPEN_LINK_TOOLTIP",REDUCE_LIST_INDENT:"REDUCE_LIST_INDENT",REMOVE_EXTRA_LIST_ITEM:"REMOVE_EXTRA_LIST_ITEM",RESET_CURRENT_AND_PREVIOUS_BLOCKS:"RESET_CURRENT_AND_PREVIOUS_BLOCKS",SUBMIT:"SUBMIT"};const k=t=>{const e=t.getCurrentContent().getBlockMap();if(e.size>2||(t=>!!t.reduce((t=0,e)=>t+e.getLength(),0))(e)||(t=>!!t.find(t=>Object(v.o)(t.getType())))(e))return null;{const n=t.getSelection();if(n.isCollapsed()&&n.getFocusKey()===e.first().getKey())return n.getFocusKey()}},j=t=>{const e=t.getCharacterList().map(t=>o.CharacterMetadata.create({entity:t.getEntity()}));return t.set("characterList",e)};var w=n("./src/reddit/components/ConfirmUserActionModal/index.tsx"),R=n("./src/reddit/components/RichTextEditor/constants/draftEditorCommands.ts"),B=n("./node_modules/lodash/escape.js"),I=n.n(B),A=n("./src/reddit/components/RichTextEditor/media/helpers.ts"),K=n("./src/reddit/components/RichTextEditor/helpers/common.ts"),M=n("./src/reddit/components/RichTextEditor/entity/entityTypes.ts"),_=n("./node_modules/immutable/dist/immutable.js"),L=n("./src/reddit/helpers/dom/index.ts"),D=n("./node_modules/lodash/chunk.js"),F=n.n(D),N=n("./node_modules/lodash/flatten.js"),P=n.n(N),U=n("./node_modules/lodash/takeWhile.js"),H=n.n(U),V=n("./src/reddit/components/RichTextEditor/helpers/modifiers.ts"),z=n("./src/reddit/components/RichTextEditor/table/helpers.ts"),W=n("./node_modules/lodash/last.js"),q=n.n(W),G=n("./src/reddit/components/RichTextEditor/constants/editorChangeTypes.ts"),Q=n("./src/reddit/components/RichTextEditor/helpers/forEachBlock.ts"),Y=n("./node_modules/lodash/find.js"),J=n.n(Y),Z=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(c){r=!0,i=c}finally{try{!o&&a.return&&a.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var X=(t,e)=>{const n=t.getSelection(),r=t.getCurrentContent(),i=r.getBlockForKey(n.getAnchorKey()),s=r.getBlockForKey(n.getFocusKey());var a=Object(z.e)(r,i,s),c=Z(a,2);const l=c[0],d=c[1];if(!l||l!==d)return t;const u=Object(z.g)(i),p=Object(z.g)(s),h=l.blocks,g=l.start,m=p.colCount,f=h.length/m;var b=Object(z.f)(u,p);const y=b.minCol,E=b.minRow,S=b.maxCol,C=b.maxRow,O=h.filter(t=>{var n=Object(z.g)(t);const o=n.rowIndex,r=n.colIndex;return"rows"===e?!(E<=o&&o<=C):!(y<=r&&r<=S)});O.sort(z.b);const x="rows"===e?m:O.length/f,v=P()(Object(z.d)(F()(O,x))),T=r.getBlocksAsArray(),k=[...T.slice(0,g),...v,...T.slice(g+h.length)],j=r.merge({blockMap:o.BlockMapBuilder.createFromArray(k)}),w={colIndex:y,rowIndex:E};let R=J()(v,t=>Object(z.h)(w,Object(z.g)(t)));R||(R=v.length?v[v.length-1]:T[g>0?g-1:0]);const B=o.SelectionState.createEmpty(R.getKey()).merge({focusOffset:R.getLength(),anchorOffset:R.getLength()});let I=o.EditorState.push(t,j,G.e);return I=o.EditorState.forceSelection(I,B)},$=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(c){r=!0,i=c}finally{try{!o&&a.return&&a.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var tt=(t,e=!1)=>{const n=t.getSelection();if(n.isCollapsed())return;if(n.getStartKey()===n.getEndKey()&&!e)return;const r=t.getCurrentContent(),i=r.getBlockForKey(n.getAnchorKey()),s=r.getBlockForKey(n.getFocusKey());var a=Object(z.e)(r,i,s),c=$(a,2);const l=c[0],d=c[1];if(!l||l!==d)return;const u={};let p=n;if(i===s){const t=Object(z.n)(s,0,n.getStartOffset()),e=Object(z.n)(s,n.getEndOffset());u[s.getKey()]=Object(z.j)(s,[t,e]),p=n}else{if(l.blocks[0].getKey()===n.getStartKey()&&q()(l.blocks).getKey()===n.getEndKey())return X(t,"rows");Object(Q.a)(r,n,(t,e)=>{u[e]=Object(z.n)(t,0,0)}),p=n.merge({anchorOffset:0,focusOffset:0})}const h=r.merge({blockMap:r.getBlockMap().merge(u),selectionAfter:p});return o.EditorState.push(t,h,G.f)},et=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(c){r=!0,i=c}finally{try{!o&&a.return&&a.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();const nt=(t,e,n,o)=>{const r=e.htmlParts;t.forEach((t,i)=>{r.push(`<${n} ${o[i]} style="margin: 0px; padding: 4px 9px; border: 1px solid rgb(229, 227, 218);">`),Et(t,e),r.push(`</${n}>`)})},ot=(t,e)=>{const n=e.editor,o=e.htmlParts,r=n.getEditorKey(),i=t[0].map(t=>{const e=Object(z.g)(t).alignment;return e?`align="${z.a[e]}"`:""});var s=function(t){return Array.isArray(t)?t:Array.from(t)}(t);const a=s[0],c=s.slice(1);o.push(`\n    <table data-editor="${r}">\n      <thead>\n        <tr>`),nt(a,e,"th",i),o.push("\n        </tr>\n      </thead>\n      <tbody>"),c.forEach(t=>{o.push("\n        <tr>"),nt(t,e,"td",i),o.push("\n        </tr>")}),o.push("\n      </tbody>\n    </table>")},rt=t=>{const e=t[0],n=t[t.length-1],o=[...t].sort(z.b);var r=Object(z.f)(Object(z.g)(e),Object(z.g)(n));const i=r.minCol,s=r.maxCol-i+1;return Object(z.d)(F()(o,s))},it=(t,e,n)=>{n?e.textParts.push(Ot(t[0],e)):((t,e)=>{const n=e.textParts;t.forEach(t=>{n.push(t.map(t=>Ot(t,e)).join(" "))})})(rt(t),e)},st=t=>{const e=t.processed,n=t.remaining,o=[];for(;n.length;){const t=n[0];if(!Object(v.v)(t.getType()))break;o.push(n.shift())}const r=!n.length&&!e.length,i=1===o.length&&r;((t,e,n)=>{n?Et(t[0],e):ot(rt(t),e)})(o,t,i),it(o,t,i),((t,e,n,o)=>{if(n)if(o){const n=t[0].merge({data:Object(_.Map)(),type:v.n});e.blocksParts=[n]}else e.blocksParts=P()(rt(t))})(o,t,r,i),e.push(...o)},at=t=>tt(t,!0),ct=(t,e,n)=>{const r=Object(v.v)(n.first().getType()),i=Object(v.v)(n.last().getType()),s=t.getBlockForKey(e.getAnchorKey()),a=t.getBlockForKey(e.getFocusKey());var c=Object(z.e)(t,s,a),l=et(c,2);const d=l[0],u=l[1];return d&&d===u?((t,e,n,r)=>{const i=Object(v.v)(r.first().getType()),s=t.getBlockForKey(e.getAnchorKey()),a=t.getBlockForKey(e.getFocusKey()),c=n.blocks,l=n.start;c.sort(z.b);let d=Object(z.g)(c[0]).colCount;const u=F()(c,d);let p=u.length;var h=Object(z.f)(Object(z.g)(s),Object(z.g)(a));const g=h.minRow,m=h.minCol,f=r.toArray();if(i){const n=H()(f,t=>Object(v.v)(t.getType()));n.sort(z.b);const r=Object(z.g)(n[0]).colCount,i=F()(n,r),s=i.length,a=g+s-1,h=m+r-1;if(n.length!==s*r)throw new Error("Invalid table fragment!");if(h>=d&&u.forEach(t=>{t.push(...Object(z.l)(h-d+1,1))}),d=u[0].length,a>=p){const t=F()(Object(z.l)(d,a-p+1),d);u.push(...t)}p=u.length;for(let t=0;t<s;t++)for(let e=0;e<r;e++){const n=g+t,o=m+e,r=i[t][e];u[n][o]=r.set("key",u[n][o].getKey())}const b=Object(z.d)(u),y=P()(b),E=t.getBlocksAsArray(),S=[...E.slice(0,l),...y,...E.slice(l+c.length)],C=Object(z.o)(e,u[g][m],u[a][h]);return t.merge({blockMap:o.BlockMapBuilder.createFromArray(S),selectionAfter:C})}{const n=u[g][m],r=Object(z.j)(n,f," ");let i=e;return e.getStartKey()!==e.getEndKey()&&(i=Object(z.o)(e,n,n)),V.c(t,i,o.BlockMapBuilder.createFromArray([r]))}})(t,e,d,n):d||u||!r&&!i?void 0:((t,e,n)=>{const r=Object(v.v)(n.first().getType()),i=Object(v.v)(n.last().getType()),s=n.toArray();r&&s.unshift(Object(K.h)()),i&&s.push(Object(K.h)());const a=o.BlockMapBuilder.createFromArray(s);return V.c(t,e,a)})(t,e,n)};var lt=n("./node_modules/draft-js/lib/removeEntitiesAtEdges.js"),dt=n.n(lt);var ut=(t,e)=>{const n=e.getStartKey(),o=e.getStartOffset(),r=e.getEndKey(),i=e.getEndOffset(),s=dt()(t,e).getBlockMap(),a=s.keySeq(),c=a.indexOf(n),l=a.indexOf(r)+1;return s.slice(c,l).map((t,e)=>{const s=t.getText(),a=t.getCharacterList();return n===r?t.merge({text:s.slice(o,i),characterList:a.slice(o,i)}):e===n?t.merge({text:s.slice(o),characterList:a.slice(o)}):e===r?t.merge({text:s.slice(0,i),characterList:a.slice(0,i)}):t})};const pt=(t,e)=>{const n={children:[],parentItem:e,type:t.getType()},o={block:t,parentList:n};return n.children.push(o),e&&(e.childrenLists=e.childrenLists||[],e.childrenLists.push(n)),{list:n,item:o}},ht=(t,e)=>{const n=t.type,o=t.children,r=e.htmlParts,i=n===v.b.ORDERED_LIST?"ol":"ul";r.push(`<${i}>`),o.forEach(t=>((t,e)=>{const n=t.block,o=t.childrenLists,r=e.htmlParts;r.push("<li>"),Et(n,e,!0),o&&o.forEach(t=>ht(t,e)),r.push("</li>")})(t,e)),r.push(`</${i}>`)},gt=(t,e)=>{t.children.forEach((t,n)=>mt(t,n,e))},mt=(t,e,n)=>{const o=t.block,r=t.childrenLists,i=n.textParts,s=" ".repeat(o.getDepth()),a=o.getType()===v.b.ORDERED_LIST?`${e+1}.`:"-",c=Ot(o,n);i.push(`${s}${a} ${c}`),r&&r.forEach(t=>gt(t,n))},ft=t=>{const e=t.remaining,n=e.shift(),o=n.getType(),r=[n];for(;e.length;){const t=e[0],n=t.getType();if(!Object(v.s)(n))break;if(t.getDepth()>0||n===v.b.UNORDERED_LIST)r.push(e.shift());else{if(n!==o)break;if(r.some(t=>t.getType()!==v.b.ORDERED_LIST))break;r.push(e.shift())}}const i=(t=>{const e=t[0],n={type:e.getType(),children:[]};let o,r=n,i=e.getDepth();return t.forEach(t=>{const e=t.getType(),n=t.getDepth();if(n>i){const e=pt(t,o);r=e.list,o=e.item,i=n}else{for(;i!==n;)r=r.parentItem?r.parentItem.parentList:r,i--;if(e===r.type)o={block:t,parentList:r},r.children.push(o);else{const e=pt(t,r.parentItem);r=e.list,o=e.item}}}),n})(r);ht(i,t),gt(i,t),t.processed.push(...r)};var bt=(t,e)=>{const n=t.toArray().filter(t=>!Object(v.t)(t.getType()));1===n.length&&n[0].getType()!==v.n&&n.push(new o.ContentBlock({key:Object(o.genKey)(),type:v.n}));const r=o.ContentState.createFromBlockArray(n),i=JSON.stringify(Object(o.convertToRaw)(r));return`<div data-reddit-rtjson="${I()(i)}">${e}</div>`};const yt=()=>!!window.clipboardData,Et=(t,e,n=!1)=>{const o=e.htmlParts,r=St(t,e);r&&r.forEach(t=>o.push(n?t.innerHTML:t.outerHTML))},St=(t,e)=>{const n=e.selection,o=e.editor,r=n.getStartKey(),i=n.getEndKey(),s=t.getKey(),a=o.refs.editor,c=Object(K.d)(s,a);return c?s===r||s===i?Object(L.c)(c):[c]:null};var Ct=(t,e,n)=>{const r=t.getCurrentContent(),i=t.getSelection(),s=wt(t)||ut(r,i);if(!s||!s.count())return;const a=s.toArray(),c={editor:e,editorState:t,selection:i,remaining:a,processed:[],htmlParts:[],textParts:[],blocksParts:[...a]};for(;c.remaining.length;){const t=c.remaining[0].getType();switch(!0){case Object(v.t)(t):jt(c);break;case Object(v.s)(t):ft(c);break;case Object(v.v)(t):st(c);break;default:xt(c)}}const l=c.textParts.join("\n"),d=(t=>Object(_.OrderedMap)(t.map(t=>{const e=Object(o.genKey)();return[e,t.set("key",e)]})))(c.blocksParts);return((t,{html:e,text:n})=>{yt()?window.clipboardData.setData("text",n):(e&&t.clipboardData.setData("text/html",e),t.clipboardData.setData("text/plain",n))})(n,{html:bt(d,c.htmlParts.join("")),text:l}),n.stopPropagation(),n.preventDefault(),e.setClipboard(d),d};const Ot=(t,e)=>{const n=t.getText(),o=e.editorState.getCurrentContent(),r=[];let i=-1;return t.getCharacterList().forEach((t,e)=>{const s=t&&t.getEntity();if(s&&void 0!==e){const t=o.getEntity(s);t.getType()===M.a.EMOTE&&(r.push(n.substring(i+1,e)),r.push(`:${t.getData().id}:`),i=e)}}),r.push(n.substring(i+1,n.length)),r.join("")},xt=t=>{const e=t.remaining.shift();((t,e)=>Et(t,e))(e,t),((t,e)=>{e.textParts.push(Ot(t,e))})(e,t),t.processed.push(e)},vt=(t,e)=>{const n=t.first(),r=t.last();let i=t;if(Object(v.u)(n.getType())?i=i.set(i.keySeq().first(),n.merge({type:v.n})):Object(v.o)(n.getType())&&(i=o.BlockMapBuilder.createFromArray([Object(K.h)(),...i.toArray()])),Object(v.u)(r.getType())||!Object(A.r)(e)){const t=Object(K.h)();i=i.set(t.getKey(),t)}else if(Object(v.o)(r.getType())){const t=Object(K.h)().merge({type:v.j});i=i.set(t.getKey(),t)}return i},Tt=(t,e,n)=>{const o=t.getBlockForKey(e.getStartKey());if(Object(v.u)(o.getType())){const o=n.first(),r=n.set(n.keySeq().first(),Object(K.h)(o.getKey(),o.getText()).merge({type:v.j}));return V.c(t,e,r)}},kt=(t,e,n)=>{const o=((t,e,n)=>{const o=e?e.getText():"";return`<span data-editor="${n}">${I()(o)}</span>`})(0,e,n.editor.getEditorKey());n.htmlParts.push(o)},jt=t=>{const e=t.remaining,n=e.shift(),o=e[0]&&Object(v.u)(e[0].getType())?e.shift():void 0;kt(0,o,t),((t,e)=>{const n=t?Ot(t,e):"";e.textParts.push(n)})(o,t),t.processed.push(n),o&&t.processed.push(o)},wt=t=>{const e=t.getSelection(),n=e.getFocusKey();if(n!==e.getAnchorKey())return;const r=t.getCurrentContent(),i=r.getBlockForKey(n);if(Object(v.o)(i.getType())){const t=[i],e=r.getBlockAfter(i.getKey());return e&&Object(v.u)(e.getType())&&t.push(e),o.ContentState.createFromBlockArray(t).getBlockMap()}},Rt=t=>{const e=wt(t);if(e)return Object(A.d)(t,e.first().getKey())},Bt=t=>{const e=t.getSelection();let n=t.getCurrentContent();const r=n.getBlockForKey(e.getStartKey()),i=n.getBlockForKey(e.getEndKey());if(Object(v.t)(r.getType())||Object(v.t)(i.getType())){if(e.isCollapsed())if(Object(v.u)(r.getType()))n=V.d(n,e),n=o.Modifier.setBlockType(n,n.getSelectionAfter(),v.n);else if(Object(v.o)(r.getType())){let r=n.getBlockAfter(e.getStartKey());return r||(r=(t=Object(A.b)(t,e.getStartKey(),K.a.after)).getCurrentContent().getBlockAfter(e.getStartKey())),o.EditorState.forceSelection(t,Object(K.b)(r,!0))}return o.EditorState.push(t,n,"split-block")}},It=(t,e)=>{const n=t.getSelection(),r=t.getCurrentContent(),i="up"===e?n.getStartKey():n.getEndKey(),s=r.getBlockForKey(i);if(!Object(v.o)(s.getType()))return;const a="up"===e?r.getBlockBefore(i):r.getBlockAfter(i);return a?o.EditorState.forceSelection(t,Object(K.b)(a,!0)):Object(A.b)(t,i,"up"===e?K.a.before:K.a.after)},At=(t,e)=>{if(t.shiftKey)return;const n=It(e,"up");return n&&t.preventDefault(),n},Kt=(t,e)=>{if(t.shiftKey)return;const n=It(e,"down");return n&&t.preventDefault(),n},Mt=(t,e)=>{const n=t.getSelection();return n.isCollapsed()&&0===n.getStartOffset()&&Object(v.o)(t.getCurrentContent().getBlockForKey(n.getStartKey()).getType())};var _t=(t,e)=>{if(!Object(A.r)(e))return t;const n=t.getSelection(),o=t.getCurrentContent(),r=o.getBlockForKey(n.getStartKey());if(Object(v.o)(r.getType())){const e=o.getBlockAfter(r.getKey());if(!e||!Object(v.u)(e.getType()))return Object(A.d)(t,r.getKey(),!1)}return t},Lt=n("./src/reddit/actions/modal.ts"),Dt=n("./src/reddit/actions/upload.ts"),Ft=n("./src/reddit/components/ThumbnailSelector/index.tsx"),Nt=t=>null,Pt=n("./src/reddit/helpers/media/index.ts"),Ut=n("./src/reddit/helpers/richTextEditor/index.ts"),Ht=n("./src/reddit/selectors/activeModalId.ts"),Vt=n("./src/reddit/selectors/user.ts");const zt="application/x-reddit-rte-block";var Wt=n("./src/reddit/components/RichTextEditor/media/MediaBlock/MediaView/ImagePreview/index.m.less"),qt=n.n(Wt);const Gt=g.a.img("Img",qt.a);var Qt=g.a.wrapped(t=>{const e=t.className,n=t.url;return a.a.createElement("div",{className:e},a.a.createElement(Gt,{draggable:!1,src:n}))},"Component",qt.a),Yt=n("./src/app/strings/index.ts"),Jt=n("./src/reddit/components/RichTextEditor/media/MediaBlock/MediaView/Placeholder/index.m.less"),Zt=n.n(Jt);const Xt=Object(Yt.e)("postCreation.processingVideo"),$t=Object(Yt.e)("postCreation.processingImage"),te=g.a.div("Message",Zt.a);var ee=g.a.wrapped(t=>{const e=t.className,n=t.isImage,o=t.language;return a.a.createElement("div",{className:e},a.a.createElement(te,null,(n?$t:Xt)(o)))},"Component",Zt.a),ne=n("./src/lib/formatApiError/index.ts"),oe=n("./src/reddit/components/ProgressBar/index.tsx"),re=n("./src/reddit/controls/Button/index.tsx"),ie=n("./src/reddit/components/RichTextEditor/media/MediaBlock/MediaView/StatusBar/index.m.less"),se=n.n(ie);const ae=Object(Yt.e)("postCreation.cancel"),ce=Object(Yt.e)("postCreation.retry"),le=Object(Yt.e)("postCreation.remove"),de=Object(Yt.e)("postCreation.uploadStatus.uploadCanceled"),ue=Object(Yt.e)("postCreation.uploadStatus.uploadFailed"),pe=Object(Yt.e)("postCreation.uploadStatus.success"),he=Object(Yt.e)("postCreation.uploadStatus.uploading"),ge=g.a.div("ControlRow",se.a),me=g.a.wrapped(re.n,"Button",se.a),fe=g.a.wrapped(re.n,"ErrButton",se.a),be=g.a.div("Status",se.a),ye=g.a.wrapped(oe.a,"ProgressBar",se.a),Ee=g.a.div("ErrorLine",se.a),Se=t=>e=>{e.stopPropagation(),t(e)};var Ce=g.a.wrapped(t=>{const e=t.language,n=t.upload,o=Se(t.onCancel),r=Se(t.onRetry),i=Se(t.onRemove),s=n.status,c=n.progress,l=c&&c.percent||0,d=s===x.a.FAILED||s===x.a.CANCELED,u=((t,e)=>{const n=t.status,o=t.progress;return n===x.a.CANCELED?de(e):n===x.a.FAILED?`${ue(e)}: ${Object(ne.a)(e,t.error)} `:100===(o&&o.percent||0)?pe(e):`${he(e)}: "${t.file.name}"`})(n,e);return a.a.createElement("div",{className:t.className},d?a.a.createElement(Ee,null):a.a.createElement(ye,{innerBarClassName:se.a.ProgressBarInner,percent:l}),a.a.createElement(ge,null,a.a.createElement(be,{className:d?se.a.hasError:void 0,title:d?u:void 0},u),a.a.createElement("div",null,d?[a.a.createElement(fe,{key:"remove",onClick:i},le(e)),a.a.createElement(fe,{key:"retry",onClick:r},ce(e))]:a.a.createElement(me,{disabled:100===l,onClick:o},ae(e)))))},"Component",se.a),Oe=n("./node_modules/react-motion/lib/react-motion.js"),xe=n("./src/reddit/components/HTML5StreamPlayer/index.tsx"),ve=n("./src/reddit/components/PlayButton/index.tsx"),Te=n("./src/reddit/components/RichTextEditor/media/MediaBlock/MediaView/VideoPreview/index.m.less"),ke=n.n(Te);const je={stiffness:60,damping:20},we=[{key:"video",style:{opacity:Object(Oe.spring)(1,je)}}],Re=g.a.wrapped(t=>{var e=t.autoPlay;const n=void 0!==e&&e,o=t.className,r=t.showControls,i=t.shouldPause,s=t.style,c=t.dashUrl,l=t.hlsUrl,d=t.otherUrl;return a.a.createElement("div",{className:o,style:s},a.a.createElement(xe.b,{autoPlay:n,shouldIgnoreAutoplayPref:!0,shouldLoad:!1,shouldPause:i,isGif:!1,hlsSource:l,mpegDashSource:c,otherSource:d,showSettingsIcon:!1,showControlBar:r,playerClickPlay:!1,hideUntilLoaded:!0}))},"VideoPlayer",ke.a),Be=g.a.img("PosterImg",ke.a),Ie=g.a.wrapped(t=>{const e=t.className,n=t.onPlayButtonClick,o=t.url,r=t.showPlayButton;return a.a.createElement("div",{className:e},a.a.createElement(Be,{draggable:!1,src:o}),r&&a.a.createElement(ve.a,{className:ke.a.playButton,onClick:n}))},"Poster",ke.a);var Ae=g.a.wrapped(class extends a.a.Component{constructor(t){super(t),this.onPlayButtonClick=(()=>{this.setState({showVideo:!0})}),this.willEnter=(()=>({opacity:0})),this.willLeave=(()=>({opacity:Object(Oe.spring)(0,je)})),this.didLeave=(()=>{this.setState({showVideo:!1})}),this.state={showVideo:!1}}renderVideo(){const t=this.props;return a.a.createElement("div",{className:t.className},a.a.createElement(Re,{dashUrl:t.dashUrl,hlsUrl:t.hlsUrl,showControls:t.isUploaded&&t.isSelected,shouldPause:!t.isSelected||void 0}))}render(){var t=this.props;const e=t.className,n=t.isSelected,o=t.posterUrl,r=t.dashUrl,i=t.hlsUrl,s=t.otherUrl;if(!o)return this.renderVideo();const c=this.state.showVideo,l=!!(r||i||s);return a.a.createElement(Oe.TransitionMotion,{defaultStyles:[],styles:n&&c&&l?we:[],willEnter:this.willEnter,willLeave:this.willLeave,didLeave:this.didLeave},t=>a.a.createElement("div",{className:e},t.map(t=>a.a.createElement(Re,{key:t.key,autoPlay:!0,style:t.style,otherUrl:s,dashUrl:r,hlsUrl:i,showControls:!0,shouldPause:!n||void 0})),a.a.createElement(Ie,{url:o,showPlayButton:!c||!n,onPlayButtonClick:this.onPlayButtonClick})))}},"Component",ke.a),Ke=n("./src/reddit/components/RichTextEditor/media/MediaBlock/MediaView/index.m.less"),Me=n.n(Ke),_e=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]])}return n};var Le=t=>{const e=t.alignCenter,n=t.isSelected,o=t.onCancel,r=t.onRetry,i=t.onRemove,s=t.language,c=t.upload,l=t.mediaAsset,d=t.thumbnail,u=_e(t,["alignCenter","isSelected","onCancel","onRetry","onRemove","language","upload","mediaAsset","thumbnail"]);let h=!1;if(c)h="image"===Object(Pt.f)(c.metadata.mimetype);else{if(!l)return null;h=l.type===A.a.Image||l.type===A.a.AnimatedImage}const g=c?c.metadata.height:l.height,m=!c||c.status===x.a.SUCCESS,f=h&&!!g&&g<104,b=!g;return a.a.createElement("div",Object.assign({className:Object(p.a)(Me.a.container,{[Me.a.alignCenter]:e,[Me.a.isCompact]:f,[Me.a.isUploaded]:m,[Me.a.isSelected]:n})},u),b?a.a.createElement(ee,{className:Me.a.placeholder,isImage:h,language:s}):h?a.a.createElement(Qt,{className:Me.a.imagePreview,url:c?c.metadata.localUrl:l.imageUrl}):a.a.createElement(Ae,{className:Me.a.videoPreview,dashUrl:l?l.dashUrl:void 0,hlsUrl:l?l.hlsUrl:void 0,isSelected:n,isUploaded:m,otherUrl:c?c.metadata.localUrl:void 0,posterUrl:d?d.url:l.posterUrl}),c&&a.a.createElement(Ce,{className:Me.a.statusBar,language:s,onCancel:o,onRemove:i,onRetry:r,upload:c}))},De=n("./src/reddit/components/RichTextEditor/media/MediaBlock/SelectionHook/index.m.less"),Fe=n.n(De),Ne=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]])}return n};const Pe=g.a.div("HiddenDiv",Fe.a);var Ue=t=>{var e=t.elementRef,n=Ne(t,["elementRef"]);return a.a.createElement(Pe,Object.assign({},n,{innerRef:e}),a.a.createElement("br",null))},He=n("./src/reddit/components/MakeGifToggle/index.tsx"),Ve=n("./src/reddit/icons/svgs/ThumbnailSelect/index.tsx"),ze=n("./src/reddit/icons/svgs/Trash2/index.tsx"),We=n("./src/reddit/layout/row/Inline/index.tsx"),qe=n("./src/reddit/components/RichTextEditor/Toolbar/index.tsx"),Ge=n("./src/reddit/components/RichTextEditor/Toolbar/FormatterButton/index.tsx"),Qe=n("./src/reddit/components/RichTextEditor/Toolbar/formatterConfigs.tsx"),Ye=n("./src/reddit/components/RichTextEditor/media/MediaBlock/Toolbar/index.m.less"),Je=n.n(Ye);const Ze=Object(Yt.e)("postCreation.remove"),Xe=Object(Yt.e)("postCreation.mediaInput.chooseThumbnail"),$e=g.a.wrapped(Ge.a,"FormatterButton",Je.a),tn=Object(Qe.f)(ze.b),en=Object(Qe.f)(Ve.a),nn=g.a.wrapped(We.a,"ToolbarContent",Je.a);var on=t=>{const e=t.alignCenter,n=t.block,o=t.editorState,r=t.language,i=t.onChange,s=t.showVideoControls,c=n.getKey();var l=(Object(A.h)(n)||{}).makeGif;const d=void 0!==l&&l;return a.a.createElement("div",{className:Object(p.a)(Je.a.container,{[Je.a.alignCenter]:e})},a.a.createElement(nn,{className:Je.a.content},s&&a.a.createElement(He.a,{isCompact:!0,key:"make-gif",on:d,onClick:()=>i(Object(A.q)(o,c,{makeGif:!d}))}),s&&t.showThumbnailButton&&a.a.createElement($e,{Icon:en,onClick:t.onThumbnailButtonClick,tooltip:Xe(r),tooltipBelow:!0}),s&&a.a.createElement(qe.c,null),a.a.createElement($e,{Icon:tn,onClick:()=>i(Object(A.d)(o,c)),tooltip:Ze(r),tooltipBelow:!0})))},rn=n("./src/reddit/components/RichTextEditor/media/MediaBlock/index.m.less"),sn=n.n(rn);const an=t=>`RTE_VIDEO_THUMBNAIL_SELECTOR_${t.getKey()}`,cn=Object(l.a)(t=>t.uploads,(t,e)=>{const n=Object(A.h)(e.block);return n&&n.uploadInfo&&n.uploadInfo.uploadKey},(t,e)=>e?t[e]:void 0),ln=Object(c.b)((t,e)=>({upload:cn(t,e),language:Object(Vt.R)(t),isThumbnailSelectorOpen:Object(Ht.a)(t)===an(e.block),isRteVideoPosterEnabled:E.d.rteVideoPoster(t)}),(t,e)=>({onCancelUpload:e=>t(Dt.i(e,!1)),toggleVideoThumbnailsSelector:()=>t(Object(Lt.i)(an(e.block)))})),dn=g.a.div("MediaContainer",sn.a),un=g.a.div("Container",sn.a);var pn=ln(class extends a.a.Component{constructor(t){super(t),this.onNativeSelectionChange=(()=>{const t=window.getSelection();if(0===t.rangeCount)return;const e=t.getRangeAt(0),n=e.commonAncestorContainer;this.state.active?this.rootContainer.contains(n)||this.setState({active:!1}):this.rootContainer&&this.rootContainer.contains(n)&&this.selectBlock(),this.setState({isInSelection:Object(L.i)(e,this.rootContainer)})}),this.selectBlock=(()=>{const t=document.createRange();t.selectNodeContents(this.rootContainer);const e=window.getSelection();e.removeAllRanges(),e.addRange(t),this.setState({active:!0})}),this.isSelected=(()=>{const t=this.props.blockProps.getEditorState().getSelection(),e=this.props.block.getKey();return this.state.active&&Object(A.n)(t,e)}),this.onRetryUpload=(()=>{const t=this.props.upload;t&&this.props.blockProps.onRetryUpload(t.key)}),this.onMediaViewClickCapture=(t=>{this.state.active||this.selectBlock()}),this.onDragStart=(t=>{t.dataTransfer.effectAllowed="move",t.dataTransfer.setData(zt,this.props.block.getKey())}),this.onRemove=(()=>{const t=this.props.blockProps.getEditorState();this.props.blockProps.onChange(Object(A.d)(t,this.props.block.getKey()))}),this.onCancelUpload=(async()=>{this.props.upload&&(await this.props.onCancelUpload(this.props.upload.key),this.selectBlock())}),this.onToolbarStateChange=(t=>{this.props.blockProps.onChange(t)}),this.toggleVideoThumbnailsSelector=(()=>{this.props.toggleVideoThumbnailsSelector()}),this.onThumbnailSelect=(t=>{const e=this.props.blockProps.getEditorState(),n=this.props.block.getKey();let o=Object(A.q)(e,this.props.block.getKey(),{thumbnail:t});o=Object(A.p)(o,n),this.props.blockProps.onChange(o),this.toggleVideoThumbnailsSelector()}),this.state={active:!1,isInSelection:!1}}shouldComponentUpdate(t,e){return e.active!==this.state.active||e.isInSelection!==this.state.isInSelection||t.block!==this.props.block||t.upload!==this.props.upload||Object(A.n)(t.selection,t.block.getKey())}componentDidMount(){document.addEventListener("selectionchange",this.onNativeSelectionChange);const t=this.props.selection;t.getHasFocus()&&Object(A.n)(t,this.props.block.getKey())&&this.selectBlock(),this.overlayContainer=Nt(!0)}componentWillUnmount(){document.removeEventListener("selectionchange",this.onNativeSelectionChange)}componentWillReceiveProps(t){const e=t.block.getKey(),n=this.props.blockProps.getEditorState(),o=n;n!==o&&this.props.blockProps.onChange(o),!this.state.active&&t.selection!==this.props.selection&&t.selection.getHasFocus()&&Object(A.n)(t.selection,e)&&this.selectBlock()}getToolbarOffset(){return this.props.blockProps.rteFocusableContentRef&&this.rootContainer?this.rootContainer.getBoundingClientRect().top-this.props.blockProps.rteFocusableContentRef.getBoundingClientRect().top-30-10:0}render(){var t=this.props;const e=t.block,n=t.blockProps,o=t.isRteVideoPosterEnabled,r=t.language,i=t.offsetKey,s=t.upload,c=Object(A.h)(e),l=c?c.thumbnail:void 0,d=!!s&&Object(Pt.l)(s.metadata.mimetype||"");var u=this.state;const p=u.active,h=u.isInSelection,g=n.editorType===Ut.a.Comment;return a.a.createElement(un,{innerRef:t=>this.rootContainer=t},p&&a.a.createElement(on,{block:e,editorState:n.getEditorState(),language:r,onChange:this.onToolbarStateChange,onThumbnailButtonClick:this.toggleVideoThumbnailsSelector,showThumbnailButton:o,showVideoControls:d,alignCenter:!g}),a.a.createElement(Ue,null),a.a.createElement("div",{contentEditable:!1,"data-offset-key":i},a.a.createElement(dn,{draggable:!0,onDragStart:this.onDragStart,innerRef:t=>this.mediaContainer=t},a.a.createElement(Le,{isSelected:h||p,language:r,thumbnail:l,onCancel:this.onCancelUpload,onClickCapture:this.onMediaViewClickCapture,onRetry:this.onRetryUpload,onRemove:this.onRemove,upload:s,mediaAsset:c.mediaAsset,alignCenter:!g})),s&&d&&a.a.createElement(Ft.a,{language:r,onSelect:this.onThumbnailSelect,onToggleModal:this.toggleVideoThumbnailsSelector,videoSource:s.metadata.localUrl,videoDuration:s.metadata.videoDuration,selected:l,isOpen:this.props.isThumbnailSelectorOpen})),a.a.createElement(Ue,null))}}),hn=n("./src/reddit/components/RichTextEditor/media/MediaCaption/index.m.less"),gn=n.n(hn);const mn=Object(_.Map)({[v.j]:{element:"div",wrapper:a.a.createElement(class extends a.a.PureComponent{constructor(t){super(t);var e=Object(K.e)(t.children[0]).props;const n=e.contentState,o=e.block;this.mediaBlockKey=n.getBlockBefore(o.getKey()).getKey()}render(){const t=this.props.children[0];var e=Object(K.e)(t).props;const n=e.block,o=e.contentState.getBlockForKey(this.mediaBlockKey),r=Object(A.h)(o);if(!r||!(r.mediaAsset||r.uploadInfo&&r.uploadInfo.mediaType))return null;const i=!n.getLength();return a.a.createElement("div",{className:gn.a.wrapper,style:{"--media-caption-placeholder-text":i?`'${Object(C.c)("Add caption")}'`:""}},t)}},null)}});var fn=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(c){r=!0,i=c}finally{try{!o&&a.return&&a.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var bn=(t,e,n)=>{const r=t.getSelection(),i=t.getCurrentContent(),s=i.getBlockForKey(r.getAnchorKey()),a=i.getBlockForKey(r.getFocusKey());var c=Object(z.e)(i,s,a),l=fn(c,2);const d=l[0],u=l[1];if(!d||d!==u)return t;const p=d.blocks,h=d.start,g=Object(z.g)(s),m=Object(z.g)(a),f=m.colCount;p.sort(z.b);const b=F()(p,f);var y=Object(z.f)(g,m);const E=y.minCol,S=y.minRow,C=y.maxCol,O=y.maxRow,x={rowIndex:0,colIndex:0};if("rows"===e){const t="before"===n?S:O+1,e=F()(Object(z.l)(f,O-S+1),f);b.splice(t,0,...e),x.rowIndex=t}else{const t="before"===n?E:C+1;b.forEach(e=>{e.splice(t,0,...Object(z.l)(C-E+1,1))}),x.colIndex=t}const v=Object(z.d)(b),T=i.getBlocksAsArray(),k=P()(v),j=[...T.slice(0,h),...k,...T.slice(h+p.length)],w=i.merge({blockMap:o.BlockMapBuilder.createFromArray(j)}),R=J()(k,t=>Object(z.h)(x,Object(z.g)(t))),B=Object(z.o)(r,R,R);let I=o.EditorState.push(t,w,G.e);return I=o.EditorState.forceSelection(I,B)},yn=n("./node_modules/lodash/clamp.js"),En=n.n(yn),Sn=n("./src/reddit/components/RichTextEditor/helpers/sliceContiguousBlocks.ts");var Cn=(t,e,n="preserve")=>{const r=t.getSelection(),i=t.getCurrentContent(),s="up"===e||"left"===e?r.getStartKey():r.getEndKey(),a=i.getBlockForKey(s);if(!Object(v.v)(a.getType()))return;const c=Object(z.g)(a),l=c.colCount,d=c.colIndex,u=c.rowIndex,p=i.getBlocksAsArray(),h=Object(Sn.a)(i,a);if(!h)return;let g=u,m=d;switch(e){case"up":g--;break;case"down":g++;break;case"left":--m<0&&(g--,m=l-1);break;case"right":++m>=l&&(g++,m=0)}const f={rowIndex:g,colIndex:m};let b=s;const y=J()(h.blocks,t=>Object(z.h)(Object(z.g)(t),f));if(y)b=y.getKey();else{const t=Object(z.c)(f,c)<0?h.start-1:h.start+h.blocks.length;0<=t&&t<p.length&&(b=p[t].getKey())}const E=i.getBlockForKey(b);let S=0;"preserve"===n?S=En()(r.getFocusOffset(),0,E.getLength()):"end"===n&&(S=E.getLength());const C=r.merge({anchorKey:b,focusKey:b,focusOffset:S,anchorOffset:S});return r!==C?o.EditorState.forceSelection(t,C):void 0},On=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(c){r=!0,i=c}finally{try{!o&&a.return&&a.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();const xn=(t,e)=>{const n=e.getCurrentContent(),o=e.getSelection(),r=n.getBlockForKey(o.getFocusKey());var i=Object(z.e)(n,r,r);const s=On(i,1)[0];if(!s)return;const a=Object(z.g)(r);let c;return(c=a.colIndex===a.colCount-1&&a.rowIndex===s.blocks.length/a.colCount-1&&!t.shiftKey&&o.getFocusKey()===o.getAnchorKey()?bn(e,"rows","after"):Cn(e,t.shiftKey?"left":"right","end"))?(t.preventDefault(),c):void 0},vn=(t,e)=>{if(t.shiftKey)return;const n=Cn(e,"up");return n&&t.preventDefault(),n},Tn=(t,e)=>{if(t.shiftKey)return;const n=Cn(e,"down");return n&&t.preventDefault(),n};class kn{constructor(){this.lastRowInsertionState=null}undoRowInsertion(t){const e=o.EditorState.undo(t);return Cn(e,"down","end")||e}isSelectionInLastRow(t){const e=t.getCurrentContent(),n=t.getSelection(),o=e.getBlockForKey(n.getFocusKey());var r=Object(z.e)(e,o,o);const i=On(r,1)[0];if(!i)return!1;const s=Object(z.g)(i.blocks[0]).colCount,a=i.blocks.length/s;return Object(z.g)(o).rowIndex===a-1}insertNewRow(t){const e=t.getSelection();let n=bn(t,"rows","after");return n=o.EditorState.forceSelection(n,e),n=Cn(n,"down")||n,this.lastRowInsertionState=n,n}handle(t){return t.getSelection().isCollapsed()?t===this.lastRowInsertionState?this.undoRowInsertion(t):this.isSelectionInLastRow(t)?this.insertNewRow(t):Cn(t,"down")||t:t}}const jn=(t,e)=>{const n=t.getSelection();if(n.isCollapsed()||n.getStartKey()===n.getEndKey())return;const r=t.getCurrentContent(),i=r.getBlockForKey(n.getAnchorKey()),s=r.getBlockForKey(n.getFocusKey());var a=Object(z.e)(r,i,s),c=On(a,2);const l=c[0],d=c[1];if(l&&l===d){const i=Object(z.o)(n,s,s,!1),a=V.b(r,i,e);return o.EditorState.push(t,a,G.d)}};var wn=n("./node_modules/lodash/forEach.js"),Rn=n.n(wn),Bn=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(c){r=!0,i=c}finally{try{!o&&a.return&&a.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();const In=(t,e)=>e?t[0]:t[t.length-1];var An=(t,e)=>{return t.getSelection().isCollapsed()?((t,e)=>{const n=t.getSelection(),r=e.getSelection();if(!n.isCollapsed()||r.isCollapsed()||0!==r.getStartOffset()||r.getStartKey()!==n.getStartKey())return t;const i=t.getCurrentContent(),s=e.getCurrentContent(),a=i.getBlockForKey(n.getAnchorKey());if(!Object(v.v)(a.getType()))return t;var c=Object(z.g)(a);const l=c.rowIndex,d=c.colIndex;if(0!==l||0!==d)return t;const u=i.getBlockMap(),p=s.getBlockMap();if(u.size>=p.size)return t;const h=i.getBlockAfter(n.getAnchorKey()),g=s.getBlockAfter(r.getEndKey());if(h&&h!==g)return t;const m=a.merge({type:v.n,data:Object(_.Map)({})}),f=i.merge({blockMap:u.set(a.getKey(),m)});return o.EditorState.set(t,{currentContent:f})})(t,e):((t,e)=>{const n=t.getSelection();if(n.isCollapsed())return t;if(e.getSelection()===n)return t;if(n.getFocusKey()===n.getAnchorKey())return t;const r=t.getCurrentContent(),i=r.getBlockForKey(n.getAnchorKey()),s=r.getBlockForKey(n.getFocusKey());var a=Object(z.e)(r,i,s),c=Bn(a,2);const l=c[0],d=c[1];if(!l&&!d)return t;let u=t;if(l!==d){const e=n.getIsBackward(),r=Object(z.o)(n,l?In(l.blocks,!e):null,d?In(d.blocks,e):null,e);n!==r&&(u=o.EditorState.forceSelection(t,r))}else if(l&&d&&l===d){const e=Object(z.g)(i),a=Object(z.g)(s),c=r.getBlocksAsArray(),l=d.start,p=d.blocks,h=p[0],g=Object(z.g)(h);if(0!==g.colIndex||0!==g.rowIndex)throw new Error("First table block must always has [0, 0] coordinate!");const m=Object(z.b)(s,i)<0,f=Object(z.k)(e,a),b=[],y=[];Rn()(p,t=>{const e=Object(z.g)(t);f(e.rowIndex,e.colIndex)?b.push(t):t!==h&&y.push(t)});const E=b[0]===h;b.sort(z.b);const S=[...c.slice(0,l),...E?[]:[h],...b,...y,...c.slice(l+p.length)],C=In(b,!m),O=In(b,m),x=Object(z.o)(n,C,O,m),v=r.merge({blockMap:o.BlockMapBuilder.createFromArray(S),selectionAfter:x});u=o.EditorState.set(t,{currentContent:v}),x!==n&&(u=o.EditorState.forceSelection(u,x))}return u})(t,e)},Kn=n("./src/reddit/components/RichTextEditor/table/Renderer/index.m.less"),Mn=n.n(Kn);const _n=g.a.div("Cell",Mn.a),Ln=g.a.div("Row",Mn.a),Dn=g.a.div("Table",Mn.a),Fn=(t,e)=>{if(!e||!t.contains(e))return;let n=e;for(;n&&n!==t;){if(n instanceof HTMLElement&&n.hasAttribute("data-row"))return n;n.parentElement&&(n=n.parentElement)}},Nn=(t,e=10)=>{let n=t,o=e;for(;n&&o>0;){if(n instanceof HTMLElement&&n.dataset.table)return n;n.parentElement&&(n=n.parentElement),o--}},Pn=t=>{const e=t.dataset;if("string"==typeof e.row&&"string"==typeof e.col)return{rowIndex:+e.row,colIndex:+e.col}},Un=t=>{const e=window.getSelection(),n=e.focusNode,o=e.anchorNode,r=e.rangeCount;if(n!==o&&r&&t){const n=e.getRangeAt(0);return Object(L.i)(n,t)&&!t.contains(n.commonAncestorContainer)}return!1},Hn=t=>{const e=a.a.Children.toArray(t);var n=Object(K.e)(e[0]).props;const o=n.selection,r=n.contentState,i=n.block;const s=Object(z.g)(i).colCount;e.sort((t,e)=>Object(z.b)(Object(K.c)(t),Object(K.c)(e)));const c=F()(e,s);let l,d,u=!1;if(o.getAnchorKey()!==o.getFocusKey()){const t=r.getBlocksAsArray(),n=r.getBlockForKey(o.getStartKey()),s=r.getBlockForKey(o.getEndKey()),a=t.indexOf(n),c=t.indexOf(s),p=t.indexOf(i),h=p+e.length-1;a<p&&p<c||a<h&&h<c?u=!0:p<=a&&c<=h&&(d=Object(z.g)(o.getIsBackward()?s:n),l=Object(z.g)(o.getIsBackward()?n:s))}return{rows:c,anchorCell:d,focusCell:l,isSelectWholeTable:u}};const Vn=Object(_.Map)({[v.l]:{element:"div",wrapper:a.a.createElement(class extends a.a.Component{constructor(t){super(t),this.tableElem=null,this.onMouseDown=(t=>{if(!this.tableElem||t.nativeEvent.detail<2)return;const e=window.getSelection(),n=e.rangeCount?e.getRangeAt(0):null,o=Fn(this.tableElem,e.focusNode);if(n&&o)if(2===t.nativeEvent.detail&&e.isCollapsed){const r=n.cloneRange();r.setEndAfter(o),r.toString()||(t.preventDefault(),e.selectAllChildren(o))}else t.nativeEvent.detail>=3&&(e.selectAllChildren(o),t.preventDefault())}),this.onNativeSelectionChange=(()=>{const t=this.tableElem;if(!t)return;const e=window.getSelection();if(e.anchorNode===e.focusNode)return void this.resetSelection();const n=Fn(t,e.anchorNode),o=Fn(t,e.focusNode);n&&n===o?this.resetSelection():n&&o?this.setCellsRange(n,o):n||o?this.selectWholeTable():Un(t)?this.selectWholeTable():this.resetSelection()}),this.resetSelection=(()=>{(this.state.anchorCell||this.state.focusCell||this.state.isSelectWholeTable)&&this.setState({isSelectWholeTable:!1,focusCell:void 0,anchorCell:void 0})}),this.setCellsRange=((t,e)=>{const n=Pn(e),o=Pn(t);Object(z.h)(n,this.state.focusCell)&&Object(z.h)(o,this.state.anchorCell)&&!this.state.isSelectWholeTable||this.setState({focusCell:n,anchorCell:o,isSelectWholeTable:!1})}),this.selectWholeTable=(()=>{!this.state.focusCell&&this.state.isSelectWholeTable||this.setState({focusCell:void 0,isSelectWholeTable:!0})}),this.state=Hn(t.children)}componentDidMount(){document.addEventListener("selectionchange",this.onNativeSelectionChange)}componentWillUnmount(){document.removeEventListener("selectionchange",this.onNativeSelectionChange)}componentWillReceiveProps(t){t.children!==this.props.children&&this.setState(Hn(t.children))}render(){var t=this.state;const e=t.rows,n=t.anchorCell,o=t.focusCell;let r;t.isSelectWholeTable?r=((t,e)=>!0):n&&o&&!Object(z.h)(n,o)&&(r=Object(z.k)(n,o));const i=e[0].map(t=>Object(z.g)(Object(K.e)(t).props.block).alignment),s=e.map((t,e)=>a.a.createElement(Ln,{key:e},t.map((t,n)=>a.a.createElement(_n,{"data-row":e,"data-col":n,"data-selected":!!r&&r(e,n),key:n,style:{"--cell-text-alignment":i[n]?z.a[i[n]]:void 0}},t))));return a.a.createElement(Dn,{className:r?Mn.a.isFakeSelectionActive:void 0,innerRef:t=>this.tableElem=t,onMouseDown:this.onMouseDown,"data-table":!0},s)}},null)}});var zn=n("./node_modules/lodash/isEqual.js"),Wn=n.n(zn),qn=n("./src/reddit/components/RichTextEditor/Tooltip/index.tsx"),Gn=n("./src/reddit/icons/svgs/FormattingAlignCenter/index.m.less"),Qn=n.n(Gn);var Yn=t=>a.a.createElement("svg",{className:Object(p.a)(Qn.a.icon,t.className),viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},a.a.createElement("g",{fill:"inherit",fillRule:"nonzero"},a.a.createElement("path",{d:"M3.5 11h13c.55 0 1-.45 1-1s-.45-1-1-1h-13c-.55 0-1 .45-1 1s.45 1 1 1zM7.42 16h5.08c.55 0 1-.45 1-1s-.45-1-1-1H7.42c-.56 0-1 .45-1 1s.44 1 1 1zM3.5 6h13c.55 0 1-.45 1-1s-.45-1-1-1h-13c-.55 0-1 .45-1 1s.45 1 1 1z"}))),Jn=n("./src/reddit/icons/svgs/FormattingAlignLeft/index.m.less"),Zn=n.n(Jn);var Xn=t=>a.a.createElement("svg",{className:Object(p.a)(Zn.a.icon,t.className),viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},a.a.createElement("g",{fill:"inherit",fillRule:"nonzero"},a.a.createElement("path",{d:"M3.5 11h13c.55 0 1-.45 1-1s-.45-1-1-1h-13c-.55 0-1 .45-1 1s.45 1 1 1zM3.5 16h5.4c.54 0 1-.45 1-1s-.46-1-1-1H3.5c-.55 0-1 .45-1 1s.45 1 1 1zM3.5 6h13c.55 0 1-.45 1-1s-.45-1-1-1h-13c-.55 0-1 .45-1 1s.45 1 1 1z"}))),$n=n("./src/reddit/icons/svgs/FormattingAlignRight/index.m.less"),to=n.n($n);var eo=t=>a.a.createElement("svg",{className:Object(p.a)(to.a.icon,t.className),viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},a.a.createElement("g",{fill:"inherit",fillRule:"nonzero"},a.a.createElement("path",{d:"M3.5 11h13c.55 0 1-.45 1-1s-.45-1-1-1h-13c-.55 0-1 .45-1 1s.45 1 1 1zM11.5 16h5c.55 0 1-.45 1-1s-.45-1-1-1h-5c-.55 0-1 .45-1 1s.45 1 1 1zM3.5 6h13c.55 0 1-.45 1-1s-.45-1-1-1h-13c-.55 0-1 .45-1 1s.45 1 1 1z"}))),no=n("./src/reddit/icons/svgs/FormattingDeleteRow/index.m.less"),oo=n.n(no);var ro=t=>a.a.createElement("svg",{className:Object(p.a)(oo.a.icon,t.className),viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},a.a.createElement("g",{fill:"inherit",fillRule:"nonzero",transform:"vertical"===t.orientation?"rotate(90, 10, 10)":""},a.a.createElement("path",{d:"M3 3c0-.55.45-1 1-1h12c.55 0 1 .45 1 1v14c0 .55-.45 1-1 1H4c-.55 0-1-.45-1-1V3zM2 3v14c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V3c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2z"}),a.a.createElement("path",{d:"M2 15h16v1H2M2 4h16v1H2M7.17 11.4l4.24-4.23c.4-.4 1.04-.4 1.43 0 .4.4.4 1.03 0 1.42L8.6 12.82c-.4.4-1.04.4-1.43 0-.4-.4-.4-1.03 0-1.42z"}),a.a.createElement("path",{d:"M8.6 7.17l4.23 4.24c.4.4.4 1.04 0 1.43-.4.4-1.03.4-1.42 0L7.18 8.6c-.4-.4-.4-1.04 0-1.43.4-.4 1.03-.4 1.42 0z"}))),io=n("./src/reddit/icons/svgs/FormattingInsertRow/index.m.less"),so=n.n(io);const ao={up:"rotate(180 10 10)",down:"",left:"rotate(90 10 10)",right:"rotate(-90 10 10)"};var co=t=>a.a.createElement("svg",{className:Object(p.a)(so.a.icon,t.className),viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},a.a.createElement("g",{fill:"inherit",fillRule:"nonzero",transform:ao[t.orientation||"down"]},a.a.createElement("path",{d:"M17 17c0 .55-.45 1-1 1H4c-.55 0-1-.45-1-1V3c0-.55.45-1 1-1h12c.55 0 1 .45 1 1v14zm1 0V3c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2z"}),a.a.createElement("path",{d:"M18 6H2V5h16M13 13H7c-.55 0-1-.45-1-1s.45-1 1-1h6c.55 0 1 .45 1 1s-.45 1-1 1z"}),a.a.createElement("path",{d:"M9 15V9c0-.55.45-1 1-1s1 .45 1 1v6c0 .55-.45 1-1 1s-1-.45-1-1z"}))),lo=n("./src/reddit/models/RichTextJson/index.ts"),uo=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(c){r=!0,i=c}finally{try{!o&&a.return&&a.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var po=(t,e=!1)=>{const n=t.getSelection(),r=t.getCurrentContent(),i=r.getBlockForKey(n.getAnchorKey()),s=r.getBlockForKey(n.getFocusKey());var a=Object(z.e)(r,i,s),c=uo(a,2);const l=c[0],d=c[1];if(l&&l===d){const e=l.blocks;e.sort(z.b);const r=Object(z.o)(n,e[0],q()(e));return X(o.EditorState.set(t,{selection:r}),"rows")}},ho=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(c){r=!0,i=c}finally{try{!o&&a.return&&a.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();var go=(t,e)=>{const n=t.getSelection(),r=t.getCurrentContent(),i=r.getBlockForKey(n.getAnchorKey()),s=r.getBlockForKey(n.getFocusKey());var a=Object(z.e)(r,i,s),c=ho(a,2);const l=c[0],d=c[1];if(!l||l!==d)return t;const u=Object(z.g)(i),p=Object(z.g)(s);var h=Object(z.f)(u,p);const g=h.minCol,m=h.maxCol,f=l.blocks.map(t=>{const n=Object(z.g)(t).colIndex;return g<=n&&n<=m?Object(z.m)(t,{alignment:e}):t}),b=r.getBlockMap(),y=r.merge({blockMap:b.merge(o.BlockMapBuilder.createFromArray(f)),selectionAfter:n,selectionBefore:n});return o.EditorState.push(t,y,G.b)},mo=n("./src/reddit/components/RichTextEditor/table/Toolbar/index.m.less"),fo=n.n(mo);const bo=Object(Yt.e)("postCreation.tableToolbar.alignLeft"),yo=Object(Yt.e)("postCreation.tableToolbar.alignCenter"),Eo=Object(Yt.e)("postCreation.tableToolbar.alignRight"),So=Object(Yt.e)("postCreation.tableToolbar.insertColumnBefore"),Co=Object(Yt.e)("postCreation.tableToolbar.insertColumnAfter"),Oo=Object(Yt.e)("postCreation.tableToolbar.deleteColumn"),xo=Object(Yt.e)("postCreation.tableToolbar.insertRowAbove"),vo=Object(Yt.e)("postCreation.tableToolbar.insertRowBelow"),To=Object(Yt.e)("postCreation.tableToolbar.deleteRow"),ko=Object(Yt.e)("postCreation.tableToolbar.deleteTable"),jo=(t,e)=>n=>a.a.createElement(t,Object.assign({},e,n)),wo=Object(Qe.f)(co),Ro=jo(wo,{orientation:"up"}),Bo=jo(wo,{orientation:"right"}),Io=jo(wo,{orientation:"left"}),Ao=Object(Qe.f)(ro),Ko=jo(Ao,{orientation:"vertical"}),Mo=Object(Qe.f)(Yn),_o=Object(Qe.f)(Xn),Lo=Object(Qe.f)(eo),Do=Object(Qe.f)(ze.b),Fo=g.a.wrapped(We.a,"ToolbarContent",fo.a),No=t=>a.a.createElement(Ge.a,Object.assign({},t,{className:Object(p.a)(fo.a.formatterButton,t.className),tooltipContentClass:fo.a.tooltip}));var Po=t=>{const e=t.editorState,n=t.language,o=t.onChange;return a.a.createElement(Fo,null,a.a.createElement(No,{Icon:_o,onClick:()=>o(go(e,lo.e)),tooltip:bo(n)}),a.a.createElement(No,{Icon:Mo,onClick:()=>o(go(e,lo.d)),tooltip:yo(n)}),a.a.createElement(No,{Icon:Lo,onClick:()=>o(go(e,lo.f)),tooltip:Eo(n)}),a.a.createElement(qe.c,null),a.a.createElement(No,{Icon:Io,onClick:()=>o(bn(e,"columns","before")),tooltip:So(n)}),a.a.createElement(No,{Icon:Bo,onClick:()=>o(bn(e,"columns","after")),tooltip:Co(n)}),a.a.createElement(No,{Icon:Ko,onClick:()=>o(X(e,"columns")),tooltip:Oo(n)}),a.a.createElement(qe.c,null),a.a.createElement(No,{Icon:Ro,onClick:()=>o(bn(e,"rows","before")),tooltip:xo(n)}),a.a.createElement(No,{Icon:wo,onClick:()=>o(bn(e,"rows","after")),tooltip:vo(n)}),a.a.createElement(No,{Icon:Ao,onClick:()=>o(X(e,"rows")),tooltip:To(n)}),a.a.createElement(qe.c,null),a.a.createElement(No,{Icon:Do,onClick:()=>o(po(e)||e),tooltip:ko(n)}))},Uo=n("./src/reddit/components/RichTextEditor/table/ToolbarController/index.m.less"),Ho=n.n(Uo);const Vo=20,zo=g.a.div("ActionButton",Ho.a),Wo=g.a.div("ToolbarWrapper",Ho.a),qo=t=>{const e={};if(!t||!document.documentElement)return e;const n=t.left-154.5,o=t.left+154.5-document.documentElement.clientWidth;return n<0?e.left=-n+Vo+2:o>0&&(e.left=-o+Vo-2),e},Go=t=>{t.preventDefault(),t.stopPropagation()};class Qo extends s.Component{constructor(t){super(t),this.containerElem=null,this.setContainerRef=(t=>this.containerElem=t),this.onResize=(t=>{this.hideToolbar(),this.state.tooltipPosition&&this.updateForCurrentSelection()}),this.onDocumentClick=(t=>{this.state.isToolbarActive&&this.containerElem&&(this.containerElem.contains(t.target)||this.hideToolbar())}),this.onNativeSelectionChange=(()=>{this.updateForCurrentSelection()}),this.updateForCurrentSelection=(()=>{const t=window.getSelection();if(!t.rangeCount)return void this.hideActionButton();const e=t.getRangeAt(0).commonAncestorContainer;if(!this.props.rteDomRef.contains(e))return void this.hideActionButton();const n=Nn(e);if(!n)return void this.hideActionButton();const o=Fn(n,t.anchorNode);if(!o)return void this.hideActionButton();const r=Fn(n,t.focusNode);r?this.updateActionButtonPosition(o,r):this.hideActionButton()}),this.updateActionButtonPosition=((t,e)=>{const n=t.getBoundingClientRect(),o=e.getBoundingClientRect(),r={top:Math.min(n.top,o.top),left:Math.max(n.right,o.right)-Vo};Wn()(this.state.tooltipPosition,r)||this.setState({tooltipPosition:r}),this.hideToolbar()}),this.hideActionButton=(()=>{this.hideToolbar(),this.state.tooltipPosition&&this.setState({tooltipPosition:null})}),this.hideToolbar=(()=>{this.state.isToolbarActive&&this.setState({isToolbarActive:!1})}),this.onActionButtonClick=(t=>{this.setState(t=>({isToolbarActive:!t.isToolbarActive})),Go(t)}),this.state={isToolbarActive:!1,tooltipPosition:null},this.api={hideActionButton:this.hideActionButton}}componentDidMount(){const t=this.props.onSetApi;document.addEventListener("selectionchange",this.onNativeSelectionChange),document.addEventListener("click",this.onDocumentClick),window.addEventListener("resize",this.onResize),t&&t(this.api)}componentWillUnmount(){const t=this.props.onSetApi;document.removeEventListener("selectionchange",this.onNativeSelectionChange),document.removeEventListener("click",this.onDocumentClick),window.removeEventListener("resize",this.onResize),t&&t(null)}componentWillReceiveProps(t){const e=t.editorState.getSelection(),n=this.props.editorState.getSelection();e.getHasFocus()&&Object(v.v)(o.RichUtils.getCurrentBlockType(t.editorState))?e!==n&&this.hideToolbar():this.hideActionButton()}render(){const t=!this.props.readOnly&&this.state.isToolbarActive,e=this.state.tooltipPosition;return a.a.createElement("div",{ref:this.setContainerRef},a.a.createElement(qn.b,{targetPosition:e},a.a.createElement(zo,{className:t?Ho.a.isPressed:void 0,onClick:this.onActionButtonClick,onMouseDown:Go,onMouseMove:Go},t?a.a.createElement(Wo,{style:qo(e)},a.a.createElement(Po,{onChange:this.props.onChange,editorState:this.props.editorState,language:this.props.language})):null)))}}var Yo=n("./src/reddit/components/RichTextEditor/editorStateTransforms.ts");function Jo(){return new Map}const Zo=a.a.createContext(Jo());function Xo(t){class e extends a.a.Component{constructor(){super(...arguments),this.elementRef=null,this.updateElementRef=(t=>{const e=this.props.registry;this.elementRef=t,t?e.set(this.props.entityKey,t):e.delete(this.props.entityKey)})}componentWillReceiveProps(t){const e=this.props.registry;this.props.entityKey!==t.entityKey&&this.elementRef&&(e.get(this.props.entityKey)===this.elementRef&&e.delete(this.props.entityKey),e.set(t.entityKey,this.elementRef))}render(){return a.a.createElement("span",{ref:this.updateElementRef},a.a.createElement(t,Object.assign({},this.props)))}}return t=>a.a.createElement(Zo.Consumer,null,n=>a.a.createElement(e,Object.assign({},t,{registry:n})))}var $o=n("./src/reddit/components/RichTextEditor/emotes/helpers.ts"),tr=n("./src/reddit/components/RichTextEditor/emotes/decorator.m.less"),er=n.n(tr);const nr={strategy:$o.e,component:Xo(t=>{const e=t.contentState,n=Object($o.i)(e);var o=e.getEntity(t.entityKey).getData();const r=o.id,i=o.emoji,s=o.sticker,c=n?s:i;return a.a.createElement("span",{className:Object(p.a)(er.a.emote,{[er.a.sticker]:n}),title:`:${r}:`,style:{backgroundImage:`url(${c.path})`,height:c.y,width:c.x}},t.children)})},or=()=>nr;var rr=n("./src/higherOrderComponents/makeAsync.tsx"),ir=Object(rr.a)({ErrorComponent:()=>null,LoadingComponent:()=>null,getComponent:()=>n.e("EmotesTooltip").then(n.bind(null,"./src/reddit/components/RichTextEditor/emotes/tooltip.tsx")).then(t=>t.default)});const sr=Object(rr.a)({ErrorComponent:()=>null,LoadingComponent:()=>null,getComponent:()=>n.e("GifTooltip").then(n.bind(null,"./src/reddit/components/RichTextEditor/media/GifTooltip/index.tsx")).then(t=>t.default)});var ar=function(t){return a.a.createElement(sr,Object.assign({},t))};const cr=new Set([M.a.LINK]);var lr=n("./src/reddit/components/RichTextEditor/entity/link/helpers.tsx"),dr=n("./src/reddit/components/RichTextEditor/entity/link/decorator.m.less"),ur=n.n(dr);const pr=g.a.a("RegularLink",ur.a),hr={strategy:lr.a,component:Xo(t=>{const e=t.contentState.getEntity(t.entityKey).getData().url;return a.a.createElement(pr,{href:e},t.children)})},gr=()=>hr;var mr=n("./src/lib/linkMatchers/index.ts"),fr=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(c){r=!0,i=c}finally{try{!o&&a.return&&a.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();const br=(t,e)=>{if(e.getType()===v.f)return[];return(t.match(e.getText())||[]).filter(t=>((t,{index:e,lastIndex:n})=>{for(let o=e;o<n;o++)if(t.getInlineStyleAt(o).contains(v.k.MONOSPACE))return!1;return!0})(e,t))},yr=(t,e,n,r)=>{const i=t.getBlockForKey(e),s=o.SelectionState.createEmpty(e),a=[],c=new Set;let l=t;const d=(t,e,o)=>{let r=null;for(let s=t;s<e;s++){const t=i.getEntityAt(s),e=t&&l.getEntity(t);if(e){if(e.getType()!==n)return;r||c.has(t)||(r=t)}}if(r){l.getEntity(r).getData().url!==o&&(l=l.mergeEntityData(r,{url:o}))}return r||(t=>(l=l.createEntity(n,"MUTABLE",{url:t})).getLastCreatedEntityKey())(o)},u=(t,e,n)=>{const r=s.merge({anchorOffset:t,focusOffset:e});l=o.Modifier.applyEntity(l,r,n)},p=(t,e)=>u(t,e,null),h=l.getBlockForKey(e);br(r,h).forEach(({index:t,lastIndex:e,url:n})=>{const o=d(t,e,n);o&&(u(t,e,o),c.add(o),a.push([t,e]))});let g=0;return h.findEntityRanges(t=>{const e=t.getEntity();return!!e&&l.getEntity(e).getType()===n},(t,e)=>{if(g>=a.length)return void p(t,e);var n=fr(a[g],2);const o=n[0],r=n[1];e<=o?p(t,e):(t<o&&p(t,o-1),e>r&&p(r,e),g++)}),l},Er=(t,e)=>{const n=t.getCurrentContent(),r=e.getCurrentContent();if(n===r)return t;const i=n.getBlockMap(),s=r.getBlockMap();let a=n;return i.forEach((t,e)=>{if(e){if(t===s.get(e))return;a=yr(a,e,M.a.SUBREDDIT_LINK,mr.d),a=yr(a,e,M.a.USER_LINK,mr.g)}}),t.getCurrentContent()===a?t:(a=a.merge({selectionAfter:t.getCurrentContent().getSelectionAfter(),selectionBefore:t.getCurrentContent().getSelectionBefore()}),o.EditorState.set(t,{currentContent:a}))};var Sr=t=>{return!!t.getCurrentContent().getBlockMap().filter(t=>!!t&&t.getType()===v.a).size};const Cr=" ".repeat(4),Or=new RegExp("^ {1,4}|\\t"),xr=new Set([v.b.CODE_BLOCK]),vr=(t,e)=>{const n=e.getCurrentContent(),r=e.getSelection(),i=t.shiftKey;let s=n,a=r.getAnchorOffset(),c=r.getFocusOffset();if(Object(Q.a)(n,r,(t,e)=>{const n=t.getType();if("paragraph"===n||!xr.has(n))return!1;let l=null;const d=t.getText(),u=o.SelectionState.createEmpty(e);if(i){const t=d.match(Or);if(t){const e=t[0].length;s=V.b(s,u.merge({focusOffset:e}),""),l=-e}}else s=V.a(s,r.isCollapsed()?r:u,Cr),l=4;null!==l&&(e===r.getAnchorKey()&&(a+=l),e===r.getFocusKey()&&(c+=l))}),s!==n)return s=s.merge({selectionAfter:r.merge({anchorOffset:a,focusOffset:c})}),t.preventDefault(),o.EditorState.push(e,s,i?"remove-range":"insert-characters")},Tr=(t,e)=>(t=>{const e=t.getSelection(),n=t.getCurrentContent();if(!e.isCollapsed())return tt(t);if(0===e.getStartOffset()){const o=n.getBlockForKey(e.getEndKey());if(Object(v.v)(o.getType()))return t;{const e=n.getBlockBefore(o.getKey());if(e&&Object(v.v)(e.getType()))return t}}})(t)||((t,e)=>{const n=t.getSelection(),r=t.getCurrentContent();if(n.isCollapsed()&&0===n.getStartOffset()){const i=r.getBlockForKey(n.getEndKey());if(Object(v.o)(i.getType()))return Object(A.d)(t,i.getKey());if(Object(v.u)(i.getType())){const e=r.getBlockBefore(i.getKey());return o.EditorState.forceSelection(t,Object(K.b)(e))}if(!Object(A.r)(e)&&Object(K.g)(i)){const e=r.getBlockBefore(i.getKey());if(e&&Object(v.o)(e.getType()))return t=o.EditorState.push(t,Object(K.i)(r,i.getKey()),G.f),o.EditorState.forceSelection(t,Object(K.b)(e))}}})(t,e),kr=(t,e)=>(t=>{const e=t.getSelection(),n=t.getCurrentContent();if(!e.isCollapsed())return tt(t);{const o=n.getBlockForKey(e.getEndKey());if(e.getEndOffset()===o.getLength()){if(Object(v.v)(o.getType()))return t;{const e=n.getBlockAfter(o.getKey());if(e&&Object(v.v)(e.getType()))return t}}}})(t)||((t,e)=>{const n=t.getSelection(),r=t.getCurrentContent();if(!n.isCollapsed())return;const i=r.getBlockForKey(n.getEndKey());if(n.getEndOffset()===i.getLength()){if(Object(v.o)(i.getType()))return Object(A.d)(t,i.getKey());{const s=r.getBlockAfter(n.getEndKey());if(s&&Object(v.o)(s.getType())){if(Object(A.r)(e))return Object(A.d)(t,s.getKey());if(Object(K.g)(i))return t=o.EditorState.push(t,Object(K.i)(r,i.getKey()),G.f),o.EditorState.forceSelection(t,Object(K.b)(s))}}}})(t,e),jr=t=>{const e=t.getSelection();if(!e.isCollapsed())return!1;const n=o.RichUtils.getCurrentBlockType(t);if(!v.c.includes(n))return!1;if(e.getFocusOffset()>0){if("\n"===t.getCurrentContent().getBlockForKey(e.getFocusKey()).getText()[e.getFocusOffset()-1])return!1}return!0};var wr=n("./src/lib/memoizeByReference/index.ts");const Rr=Object(wr.a)(t=>{const e=t.getSelection();if(!e.isCollapsed())return;const n=e.getStartOffset(),o=t.getCurrentContent(),r=o.getBlockForKey(e.getFocusKey());if(r.getType()!==v.n)return;const i=r.getText();if(i.startsWith("1.")&&2===n)return v.i.ORDERED;if(i.startsWith("*")&&1===n){const t=o.getBlockBefore(r.getKey());if(t&&t.getType()===v.n&&t.getText().startsWith("* "))return;return v.i.UNORDERED}}),Br=t=>{const e=Rr(t);if(!e)return t;const n=Object(Yo.a)(t);let r=o.Modifier.replaceText(n.getCurrentContent(),n.getSelection().merge({anchorOffset:0}),"");return r=o.Modifier.setBlockType(r,r.getSelectionAfter(),e),o.EditorState.push(n,r,G.c)};var Ir=n("./src/reddit/components/RichTextEditor/helpers/styles.ts"),Ar=n("./src/reddit/components/RichTextEditor/spoiler/helpers.ts"),Kr=n("./src/reddit/components/RichTextEditor/spoiler/decorator.m.less"),Mr=n.n(Kr);const _r=()=>({strategy:Ar.a,component:t=>a.a.createElement("span",{className:Mr.a.spoiler},a.a.createElement("span",null),t.children,a.a.createElement("span",null))});var Lr=n("./src/reddit/components/FocusableContent/index.tsx"),Dr=n("./src/reddit/contexts/InsideOverlay.tsx"),Fr=n("./node_modules/lodash/debounce.js"),Nr=n.n(Fr),Pr=n("./src/reddit/actions/subredditAutocomplete.ts"),Ur=n("./src/reddit/helpers/name/index.ts"),Hr=n("./src/reddit/selectors/subredditAutocomplete.ts"),Vr=n("./src/reddit/controls/SubredditDropdown/index.m.less"),zr=n.n(Vr),Wr=function(t,e){var n={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(n[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(t);r<o.length;r++)e.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(t,o[r])&&(n[o[r]]=t[o[r]])}return n};const qr=t=>{var e=t.isFocused,n=Wr(t,["isFocused"]);return a.a.createElement("div",Object.assign({className:Object(p.a)(zr.a.entry,{[zr.a.mIsFocused]:e})},n))};class Gr extends s.Component{constructor(t){super(t),this.mouseDown=!1,this.onMouseUp=(()=>{this.mouseDown&&(this.props.onEntrySelect(this.props.entry),this.mouseDown=!1)}),this.onMouseDown=(t=>{this.mouseDown=!0,t.preventDefault()}),this.onMouseOver=(()=>{this.props.onEntryFocus(this.props.entry)}),this.mouseDown=!1}componentDidUpdate(){this.mouseDown=!1}render(){return a.a.createElement(qr,{isFocused:this.props.isFocused,onMouseDown:this.onMouseDown,onMouseUp:this.onMouseUp,onMouseOver:this.onMouseOver},this.props.children)}}const Qr=Object(l.c)({subredditSuggestions:(t,e)=>{const n=Object(Hr.e)(t,e);return n?n.subreddits:[]}});var Yr=Object(c.b)(Qr,(t,e)=>({onGetSubredditAutocomplete:e=>{t(Pr.d(e))}}))(class extends s.Component{constructor(t){super(t),this.api=null,this.onEntrySelect=(t=>{this.props.onSelect(this.props.subredditSuggestions[t].name)}),this.onEntryFocus=(t=>{this.setState({selectedSuggestionIndex:t})}),this.moveUp=(()=>{if(this.props.subredditSuggestions.length>1){let t=this.state.selectedSuggestionIndex-1;return t=t<0?this.props.subredditSuggestions.length-1:t,this.setState({selectedSuggestionIndex:t}),!0}return!1}),this.moveDown=(()=>{if(this.props.subredditSuggestions.length>1){const t=(this.state.selectedSuggestionIndex+1)%this.props.subredditSuggestions.length;return this.setState({selectedSuggestionIndex:t}),!0}return!1}),this.selectCurrent=(()=>{if(this.props.subredditSuggestions.length){const t=this.props.subredditSuggestions[this.state.selectedSuggestionIndex];return t&&this.props.onSelect(t.name),!0}return!1}),this.state={selectedSuggestionIndex:0},this.requestSubredditAutocomplete=Nr()(this.requestSubredditAutocomplete.bind(this),200,{maxWait:200}),this.api={moveUp:this.moveUp,moveDown:this.moveDown,selectCurrent:this.selectCurrent}}componentDidMount(){this.requestSubredditAutocomplete(this.props.substring),this.props.onDropdownApi(this.api)}componentWillUnmount(){this.props.onDropdownApi(null)}componentWillReceiveProps(t){t.substring!==this.props.substring&&(this.requestSubredditAutocomplete(t.substring),this.setState({selectedSuggestionIndex:0}))}requestSubredditAutocomplete(t){this.props.onGetSubredditAutocomplete(t)}render(){return this.props.subredditSuggestions.length?a.a.createElement("div",{className:Object(p.a)(zr.a.list,this.props.className)},this.props.subredditSuggestions.map((t,e)=>a.a.createElement(Gr,{entry:e,isFocused:e===this.state.selectedSuggestionIndex,key:t.name,onEntrySelect:this.onEntrySelect,onEntryFocus:this.onEntryFocus},Object(Ur.b)(t.name)))):null}}),Jr=n("./src/reddit/components/RichTextEditor/Blockquote/index.m.less"),Zr=n.n(Jr);const Xr=g.a.div("BlockQuoteWrapper",Zr.a),$r=Object(_.Map)({[v.e]:{element:"blockquote",wrapper:a.a.createElement(Xr,null)}});var ti=n("./src/reddit/components/RichTextEditor/CodeBlock/index.m.less"),ei=n.n(ti);const ni=g.a.div("CodeBlockWrapper",ei.a),oi=Object(_.Map)({[v.f]:{element:"code",wrapper:a.a.createElement(ni,null)}});var ri=n("./node_modules/bowser/src/bowser.js"),ii=n.n(ri),si=n("./node_modules/lodash/includes.js"),ai=n.n(si),ci=n("./src/reddit/components/RichTextEditor/DragController/helpers.ts"),li=n("./src/reddit/components/RichTextEditor/DragController/index.m.less"),di=n.n(li);const ui=g.a.div("DropLine",di.a),pi=g.a.wrapped(qn.b,"Tooltip",di.a);class hi extends s.Component{constructor(t){super(t),this.dragCount=0,this.setContainerRef=(t=>this.containerRef=t),this.preventDocumentDrop=(t=>{!!function t(e){return e.draggable?e:e.parentElement?t(e.parentElement):null}(t.target)||(t.preventDefault(),t.stopPropagation())}),this.onDragOver=(t=>{const e=ai()(t.dataTransfer.types,zt);if(!e){if(!Object(ci.c)(t.dataTransfer)||!this.props.allowMediaUploads)return}if(!e&&!Object(ci.c)(t.dataTransfer))return;t.preventDefault();try{t.dataTransfer.dropEffect=e?"move":"copy"}catch(i){}const n=this.props.editorState;let o=null;const r=Object(ci.b)(n,t);if(r){const t=this.containerRef.getBoundingClientRect().left;o={top:r.clientY,left:t}}Wn()(o,this.state.point)||this.setState({point:o})}),this.onDragEnter=(t=>{this.dragCount++}),this.onDragLeave=(t=>{this.dragCount--,0===this.dragCount&&this.state.point&&this.setState({point:null})}),this.onDrop=(t=>{const e=()=>{this.dragCount=0,this.setState({point:null})},n=ii.a.msie?null:t.dataTransfer.getData(zt),o=Object(ci.a)(t.dataTransfer);if(!(n||o.length&&this.props.allowMediaUploads))return void e();const r=this.props.editorState,i=Object(ci.b)(r,t);if(!i)return void e();t.preventDefault(),t.stopPropagation();const s=i.isBefore?K.a.before:K.a.after;n?this.props.onBlockMove(n,i.blockKey,s):setTimeout(()=>{this.props.onFilesDrop(o,i.blockKey,s)}),e()}),this.state={point:null}}componentDidMount(){document.addEventListener("drop",this.preventDocumentDrop),document.addEventListener("dragover",this.preventDocumentDrop)}componentWillUnmount(){document.removeEventListener("drop",this.preventDocumentDrop),document.removeEventListener("dragover",this.preventDocumentDrop)}render(){const t=this.props.children,e=this.state.point,n=a.a.Children.only(t);return a.a.createElement("div",{className:Object(p.a)(di.a.container,{[di.a.hideCaret]:!!e}),onDragEnter:this.onDragEnter,onDragLeave:this.onDragLeave,onDragOver:this.onDragOver,onDrop:this.onDrop,ref:this.setContainerRef},a.a.createElement("div",null,n),a.a.createElement(pi,{targetPosition:e},a.a.createElement(ui,null)))}}var gi=n("./node_modules/draft-js/lib/DraftPasteProcessor.js"),mi=n.n(gi),fi=n("./node_modules/draft-js/lib/getEntityKeyForSelection.js"),bi=n.n(fi),yi=n("./node_modules/draft-js/lib/splitTextIntoTextBlocks.js"),Ei=n.n(yi),Si=n("./src/reddit/components/RichTextEditor/entity/cloneEntitiesInFragment.ts"),Ci=n("./src/reddit/components/RichTextEditor/entity/applyEntityToContentBlock.ts");var Oi=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(c){r=!0,i=c}finally{try{!o&&a.return&&a.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();function xi(t,e,n){const r=Object(o.convertFromHTML)(e,void 0,n);if(r){const e=r.contentBlocks,n=r.entityMap;if(e){const r=o.BlockMapBuilder.createFromArray(function(t){return t.map(t=>Object(v.r)(t.getType())?j(t):t)}(e));return[t.set("entityMap",n),r]}}return[t,null]}function vi(t,e,n){const r=Ei()(e),i=n&&1===r.length?n:o.CharacterMetadata.create(),s=mi.a.processText(r,i).map(t=>t.merge({type:v.n}));return o.BlockMapBuilder.createFromArray(s)}const Ti=t=>{if(!t)return null;const e=document.createElement("div");e.innerHTML=t;const n=e.querySelector("[data-reddit-rtjson]");return n&&n.getAttribute("data-reddit-rtjson")},ki=t=>{if(yt())return{text:window.clipboardData.getData("text"),html:null};{const e=t.clipboardData.getData("text/html");return{text:t.clipboardData.getData("text/plain"),html:e}}};function ji(t,e,n,r){var i=ki(n);const s=i.text,a=i.html,c=function(t,e,n,o){const r={text:e,html:n,rtjson:o,fragment:null},i=t.getClipboard();return i&&n&&function(t,e,n,o){return-1!==e.indexOf(o)||1===t.size&&t.first().getText()===n}(i,n,e,t.getEditorKey())&&(r.fragment=i),r}(e,s,a,a&&Ti(a));e.getClipboard()&&!c.fragment&&e.setClipboard(null);const l=t.getCurrentContent(),d=t.getSelection(),u=t.getCurrentInlineStyle(),p=e.props.blockRenderMap;let h=null,g=l;if(!(h=function(t,e,n){const o=t.getBlockForKey(e.getStartKey()),r=t.getBlockForKey(e.getEndKey());if(o.getType()===v.f||r.getType()===v.f)return vi(0,n).map(t=>t.merge({type:v.f,depth:0}))}(g,d,c.text))&&c.fragment){h=c.fragment;var m=Object(Si.b)(g,h),f=Oi(m,2);g=f[0],h=f[1],h=vt(h,r)}if(!h&&c.rtjson&&(h=function(t){const e=JSON.parse(t);return Object(o.convertFromRaw)(e).getBlockMap()}(c.rtjson)),!h&&c.html){var b=xi(g,c.html,p),y=Oi(b,2);g=y[0],h=y[1]}if(!h&&c.text){const t=function(t,e,n){return o.CharacterMetadata.create({style:n,entity:bi()(t,e)})}(g,d,u);var E=function(t,e){let n=t,o=e;return e.forEach(t=>{const e=t.getText(),r=mr.c.match(e);if(!r)return;let i=t;r.forEach(({index:t,lastIndex:e,url:r})=>{const s=(n=n.createEntity(M.a.LINK,"MUTABLE",{url:r})).getLastCreatedEntityKey();i=Object(Ci.a)(i,t,e,s),o=o.set(i.getKey(),i)})}),[n,o]}(g,h=vi(0,c.text,t)),S=Oi(E,2);g=S[0],h=S[1]}if(h)return g=function(t,e,n){if(n.isEmpty())return t;let o=ct(t,e,n)||Tt(t,e,n);return o||(o=V.c(t,e,n))}(g,d,h),o.EditorState.push(t,g,G.e)}var wi=n("./src/reddit/components/RichTextEditor/entity/getSelectionEntityInfo.ts"),Ri=n("./src/reddit/components/RichTextEditor/Tooltip/getSelectionClientRect.ts"),Bi=n("./src/reddit/components/RichTextEditor/LinksController/LinkDetailsPopup/index.m.less"),Ii=n.n(Bi);const Ai=Object(Yt.e)("postCreation.linkDetailsPopup.changeButton"),Ki=Object(Yt.e)("postCreation.linkDetailsPopup.removeButton"),Mi=g.a.div("LinkDetailsBox",Ii.a),_i=g.a.a("Link",Ii.a),Li=g.a.a("LinkButton",Ii.a);var Di=t=>a.a.createElement("div",null,a.a.createElement(Mi,{onMouseDown:t=>t.preventDefault()},a.a.createElement(_i,{href:t.url,target:"_blank"},t.url),a.a.createElement("span",null," – "),a.a.createElement(Li,{onClick:()=>t.onStartEdit(),role:"button"},Ai(t.language)),a.a.createElement("span",null," | "),a.a.createElement(Li,{onClick:()=>t.onRemove(),role:"button"},Ki(t.language)))),Fi=n("./src/reddit/controls/Input/index.tsx"),Ni=n("./src/reddit/components/RichTextEditor/LinksController/LinkEditorPopup/index.m.less"),Pi=n.n(Ni);const Ui=Object(Yt.e)("postCreation.linkEditorPopup.insertButton"),Hi=Object(Yt.e)("postCreation.linkEditorPopup.applyButton"),Vi=Object(Yt.e)("postCreation.linkEditorPopup.textLabel"),zi=Object(Yt.e)("postCreation.linkEditorPopup.linkLabel"),Wi=Object(Yt.e)("postCreation.linkEditorPopup.textInputPlaceholder"),qi=Object(Yt.e)("postCreation.linkEditorPopup.linkInputPlaceholder"),Gi=Object(Yt.e)("postCreation.linkEditorPopup.invalidLinkHint"),Qi=g.a.form("EditForm",Pi.a),Yi=g.a.wrapped(t=>a.a.createElement("div",Object.assign({},t),t.children),"LinkEditorBox",Pi.a),Ji=g.a.wrapped(Fi.a,"Input",Pi.a),Zi=g.a.label("Label",Pi.a),Xi=g.a.div("HintAndButtonRow",Pi.a),$i=g.a.span("InvalidUrlHint",Pi.a),ts=g.a.wrapped(re.f,"SubmitButton",Pi.a),es=t=>{t&&(t.focus(),t.select())},ns=/ /g,os=t=>t.replace(ns,"%20");class rs extends s.Component{constructor(t){super(t),this.focused=!1,this.focusLostTimer=0,this.textInputElementRef=null,this.urlInputElementRef=null,this.onEdited=(()=>{const t=this.state.url.trim(),e=os(t),n=Object(mr.f)(e);if(!n)return this.setState({isInvalidUrl:!0}),void(this.urlInputElementRef&&this.urlInputElementRef.focus());const o=n.url;this.props.onEdited(o,this.state.displayText.trim()||t)}),this.onFocus=(()=>{this.focused=!0}),this.onBlur=(()=>{this.focused=!1,this.focusLostTimer=window.setTimeout(()=>{this.focused||this.props.onFocusLost()},0)}),this.onClick=(t=>{t.stopPropagation()}),this.handleUrlChange=(t=>{const e=t.target.value;let n=this.state.isInvalidUrl;n&&Object(mr.e)(mr.c,e)&&(n=!1),this.setState({url:e,isInvalidUrl:n})}),this.handleDisplayTextChange=(t=>{this.setState({displayText:t.target.value})}),this.handleSubmit=(t=>{this.onEdited(),t.preventDefault()}),this.state={url:t.url,displayText:t.displayText,isInvalidUrl:!1}}componentDidMount(){Object(mr.e)(mr.c,this.state.displayText)?es(this.textInputElementRef):es(this.urlInputElementRef)}componentWillUnmount(){this.focusLostTimer&&clearTimeout(this.focusLostTimer)}render(){var t=this.props;const e=t.language,n=t.isInsertMode;return a.a.createElement(Yi,{tabIndex:0,onClick:this.onClick,onBlur:this.onBlur,onFocus:this.onFocus},a.a.createElement(Qi,{onSubmit:this.handleSubmit},a.a.createElement(Zi,null,Vi(e),":",a.a.createElement(Ji,{innerRef:t=>this.textInputElementRef=t,type:"text",placeholder:Wi(e),value:this.state.displayText,onChange:this.handleDisplayTextChange})),a.a.createElement(Zi,null,zi(e),":",a.a.createElement(Ji,{innerRef:t=>this.urlInputElementRef=t,type:"text",placeholder:qi(e),value:this.state.url,onChange:this.handleUrlChange})),a.a.createElement(Xi,null,a.a.createElement(ts,{type:"submit",disabled:this.state.isInvalidUrl},n?Ui(e):Hi(e)),this.state.isInvalidUrl?a.a.createElement($i,null,Gi(e)):null)))}}function is(t,e,n){const o=t.getCurrentContent(),r={text:"",url:""};if(e.isCollapsed())return r;if(n)r.text=n.entityText,r.url=o.getEntity(n.entityKey).getData().url;else{r.text=function(t,e){if(t.getStartKey()!==t.getEndKey())throw new Error("Selection must be in a single block");return t.isCollapsed()?"":e.getBlockForKey(t.getStartKey()).getText().slice(t.getStartOffset(),t.getEndOffset())}(e,t.getCurrentContent());const n=Object(mr.e)(mr.c,r.text);n&&(r.url=n.url)}return r}function ss(t,e){return o.EditorState.set(t,{currentContent:o.Modifier.removeInlineStyle(t.getCurrentContent(),e,v.k.HIGHLIGHT)})}class as extends s.Component{constructor(t){super(t),this.api=null,this.updateTooltipPosition=null,this.lastEditorSelectionClientRect=null,this.editLinkInSelection=(t=>{const e=this.props.editorState;let n=t,r=e;const i=e.getCurrentContent();if(!Object(lr.e)(i,t))return!1;const s=Object(wi.a)(i,t);if(s){if(i.getEntity(s.entityKey).getType()!==M.a.LINK)return!1;n=s.entitySelection}else this.isEditorFocused()&&(this.lastEditorSelectionClientRect=Object(Ri.a)());return this.state.linkSelection&&(r=ss(e,this.state.linkSelection)),r=function(t,e){return o.EditorState.set(t,{currentContent:o.Modifier.applyInlineStyle(t.getCurrentContent(),e,v.k.HIGHLIGHT)})}(e,n),this.props.onChange(r,()=>{this.setState({linkSelection:n,linkEntity:s})}),!0}),this.hidePopup=(()=>{this.interruptLinkEditing(),this.hideDetailsPopup()}),this.showDetailsPopup=(()=>{this.state.isDetailsPopupActive||this.setState({isDetailsPopupActive:!0})}),this.hideDetailsPopup=(()=>{this.state.isDetailsPopupActive&&this.setState({isDetailsPopupActive:!1})}),this.updatePosition=(()=>{if(!this.updateTooltipPosition)return;const t=this.props.editorState,e=t.getCurrentContent();let n;if(this.state.linkSelection){const t=Object(wi.a)(e,this.state.linkSelection);if(t){const e=this.props.entityElementRegistry.get(t.entityKey);n=e&&e.getBoundingClientRect()}else this.lastEditorSelectionClientRect&&(n=this.lastEditorSelectionClientRect)}else{const e=Object(lr.b)(t);if(e){const t=this.props.entityElementRegistry.get(e.entityKey);n=t&&t.getBoundingClientRect()}}n&&(this.updateTooltipPosition({left:n.left,top:n.bottom}),this.lastEditorSelectionClientRect=null)}),this.handleLink=((t,e)=>{const n=this.state.linkSelection,r=this.props.editorState;let i=r;n&&(n.isCollapsed()||(i=ss(r,n)),void 0!==t&&(i=Object(lr.h)(i,n,t,e)),this.setState({linkSelection:null,linkEntity:null}),i!==r&&(i=o.EditorState.forceSelection(i,i.getSelection()),this.props.onChange(i)))}),this.onLinkEdited=((t,e)=>{this.handleLink(t,e)}),this.interruptLinkEditing=(()=>this.handleLink()),this.isEditorFocused=(()=>this.props.editorState.getSelection().getHasFocus()),this.onStartEditFocusedLink=(()=>{const t=this.props.editorState,e=Object(lr.b)(t);e&&this.editLinkInSelection(e.entitySelection)}),this.onRemoveFocusedLink=(()=>{const t=this.props.editorState,e=Object(lr.b)(t);e&&this.props.onChange(Object(lr.h)(t,e.entitySelection,""))}),this.renderEditorPopup=(()=>{var t=this.state;const e=t.linkSelection,n=t.linkEntity,o=this.props.editorState;if(!e)return null;var r=is(o,e,n);const i=r.text,s=r.url;return a.a.createElement(rs,{url:s,displayText:i,isInsertMode:!n,onEdited:this.onLinkEdited,onFocusLost:this.interruptLinkEditing,language:this.props.language})}),this.renderDetailsPopup=(()=>{const t=Object(lr.b)(this.props.editorState);return t&&this.isEditorFocused()&&this.state.isDetailsPopupActive?a.a.createElement(Di,{url:t.url,onStartEdit:this.onStartEditFocusedLink,onRemove:this.onRemoveFocusedLink,language:this.props.language}):null}),this.state={isDetailsPopupActive:!1,linkSelection:null,linkEntity:null},this.api={editLinkInSelection:this.editLinkInSelection,hidePopup:this.hidePopup}}componentDidMount(){const t=this.props.onSetApi;this.api&&t&&t(this.api)}componentWillUnmount(){this.props.onSetApi&&this.props.onSetApi(null)}componentDidUpdate(t,e){e.linkSelection===this.state.linkSelection&&t.editorState===this.props.editorState||(this.showDetailsPopup(),this.updatePosition())}render(){return a.a.createElement(qn.b,{onSetPositionUpdater:t=>this.updateTooltipPosition=t,trianglePlacement:qn.a.Above},this.renderEditorPopup()||this.renderDetailsPopup())}}var cs=n("./src/reddit/components/RichTextEditor/OrderedList/index.m.less"),ls=n.n(cs);const ds=g.a.ol("OrderedListWrapper",ls.a),us=Object(_.Map)({[v.i.ORDERED]:{element:"li",aliasedElements:["li"],wrapper:a.a.createElement(ds,null)}});var ps=n("./src/reddit/components/RichTextEditor/Paragraph/index.m.less"),hs=n.n(ps);const gs=g.a.div("ParagraphWrapper",hs.a),ms=Object(_.Map)({[v.n]:{element:"div",aliasedElements:["p"],wrapper:a.a.createElement(gs,null)}});var fs=n("./src/reddit/components/RichTextEditor/RTEState/index.tsx"),bs=n("./src/reddit/helpers/styles/mixins/fonts.tsx"),ys=n("./src/reddit/components/RichTextEditor/TextRendering/index.m.less"),Es=n.n(ys);const Ss=Object(wr.a)(()=>({[v.k.SUPERSCRIPT]:{position:"relative",top:"-0.4em",fontSize:"0.7em",lineHeight:"0.7em"},[v.k.HIGHLIGHT]:{backgroundColor:"#b8e0f9"},[v.k.UNDERLINE]:{textDecoration:"none"},[v.k.MONOSPACE]:{backgroundColor:"var(--newRedditTheme-field)",caretColor:"#000",color:"var(--newRedditTheme-monospaceColor)",fontFamily:bs.c,padding:"0.1em 0.2em",fontSize:"0.8em",borderRadius:"3px"}})),Cs=g.a.div("H1",Es.a),Os=g.a.div("H2",Es.a),xs=g.a.div("H3",Es.a),vs=g.a.div("H4",Es.a),Ts=g.a.div("H5",Es.a),ks=g.a.div("H6",Es.a),js=t=>({component:e=>a.a.createElement(t,null,a.a.createElement(o.EditorBlock,Object.assign({},e))),editable:!0}),ws={[v.g.H1]:js(Cs),[v.g.H2]:js(Os),[v.g.H3]:js(xs),[v.g.H4]:js(vs),[v.g.H5]:js(Ts),[v.g.H6]:js(ks)},Rs=["italic normal 1em 'Noto Sans'","italic bold 1em 'Noto Sans'","normal bold 1em 'Noto Sans'"],Bs=()=>{const t=document.fonts;t&&t.load&&Rs.forEach(e=>t.load(e))};var Is=n("./src/reddit/components/RichTextEditor/UnorderedList/index.m.less"),As=n.n(Is);const Ks=g.a.ul("UnorderedListWrapper",As.a),Ms=Object(_.Map)({[v.i.UNORDERED]:{element:"li",aliasedElements:["li"],wrapper:a.a.createElement(Ks,null)}});var _s=n("./node_modules/lodash/dropRightWhile.js"),Ls=n.n(_s),Ds=n("./node_modules/lodash/flatMap.js"),Fs=n.n(Ds),Ns=n("./node_modules/lodash/reduceRight.js"),Ps=n.n(Ns),Us=n("./node_modules/lodash/trimEnd.js"),Hs=n.n(Us),Vs=n("./node_modules/lodash/trimStart.js"),zs=n.n(Vs),Ws=n("./src/lib/forEachGroup/index.ts");function qs(t,e){const n=[],o=t.withMutations(t=>{for(;t.size&&e(t.first());)n.push(t.first()),t.shift()});return{popped:n,stack:o}}var Gs=n("./src/lib/linkMatchers/customLinks.ts"),Qs=n("./src/lib/unicodeUtils/index.ts"),Ys=n("./src/reddit/helpers/richTextJson/index.ts"),Js=n("./src/reddit/models/RichTextJson/nodeMakers.ts");const Zs={BOLD:lo.j.bold,ITALIC:lo.j.italic,MONOSPACE:lo.j.monospace,STRIKETHROUGH:lo.j.strikethrough,SUBSCRIPT:lo.j.subscript,SUPERSCRIPT:lo.j.superscript,UNDERLINE:lo.j.underline};var Xs=(t,e)=>$s(t.getBlockMap(),t,e);const $s=(t,e,n)=>{const o=[];let r=t.toStack();for(;r.size;){const t=r.first(),l=t.getType();switch(r=r.shift(),l){case v.g.H1:case v.g.H2:case v.g.H3:case v.g.H4:case v.g.H5:case v.g.H6:o.push(ra(t,e));break;case v.e:{var i=qs(r,t=>t.getType()===v.e);const n=i.popped;r=i.stack,o.push(ia([t,...n],e));break}case v.f:{var s=qs(r,t=>t.getType()===v.f);const e=s.popped;r=s.stack,o.push(sa([t,...e]));break}case v.i.ORDERED:case v.i.UNORDERED:{var a=qs(r,t=>t.getType()===l);const n=a.popped;r=a.stack,o.push(aa([t,...n],e));break}case v.l:{var c=qs(r,t=>Object(v.v)(t.getType()));const n=c.popped;r=c.stack,o.push(ca([t,...n],e));break}case v.a:{let e=r.first();e&&Object(v.u)(e.getType())?r=r.shift():e=void 0,o.push(la(t,e,n));break}case v.n:default:o.push(na(t,e))}}return o},ta=(t,e)=>{const n=[],o=Object(Qs.b)(t);return Object(Ws.a)(e,{keyFn:t=>t.getStyle()},(e,r,i,s)=>{if(r.isEmpty())return;const a=t.slice(i,s),c=i+(a.length-zs()(a).length),l=s-(a.length-Hs()(a).length),d=l-c,u=o[c],p=o[l]-u;d>0&&n.push([(t=>t.reduce((t,e)=>e===v.k.UNDERLINE||e===v.k.SUBSCRIPT?t:t|(Zs[e]||0)|0,0))(r),u,p])}),n.length?n:null},ea=(t,e)=>{const n=t.getText(),o=t.getCharacterList(),r=[],i=v.d.includes(t.getType()),s=v.c.includes(t.getType());let a=0;return Object(Ws.a)(o,{keyFn:(t,o)=>{const r=t.getEntity();return i&&t.getStyle().contains(v.k.SPOILER)?"spoiler":Object(M.b)(r,e)?`link-${t.getEntity()}`:"\n"===n[o]?s?"linebreak":"skip":r&&e.getEntity(r).getType()===M.a.EMOTE?`emote-${a++}`:"text"}},(t,i,s,a)=>{const c=n.slice(s,a),l=o.slice(s,a).toList();if("text"===i){const t=ta(c,l);r.push(Object(Js.s)(c,t))}else if("spoiler"===i)r.push(Object(Js.n)(c));else if(i.startsWith("link-")){const n=e.getEntity(t.getEntity());r.push(((t,e,n)=>{const o=t.getData().url,r="/"===e[0];if(t.getType()===M.a.SUBREDDIT_LINK){const t=e.replace(Gs.d,"");return Object(Js.o)(t,r)}if(t.getType()===M.a.USER_LINK){const t=e.replace(Gs.d,"");return Object(Js.t)(t,r)}const i=ta(e,n);return Object(Js.i)(e,o,i)})(n,c,l))}else if("linebreak"===i)r.push(Object(Js.h)());else if(i.startsWith("emote-")){const n=e.getEntity(t.getEntity()).getData();r.push(Object(Js.e)(n.fullId,n.imageType))}}),r},na=(t,e)=>Object(Js.l)(ea(t,e)),oa=t=>"text"===t.e?Object(Js.m)(t.t):"link"===t.e?Object(Js.i)(t.t,t.u,null):t.e===lo.x?t.c.map(oa):t.e===lo.n?Object(Js.m)(""):t,ra=(t,e)=>Object(Js.f)(v.m[t.getType()],((t,e)=>Ps()(Fs()(ea(t,e),oa),([t,...e],n)=>{if(!t)return[n];const o=e.length?e:[];return t&&"raw"===n.e&&"raw"===t.e?[Object(Js.m)(n.t+t.t),...o]:[n,t,...o]},[]))(t,e)),ia=(t,e)=>Object(Js.c)(Ls()(t.map(t=>((t,e)=>t.getText().trim().length?na(t,e):Js.a)(t,e)),t=>t===Js.a)),sa=t=>Object(Js.d)(t.map(t=>Object(Js.m)(t.getText()))),aa=(t,e)=>{if(!t.length)return Object(Js.k)([],!1);const n=t[0].getDepth();let o=null;const r=[];let i=[];const s=()=>null!==o||i.length,a=()=>{const t=[];null!==o&&(t.push(o),o=null),i.length&&(t.push(aa(i,e)),i=[]),r.push(Object(Js.j)(t))};return t.forEach(t=>{t.getDepth()>n?i.push(t):(s()&&a(),o=Object(Js.l)(ea(t,e)))}),s()&&a(),Object(Js.k)(r,t[0].getType()===v.i.ORDERED)},ca=(t,e)=>{const n=[...t].sort(z.b),o=n[0];const r=Object(z.g)(o).colCount,i=F()(n,r),s=i[0].map(t=>{const n=Object(z.g)(t).alignment;return Object(Js.q)(ea(t,e),n)}),a=i.slice(1).map(t=>t.map(t=>Object(Js.p)(ea(t,e))));return Object(Js.r)(s,a)},la=(t,e,n)=>{const o=Object(A.h)(t);if(!o)throw new Error("Invalid atomic block!");const r=o.uploadInfo,i=o.mediaAsset,s=o.makeGif,a=e?e.getText():"";if(r&&n){const t=n[r.uploadKey],e=t&&t.metadata.mimetype||"";var c=Object(A.f)(o,n);const i=c.assetId,l=c.thumbnailAssetId;return Object(Pt.j)(e)?Object(Js.b)(i,a):Object(Pt.k)(e)?Object(Js.g)(i,a):Object(Js.u)(i,a,l,s)}{const t=i.assetId;let e;switch(i.type){case A.a.AnimatedImage:e=Object(Js.b)(t,a);break;case A.a.Image:e=Object(Js.g)(t,a);break;case A.a.Video:e=Object(Js.u)(t,a);break;default:throw new Error("Invalid media type")}return Object(Ys.d)(t)?Object(Js.l)([e]):e}};var da,ua=n("./src/reddit/constants/componentSizes.ts"),pa=n("./src/reddit/constants/elementIds.ts");!function(t){t.Up="up",t.Down="down"}(da||(da={}));var ha=t=>{const e=window.getSelection().focusNode;if(!e||!e.parentElement)return;const n=document.getElementById(pa.d),o=n||document.documentElement;if(!o)return;const r=window.innerHeight;var i=e.parentElement.getBoundingClientRect();const s=i.bottom,a=i.top,c=n?0:ua.g+ua.q;t===da.Up&&a<c?o.scrollBy(0,a-c):t===da.Down&&s>r&&o.scrollBy(0,s-r)},ga=n("./src/reddit/models/Product/index.ts"),ma=(t,e,n)=>{const o={url:n};return t.createEntity(e,"MUTABLE",o)},fa=n("./node_modules/lodash/maxBy.js"),ba=n.n(fa);const ya=(t,e)=>{if(!e)return(t=>{const e=t.id;switch(t.e){case lo.m:return{assetId:e,type:A.a.Image};case lo.a:return{assetId:e,type:A.a.AnimatedImage};case lo.C:return{assetId:e,type:A.a.Video}}})(t);const n=e.id;switch(e.e){case lo.s:{const t=e.s;return{assetId:n,type:A.a.Image,imageUrl:t.u,width:t.x,height:t.y}}case lo.r:{const t=e.s;return{assetId:n,type:A.a.AnimatedImage,imageUrl:t.gif,posterUrl:t.p,dashUrl:t.mp4,width:t.x,height:t.y}}case lo.t:{const t=e.isGif,o=e.dashUrl,r=e.hlsUrl,i=e.p,s=e.x,a=e.y;let c;if(i){c=ba()(i,t=>t.x).u}return{assetId:n,type:A.a.Video,isGif:t,dashUrl:o,hlsUrl:r,posterUrl:c,width:s,height:a}}}};function Ea(t,e,n){const r=t.id,i=t.c,s=lo.D(e,r),a=ya(t,s),c=[new o.ContentBlock({key:Object(o.genKey)(),type:v.a,data:Object(_.Map)({mediaAsset:a})})];if(n){const t=Object(K.h)(Object(o.genKey)(),i).merge({type:v.j});c.push(t)}return c}var Sa=function(){return function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var n=[],o=!0,r=!1,i=void 0;try{for(var s,a=t[Symbol.iterator]();!(o=(s=a.next()).done)&&(n.push(s.value),!e||n.length!==e);o=!0);}catch(c){r=!0,i=c}finally{try{!o&&a.return&&a.return()}finally{if(r)throw i}}return n}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();const Ca=Object.keys(Zs),Oa=(t,e,n)=>{switch(e.e){case lo.u:return wa(t,e.c,v.b.UNSTYLED,n);case lo.k:const o=v.h[e.l];return wa(t,e.c||[],o,n);case lo.p:return Ta(t,e,n);case lo.b:return xa(t,e,n);case lo.c:return void e.c.forEach(e=>wa(t,[e],v.b.CODE_BLOCK,n));case lo.z:return va(t,e,n);case lo.m:case lo.a:case lo.C:return void t.blocks.push(...Ea(e,n.mediaMetadataMap,Object(A.r)(n.editorType)))}},xa=(t,e,n)=>{e&&e.c&&e.c.length&&e.c.forEach(e=>e.e===lo.u?wa(t,e.c,v.b.BLOCK_QUOTE,n):Oa(t,e,n))},va=(t,e,n)=>{const o=e.h,r=e.c,i=o.length;[o,...r].forEach((e,r)=>e.forEach((e,s)=>{var a=e.c;const c=void 0===a?[]:a,l={alignment:o[s].a,colCount:i,colIndex:s,rowIndex:r};wa(t,c,v.b.TABLE_CELL,n,l)}))},Ta=(t,e,n,o=0)=>{const r=e.o?v.b.ORDERED_LIST:v.b.UNORDERED_LIST;e.c.forEach(e=>{const i=e.c;if(!i||!i.length)return;var s=Sa(i,2);const a=s[0],c=s[1],l=a.e===lo.u?a.c:[];wa(t,l,r,n,void 0,o),c&&c.e===lo.p&&Ta(t,c,n,o+1)})},ka={[lo.y]:["r/","/r/"],[lo.B]:["u/","/user/"],[lo.v]:["p/",""],[lo.g]:["c/",""]},ja={[lo.y]:M.a.SUBREDDIT_LINK,[lo.B]:M.a.USER_LINK,[lo.v]:M.a.POST_LINK,[lo.g]:M.a.COMMENT_LINK},wa=(t,e,n,r,i={},s,a=!1)=>{const c=t.content;if(1===e.length&&(e[0].e===lo.m||e[0].e===lo.a)){const n=e[0];if(Object(Ys.d)(n.id))return void t.blocks.push(...Ea(n,r.mediaMetadataMap,Object(A.r)(r.editorType)))}var l=Ra(e,c,r);const d=l.charList,u=l.text,p=l.updatedContent,h=new o.ContentBlock({key:Object(o.genKey)(),characterList:Object(_.List)(d),data:Object(_.fromJS)(i),depth:s,text:u,type:n});t.content=p||c,a?t.blocks.unshift(h):t.blocks.push(h)},Ra=(t,e,n)=>{let o=e,r="";const i=[];if(t.forEach(t=>{const e=Ba(t,o,n);o=e.updatedContent||o,r+=e.text,i.push(...e.charList)}),r.length!==i.length)throw new Error("Characters length mismatch!");return{charList:i,text:r,updatedContent:o!==e?o:void 0}},Ba=(t,e,n)=>{switch(t.e){case lo.A:{const e=t.t,n=t.f;return{charList:Ia(e,n),text:e}}case lo.x:{const r=t.c,i=Ra(r,e,n);return i.charList=i.charList.map(t=>(t=>o.CharacterMetadata.create({style:t.getStyle().add(v.k.SPOILER),entity:t.getEntity()}))(t)),i}case lo.v:case lo.g:case lo.w:{const e=t.t;return{charList:Ia(e),text:e}}case lo.y:case lo.B:{var r=Sa(ka[t.e],2);const n=r[0],o=r[1],i=(t.l?"/":"")+n+t.t,s=o+t.t,a=ma(e,ja[t.e],s),c=a.getLastCreatedEntityKey();return{charList:Ia(i,void 0,c),text:i,updatedContent:a}}case lo.o:{const n=t.t,o=t.u,r=t.f,i=ma(e,M.a.LINK,o),s=i.getLastCreatedEntityKey();return{charList:Ia(n,r,s),text:n,updatedContent:i}}case lo.m:case lo.a:const i=t.id;if(i.startsWith("emote|")){const t=Object(ga.b)(i),o=n.activeEmotes&&n.activeEmotes[t];if(o){const t=Object($o.c)(e,o),n=t.getLastCreatedEntityKey(),r=$o.a;return{charList:Ia(r,void 0,n),text:r,updatedContent:t}}const r=`:${t}:`;return{charList:Ia(r),text:r}}return{text:"",charList:Ia("")};default:return{text:"",charList:Ia("")}}},Ia=(t,e,n=null)=>{const r=o.CharacterMetadata.create({entity:n}),i=Array(t.length).fill(r),s=Object(Qs.a)(t);return e&&e.forEach(t=>{var e=Sa(t,3);const r=e[0],a=e[1],c=e[2],l=(t=>{const e=Ca.filter(e=>!!(Zs[e]&t));return Object(_.OrderedSet)(e)})(r),d=a+c,u=o.CharacterMetadata.create({entity:n,style:l});i.fill(u,s[a],s[d])}),i},Aa=(t,e)=>{t.blocks.length&&(t.blocks[0].getType()===v.b.TABLE_CELL&&wa(t,[],v.b.UNSTYLED,e,void 0,void 0,!0),t.blocks[t.blocks.length-1].getType()===v.b.TABLE_CELL&&wa(t,[],v.b.UNSTYLED,e))};var Ka=(t,e,n,r)=>{const i="string"==typeof t?JSON.parse(t):t;if(!i||!i.document||!i.document.length)return null;const s={editorType:e,mediaMetadataMap:n,activeEmotes:r?r.reduce((t,e)=>Object.assign({},t,e.emotes),{}):void 0},a={blocks:[],content:o.ContentState.createFromText("")};i.document.forEach(t=>{Oa(a,t,s)}),0===a.blocks.length&&wa(a,[],v.b.UNSTYLED,s),Aa(a,s);const c=o.BlockMapBuilder.createFromArray(a.blocks),l=o.SelectionState.createEmpty(c.first().getKey());return a.content.merge({blockMap:c,selectionBefore:l,selectionAfter:l})},Ma=n("./src/reddit/constants/elementClassNames.ts"),_a=n("./src/reddit/constants/keycodes.ts"),La=n("./src/reddit/selectors/economics.ts"),Da=n("./src/reddit/components/RichTextEditor/index.m.less"),Fa=n.n(Da);Object(fs.b)({draftToRTFJson:Xs,getMediaCount:A.g,getPendingThumbnailUploads:A.i,isAllMediaUploaded:A.m});const Na="handled",Pa="not-handled",Ua=/^\s*$/,Ha=20,Va=g.a.wrapped(Lr.a,"FocusableContent",Fa.a),za=Object(c.b)(()=>{const t=(()=>Object(l.a)(t=>t.uploads,(t,e)=>Object(x.e)(x.b.RTE_MEDIA,e.rteState.editorKey),(t,e)=>i()(t,t=>t.key.startsWith(e))))();return Object(l.c)({editorUploads:t,emotesEnabled:E.d.spEmotes,giphyEnabled:E.d.spGiphy,activeEmotes:(t,e)=>!!e.destSubreddit&&e.destSubreddit.id&&Object(La.c)(t,e.destSubreddit.id)||void 0})},t=>({onFetchEditorProducts:e=>t(Object(b.d)(e)),onTrackMediaDrop:e=>t((t,n)=>S.l(n(),e)),retryUpload:e=>t(y.a(e)),startUploads:(e,n,o)=>t(y.b(e,n,o))}));class Wa extends s.Component{constructor(t){super(t),this.blockRenderMap=o.DefaultDraftBlockRenderMap.merge($r,oi,Vn,us,ms,Ms,mn),this.editorHeight=null,this.editorRef=null,this.editorRootStyleMutationObserver=null,this.linksControllerApi=null,this.subredditDropdownApi=null,this.tableToolbarControllerApi=null,this.emotesTooltipApi=null,this.gifTooltipApi=null,this.updateSubredditDropdownPosition=null,this.isJustAutocompleteSelected=!1,this.isJustLinkified=!1,this.isMouseDown=!1,this.isJustConvertedToList=!1,this.needSyncScroll=null,this.transforms={[T.BREAK_HEADER_ENTITY]:Yo.b,[T.INSERT_LINE_BREAK]:Yo.e,[T.REDUCE_LIST_INDENT]:Yo.f,[T.RESET_CURRENT_AND_PREVIOUS_BLOCKS]:Yo.g,[T.REMOVE_EXTRA_LIST_ITEM]:Yo.h,[R.d]:t=>kr(t,this.props.editorType),[R.b]:t=>Tr(t,this.props.editorType),[R.f]:Yo.d,[R.c]:t=>Object(Yo.c)(v.k.BOLD,t),[R.e]:t=>Object(Yo.c)(v.k.ITALIC,t),[R.g]:t=>Object(Yo.c)(v.k.UNDERLINE,t)},this.setContainerRef=(t=>{const e=this.props.domRef;e&&e(t),this.setState({containerRef:t})}),this.setFocusableContentRef=(t=>this.setState({focusableContentRef:t})),this.rteStateChanged=((t,e)=>{const n=Object.assign({},this.props.rteState,{isBound:!0,editorState:t});this.props.onChange(n,e)}),this.hideTooltips=(()=>{this.emotesTooltipApi&&this.emotesTooltipApi.closeTooltip(),this.gifTooltipApi&&this.gifTooltipApi.closeTooltip(),this.tableToolbarControllerApi&&this.tableToolbarControllerApi.hideActionButton(),this.linksControllerApi&&this.linksControllerApi.hidePopup(),this.suppressAutocompleteForFocusedLink()}),this.onEditorStyleChanged=(()=>{if(!this.editorRef)return;const t=this.editorRef.refs.editor,e=t.style.height?Number.parseInt(t.style.height):null;this.editorHeight!==e&&(this.hideTooltips(),this.editorHeight=e,e&&this.props.onEditorResize&&this.props.onEditorResize(e))}),this.insertValidatedMedia=(()=>{const t=this.props.editorUploads;var e=this.state;const n=e.editorState,o=e.mediaToInsert;if(!o)return;const r=o.files,i=o.blockKey,s=o.insertionMode,a=r.map(e=>t.find(t=>t.file===e)).filter(Boolean);this.setState({mediaToInsert:null});const c=a.filter(t=>!!t.metadata.mimetype);c.length&&this.onChange(Object(A.l)(n,c,i,s))}),this.focus=(()=>this.editorRef&&this.editorRef.focus()),this.blur=(()=>this.editorRef&&this.editorRef.blur()),this.isFocused=(()=>this.state.editorState.getSelection().getHasFocus()),this.setEditorRef=(t=>this.editorRef=t),this.setSubredditDropdownApi=(t=>this.subredditDropdownApi=t),this.setLinksControllerApi=(t=>this.linksControllerApi=t),this.setTableToolbarControllerApi=(t=>this.tableToolbarControllerApi=t),this.setEmotesTooltipApi=(t=>this.emotesTooltipApi=t),this.setGifTooltipApi=(t=>this.gifTooltipApi=t),this.setSubredditDropdownPositionUpdater=(t=>this.updateSubredditDropdownPosition=t),this.getEditorState=(()=>this.state.editorState),this.setEditorState=((t,e)=>{const n=this.state.editorState.getCurrentContent()!==t.getCurrentContent();n&&this.props.readOnly||(this.setState({editorState:t},e),this.rteStateChanged(t,n))}),this.toolbarSetState=(t=>{const e=t.getInlineStyleOverride();let n=t;n.getSelection().getHasFocus()||(n=o.EditorState.forceSelection(n,n.getSelection()),e&&(n=o.EditorState.setInlineStyleOverride(n,e))),this.onChange(n)}),this.onChange=((t,e)=>{let n=t;n=An(n,this.state.editorState),n=_t(n,this.props.editorType),this.emotesTooltipApi&&(n=Object($o.d)(n,this.state.editorState)),n=Er(n,this.state.editorState),n=Object(Ir.d)(n,this.state.editorState),this.state.shouldShowFtuMessage&&this.state.editorState.getCurrentContent()!==t.getCurrentContent()&&this.setState({shouldShowFtuMessage:!1}),this.setEditorState(n,e);let o=this.state.suppressAutocompleteForLink;if(o){const e=Object(lr.c)(t);e&&e.entityKey===o||(o=null)}this.setState({suppressAutocompleteForLink:o}),this.isJustAutocompleteSelected=!1,this.isJustLinkified=!1,this.isMouseDown=!1,this.isJustConvertedToList=!1}),this.onFocus=(()=>{var t=this.props;const e=t.enableFtuMessage,n=t.onFocus;e&&this.setState({shouldShowFtuMessage:!0}),this.emotesTooltipApi&&this.emotesTooltipApi.closeTooltip(),this.gifTooltipApi&&this.gifTooltipApi.closeTooltip(),n&&n()}),this.handleBeforeInput=(t=>{const e=this.state.editorState;if(this.isMouseDown)return Na;if(Mt(e,t))return Na;let n=function(t,e){const n=t.getSelection(),r=n.getFocusOffset();if(!n.isCollapsed()||0===r)return;const i=n.getFocusKey(),s=t.getCurrentContent(),a=s.getBlockForKey(i),c=a.getEntityAt(r-1),l=a.getEntityAt(r);if(!c||l&&l===c)return;const d=s.getEntity(c),u=cr.has(d.getType());if("MUTABLE"===d.getMutability()&&u){const r=o.Modifier.insertText(s,n,e,t.getCurrentInlineStyle());return o.EditorState.push(t,r,"insert-characters")}}(e,t)||e;return(n=jn(n,t)||n)!==e?(this.onChange(n),Na):Pa}),this.keyBindingFN=(t=>{const e=this.state.editorState,n=this.props.submitOnEnter,r=e.getSelection();if(t.metaKey&&t.keyCode===_a.a.K)return T.OPEN_LINK_TOOLTIP;if(t.keyCode===_a.a.Space){if(Rr(e))return T.CONVERT_TO_LIST_ON_SPACE;if(Object(lr.d)(e))return T.LINKIFY_ON_SPACE}else if(t.keyCode===_a.a.Enter){if(t.ctrlKey||t.metaKey||n&&!t.shiftKey)return T.SUBMIT;if(t.shiftKey&&jr(e))return T.INSERT_LINE_BREAK;{const t=this.enterKeyBinding(e);if(t)return t}}else if(t.keyCode===_a.a.Backspace){if(this.isJustLinkified||this.isJustConvertedToList)return R.h;if(r.isCollapsed()){const t=e.getCurrentContent(),n=r.getEndKey(),o=r.getStartOffset(),i=t.getBlockForKey(n),s=i.getType();if((Object(v.s)(s)||Object(v.q)(s)||Object(v.p)(s))&&0===o&&i.getLength()>0){const e=t.getBlockBefore(n);if(!e||e.getType()!==s)return T.MAKE_PLAIN_BLOCK}}}return Object(o.getDefaultKeyBinding)(t)}),this.handleKeyCommand=(t=>{const e=this.state.editorState;let n=t,r=null;const i=t=>{let e=t;if(r){var n=r;const t=n.selection,o=n.url;e=Object(lr.f)(e,t,o)}return this.onChange(e),this.isJustLinkified=!!r,Na};if(n===T.SUBMIT)this.props.onSubmit();else{if(n===T.CONVERT_TO_LIST_ON_SPACE){const t=i(Br(e));return this.isJustConvertedToList=!0,t}if(n===T.LINKIFY_ON_SPACE)return r=Object(lr.d)(e),i(Object(Yo.a)(e));if(n===T.LINKIFY_ON_ENTER&&(r=Object(lr.d)(e),!(n=this.enterKeyBinding(e,!1))))return i(Object(Yo.d)(e))}if(n===T.OPEN_LINK_TOOLTIP)return this.onToolbarLinkButtonClick(),Na;if(n===T.MAKE_PLAIN_BLOCK){return i(Object(Yo.i)(v.n,e))}if(n===T.EXEC_TABLE_ON_ENTER_HANDLER)return i(this.tableOnEnterHandler.handle(e));const s=this.transforms[n];if(s){const t=s(e);if(t)return i(t)}const a=o.RichUtils.handleKeyCommand(e,n);return a?i(a):Pa}),this.handleOnTab=(t=>{if(this.emotesTooltipApi&&this.emotesTooltipApi.handleTabInEditor()||this.subredditDropdownApi&&this.subredditDropdownApi.selectCurrent())return void t.preventDefault();const e=this.state.editorState;let n=xn(t,e);if(n=n||vr(t,e))return void this.onChange(n);const r=o.RichUtils.onTab(t,e,2);this.onChange(r)}),this.handleOnUpArrow=(t=>{if(this.emotesTooltipApi&&this.emotesTooltipApi.handleUpArrowInEditor()||this.subredditDropdownApi&&this.subredditDropdownApi.moveUp())return void t.preventDefault();const e=vn(t,this.state.editorState)||At(t,this.state.editorState);e&&this.onChange(e),this.needSyncScroll=da.Up}),this.handleOnDownArrow=(t=>{if(this.subredditDropdownApi&&this.subredditDropdownApi.moveDown())return void t.preventDefault();const e=Tn(t,this.state.editorState)||Kt(t,this.state.editorState);e&&this.onChange(e),this.needSyncScroll=da.Down}),this.handleReturn=(t=>{const e=Bt(this.state.editorState);return e?(this.onChange(e),t.preventDefault(),Na):this.subredditDropdownApi&&this.subredditDropdownApi.selectCurrent()?(t.preventDefault(),Na):Pa}),this.suppressAutocompleteForFocusedLink=(()=>{const t=Object(lr.c)(this.state.editorState);t&&this.state.suppressAutocompleteForLink!==t.entityKey&&this.setState({suppressAutocompleteForLink:t.entityKey})}),this.handleEscape=(t=>{this.emotesTooltipApi&&this.emotesTooltipApi.handleEscapeKeyInEditor(),this.suppressAutocompleteForFocusedLink()}),this.handleOnCopy=(t=>{this.editorRef&&Ct(this.state.editorState,this.editorRef,t)}),this.handleOnCut=(t=>{const e=this.state.editorState;if(!this.editorRef)return;if(!Ct(e,this.editorRef,t))return;const n=at(e)||Rt(e)||Object(A.e)(e);n&&this.onChange(n)}),this.handleOnPaste=(t=>{const e=this.state.editorState;if(!this.editorRef)return;if(this.handleFilesPaste(t,e),t.isPropagationStopped())return;const n=ji(e,this.editorRef,t,this.props.editorType);n&&this.onChange(n)}),this.handleFilesPaste=((t,e)=>{const n=t.clipboardData.files;if(n&&n.length){const o=Array.from(n),r=e.getSelection().getEndKey();this.insertMediaFiles({files:o,blockKey:r,insertionMode:K.a.after,filesSource:f.FileSource.Clipboard}),t.stopPropagation()}}),this.handleOnMouseDown=(t=>{this.isMouseDown=!0}),this.handleOnMouseUp=(t=>{this.isMouseDown=!1}),this.handleDroppedFiles=((t,e)=>Na),this.handleDrop=((t,e,n)=>Na),this.handleBlur=(()=>{this.props.onBlur&&this.props.onBlur()}),this.handlePastedText=((t,e)=>Na),this.onSubredditSuggestionSelected=(t=>{this.onChange(Object(lr.g)(this.state.editorState,t)),this.isJustAutocompleteSelected=!0}),this.onToolbarEmoteButtonClick=(t=>{this.gifTooltipApi&&this.gifTooltipApi.closeTooltip(),this.emotesTooltipApi&&this.emotesTooltipApi.toggleTooltip(t)}),this.onToolbarGifButtonClick=(t=>{this.emotesTooltipApi&&this.emotesTooltipApi.closeTooltip(),this.gifTooltipApi&&this.gifTooltipApi.toggleTooltip(t)}),this.onToolbarLinkButtonClick=(()=>{if(!this.linksControllerApi)return;const t=this.state.editorState;this.linksControllerApi.editLinkInSelection(t.getSelection())||Object(m.b)(void 0,"Current selection cannot be edited by link editor!")}),this.onToolbarFtuTooltipClick=(()=>{this.setState({shouldShowFtuMessage:!1})}),this.handleSwitchToMarkdownMode=(()=>{const t=this.state.editorState,e=this.props.onSwitchEditorMode,n=fs.a.toRichTextJSON(Object.assign({},this.props.rteState,{isBound:!0,editorState:Object(A.c)(t)}));e&&e(O.h.MARKDOWN,n),this.state.confirmModalOpen&&this.toggleConfirmModal()}),this.onToolbarMarkdownSwitchClick=(()=>{const t=this.state.editorState;t&&Sr(t)?this.setState({confirmModalOpen:!0}):this.handleSwitchToMarkdownMode()}),this.toggleConfirmModal=(()=>{this.setState({confirmModalOpen:!this.state.confirmModalOpen})}),this.onToolbarOverflowMenuClick=(()=>{this.setState({shouldShowFtuMessage:!1})}),this.insertMediaFiles=(async t=>{this.setState({mediaToInsert:t});const e=t.files,n=t.filesSource,o=e.slice(0,Ha);await this.props.startUploads(o,n,this.props.rteState.editorKey),this.insertValidatedMedia()}),this.onRetryUpload=(t=>{this.props.retryUpload(t)}),this.onFilesSelect=(t=>{const e=this.state.editorState.getSelection().getEndKey();this.insertMediaFiles({files:t,blockKey:e,insertionMode:K.a.after,filesSource:f.FileSource.FileSelector})}),this.onFilesDrop=((t,e,n)=>{this.props.onTrackMediaDrop(t),this.insertMediaFiles({files:t,blockKey:e,insertionMode:n,filesSource:f.FileSource.DragAndDrop})}),this.onBlockMove=((t,e,n)=>{const o=this.state.editorState,r=Object(A.o)(o,t,e,n);r&&this.onChange(r)}),this.getAtomicBlocksRenderConfig=(()=>({component:pn,props:{getEditorState:this.getEditorState,onChange:this.onChange,onRetryUpload:this.onRetryUpload,rteFocusableContentRef:this.state.focusableContentRef,editorType:this.props.editorType}})),this.blockRendererFn=(t=>{const e=t.getType();return e===v.a?this.getAtomicBlocksRenderConfig():e in ws?ws[e]:void 0}),this.renderToolbar=(t=>a.a.createElement(qe.b,Object.assign({},t))),this.entityElementRegistry=Jo(),this.tableOnEnterHandler=new kn;const e=t.activeEmotes,n=t.editorType,r=t.noBorder,i=t.initialHeight,s=t.initialMinHeight,c=t.rteState;let l;c.isBound?l=c.editorState:Object(lo.E)(c.initialRTJSON)?l=this.createInitialState(c.editorKey):(l=o.EditorState.createWithContent(Ka(c.initialRTJSON,n,c.mediaMetadataMap,e),this.editorDecorators()),l=this.moveSelectionToEnd(l)),this.state={noBorder:r,containerRef:null,confirmModalOpen:!1,editorState:l,focusableContentRef:null,inited:!1,initialHeight:i,initialMinHeight:s,mediaToInsert:null,shouldShowFtuMessage:!1,suppressAutocompleteForLink:null}}editorDecorators(){return new o.CompositeDecorator([or(),_r(),gr()])}moveSelectionToEnd(t){const e=t.getCurrentContent().getBlockMap(),n=e.last().getKey(),r=e.last().getLength(),i=new o.SelectionState({anchorKey:n,anchorOffset:r,focusKey:n,focusOffset:r});return o.EditorState.acceptSelection(t,i)}createInitialState(t){return o.EditorState.createWithContent(o.ContentState.createFromBlockArray([new o.ContentBlock({key:`${t}_initial`})]),this.editorDecorators())}componentDidMount(){if(this.props.rteRef&&this.props.rteRef(this),h.a.write(Bs),this.rteStateChanged(this.state.editorState,!1),this.editorRef){const t=this.editorRef.refs.editor;t.addEventListener("scroll",this.hideTooltips),this.editorRootStyleMutationObserver=new MutationObserver(this.onEditorStyleChanged),this.editorRootStyleMutationObserver.observe(t,{attributes:!0,attributeFilter:["style"]})}var t=this.props;const e=t.destSubreddit,n=t.emotesEnabled,o=t.giphyEnabled;e&&e.id&&(n||o)&&this.props.onFetchEditorProducts(e.id)}componentDidUpdate(t,e){const n=this.getLinkForAutocomplete();if(n&&this.updateSubredditDropdownPosition){const t=this.entityElementRegistry.get(n.entityKey);if(t){var o=t.getBoundingClientRect();const e=o.left,n=o.bottom;this.updateSubredditDropdownPosition({left:e,top:n})}}this.needSyncScroll&&(ha(this.needSyncScroll),this.needSyncScroll=null)}componentWillUnmount(){if(this.props.rteRef&&this.props.rteRef(null),this.insertValidatedMedia=(()=>{}),this.editorRef){this.editorRef.refs.editor.removeEventListener("scroll",this.hideTooltips)}this.editorRootStyleMutationObserver&&(this.editorRootStyleMutationObserver.disconnect(),this.editorRootStyleMutationObserver=null)}componentWillReceiveProps(t){t.rteState!==this.props.rteState&&t.rteState.isBound&&t.rteState.editorState!==this.state.editorState&&this.setState({editorState:t.rteState.editorState})}shouldComponentUpdate(t,e){if(e!==this.state)return!0;if(!(t.rteState.isBound&&t.rteState.editorState===this.state.editorState))return!0;return!u()(t,this.props,(t,e,n)=>"rteState"===n||void 0)}enterKeyBinding(t,e=!0){const n=t.getCurrentContent(),o=t.getSelection(),r=o.getStartKey(),i=o.getEndKey(),s=o.getEndOffset(),a=n.getBlockForKey(r).getType(),c=n.getBlockForKey(i),l=c.getType(),d=s===c.getText().length;if(a===v.l||l===v.l)return T.EXEC_TABLE_ON_ENTER_HANDLER;if(o.isCollapsed()){if(e&&Object(lr.d)(t))return T.LINKIFY_ON_ENTER;if(Object(v.r)(l)&&d)return T.BREAK_HEADER_ENTITY;if(Object(v.s)(l)){if(Ua.test(c.getText()))return c.getDepth()>0?T.REDUCE_LIST_INDENT:T.REMOVE_EXTRA_LIST_ITEM}else if(l===v.e){const t=n.getBlockBefore(i);if(t&&t.getType()===v.e&&Ua.test(t.getText())&&Ua.test(c.getText()))return T.RESET_CURRENT_AND_PREVIOUS_BLOCKS}else if(l===v.f){const t=n.getBlockBefore(i),e=n.getBlockAfter(i);if(!c.getText()&&t&&t.getType()===v.f&&!t.getText()&&(!e||e.getType()!==v.f))return T.RESET_CURRENT_AND_PREVIOUS_BLOCKS}}}getLinkForAutocomplete(){var t=this.state;const e=t.editorState,n=t.suppressAutocompleteForLink;if(!this.isJustAutocompleteSelected&&e.getSelection().getHasFocus()){const t=Object(lr.c)(e);if(t&&t.entityKey!==n)return t}}renderSubredditDropdown(){const t=this.getLinkForAutocomplete();return t?a.a.createElement(qn.b,{onSetPositionUpdater:this.setSubredditDropdownPositionUpdater},a.a.createElement(Yr,{onDropdownApi:this.setSubredditDropdownApi,substring:t.subredditName,onSelect:this.onSubredditSuggestionSelected})):null}render(){var t=this.props;const e=t.className,n=t.activeEmotes,r=t.userCanUseGifs;var i=t.allowMediaUploads;const s=void 0!==i&&i,c=t.dataTestId,l=t.destSubreddit,d=t.focusableContentRTEClassName,u=t.giphyEnabled,h=t.hideToolbar,g=t.rteState,m=t.isOverlay,f=t.language,b=t.placeholderText;var y=t.toolbarPosition;const E=void 0===y?"top":y;var S=t.renderToolbar;const O=void 0===S?this.renderToolbar:S,x=g.editorKey;var v=this.state;const T=v.containerRef,j=v.editorState,R=v.mediaToInsert,B=v.shouldShowFtuMessage,I=v.confirmModalOpen,A=this.props.readOnly||!!R,K=k(j),M=!(!n||!Object.keys(n).length),_=O({allowMediaUploads:s,destSubreddit:l,editorKey:x,editorState:j,isOverlay:!!m,language:f,onChange:this.toolbarSetState,onFilesSelect:this.onFilesSelect,trackOnClick:this.props.trackToolbarClick,readOnly:A,onFtuTooltipClick:this.onToolbarFtuTooltipClick,onEmoteButtonClick:M?this.onToolbarEmoteButtonClick:void 0,onGifButtonClick:u?this.onToolbarGifButtonClick:void 0,onLinkButtonClick:this.onToolbarLinkButtonClick,onMarkdownButtonClick:this.onToolbarMarkdownSwitchClick,onOverflowMenuClick:this.onToolbarOverflowMenuClick,shouldShowFtuMessage:B,userCanUseGifs:!!r});return a.a.createElement("div",{className:e,ref:this.setContainerRef},a.a.createElement(Va,{className:d,noBorder:this.props.noBorder,isFocused:this.isFocused(),ref:this.setFocusableContentRef},!h&&"top"===E&&_,T&&a.a.createElement(Qo,{editorState:j,readOnly:A,language:f,onChange:this.onChange,onSetApi:this.setTableToolbarControllerApi,rteDomRef:T}),a.a.createElement("div",{className:Object(p.a)(Fa.a.editorWrapper,{[Fa.a.hasInitialHeight]:!!this.props.initialHeight,[Fa.a.hasInitialMinHeight]:!!this.props.initialMinHeight,[Fa.a.noBorder]:!!this.props.noBorder}),style:{"--rte-initial-height":this.props.initialHeight?`${this.props.initialHeight}px`:void 0,"--rte-initial-min-height":this.props.initialMinHeight?`${this.props.initialMinHeight}px`:void 0},"data-test-id":c,onCopyCapture:this.handleOnCopy,onCutCapture:this.handleOnCut,onPasteCapture:this.handleOnPaste,onMouseDown:this.handleOnMouseDown,onMouseUp:this.handleOnMouseUp},a.a.createElement("style",{dangerouslySetInnerHTML:{__html:`\n                .${Ma.c}[${Ma.e}="${K}-0-0"]::after {\n                  bottom: 0;\n                  color: var(--newCommunityTheme-actionIcon);\n                  content: '${b}';\n                  cursor: text;\n                  left: 0;\n                  position: absolute;\n                  top: 0;\n                }\n              `}}),a.a.createElement(hi,{allowMediaUploads:s&&!A,onBlockMove:this.onBlockMove,onFilesDrop:this.onFilesDrop,editorState:j,onChange:this.onChange},a.a.createElement(Zo.Provider,{value:this.entityElementRegistry},a.a.createElement(o.Editor,{readOnly:A,ref:this.setEditorRef,blockRendererFn:this.blockRendererFn,blockRenderMap:this.blockRenderMap,editorKey:x,editorState:j,keyBindingFn:this.keyBindingFN,handleBeforeInput:this.handleBeforeInput,handleKeyCommand:this.handleKeyCommand,handlePastedText:this.handlePastedText,handleDroppedFiles:this.handleDroppedFiles,handleDrop:this.handleDrop,onBlur:this.handleBlur,onChange:this.onChange,onFocus:this.onFocus,onTab:this.handleOnTab,onUpArrow:this.handleOnUpArrow,onDownArrow:this.handleOnDownArrow,onEscape:this.handleEscape,spellCheck:!0,handleReturn:this.handleReturn,customStyleMap:Ss()})))),!h&&"bottom"===E&&_,a.a.createElement(as,{editorState:j,entityElementRegistry:this.entityElementRegistry,language:f,onSetApi:this.setLinksControllerApi,onChange:this.onChange}),M&&l&&a.a.createElement(ir,{editorState:j,onChange:this.onChange,onSetApi:this.setEmotesTooltipApi,subreddit:l}),u&&l&&a.a.createElement(ar,{editorState:j,onChange:this.onChange,onSetApi:this.setGifTooltipApi,subreddit:l,userCanUseGifs:!!r}),this.renderSubredditDropdown()),I&&a.a.createElement(w.a,{toggleModal:this.toggleConfirmModal,onConfirm:this.handleSwitchToMarkdownMode,actionText:"continue",cancelActionText:"cancel",headerText:Object(C.c)("Switch to Markdown"),modalText:Object(C.c)("Switching to markdown will remove any images, gifs or videos from your post."),trackClick:()=>{}}))}}e.a=za(Object(Dr.b)(t=>a.a.createElement(Wa,Object.assign({key:t.rteState.editorKey},t))))},"./src/reddit/components/RichTextEditor/media/MediaBlock/MediaView/ImagePreview/index.m.less":function(t,e,n){t.exports={Img:"_1gJwMe53cjYITkMu0Ve8j-",img:"_1gJwMe53cjYITkMu0Ve8j-",Component:"_3VYFd7PKhTJ-0i22YsgFPv",component:"_3VYFd7PKhTJ-0i22YsgFPv"}},"./src/reddit/components/RichTextEditor/media/MediaBlock/MediaView/Placeholder/index.m.less":function(t,e,n){t.exports={Message:"_3cyJHYsdZdz4RWdmrzyYx-",message:"_3cyJHYsdZdz4RWdmrzyYx-",Component:"_3JSUHg1gLhxUj4PB_Pgw8a",component:"_3JSUHg1gLhxUj4PB_Pgw8a"}},"./src/reddit/components/RichTextEditor/media/MediaBlock/MediaView/StatusBar/index.m.less":function(t,e,n){t.exports={buttonBaseStyles:"_3R1ajPuzbs2MdbXedj3YXU",ControlRow:"_1rrSEjTxZcLOZTDNZlj5N4",controlRow:"_1rrSEjTxZcLOZTDNZlj5N4",Button:"_2rIEdliEXr7qNb-COL-zuO",button:"_2rIEdliEXr7qNb-COL-zuO",ErrButton:"_3CUr1530H3uD-ts9tKd9RA",errButton:"_3CUr1530H3uD-ts9tKd9RA",Status:"jXuqxr-x0kyU3BSfugjwM",status:"jXuqxr-x0kyU3BSfugjwM",hasError:"_4XwI6tILia1pR9HTda4wv",ProgressBar:"_1NvtB5J5UfhiHd0ix7TZgb",progressBar:"_1NvtB5J5UfhiHd0ix7TZgb",ProgressBarInner:"_29o2WRRYmrLU47NaFzQzxq",progressBarInner:"_29o2WRRYmrLU47NaFzQzxq",ErrorLine:"_3M-thbkBHHvsWjDt8edbhz",errorLine:"_3M-thbkBHHvsWjDt8edbhz",Component:"_1CqupI5I-zzAInIdLwphQg",component:"_1CqupI5I-zzAInIdLwphQg"}},"./src/reddit/components/RichTextEditor/media/MediaBlock/MediaView/VideoPreview/index.m.less":function(t,e,n){t.exports={VideoPlayer:"_3gstD1_YUjNWZqjtwdgU9t",videoPlayer:"_3gstD1_YUjNWZqjtwdgU9t",PosterImg:"_2C2yx7Rf_BKPOyll-aq_hI",posterImg:"_2C2yx7Rf_BKPOyll-aq_hI",Poster:"_1UCJLqzcYXck8Ahv0PlvVw",poster:"_1UCJLqzcYXck8Ahv0PlvVw",Component:"wSihDBKVJH6iP2jdDjRQ6",component:"wSihDBKVJH6iP2jdDjRQ6",playButton:"il4HPAfKcVtq-WQY-if85"}},"./src/reddit/components/RichTextEditor/media/MediaBlock/MediaView/index.m.less":function(t,e,n){t.exports={statusBar:"_33CSkXq7gXeXCM2zSal9BN",container:"_1FMEfWD94pPZ_HdEN_e7Xy",isCompact:"_3-T8BPflZuKw_F2VRPDbcX",isUploaded:"_3Lj2c902Oeb7yL_jYu9v5L",isSelected:"Eaps2a9y_jwhKHth8v14G",imagePreview:"_2nlrFrYbO0bIKFeZ3HMbn_",videoPreview:"_2MumquPHY8gruoy6114twC",placeholder:"_1-LSy7nvfNGWVhRWwwQu6A",alignCenter:"_3U9f0TNBM1K2bggm3KMHTk"}},"./src/reddit/components/RichTextEditor/media/MediaBlock/SelectionHook/index.m.less":function(t,e,n){t.exports={HiddenDiv:"_13RYjdyxMuKrkV_EtlOjhg",hiddenDiv:"_13RYjdyxMuKrkV_EtlOjhg"}},"./src/reddit/components/RichTextEditor/media/MediaBlock/Toolbar/index.m.less":function(t,e,n){t.exports={container:"_3hDtN0e5U4EpahGe25ye-b",alignCenter:"Vh7FGvkGyl5SeyJP4J1GG",content:"_3wXzBVn-uBvRcixZwQWkNX",FormatterButton:"_6DRydZXlG3Ko7_4xxYUhW",formatterButton:"_6DRydZXlG3Ko7_4xxYUhW",ToolbarContent:"_3qUkCQkbZvTB6uBQEQQfSZ",toolbarContent:"_3qUkCQkbZvTB6uBQEQQfSZ"}},"./src/reddit/components/RichTextEditor/media/MediaBlock/index.m.less":function(t,e,n){t.exports={MediaContainer:"_12ZUhulrgf1BAChnRZHmZt",mediaContainer:"_12ZUhulrgf1BAChnRZHmZt",Container:"DK9d46mm9FgC8mFWPGlG_",container:"DK9d46mm9FgC8mFWPGlG_"}},"./src/reddit/components/RichTextEditor/media/MediaCaption/index.m.less":function(t,e,n){t.exports={wrapper:"_2eZK2IABgFqGZLMYPxwoNY"}},"./src/reddit/components/RichTextEditor/media/helpers.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return o}),n.d(e,"r",function(){return b}),n.d(e,"h",function(){return y}),n.d(e,"q",function(){return E}),n.d(e,"l",function(){return S}),n.d(e,"k",function(){return C}),n.d(e,"n",function(){return O}),n.d(e,"p",function(){return x}),n.d(e,"d",function(){return T}),n.d(e,"c",function(){return k}),n.d(e,"e",function(){return j}),n.d(e,"m",function(){return R}),n.d(e,"g",function(){return B}),n.d(e,"j",function(){return I}),n.d(e,"i",function(){return A}),n.d(e,"o",function(){return K}),n.d(e,"b",function(){return M}),n.d(e,"f",function(){return L});var o,r=n("./node_modules/draft-js/lib/Draft.js"),i=n("./node_modules/immutable/dist/immutable.js"),s=n("./node_modules/lodash/flatten.js"),a=n.n(s),c=n("./node_modules/lodash/last.js"),l=n.n(c),d=n("./src/reddit/helpers/media/index.ts"),u=n("./src/reddit/helpers/richTextEditor/index.ts"),p=n("./src/reddit/helpers/richTextJson/index.ts"),h=n("./src/reddit/models/Upload/index.ts"),g=n("./src/reddit/components/RichTextEditor/constants/editorChangeTypes.ts"),m=n("./src/reddit/components/RichTextEditor/helpers/common.ts"),f=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts");!function(t){t[t.Image=0]="Image",t[t.AnimatedImage=1]="AnimatedImage",t[t.Video=2]="Video"}(o||(o={}));const b=t=>t!==u.a.Comment,y=t=>{if(!Object(f.o)(t.getType()))return;const e=t.getData(),n=e.get("mediaAsset"),o=e.get("uploadInfo");if(!n&&!o)return;const r=e.get("thumbnail");return{makeGif:e.get("makeGif"),thumbnail:r,uploadInfo:o,mediaAsset:n}},E=(t,e,n)=>{let o=t.getCurrentContent();const s=o.getBlockForKey(e),a=y(s),c=a&&a.uploadInfo;if(!c)throw new Error("Block must contain `uploadInfo` data");if(n.makeGif===a.makeGif&&n.thumbnail===a.thumbnail)return t;const l=Object(i.Map)(n),d=o.getBlockMap().toKeyedSeq().filter(t=>{const e=y(t);return!!e&&!!e.uploadInfo&&e.uploadInfo.uploadKey===c.uploadKey}).map(t=>t.mergeIn(["data"],l));return o=(o=o.mergeIn(["blockMap"],d)).merge({selectionAfter:t.getSelection()}),r.EditorState.push(t,o,g.b)},S=(t,e,n,o)=>{let s=t.getCurrentContent();const c=a()(e.map(t=>{const e=Object(d.f)(t.metadata.mimetype),n=(t=>{if(t&&t.metadata.videoFirstFrameUrl)return{url:t.metadata.videoFirstFrameUrl,time:0}})(t);return[new r.ContentBlock({key:Object(r.genKey)(),type:f.a,data:Object(i.Map)({uploadInfo:{mediaType:e,uploadKey:t.key},thumbnail:n})}),new r.ContentBlock({key:Object(r.genKey)(),type:f.j})]}));s=Object(m.f)(s,n,c,o);const u=r.EditorState.push(t,s,g.e),p=l()(c);return r.EditorState.forceSelection(u,Object(m.b)(p,!0))},C=(t,e,n,s,a,c,l,d)=>{const u=new r.ContentBlock({key:Object(r.genKey)(),type:f.a,data:Object(i.Map)({mediaAsset:{type:o.AnimatedImage,assetId:Object(p.b)(e,s),imageUrl:n,width:a,height:c}})}),h=Object(m.f)(t.getCurrentContent(),l,[u],d);let b=r.EditorState.push(t,h,g.e);b=r.EditorState.forceSelection(b,Object(m.b)(u,!0));const y=u.getKey();return b.getCurrentContent().getBlockAfter(y)||(b=M(b,y)),b};function O(t,e){return t.isCollapsed()&&t.getStartKey()===e&&0===t.getStartOffset()&&0===t.getEndOffset()}function x(t,e){const n=t.getCurrentContent().getBlockAfter(e);return r.EditorState.forceSelection(t,Object(m.b)(n,!0))}const v=(t,e)=>{const n=t.getBlockAfter(e);return t=Object(m.i)(t,e),n&&Object(f.u)(n.getType())&&(t=Object(m.i)(t,n.getKey())),t},T=(t,e,n=!0)=>{let o=t.getCurrentContent();o=v(o,e);let i=n?r.EditorState.push(t,o,g.f):r.EditorState.set(t,{currentContent:o});return i=r.EditorState.forceSelection(i,o.getSelectionAfter())},k=t=>{let e=t.getCurrentContent();w(e).forEach(t=>{e=v(e,t.getKey())});const n=r.EditorState.push(t,e,g.f);return r.EditorState.forceSelection(n,e.getSelectionAfter())},j=t=>{let e=t.getCurrentContent();const n=t.getSelection();e=r.Modifier.removeRange(e,n,"forward");let o=r.EditorState.push(t,e,g.f);return o=r.EditorState.forceSelection(o,e.getSelectionAfter())},w=t=>t.getBlockMap().toSeq().filter(t=>!!t&&!!y(t)),R=(t,e)=>t.getBlockMap().toSeq().filter(t=>{const n=y(t),o=n&&n.uploadInfo&&n.uploadInfo.uploadKey;return!(!o||e[o]&&e[o].url)}).isEmpty(),B=t=>{const e=w(t),n={gifvideo:0,image:0,video:0,total:0};return e.forEach(t=>{const e=y(t);let r;r=e.makeGif?"gifvideo":e.uploadInfo&&"video"===e.uploadInfo.mediaType||e.mediaAsset&&e.mediaAsset.type===o.Video?"video":"image",n[r]++,n.total++}),n},I=t=>!w(t).isEmpty(),A=(t,e)=>{const n=w(t).map(t=>{const n=y(t),o=n.uploadInfo,r=n.thumbnail;if(!o||!r)return;const i=_(n),s=e[i];return s&&s.url?void 0:Object.assign({},r,{uploadKey:i})}).filter(Boolean).toArray();return n.length?n:void 0},K=(t,e,n,o)=>{let i=t.getCurrentContent();const s=i.getBlockForKey(e),a=i.getBlockAfter(e),c=[s];if(a&&Object(f.u)(a.getType())&&c.push(a),c.find(t=>t.getKey()===n))return;const d=c.reduce((t,e)=>t.remove(e.getKey()),i.getBlockMap());i=i.set("blockMap",d),i=Object(m.f)(i,n,c,o);const u=r.EditorState.push(t,i,g.e);return r.EditorState.forceSelection(u,Object(m.b)(l()(c),!0))},M=(t,e,n=m.a.after)=>{const o=Object(m.h)(),i=Object(m.f)(t.getCurrentContent(),e,[o],n),s=r.EditorState.push(t,i,g.e);return r.EditorState.forceSelection(s,r.SelectionState.createEmpty(o.getKey()))},_=t=>t.thumbnail&&t.uploadInfo?`${t.uploadInfo.uploadKey}-thumbnail-${t.thumbnail.time}`:"",L=(t,e)=>{let n="",o="";if(t.uploadInfo){const r=e[t.uploadInfo.uploadKey];r&&r.url&&(n=Object(h.c)(r.url));const i=e[_(t)];i&&i.url&&(o=Object(h.c)(i.url))}return{assetId:n,thumbnailAssetId:o}}},"./src/reddit/components/RichTextEditor/spoiler/decorator.m.less":function(t,e,n){t.exports={spoiler:"_1AlhnBqYYVTQbTr33YViyK"}},"./src/reddit/components/RichTextEditor/spoiler/helpers.ts":function(t,e,n){"use strict";n.d(e,"b",function(){return i}),n.d(e,"a",function(){return s});var o=n("./src/lib/forEachGroup/index.ts"),r=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts");const i=t=>t.getStyle().has(r.k.SPOILER);function s(t,e,n){const r=t.getCharacterList();Object(o.a)(r,{keyFn:i},(t,n,o,r)=>{n&&e(o,r)})}},"./src/reddit/components/RichTextEditor/table/Renderer/index.m.less":function(t,e,n){t.exports={Cell:"_1J5sneEp0XXo0pFsMN7Kjs",cell:"_1J5sneEp0XXo0pFsMN7Kjs",Row:"_2Hd-Rc7z9gTKIz6JUGhbcl",row:"_2Hd-Rc7z9gTKIz6JUGhbcl",Table:"_9QFGu47IyMX1ID1xQid-8",table:"_9QFGu47IyMX1ID1xQid-8",isFakeSelectionActive:"_1QXaG0_iXh-LFDkah9HqP3"}},"./src/reddit/components/RichTextEditor/table/Toolbar/index.m.less":function(t,e,n){t.exports={formatterButton:"_1dNavKEU0lSO4mo9fYWTPm",ToolbarContent:"_1yPmb5QUbyAQX1wIs4FYQI",toolbarContent:"_1yPmb5QUbyAQX1wIs4FYQI",tooltip:"_3fnB5glctifL-mkYhH6aA1"}},"./src/reddit/components/RichTextEditor/table/ToolbarController/index.m.less":function(t,e,n){t.exports={ActionButton:"_2g2bsszGVtKe_XRKcRrpQi",actionButton:"_2g2bsszGVtKe_XRKcRrpQi",isPressed:"_2WwwYG59S_TJRq7FSdTVKK",ToolbarWrapper:"_3rXrpMuvoGNBbLE7TQQCB9",toolbarWrapper:"_3rXrpMuvoGNBbLE7TQQCB9"}},"./src/reddit/components/RichTextEditor/table/helpers.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return c}),n.d(e,"g",function(){return l}),n.d(e,"m",function(){return u}),n.d(e,"n",function(){return p}),n.d(e,"j",function(){return h}),n.d(e,"l",function(){return g}),n.d(e,"f",function(){return m}),n.d(e,"k",function(){return f}),n.d(e,"c",function(){return b}),n.d(e,"h",function(){return y}),n.d(e,"b",function(){return E}),n.d(e,"i",function(){return S}),n.d(e,"e",function(){return C}),n.d(e,"o",function(){return O}),n.d(e,"d",function(){return x});var o=n("./node_modules/draft-js/lib/Draft.js"),r=n("./node_modules/immutable/dist/immutable.js"),i=n("./src/reddit/models/RichTextJson/index.ts"),s=n("./src/reddit/components/RichTextEditor/helpers/sliceContiguousBlocks.ts"),a=n("./src/reddit/components/RichTextEditor/styleAndBlockTypes.ts");const c={[i.e]:"left",[i.f]:"right",[i.d]:"center"},l=t=>{const e=t.getData();return{colIndex:e.get("colIndex"),rowIndex:e.get("rowIndex"),colCount:e.get("colCount"),alignment:e.get("alignment")}},d=["data"],u=(t,e)=>t.mergeIn(d,e),p=(t,e,n)=>t.merge({text:t.getText().slice(e,n),characterList:t.getCharacterList().slice(e,n)}),h=(t,e,n="",r)=>{const i=e.map(t=>t.getText()).join(n),s=n?r||o.CharacterMetadata.create():null,a=[];return e.forEach(t=>{a.push(...t.getCharacterList().toArray()),s&&e.length>1&&a.push(s)}),t.merge({text:i,characterList:a})},g=(t,e)=>{const n=[];for(let i=0;i<e;i++)for(let e=0;e<t;e++)n.push(new o.ContentBlock({key:Object(o.genKey)(),type:a.l,data:Object(r.Map)({colCount:t,colIndex:e,rowIndex:i})}));return n},m=(t,e)=>({minCol:Math.min(t.colIndex,e.colIndex),minRow:Math.min(t.rowIndex,e.rowIndex),maxCol:Math.max(t.colIndex,e.colIndex),maxRow:Math.max(t.rowIndex,e.rowIndex)}),f=(t,e)=>{var n=m(t,e);const o=n.minCol,r=n.minRow,i=n.maxCol,s=n.maxRow;return(t,e)=>r<=t&&t<=s&&o<=e&&e<=i},b=(t,e)=>t.rowIndex<e.rowIndex?-1:t.rowIndex>e.rowIndex?1:t.colIndex-e.colIndex,y=(t,e)=>t===e||!(!t||!e)&&0===b(t,e),E=(t,e)=>b(l(t),l(e)),S=t=>{if(Object(a.v)(t.getType())){return 0===l(t).rowIndex}return!1},C=(t,e,n)=>{const o=(e,n)=>{if(e){const o=Object(s.a)(t,e);return o&&n&&-1!==o.blocks.indexOf(n)?[o,o]:[o,n?Object(s.a)(t,n):null]}return n?o(n,null).reverse():[null,null]};return o(Object(a.v)(e.getType())?e:null,Object(a.v)(n.getType())?n:null)},O=(t,e,n,o=!1)=>{const r={isBackward:o};return e&&(r.anchorKey=e.getKey(),r.anchorOffset=o?e.getLength():0),n&&(r.focusKey=n.getKey(),r.focusOffset=o?0:n.getLength()),t.merge(r)},x=t=>{if(!t.length)return[];const e=t[0].length;return t.map((t,n)=>t.map((t,o)=>u(t,{rowIndex:n,colIndex:o,colCount:e})))}},"./src/reddit/components/ThumbnailSelector/index.m.less":function(t,e,n){t.exports={Component:"uqOt5KqJAqw5pe-WNxa0a",component:"uqOt5KqJAqw5pe-WNxa0a",TitleRow:"HEiFtUR3s93dQ2jUWWnxr",titleRow:"HEiFtUR3s93dQ2jUWWnxr",Close:"_3RlS_q06rJ_8dy_UNp3Ev7",close:"_3RlS_q06rJ_8dy_UNp3Ev7",CloseWrapper:"_3lFQIq1yN1kLxjZb5AvHjL",closeWrapper:"_3lFQIq1yN1kLxjZb5AvHjL",ThumbnailsContainer:"_2sw7c1Sfzp0uz-RIcglCo",thumbnailsContainer:"_2sw7c1Sfzp0uz-RIcglCo",Image:"_2H32szY9NZ1aKr6j4Ced7u",image:"_2H32szY9NZ1aKr6j4Ced7u",thumbnail:"_2Ks8P6YD1-8_Ju3IrYpPJf",isSelected:"_3oA67AGI49fKcqDP970t4U",ButtonRow:"_2Bo7ys2El8ABMVNqYUdrA5",buttonRow:"_2Bo7ys2El8ABMVNqYUdrA5",CancelButton:"mBq3crGX9-xOOg-b-1V85",cancelButton:"mBq3crGX9-xOOg-b-1V85"}},"./src/reddit/components/ThumbnailSelector/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/lodash/debounce.js"),r=n.n(o),i=n("./node_modules/lodash/range.js"),s=n.n(i),a=n("./node_modules/react/index.js"),c=n.n(a),l=n("./src/lib/classNames/index.ts"),d=n("./src/lib/lessComponent.tsx"),u=n("./src/app/strings/index.ts"),p=n("./src/higherOrderComponents/asModal/index.tsx"),h=n("./src/reddit/controls/Button/index.tsx"),g=n("./src/reddit/helpers/media/index.ts"),m=n("./src/reddit/helpers/styles/mixins/loading.ts"),f=n("./src/reddit/icons/svgs/Close/index.tsx"),b=n("./src/reddit/layout/row/Inline/index.tsx"),y=n("./src/reddit/components/ThumbnailSelector/index.m.less"),E=n.n(y);const S=10,C=Object(u.e)("postCreation.cancel"),O=Object(u.e)("postCreation.select"),x=Object(u.e)("postCreation.mediaInput.chooseThumbnail"),v=Object(p.a)(d.a.div("Component",E.a)),T=d.a.wrapped(b.a,"TitleRow",E.a),k=d.a.wrapped(f.a,"Close",E.a),j=d.a.div("CloseWrapper",E.a),w=d.a.div("ThumbnailsContainer",E.a),R=d.a.img("Image",E.a),B=t=>c.a.createElement("div",{className:Object(l.a)(E.a.thumbnail,Object(m.a)({isLoading:t.isLoading}),{[E.a.isSelected]:t.isSelected}),onClick:t.onClick,ref:t.elementRef},t.thumbnail.url&&c.a.createElement(R,{src:t.thumbnail.url})),I=d.a.wrapped(b.a,"ButtonRow",E.a),A=h.f,K=d.a.wrapped(h.i,"CancelButton",E.a),M=(t,e)=>{if(1===t)return[0];const n=s()(0,e,e/(t-1));return n.push(e),n.map(t=>+t.toFixed(2))};e.a=class extends c.a.Component{constructor(t){super(t),this.isThumbnailsAreGenerating=!1,this.setSelectedElementRef=(t=>this.selectedElement=t),this.setThumbnails=r()(t=>this.setState({thumbnails:t}),100),this.scrollIntoView=(()=>{this.selectedElement&&this.selectedElement.scrollIntoView({})}),this.setSelected=(t=>{this.setState({selectedIndex:t})}),this.onSelectButton=(()=>{const t=this.state.selectedIndex,e=this.state.thumbnails[t];this.props.onSelect({time:e.time,url:e.url})});var e=this.props,n=e.thumbnailsCount;const o=void 0===n?S:n,i=e.selected,s=e.videoDuration,a=M(o,s).map(t=>({time:t,url:i&&i.time===t?i.url:void 0})),c=i?a.findIndex(t=>i.time===t.time):-1;this.state={thumbnails:a,selectedIndex:c}}componentDidMount(){this.scrollIntoView(),this.props.isOpen&&this.generateVideoThumbnails()}componentDidUpdate(t){this.props.isOpen&&!t.isOpen&&(this.scrollIntoView(),this.generateVideoThumbnails())}async generateVideoThumbnails(){const t=this.state.thumbnails;if(this.isThumbnailsAreGenerating||!t.find(t=>!t.url))return;this.isThumbnailsAreGenerating=!0;const e=document.createElement("video"),n=document.createElement("canvas");await Object(g.m)(e,this.props.videoSource);let o=0;e.currentTime=t[o].time,await Object(g.d)(e,n,e=>(t[o].url=e.dataUrl,o++,this.setThumbnails(t),o<t.length?t[o].time:null)),this.setState({thumbnails:t}),this.isThumbnailsAreGenerating=!1}render(){if(!this.props.isOpen)return null;var t=this.state;const e=t.selectedIndex,n=t.thumbnails;return c.a.createElement(v,{withOverlay:!0},c.a.createElement(T,null,x(this.props.language),c.a.createElement(j,{onClick:this.props.onToggleModal},c.a.createElement(k,null))),c.a.createElement(w,null,n.map((t,n)=>c.a.createElement(B,{key:n,elementRef:n===e?this.setSelectedElementRef:void 0,isLoading:!t.url,onClick:()=>this.setSelected(n),isSelected:n===e,thumbnail:t}))),c.a.createElement(I,null,c.a.createElement(K,{onClick:this.props.onToggleModal},C(this.props.language)),c.a.createElement(A,{onClick:this.onSelectButton},O(this.props.language))))}}},"./src/reddit/controls/SubredditDropdown/index.m.less":function(t,e,n){t.exports={entry:"BR2J4z5ndMj6r3-QW2hHI",mIsFocused:"_2KXTnIrbZ1Fr5F4nZyXeKS",list:"_17g61LC45mhwjs-g79qbZK"}},"./src/reddit/helpers/richTextEditor/index.ts":function(t,e,n){"use strict";var o;n.d(e,"a",function(){return o}),function(t){t[t.Post=0]="Post",t[t.Comment=1]="Comment"}(o||(o={}))},"./src/reddit/helpers/styles/mixins/fonts.tsx":function(t,e,n){"use strict";n.d(e,"a",function(){return o}),n.d(e,"b",function(){return r}),n.d(e,"c",function(){return i});const o="Arial, sans-serif",r=`Noto Sans, ${o}`,i="Noto Mono, Menlo, Monaco, Consolas, monospace"},"./src/reddit/icons/svgs/FormattingAlignCenter/index.m.less":function(t,e,n){t.exports={icon:"_1ZVHRoTDdo57082D2GcC80"}},"./src/reddit/icons/svgs/FormattingAlignLeft/index.m.less":function(t,e,n){t.exports={icon:"_33vXt91MK_ualpifvvw_3v"}},"./src/reddit/icons/svgs/FormattingAlignRight/index.m.less":function(t,e,n){t.exports={icon:"_34rYEsgbWk8eOQx_bs7fTV"}},"./src/reddit/icons/svgs/FormattingBlockQuotes/index.m.less":function(t,e,n){t.exports={icon:"_32TQMV98QwoweVXtMHpwr2"}},"./src/reddit/icons/svgs/FormattingBold/index.m.less":function(t,e,n){t.exports={icon:"_1329vPT9OSGZyEvo6Fqss"}},"./src/reddit/icons/svgs/FormattingCodeBlock/index.m.less":function(t,e,n){t.exports={icon:"F0bObcodUF6At5SPF9bIr"}},"./src/reddit/icons/svgs/FormattingDeleteRow/index.m.less":function(t,e,n){t.exports={icon:"_8Y1-XP7A1OOfoU_mUqKcg"}},"./src/reddit/icons/svgs/FormattingHeading/index.m.less":function(t,e,n){t.exports={icon:"_2C-VR7luDjfFqzNiJQEpk0"}},"./src/reddit/icons/svgs/FormattingHyperlink/index.m.less":function(t,e,n){t.exports={icon:"_2-0pxD6-cM6bWeb73TNNhJ"}},"./src/reddit/icons/svgs/FormattingHyperlink/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/react/index.js"),r=n.n(o),i=n("./src/lib/classNames/index.ts"),s=n("./src/reddit/icons/svgs/FormattingHyperlink/index.m.less"),a=n.n(s);e.a=(t=>r.a.createElement("svg",{className:Object(i.a)(a.a.icon,t.className),viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("path",{d:"M17.15,2.86a6.33,6.33,0,1,0-9,9A1,1,0,0,0,9.6,10.4a4.39,4.39,0,1,1,4.92.83,7.41,7.41,0,0,1,.14,1.44c0,.23,0,.46,0,.68a6.33,6.33,0,0,0,2.51-10.5Z"}),r.a.createElement("path",{d:"M10.4,8.19a1,1,0,0,0,0,1.41,4.39,4.39,0,1,1-4.92-.83,7.41,7.41,0,0,1-.14-1.44c0-.23,0-.46,0-.68a6.33,6.33,0,1,0,6.44,1.54A1,1,0,0,0,10.4,8.19Z"})))},"./src/reddit/icons/svgs/FormattingInsertRow/index.m.less":function(t,e,n){t.exports={icon:"_1PNKgIKbpvIWTVU3LO0PJQ"}},"./src/reddit/icons/svgs/FormattingItalics/index.m.less":function(t,e,n){t.exports={icon:"_32WqBD1jOzjyQPJdFZ8Rrt"}},"./src/reddit/icons/svgs/FormattingMonospace/index.m.less":function(t,e,n){t.exports={icon:"_1cI-FoGkiT7RNcT2BsWaRU"}},"./src/reddit/icons/svgs/FormattingSpoiler/index.m.less":function(t,e,n){t.exports={icon:"_1KIFUYxvtUxuRVhS-FGTns"}},"./src/reddit/icons/svgs/FormattingStrikethrough/index.m.less":function(t,e,n){t.exports={icon:"_3C1w798INaJPgFxfklr4an"}},"./src/reddit/icons/svgs/FormattingSuperscript/index.m.less":function(t,e,n){t.exports={icon:"_1DvEfZosXHE4A0gHsGOjEU"}},"./src/reddit/icons/svgs/FormattingTable/index.m.less":function(t,e,n){t.exports={icon:"_12fGjUaA4qUfdUrX7rnmTK"}},"./src/reddit/icons/svgs/FormattingUnorderedList/index.m.less":function(t,e,n){t.exports={icon:"LfxAZX1Sm9aiJZiizUSZO"}},"./src/reddit/icons/svgs/ImagePost/index.m.less":function(t,e,n){t.exports={icon:"_1pAYDrDlDFEJk994qhxbYj"}},"./src/reddit/icons/svgs/ImagePost/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/react/index.js"),r=n.n(o),i=n("./src/lib/classNames/index.ts"),s=n("./src/reddit/icons/svgs/ImagePost/index.m.less"),a=n.n(s);e.a=(t=>r.a.createElement("svg",{className:Object(i.a)(a.a.icon,t.className),viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("path",{d:"M16,2H4A2,2,0,0,0,2,4V16a2,2,0,0,0,2,2H16a2,2,0,0,0,2-2V4A2,2,0,0,0,16,2Zm0,14H10.14a.49.49,0,0,1,.05-.48l3.15-4.26a.5.5,0,0,1,.38-.2.53.53,0,0,1,.4.17L16,13.35ZM4,13.51,7.26,8.82a.54.54,0,0,1,.42-.21.5.5,0,0,1,.41.23l2.85,4.34L8.84,16H4Zm10.4-7.1a1.7,1.7,0,1,1-1.7-1.7A1.7,1.7,0,0,1,14.4,6.41Z"})))},"./src/reddit/icons/svgs/ThumbnailSelect/index.m.less":function(t,e,n){t.exports={icon:"_3QNLLzw_kUPhkWkxg22tT9"}},"./src/reddit/icons/svgs/ThumbnailSelect/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/react/index.js"),r=n.n(o),i=n("./src/lib/classNames/index.ts"),s=n("./src/reddit/icons/svgs/ThumbnailSelect/index.m.less"),a=n.n(s);e.a=(t=>r.a.createElement("svg",{className:Object(i.a)(a.a.icon,t.className),viewBox:"0 0 20 20",xmlns:"http://www.w3.org/2000/svg"},r.a.createElement("g",{fill:"none",fillRule:"evenodd"},r.a.createElement("path",{d:"M0 0h20v20H0z"}),r.a.createElement("path",{fill:"#A5A4A4",d:"M6 3h8c1.1046 0 2 .8954 2 2v10c0 1.1046-.8954 2-2 2H6c-1.1046 0-2-.8954-2-2V5c0-1.1046.8954-2 2-2zm11 1c1.1046 0 2 .8954 2 2v8c0 1.1046-.8954 2-2 2V4zM3 4v12h-.6667C1.597 16 1 15.1734 1 14.1538V5.8462C1 4.8266 1.597 4 2.3333 4H3z"}))))},"./src/reddit/icons/svgs/Video/index.tsx":function(t,e,n){"use strict";var o=n("./node_modules/react/index.js"),r=n.n(o);e.a=(t=>r.a.createElement("svg",{className:t.className,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20"},r.a.createElement("g",{transform:"translate(3, 4)"},r.a.createElement("path",{d:"M15.4927,2.1514 C15.1797,1.9734 14.7947,1.9784 14.4857,2.1644 L11.9997,3.6554 L11.9997,2.0004 C11.9997,0.8974 11.1027,0.0004 9.9997,0.0004 L1.9997,0.0004 C0.8967,0.0004 -0.0003,0.8974 -0.0003,2.0004 L-0.0003,10.0004 C-0.0003,11.1034 0.8967,12.0004 1.9997,12.0004 L9.9997,12.0004 C11.1027,12.0004 11.9997,11.1034 11.9997,10.0004 L11.9997,8.3664 L14.4907,9.8394 C14.6477,9.9324 14.8237,9.9784 14.9997,9.9784 C15.1707,9.9784 15.3417,9.9344 15.4957,9.8474 C15.8077,9.6694 15.9997,9.3384 15.9997,8.9784 L15.9997,3.0214 C15.9997,2.6614 15.8057,2.3284 15.4927,2.1514"}))))},"./src/reddit/selectors/editorContent.ts":function(t,e,n){"use strict";n.d(e,"a",function(){return r});var o=n("./src/reddit/actions/postCreation/constants.ts");const r=(t,e)=>t.creations.api.editor.converting.pending[e||o.l]}}]);
//# sourceMappingURL=ChatMessageInput~RichTextEditor.2974e638283fdce3171b.js.map