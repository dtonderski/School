if (self.CavalryLogger) { CavalryLogger.start_js(["2569Z"]); }

__d("ImmersiveMediaStrings",["fbt"],(function(a,b,c,d,e,f,g){e.exports={SAVE_TO_VR:g._("Save to VR"),SAVED:g._("Saved to VR"),SAVE_NUX:g._("Find saved items in Oculus Library or Oculus Home."),LINK_PROMPT:g._("Link an Oculus headset?"),LEARN_MORE:g._("Learn More"),EXPERIENCE_OCULUS:g._("Experience this in virtual reality (VR) with Oculus.")}}),null);
__d("SaveStoryRelayModernMutation_SaveMutation.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{kind:"LocalArgument",name:"input",type:"StorySaveData!",defaultValue:null}],b=[{kind:"Variable",name:"data",variableName:"input"}],c={kind:"LinkedField",alias:null,name:"save_info",storageKey:null,args:null,concreteType:"StorySaveInfo",plural:!1,selections:[{kind:"ScalarField",alias:null,name:"viewer_save_state",args:null,storageKey:null}]};return{kind:"Request",fragment:{kind:"Fragment",name:"SaveStoryRelayModernMutation_SaveMutation",type:"Mutation",metadata:null,argumentDefinitions:a,selections:[{kind:"LinkedField",alias:null,name:"story_save",storageKey:null,args:b,concreteType:"StorySaveResponsePayload",plural:!1,selections:[{kind:"LinkedField",alias:null,name:"story",storageKey:null,args:null,concreteType:"Story",plural:!1,selections:[c]}]}]},operation:{kind:"Operation",name:"SaveStoryRelayModernMutation_SaveMutation",argumentDefinitions:a,selections:[{kind:"LinkedField",alias:null,name:"story_save",storageKey:null,args:b,concreteType:"StorySaveResponsePayload",plural:!1,selections:[{kind:"LinkedField",alias:null,name:"story",storageKey:null,args:null,concreteType:"Story",plural:!1,selections:[c,{kind:"ScalarField",alias:null,name:"id",args:null,storageKey:null}]}]}]},params:{operationKind:"mutation",name:"SaveStoryRelayModernMutation_SaveMutation",id:"1516400195059687",text:null,metadata:{}}}}();e.exports=a}),null);
__d("SaveStoryRelayModernMutation_StateQuery.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{kind:"LocalArgument",name:"input",type:"String!",defaultValue:null}],b=[{kind:"Variable",name:"id",variableName:"input"}],c={kind:"LinkedField",alias:null,name:"save_info",storageKey:null,args:null,concreteType:"StorySaveInfo",plural:!1,selections:[{kind:"ScalarField",alias:null,name:"viewer_save_state",args:null,storageKey:null}]};return{kind:"Request",fragment:{kind:"Fragment",name:"SaveStoryRelayModernMutation_StateQuery",type:"Query",metadata:null,argumentDefinitions:a,selections:[{kind:"LinkedField",alias:null,name:"story_card",storageKey:null,args:b,concreteType:"Story",plural:!1,selections:[c]}]},operation:{kind:"Operation",name:"SaveStoryRelayModernMutation_StateQuery",argumentDefinitions:a,selections:[{kind:"LinkedField",alias:null,name:"story_card",storageKey:null,args:b,concreteType:"Story",plural:!1,selections:[c,{kind:"ScalarField",alias:null,name:"id",args:null,storageKey:null}]}]},params:{operationKind:"query",name:"SaveStoryRelayModernMutation_StateQuery",id:"1950422391690565",text:null,metadata:{}}}}();e.exports=a}),null);
__d("SaveStoryRelayModernMutation_UnsaveMutation.graphql",[],(function(a,b,c,d,e,f){"use strict";a=function(){var a=[{kind:"LocalArgument",name:"input",type:"StoryUnsaveData!",defaultValue:null}],b=[{kind:"Variable",name:"data",variableName:"input"}],c={kind:"LinkedField",alias:null,name:"save_info",storageKey:null,args:null,concreteType:"StorySaveInfo",plural:!1,selections:[{kind:"ScalarField",alias:null,name:"viewer_save_state",args:null,storageKey:null}]};return{kind:"Request",fragment:{kind:"Fragment",name:"SaveStoryRelayModernMutation_UnsaveMutation",type:"Mutation",metadata:null,argumentDefinitions:a,selections:[{kind:"LinkedField",alias:null,name:"story_unsave",storageKey:null,args:b,concreteType:"StoryUnsaveResponsePayload",plural:!1,selections:[{kind:"LinkedField",alias:null,name:"story",storageKey:null,args:null,concreteType:"Story",plural:!1,selections:[c]}]}]},operation:{kind:"Operation",name:"SaveStoryRelayModernMutation_UnsaveMutation",argumentDefinitions:a,selections:[{kind:"LinkedField",alias:null,name:"story_unsave",storageKey:null,args:b,concreteType:"StoryUnsaveResponsePayload",plural:!1,selections:[{kind:"LinkedField",alias:null,name:"story",storageKey:null,args:null,concreteType:"Story",plural:!1,selections:[c,{kind:"ScalarField",alias:null,name:"id",args:null,storageKey:null}]}]}]},params:{operationKind:"mutation",name:"SaveStoryRelayModernMutation_UnsaveMutation",id:"1298878733500701",text:null,metadata:{}}}}();e.exports=a}),null);
__d("SaveStoryRelayModernMutation",["FBStorySavedState","RelayModern","relay-runtime","SaveStoryRelayModernMutation_SaveMutation.graphql","SaveStoryRelayModernMutation_UnsaveMutation.graphql","SaveStoryRelayModernMutation_StateQuery.graphql"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("RelayModern").commitMutation;b("RelayModern").graphql;var h=b("relay-runtime").fetchQuery,i=function(){return b("SaveStoryRelayModernMutation_SaveMutation.graphql")},j=function(){return b("SaveStoryRelayModernMutation_UnsaveMutation.graphql")},k=function(){return b("SaveStoryRelayModernMutation_StateQuery.graphql")};function a(a,c){c={input:c};return h(a,k,c).then(function(a){a=a.story_card.save_info.viewer_save_state;return a===b("FBStorySavedState").SAVED})}function c(a,b,c,d){var e=b?i:j,f=function(a){a=a.get(c.story_id);if(!a)return;a=a.getLinkedRecord("save_info");a&&a.setValue(b,"viewer_save_state")};return g(a,{mutation:e,updater:f,variables:{input:c},onCompleted:d&&d.onSuccess,onError:d&&d.onFailure,optimisticUpdater:d&&d.optimisticUpdater})}e.exports={commit:c,isStorySaved:a}}),null);
__d("ImmersiveMediaFbt",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({SAVE_TO_VR:"SAVE_TO_VR",SAVED:"SAVED",SAVE_NUX:"SAVE_NUX",LINK_PROMPT:"LINK_PROMPT",LEARN_MORE:"LEARN_MORE",EXPERIENCE_OCULUS:"EXPERIENCE_OCULUS"})}),null);
__d("ImmersiveMediaOverlayComponent.react",["ix","cx","Image.react","ImmersiveMediaFbt","ImmersiveMediaStrings","Link.react","React","Text","XUIButton.react","XUICloseButton.react","asset","joinClasses"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();var i=b("ImmersiveMediaStrings")[b("ImmersiveMediaFbt").SAVE_TO_VR],j=b("ImmersiveMediaStrings")[b("ImmersiveMediaFbt").SAVED],k=b("ImmersiveMediaStrings")[b("ImmersiveMediaFbt").SAVE_NUX],l=b("ImmersiveMediaStrings")[b("ImmersiveMediaFbt").LINK_PROMPT],m=b("ImmersiveMediaStrings")[b("ImmersiveMediaFbt").LEARN_MORE],n=b("ImmersiveMediaStrings")[b("ImmersiveMediaFbt").EXPERIENCE_OCULUS];a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.state={showMessage:!1},b)||babelHelpers.assertThisInitialized(c)}var d=c.prototype;d.saveButtonClick=function(){this.props.saveClick&&this.props.saveClick(),this.props.showNUX&&this.setState({showMessage:!0})};d.savedButtonClick=function(){this.props.unsaveClick&&this.props.unsaveClick()};d.closeButtonClick=function(){this.setState({showMessage:!1})};d.render=function(){var a=this,c="_781e",d={color:"white",fontSize:16,lineHeight:20,textAlign:"center"},e=b("React").createElement("div",{className:b("joinClasses")("_781f",c)},b("React").createElement(b("Image.react"),{src:g("764253")}),b("React").createElement(b("Text"),{style:d},k));d=b("React").createElement("div",{className:b("joinClasses")("_781f",c)},b("React").createElement(b("Image.react"),{src:g("764253")}),b("React").createElement(b("Text"),{style:d},n),b("React").createElement(b("XUIButton.react"),{label:m,className:"_781g",href:"https://www.oculus.com/",target:"_blank"}),b("React").createElement(b("Link.react"),{href:"https://support.oculus.com/1775053542763938",target:"_blank"},b("React").createElement(b("Text"),{style:{color:"white"}},l)));e=b("React").createElement("div",null,b("React").createElement("div",{className:"_781h"}),b("React").createElement("div",null,this.props.hasOculusAccount?e:d,b("React").createElement(b("XUICloseButton.react"),{className:b("joinClasses")("_781i",c),size:"large",shade:"light",onClick:function(){return a.closeButtonClick()}})));d=b("React").createElement(b("XUIButton.react"),{className:b("joinClasses")("_781j","_781g"),onClick:function(){return a.saveButtonClick()},image:b("React").createElement(b("Image.react"),{src:g("556057")}),label:this.props.showNUX?i:""});c=b("React").createElement(b("XUIButton.react"),{className:b("joinClasses")("_781j","_781g"),onClick:function(){return a.savedButtonClick()},image:b("React").createElement(b("Image.react"),{src:g("505217")}),label:j});return b("React").createElement("div",null,b("React").createElement("div",{className:this.state.showMessage?"_781k":""},this.state.showMessage?null:this.props.storySaved?c:d),this.state.showMessage&&e)};return c}(b("React").Component);e.exports=a}),null);
__d("ImmersiveMediaOverlay.react",["CollectionCurationMechanismsValue","ImmersiveMediaOverlayComponent.react","React","RelayFBEnvironment","SaveStoryRelayModernMutation","gkx","promiseDone"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.state={storySaved:!1,hasOculusAccount:!1},b)||babelHelpers.assertThisInitialized(c)}var d=c.prototype;d.componentDidMount=function(){var a=this,c=b("gkx")("777521");this.setState({hasOculusAccount:c});this.props.graphQLID!=null&&b("promiseDone")(b("SaveStoryRelayModernMutation").isStorySaved(b("RelayFBEnvironment"),this.props.graphQLID).then(function(b){a.setState({storySaved:b})}))};d.saveButtonClick=function(){var a=this;this.props.graphQLID!=null&&b("SaveStoryRelayModernMutation").commit(b("RelayFBEnvironment"),!this.state.storySaved,{mechanism:b("CollectionCurationMechanismsValue").saved_add,story_id:this.props.graphQLID,surface:"native_marketplace_product_details"},{optimisticUpdater:function(b){a.setState({storySaved:!0})}})};d.render=function(){var a=this;return b("React").createElement(b("ImmersiveMediaOverlayComponent.react"),{saveClick:function(){return a.saveButtonClick()},storySaved:this.state.storySaved,showNUX:!0,hasOculusAccount:this.state.hasOculusAccount})};return c}(b("React").Component);e.exports=a}),null);
__d("SphericalMediaCoreActions",["SphericalMediaActionNamespaces","SphericalMediaActions"],(function(a,b,c,d,e,f){"use strict";a={turnOn:function(){return{namespace:b("SphericalMediaActionNamespaces").CORE,type:b("SphericalMediaActions").TURN_ON}},turnOff:function(){return{namespace:b("SphericalMediaActionNamespaces").CORE,type:b("SphericalMediaActions").TURN_OFF}},enableSpherical:function(){return{namespace:b("SphericalMediaActionNamespaces").CORE,type:b("SphericalMediaActions").ENABLE_SPHERICAL}},disableSpherical:function(){return{namespace:b("SphericalMediaActionNamespaces").CORE,type:b("SphericalMediaActions").DISABLE_SPHERICAL}}};e.exports=a}),null);
__d("SphericalMediaViewActions",["SphericalMediaActionNamespaces","SphericalMediaActions"],(function(a,b,c,d,e,f){"use strict";e.exports={updateView:function(a){return{namespace:b("SphericalMediaActionNamespaces").VIEW,type:b("SphericalMediaActions").UPDATE_VIEW,data:a}},updateViewport:function(a,c){return{namespace:b("SphericalMediaActionNamespaces").VIEW,type:b("SphericalMediaActions").UPDATE_VIEWPORT,data:{yaw:a,pitch:c}}},updateFOV:function(a){return{namespace:b("SphericalMediaActionNamespaces").VIEW,type:b("SphericalMediaActions").UPDATE_FOV,data:{fov:a}}},updateYaw:function(a){return{namespace:b("SphericalMediaActionNamespaces").VIEW,type:b("SphericalMediaActions").UPDATE_YAW,data:{yaw:a}}},updateViewportAndFOV:function(a,c,d){return{namespace:b("SphericalMediaActionNamespaces").VIEW,type:b("SphericalMediaActions").UPDATE_VIEWPORT_AND_FOV,data:{yaw:a,pitch:c,fov:d}}},startAnimating:function(){return{namespace:b("SphericalMediaActionNamespaces").VIEW,type:b("SphericalMediaActions").START_ANIMATING}},stopAnimating:function(){return{namespace:b("SphericalMediaActionNamespaces").VIEW,type:b("SphericalMediaActions").STOP_ANIMATING}}}}),null);
__d("SphericalMediaController.react",["cx","Event","React","SphericalMediaConstants","SphericalPhotoPartialLimits","SphericalPhotoTypedConfig","SphericalViewportControl","SubscriptionsHandler","debounce","getElementRect","performanceNow","throttle"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=b("SphericalMediaConstants").GYRO_SLIP_FACTOR,i=b("SphericalMediaConstants").LOGGER_SIGNIFICANT_MOVEMENT_DEGREE,j=b("SphericalMediaConstants").LOGGER_SIGNIFICANT_MOVEMENT_MS,k=b("SphericalMediaConstants").RB_FRICTION,l=b("SphericalMediaConstants").RB_MAX_SPRING_DEGREE,m=b("SphericalMediaConstants").RB_MAX_STRETCH_X_DEGREE,n=b("SphericalMediaConstants").RB_MAX_STRETCH_Y_DEGREE,o=b("SphericalMediaConstants").RB_SPRING_FACTOR,p=b("SphericalMediaConstants").TILED_CUBE_TILE_CONTENT_SIZE,q=b("SphericalPhotoPartialLimits").makePartialLimits;a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c){__p&&__p();var d;d=a.call(this,c)||this;d.$3=0;d.$5=!1;d.onViewChange=function(){var a=d.__sphericalViewportControl;if(a&&!a.isUpdating()){var b=d.__getViewData(),c=a.getOrientation(),e=a.getVerticalFieldOfView();e=b.fov!==e||b.pitch!==c.y||b.yaw!==c.x;e&&(a.updateViewport(b.yaw,b.pitch,b.fov),d.$4=babelHelpers["extends"]({},b))}};d.$6=function(){if(!d.__viewport)return;var a=b("getElementRect")(d.__viewport);(a.left!==0||a.right!==0||a.top!==0||a.bottom!==0||a.height!==0||a.width!==0)&&(d.$1={x:a.left,y:a.top})};d.$2=new(b("SubscriptionsHandler"))();d.$2.addSubscriptions(b("Event").listen(window,"resize",b("debounce")(d.$6)));return d}var d=c.prototype;d.UNSAFE_componentWillReceiveProps=function(a){a.isActive!==this.props.isActive&&!a.isActive&&this.$7(),a.isActive&&((a.width!==this.props.width||a.height!==this.props.height)&&this.$8(a.width,a.height))};d.componentDidMount=function(){this.props.isActive&&this.$9()};d.shouldComponentUpdate=function(a){a=a.isActive&&!this.__sphericalViewportControl||a.width!==this.props.width||a.height!==this.props.height;return a};d.componentDidUpdate=function(){this.props.isActive&&!this.__sphericalViewportControl&&this.$9(),this.$6()};d.componentWillUnmount=function(){this.$7()};d.$9=function(){__p&&__p();var a=this,c;if(!this.__viewport)return;c=this.__viewport;var d=this.__getSphericalConfig(this.props);c=new(b("SphericalViewportControl"))(c,d,this.$10(),this.props.showNewPhotoRenderer);this.$4={fov:d.fieldOfView,pitch:d.initialPitch,yaw:d.initialHeading};this.$6();c.addListener("updateViewportBegin",this.__onUpdateViewportBegin);c.addListener("updateViewportMoveStart",this.__onUpdateViewportMoveStart);c.addListener("DOM/click",this.__onDOMClick);c.addListener("updateViewportEnd",function(b,c){a.__onUpdateViewportEnd(),a.$11()});c.addListener("initialViewportChange",this.__onInitialViewportChange);c.addListener("viewportChange",this.__onViewportChange);c.addListener("zoomStart",this.__onZoomStart);c.addListener("mouseEnter",this.__onMouseEnter);c.addListener("mouseMove",b("throttle")(this.__onMouseMove));this.props.showNewPhotoRenderer&&this.props.initialFov>179&&c.setInitialOrientation();this.__sphericalViewportControl=c;this.$8(this.props.width,this.props.height)};d.$7=function(){this.$2.release(),this.__sphericalViewportControl&&this.__sphericalViewportControl.destroy(),this.__sphericalViewportControl=null,this.$5=!0};d.$11=function(){__p&&__p();var a=b("performanceNow")();if(Math.abs(a-this.$3)<j)return;var c=this.$4;if(!c)return;var d=this.__getViewData(),e=d.yaw-c.yaw;c=d.pitch-c.pitch;e=Math.sqrt(Math.pow(e,2)+Math.pow(c,2));i<e&&(this.__onSignificantMove(d),this.$3=a,this.$4=babelHelpers["extends"]({},d))};d.$8=function(a,c,d){__p&&__p();d=this.__sphericalViewportControl;if(d){d.updateViewportClientSize({width:a,height:c});if(this.props.maxTileLevel>0){a=Math.pow(2,this.props.maxTileLevel);a=p*a/90;c=c/a/3;d.updateMinVFOV(c)}b("SphericalPhotoTypedConfig").enable_stereograph_renderer&&(d.updateMaxVFOV(160),d.updateMaxHFOV(200));a=this.__getViewData();d.setFieldOfView(a.fov);c=d.getVerticalFieldOfView();c!==a.fov&&this.__updateFOV(c)}};d.$10=function(){return{disableAutoClientSizeUpdate:!0,enableGyro:this.props.enableGyro,enableRubberBanding:this.props.enableRubberBanding,maxSpringDegrees:l,maxStretchXDegrees:m,maxStretchYDegrees:n,minVFOV:this.props.maxTileLevel,rubberBandConstant:k,slipFactor:h,springFactor:o,enableZoomWithShiftKey:!1,enablePanningWithRightMouse:!1}};d.__getSphericalConfig=function(a){var b=this.__getPartialLimits(a),c=a.initialYaw,d=a.initialPitch,e=a.initialFov;if(this.$5){var f=this.__getViewData();e=f.fov;d=f.pitch;c=f.yaw}return{initialHeading:c,initialPitch:d,fieldOfView:e,keyboardVelocityFactor:a.keyboardVelocityFactor,panningVelocityFactor:a.panningVelocityFactor,enableZoom:a.enableZoom,partialLimits:b||void 0}};d.__getPartialLimits=function(a){return a.partialLimits.partialLeftDegrees||a.partialLimits.partialRightDegrees||a.partialLimits.partialTopDegrees||a.partialLimits.partialBottomDegrees?q({partialLeftDegrees:a.partialLimits.partialLeftDegrees,partialRightDegrees:a.partialLimits.partialRightDegrees,partialTopDegrees:a.partialLimits.partialTopDegrees,partialBottomDegrees:a.partialLimits.partialBottomDegrees}):null};d.__getViewportMousePosition=function(a){if(!this.$1){this.$6();if(!this.$1)return null}return{x:(a.clientX||a.changedTouches[0].clientX)-this.$1.x,y:(a.clientY||a.changedTouches[0].clientY)-this.$1.y}};d.__changeCursorStyle=function(a){if(!this.__viewport)return;this.__viewport.style.cursor=a};d.render=function(){var a=this;return b("React").createElement("div",{ref:function(b){return a.__viewport=b},className:"_5nxw _25i_"+(this.props.isActive?"":" hidden_elem"),tabIndex:0,"aria-label":this.props.caption})};return c}(b("React").Component);e.exports=a}),null);
__d("SphericalMediaRenderer.react",["cx","BackgroundImage.react","DOM","React","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(b){b=a.call(this,b)||this;b.$2=!1;b.$3=!1;if(!b.constructor.__subClassMethods)throw new Error('Must implement "static __subClassMethods"');for(var c in b.constructor.__subClassMethods)if(typeof babelHelpers.assertThisInitialized(b)[c]!=="function")throw new Error('Must implement "'+c+'"');return b}var d=c.prototype;d.UNSAFE_componentWillReceiveProps=function(a){if(!a.isActive&&this.sphericalRenderer){this.__destroy();return}};d.shouldComponentUpdate=function(a){return this.shouldRender};d.componentDidMount=function(){this.$4()};d.componentWillUnmount=function(){this.__destroy()};d.__destroy=function(){this.sphericalRenderer&&this.sphericalRenderer.destroy(),this.sphericalRenderer=null};d.$4=function(){__p&&__p();var a=this;if(this.$2||!this.__isReadyToSetup()||!this.$1||this.$3)return;this.$3=!0;var c=this.__getCanvas();b("promiseDone")(this.__getRenderer(c),function(d){d.updateViewportDimensions(a.props.width,a.props.height),d.addListener("renderingError",function(b,c){return a.__onWebGlRenderFailed(b,c)}),d.addListener("renderingContextLost",function(){return a.__onWebGlContextLost()}),b("DOM").setContent(a.$1,c),a.sphericalRenderer=d,d.renderErrorCheck(),a.$3=!1,a.__onSetupDone(d)},function(b){a.$2=!0;a.$3=!1;a.__onWebGlInitFailed(b);return})};d.draw=function(a){if(!this.sphericalRenderer)return;var b=this.sphericalRenderer;if(!b)return;try{b.render(a),this.__afterDraw(b)}catch(b){this.__onWebGlRenderFailed(b,a);return}};d.componentDidUpdate=function(){if(!this.props.isActive)return;var a=this.sphericalRenderer;!a?this.$4():(a.updateViewportDimensions(this.props.width,this.props.height),this.draw(this.__getViewData()))};d.render=function(){var a=this,c;this.props.thumbnail&&(c=b("React").createElement(b("BackgroundImage.react"),{className:(!this.__showLoadingThumbnail()||this.props.isActive&&this.sphericalRenderer?"hidden_elem":"")+" _2vjf",src:this.props.thumbnail,width:this.props.width,height:this.props.height,backgroundSize:"cover"}));return b("React").createElement("div",{className:"_4trl"},b("React").createElement("div",{className:(!this.props.isActive||!this.sphericalRenderer?"hidden_elem":"")+" _4trl",ref:function(b){return a.$1=b}}),c)};return c}(b("React").Component);e.exports=a}),null);
__d("SphericalMediaBaseStore",["ReduxThunk","redux"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("redux").applyMiddleware,h=b("redux").combineReducers,i=b("redux").compose,j=b("redux").createStore;a=function(){__p&&__p();function a(a){a===void 0&&(a=[]);a=g.apply(void 0,[b("ReduxThunk")].concat(a));var c=h(this.getReducers());this.$1=i(a)(j)(c)}var c=a.prototype;c.getStore=function(){return this.$1};c.getReducers=function(){throw new Error("Implement _getReducers")};return a}();e.exports=a}),null);
__d("SphericalMediaViewReducer",["SphericalMediaActionNamespaces","SphericalMediaActions"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g={fov:65,pitch:0,yaw:0,isAnimating:!1,centeredYaw:0};a=function(a,c){__p&&__p();a===void 0&&(a=g);if(c.namespace!==b("SphericalMediaActionNamespaces").VIEW)return a;var d={};switch(c.type){case b("SphericalMediaActions").UPDATE_VIEW:d=c.data;d.centeredYaw=c.data.yaw;break;case b("SphericalMediaActions").UPDATE_VIEWPORT_AND_FOV:var e=c.data,f=e.pitch,h=e.fov;e=e.yaw;isNaN(f+h+e)||(d.fov=h,d.pitch=f,d.yaw=e,d.centeredYaw=e);break;case b("SphericalMediaActions").UPDATE_VIEWPORT:d.pitch=c.data.pitch;d.yaw=c.data.yaw;d.centeredYaw=c.data.yaw;break;case b("SphericalMediaActions").UPDATE_FOV:d.fov=c.data.fov;break;case b("SphericalMediaActions").UPDATE_YAW:d.yaw=c.data.yaw;break;case b("SphericalMediaActions").START_ANIMATING:d.isAnimating=!0;break;case b("SphericalMediaActions").STOP_ANIMATING:d.isAnimating=!1;break}return babelHelpers["extends"]({},a,d)};e.exports=a}),null);
__d("SphericalMediaViewStore",["SphericalMediaBaseStore","SphericalMediaViewReducer"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.getReducers=function(){return{view:b("SphericalMediaViewReducer")}};return c}(b("SphericalMediaBaseStore"));e.exports=a}),null);
__d("SphericalMediaBaseRecord",["PhotoProjection","immutable","SphericalMediaViewStore","SphericalPhotoPartialLimits"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=b("PhotoProjection").CUBESTRIP;c=b("SphericalPhotoPartialLimits").makePartialLimits;d=b("immutable").Record({keyboardVelocityFactor:0,panningVelocityFactor:0,enableGyro:!1,enablePartialLimit:!1,enableRubberBanding:!1,enableZoom:!1,showFallbackUI:!1,useFallbackUI:!1,useLargeHeadingIndicator:!1,useLargeVolumeIcon:!1,partialLimits:c({partialLeftDegrees:void 0,partialRightDegrees:void 0,partialTopDegrees:void 0,partialBottomDegrees:void 0}),isPanning:!1,hasInteracted:!1,visibility:!0,aspectRatio:1,height:0,width:0,initialFov:65,initialPitch:0,initialYaw:0,renderer:null,isRendererActive:!1,isRendererSetup:!1,className:"",projectionType:a,expansionCoef:void 0,tiledSphericalConfig:{useTiledRenderer:!1,initialTileUris:[],viewportTileUris:[],maxTileLevel:0},canvasNamespace:"SphericalMedia",caption:"",type:"photo",src:"",flatImage:"",originalImageURI:"",thumbnail:"",fbid:"",loaded:!1,enableSpherical:!0,isFetchingData:!1,photoSphereMetadata:{},exif:{},useLocalSphericalImage:!1,fallback:null,fallbackCTAElement:null,enableTagging:!1,tags:[],tagUnderMouse:null,tagClicked:null,isTagging:!1,tagger:null,taggingMode:!1,targetedTag:null,sourceProjectionType:null,surface:"",sessionID:"",viewStore:new(b("SphericalMediaViewStore"))().getStore(),ctrElement:null,ambientAudio:[],feedRootElement:null,vrDevice:null,vrIsPresenting:!1,vrRenderingSupported:!1,vrRendererIsReady:!1,vrStoryProps:null,fullscreenCubeImageURI:null});f=function(a){babelHelpers.inheritsLoose(b,a);function b(){return a.apply(this,arguments)||this}return b}(d);e.exports=f}),null);
__d("SphericalMediaBaseReducer",["PhotoRendererProjection","SphericalMediaActionNamespaces","SphericalMediaActions","SphericalMediaBaseRecord","SphericalMediaViewStore","SphericalPhotoPartialLimits"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("SphericalPhotoPartialLimits").makePartialLimits,h=function(){return new(b("SphericalMediaBaseRecord"))({viewStore:new(b("SphericalMediaViewStore"))().getStore()})};a=function(a,c){__p&&__p();a===void 0&&(a=h());if(c.namespace!==b("SphericalMediaActionNamespaces").CORE&&c.namespace!==b("SphericalMediaActionNamespaces").BASE)return a;switch(c.type){case b("SphericalMediaActions").UPDATE_BASE:var d=c.data;return a.withMutations(function(a){a.merge(d),d.photoSphereMetadata&&a.set("photoSphereMetadata",d.photoSphereMetadata),d.tiledSphericalConfig&&a.set("tiledSphericalConfig",d.tiledSphericalConfig),d.tags&&a.set("tags",d.tags),d.tagUnderMouse&&a.set("tagUnderMouse",d.tagUnderMouse),d.tagClicked&&a.set("tagClicked",d.tagClicked),d.tagger&&a.set("tagger",d.tagger),d.exif&&a.set("exif",d.exif),d.fallback&&a.set("fallback",d.fallback),d.ambientAudio&&a.set("ambientAudio",d.ambientAudio),d.vrStoryProps&&a.set("vrStoryProps",d.vrStoryProps)});case b("SphericalMediaActions").DRAG_START:return a.withMutations(function(a){a.set("isPanning",!0),a.set("hasInteracted",!0)});case b("SphericalMediaActions").VISIBILITY_CHANGED:return a.set("visibility",c.data);case b("SphericalMediaActions").UPDATE_INITIAL_FOV:return a.set("initialFov",c.data.initialFov);case b("SphericalMediaActions").UPDATE_INITIAL_VIEWPORT:var e=c.data;return a.withMutations(function(a){a.set("initialYaw",e.initialYaw),a.set("initialPitch",e.initialPitch)});case b("SphericalMediaActions").UPDATE_DIMENSION:var f=c.data;return a.withMutations(function(a){a.set("height",f.height),a.set("width",f.width),a.set("aspectRatio",f.width/f.height)});case b("SphericalMediaActions").SETUP_RENDERER:var i=c.data.renderer;return a.withMutations(function(a){a.set("isRendererSetup",!0),a.set("renderer",i)});case b("SphericalMediaActions").TURN_ON:return a.set("isRendererActive",!0);case b("SphericalMediaActions").TURN_OFF:return a.withMutations(function(a){a.set("isRendererActive",!1),a.set("isRendererSetup",!1),a.set("renderer",null)});case b("SphericalMediaActions").REPLACE_BASE_STATE:return c.data;case b("SphericalMediaActions").SOURCE_ONLOAD:return a.set("loaded",!0);case b("SphericalMediaActions").DISABLE_SPHERICAL:return a.set("enableSpherical",!1);case b("SphericalMediaActions").ENABLE_SPHERICAL:return a.set("enableSpherical",!0);case b("SphericalMediaActions").REQUEST_PHOTO:return a.withMutations(function(a){a.set("loaded",!1),a.set("isFetchingData",!0)});case b("SphericalMediaActions").RECEIVE_PHOTO:var j=c.data,k=j.partialLimits,l=j.photoSphereMetadata||{};return a.withMutations(function(a){a.set("fbid",j.photoID),a.set("flatImage",j.flatImage),a.set("initialFov",j.initialFov),a.set("initialPitch",j.initialPitch),a.set("initialYaw",j.initialYaw),a.set("isFetchingData",!1),a.set("originalImageURI",j.originalImageURI),a.set("partialLimits",g({partialLeftDegrees:k.partialLeftDegrees,partialRightDegrees:k.partialRightDegrees,partialTopDegrees:k.partialTopDegrees,partialBottomDegrees:k.partialBottomDegrees})),a.set("sourceProjectionType",l.ProjectionType),a.set("src",j.src),a.set("thumbnail",j.thumbnail),a.set("photoSphereMetadata",l),a.set("tiledSphericalConfig",j.tiledSphericalConfig),l&&(l.RendererProjectionType===b("PhotoRendererProjection").CYLINDRICAL||l.RendererProjectionType===b("PhotoRendererProjection").EQUIRECTANGULAR)&&a.set("enableSpherical",!1)});case b("SphericalMediaActions").UPDATE_CTR_ELEM:return a.set("ctrElement",c.data.element);case b("SphericalMediaActions").ENABLE_TAGGING:return a.set("enableTagging",!0);case b("SphericalMediaActions").DISABLE_TAGGING:return a.set("enableTagging",!1);case b("SphericalMediaActions").UPDATE_SPATIAL_TAGS_FROM_COMPOSER:case b("SphericalMediaActions").UPDATE_SPATIAL_TAGS:var m=c.data;return a.withMutations(function(a){a.set("tags",m)});case b("SphericalMediaActions").UPDATE_TAG_UNDER_MOUSE:var n=c.data;return a.withMutations(function(a){a.set("tagUnderMouse",n)});case b("SphericalMediaActions").SET_VR_IS_PRESENTING:var o=c.data;return a.withMutations(function(a){a.set("vrIsPresenting",o)});case b("SphericalMediaActions").SET_VR_DEVICE:var p=c.data;return a.withMutations(function(a){a.set("vrDevice",p)});case b("SphericalMediaActions").SET_VR_RENDERING_SUPPORTED:var q=c.data;return a.withMutations(function(a){a.set("vrRenderingSupported",q)});case b("SphericalMediaActions").SET_VR_RENDERER_IS_READY:var r=c.data;return a.withMutations(function(a){a.set("vrRendererIsReady",r)});case b("SphericalMediaActions").CANVAS_RESIZE_SUCCESS:var s=c.data;return a.withMutations(function(a){a.set("src",s)});case b("SphericalMediaActions").TAGGING_START:return a.set("isTagging",!0);case b("SphericalMediaActions").TAGGING_STOP:return a.set("isTagging",!1);case b("SphericalMediaActions").UPDATE_TAG_CLICKED:var t=c.data;return a.withMutations(function(a){a.set("tagClicked",t)});case b("SphericalMediaActions").UPDATE_TAGGER:var u=c.data;return a.withMutations(function(a){a.set("tagger",u)});case b("SphericalMediaActions").ENTER_TAGGING_MODE:return a.set("taggingMode",!0);case b("SphericalMediaActions").EXIT_TAGGING_MODE:return a.set("taggingMode",!1);case b("SphericalMediaActions").UPDATE_TARGETED_TAG:var v=c.data;return a.withMutations(function(a){a.set("targetedTag",v)});case b("SphericalMediaActions").SHOW_FALLBACK:return a.set("showFallbackUI",!0);case b("SphericalMediaActions").USE_FALLBACK:return a.withMutations(function(a){a.set("useFallbackUI",!0),a.set("enableRubberBanding",!1)});case b("SphericalMediaActions").UPDATE_FEED_ROOT_ELEMENT:return a.set("feedRootElement",c.data);case b("SphericalMediaActions").UPDATE_PARTIAL_LIMITS:var w=c.data;return a.withMutations(function(a){a.set("partialLimits",g({partialLeftDegrees:w.partialLeftDegrees,partialRightDegrees:w.partialRightDegrees,partialTopDegrees:w.partialTopDegrees,partialBottomDegrees:w.partialBottomDegrees}))})}return a};e.exports=a}),null);
__d("SphericalPhotoActions",["SphericalMediaActionNamespaces","SphericalMediaActions"],(function(a,b,c,d,e,f){"use strict";e.exports={rendererStats:function(a){return{namespace:b("SphericalMediaActionNamespaces").PHOTO,type:b("SphericalMediaActions").PHOTO_RENDERER_STATS,data:a}}}}),null);
__d("SphericalProjectionUtils",["invariant","degToRad","gl-matrix","radToDeg"],(function(a,b,c,d,e,f,g){__p&&__p();var h=b("gl-matrix").vec3,i=b("gl-matrix").mat4,j=Math.acos,k=Math.sin,l=Math.cos,m=15,n=.2,o={convert3dTo2dNormalized:function(a,c,d,e,f,g,j){__p&&__p();a=b("degToRad")(a);c=b("degToRad")(c);d=b("degToRad")(d);e=b("degToRad")(e);f=b("degToRad")(f);var k=i.create();i.perspective(k,f,g/j,.1,100);f=i.create();i.rotateX(f,f,c);i.rotateY(f,f,a);i.invert(f,f);g=i.create();i.rotateX(g,g,e);i.rotateY(g,g,d);i.multiply(g,g,f);i.multiply(g,k,g);j=h.fromValues(0,0,-1);h.transformMat4(j,j,g);c=.5+j[0]/2;a=.5+j[1]/2;return{x:c,y:a,isNegativeTwin:j[2]>1}},convert3dTo2dScaled:function(a,b,c,d,e,f,g){var h=o.convert3dTo2dNormalized.apply(o,arguments),i=h.x,j=h.y,k=h.isNegativeTwin;return{x:i*f,y:j*g,isNegativeTwin:k}},convert3dTo2dScaledUnique:function(a,b,c,d,e,f,g){var h=o.convert3dTo2dNormalized.apply(o,arguments),i=h.x,j=h.y,k=h.isNegativeTwin;k?i=j=-1:(i*=f,j*=g);return{x:i,y:j}},convert3dTo2dOnScreen:function(a,b,c,d,e,f,g){var h=o.convert3dTo2dScaled.apply(o,arguments),i=h.x,j=h.y,k=h.isNegativeTwin;k&&(i=-i,j=b>0?-g:g);i=Math.max(0,Math.min(f,i));j=Math.max(0,Math.min(g,j));return{x:i,y:j}},convert2dTo3dNormalized:function(a,c,d,e,f,h,j){__p&&__p();a<=1&&a>=-1||g(0,5706);c<=1&&c>=-1||g(0,5707);var k=b("degToRad")(d),l=b("degToRad")(e);f=b("degToRad")(f);var p=i.create();i.perspective(p,f,h/j,.1,100);h=-a/p[0];j=-c/p[5];a=k;c=l;p=Math.atan(Math.tan(f/2)*p[5]/p[0]);p=a+(h<0?p:-p);f=c+(j>0?f/2:-f/2);var q,r,s,t,u;t=u=q=0;while(q<m&&!(Math.abs(b("radToDeg")(p-a))<n&&Math.abs(b("radToDeg")(f-c))<n)){q++;r=(a+p)/2;s=(c+f)/2;var v=o._getRelativePositionWithoutProjection(k,l,r,s),w=v.x;v=v.y;(j-u)*(j-v)<=0?f=s:(c=s,u=v);(h-t)*(h-w)<=0?p=r:(a=r,t=w)}q<m?(s=Math.ceil(b("radToDeg")(a)),v=Math.ceil(b("radToDeg")(c))):(s=d,v=e);return{yaw:s,pitch:v}},convert2dTo3dScaled:function(a,b,c,d,e,f,g){var h=f/2,i=g/2;return o.convert2dTo3dNormalized((a-h)*(2/f),(b-i)*(2/g),c,d,e,f,g)},_getRelativePositionWithoutProjection:function(a,b,c,d){__p&&__p();var e=(b-d)/2;b=(b+d)/2;d=Math.cos((a-c)/2);a=Math.sin((a-c)/2);c=Math.cos(e)*d;e=Math.sin(e)*d;d=Math.cos(b)*a;b=Math.sin(b)*a;a=2*e*b+2*c*d;b=2*d*b-2*c*e;c=1-2*e*e-2*d*d;return{x:a/c,y:b/c}},distanceBetweenSphericalCoordinatesDeg:function(a,c,d,e){return b("radToDeg")(o.distanceBetweenSphericalCoordinatesRad.apply(o,Array.from(arguments).map(b("degToRad"))))},distanceBetweenSphericalCoordinatesRad:function(a,b,c,d){return j(k(b)*k(d)+l(b)*l(d)*l(a-c))}};e.exports=o}),null);
__d("SphericalMediaTaggingUtils",["SphericalPhotoProjectionUtils","SphericalProjectionUtils","degToRad","gl-matrix","radToDeg"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("gl-matrix").vec3,h={getSpatialTagArea:function(a,c,d){var e=d.h/c.fov;e={w:Math.abs(a.width_degree)*e,h:Math.abs(a.height_degree)*e};a=b("SphericalProjectionUtils").convert3dTo2dScaledUnique(a.center.yaw,a.center.pitch,c.yaw,c.pitch,c.fov,d.w,d.h);return{topLeft:{x:a.x-e.w/2,y:a.y-e.h/2},bottomRight:{x:a.x+e.w/2,y:a.y+e.h/2}}},getSpatialTagAreaInNewPhotoRenderer:function(a,c,d,e){var f=d.h/c.fov;f={w:Math.abs(a.width_degree)*f,h:Math.abs(a.height_degree)*f};a=b("SphericalPhotoProjectionUtils").convert3dTo2d(a.center.yaw,a.center.pitch,c,d.w,d.h,e);return{topLeft:{x:a.x-f.w/2,y:a.y-f.h/2},bottomRight:{x:a.x+f.w/2,y:a.y+f.h/2}}},isPointInTagArea:function(a,b,c,d){b=h.getSpatialTagArea(b,c,d);return!(b.topLeft.x>a.x||b.bottomRight.x<a.x||b.topLeft.y>a.y||b.bottomRight.y<a.y)},isPointInTagAreaInNewPhotoRenderer:function(a,b,c,d,e){b=h.getSpatialTagAreaInNewPhotoRenderer(b,c,d,e);return!(b.topLeft.x>a.x||b.bottomRight.x<a.x||b.topLeft.y>a.y||b.bottomRight.y<a.y)},pointsToRectSize:function(a){var b=a.topLeft;a=a.bottomRight;return{w:Math.abs(a.x-b.x),h:Math.abs(a.y-b.y)}},rectSizeToPoints:function(a,b){return{topLeft:a,bottomRight:{x:a.x+Math.abs(b.w),y:a.y+Math.abs(b.h)}}},rectSizeToDegreeSize:function(a,b,c){var d=Number(c.FullPanoHeightPixels);c=Number(c.FullPanoWidthPixels);return{widthDegree:a/c*360,heightDegree:b/d*180}},degreeSizeToRectSize:function(a,b,c){var d=Number(c.FullPanoHeightPixels);c=Number(c.FullPanoWidthPixels);return{w:a/360*c,h:b/180*d}},yawPitchToPhotoXY:function(a,c,d){__p&&__p();var e=Number(d.PosePitchDegrees),f=Number(d.PoseRollDegrees),i=Number(d.CroppedAreaImageHeightPixels),j=Number(d.CroppedAreaImageWidthPixels),k=Number(d.CroppedAreaLeftPixels),l=Number(d.CroppedAreaTopPixels),m=Number(d.FullPanoHeightPixels);d=Number(d.FullPanoWidthPixels);a=h.yawPitchToVec3(a,c);c=[a.x,a.y,a.z];e!==0&&g.rotateX(c,c,[0,0,0],b("degToRad")(-e));f!==0&&g.rotateZ(c,c,[0,0,0],b("degToRad")(f));a=h.vec3ToPhotoXY(c[0],c[1],c[2]);e=a.x*d-k;f=a.y*m-l;c=e/j;d=f/i;return{x:c,y:d}},photoXYToYawPitch:function(a,c){__p&&__p();var d=Number(c.PosePitchDegrees),e=Number(c.PoseRollDegrees),f=Number(c.CroppedAreaImageHeightPixels),i=Number(c.CroppedAreaImageWidthPixels),j=Number(c.CroppedAreaLeftPixels),k=Number(c.CroppedAreaTopPixels),l=Number(c.FullPanoHeightPixels);c=Number(c.FullPanoWidthPixels);i=a.x*i;a=a.y*f;f=(i+j)/c;i=(a+k)/l;j=h.photoXYToVec3(f,i);c=[j.x,j.y,j.z];e!==0&&g.rotateZ(c,c,[0,0,0],b("degToRad")(-e));d!==0&&g.rotateX(c,c,[0,0,0],b("degToRad")(d));return h.vec3ToYawPitch.apply(h,c)},yawPitchToVec3:function(a,c){var d=b("degToRad")(a);c=b("degToRad")(90-c);a=Math.abs(a)>90?1:-1;d=Math.tan(d)*-a;if(!isFinite(d))return{x:1,y:0,z:0};c=Math.sqrt(d*d+a*a)/Math.tan(c);return!isFinite(c)?{x:0,y:1,z:0}:{x:d,y:c,z:a}},vec3ToYawPitch:function(a,c,d){c=Math.atan2(Math.sqrt(a*a+d*d),c);a=Math.atan2(a,-d);return{yaw:b("radToDeg")(a),pitch:90-b("radToDeg")(c)}},vec3ToPhotoXY:function(a,b,c){var d=Math.abs(Math.atan2(b,Math.sqrt(a*a+c*c)));b>0&&d<0&&(d*=-1);b<0&&d>0&&(d*=-1);d=(-d+Math.PI/2)/Math.PI;b=-1*Math.atan2(a,c);b<0&&(b+=2*Math.PI);b/=2*Math.PI;return{x:b,y:d}},photoXYToVec3:function(a,b){var c=(b-.5)*Math.PI,d=Math.sin(c);c=Math.cos(c);var e=(a-.75)*2*Math.PI,f=Math.sin(e);e=Math.cos(e);a=e*c;b=-d;e=f*c;return{x:a,y:b,z:e}},normalizeComposerXYToPhotoXY:function(a){return a/100},normalizePhotoXYToComposerXY:function(a){return a*100},coordinatesAreClose:function(a,b,c){c===void 0&&(c=.001);var d=Math.abs(a.x-b.x);a=Math.abs(a.y-b.y);return!(d>c||a>c)},compareTags:function(a,b){return!(a.center.pitch!==b.center.pitch||a.center.vec3[0]!==b.center.vec3[0]||a.center.vec3[1]!==b.center.vec3[1]||a.center.vec3[2]!==b.center.vec3[2]||a.center.yaw!==b.center.yaw||a.centerXY.x!==b.centerXY.x||a.centerXY.y!==b.centerXY.y||a.height_degree!==b.height_degree||a.width_degree!==b.width_degree)},getSpatialTagFromFBID:function(a,b){for(var c=0;c<b.length;c++)if(b[c].fbid==a)return b[c];return null}};e.exports=h}),null);
__d("SphericalPhotoController.redux",["DOM","ReactRedux","SphericalMediaBaseActions","SphericalMediaConstants","SphericalMediaController.react","SphericalMediaTaggingUtils","SphericalMediaViewActions","SphericalPhotoPartialLimits","SphericalPhotoProjectionUtils","SphericalPhotoTypedConfig","SphericalProjectionUtils","UserAgent","goURI","normalizeDeltaYaw"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=b("ReactRedux").connect;var g=b("SphericalMediaBaseActions").dragStart,h=b("SphericalMediaBaseActions").gyroStart,i=b("SphericalMediaBaseActions").mouseEnter,j=b("SphericalMediaBaseActions").redirectFromClickedTag,k=b("SphericalMediaBaseActions").significantMove,l=b("SphericalMediaBaseActions").taggingStart,m=b("SphericalMediaBaseActions").taggingStop,n=b("SphericalMediaBaseActions").updateBase,o=b("SphericalMediaBaseActions").updateCtrElem,p=b("SphericalMediaBaseActions").updateInitialViewport,q=b("SphericalMediaBaseActions").updateTagClicked,r=b("SphericalMediaBaseActions").updateTagUnderMouse,s=b("SphericalMediaBaseActions").viewportClicked,t=b("SphericalMediaBaseActions").zoomStart,u=b("SphericalMediaConstants").UNTAGGED_FACEBOX,v=b("SphericalMediaViewActions").stopAnimating,w=b("SphericalMediaViewActions").updateFOV,x=b("SphericalMediaViewActions").updateViewportAndFOV,y=b("SphericalPhotoPartialLimits").makePartialLimits,z=b("SphericalProjectionUtils").convert3dTo2dScaledUnique;c={__getViewData:!0,__onUpdateViewportBegin:!0,__onUpdateViewportMoveStart:!0,__onDOMClick:!0,__onUpdateViewportEnd:!0,__onViewportChange:!0,__onInitialViewportChange:!0,__onZoomStart:!0,__onMouseEnter:!0,__onMouseMove:!0,__onSignificantMove:!0,__updateFOV:!0};d=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(){__p&&__p();var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.$SphericalPhotoController5=function(){c.onViewChange()},c.__onUpdateViewportBegin=function(){c.props.viewStore.dispatch(v())},c.__onUpdateViewportMoveStart=function(a){var b=c.props.dispatch;a?b(h()):b(g())},c.__onDOMClick=function(a){if(c.props.enableTagging){c.props.taggingMode?c.$SphericalPhotoController8(a):c.$SphericalPhotoController10(a);a=c.$SphericalPhotoController7(a);c.props.dispatch(q(a))}c.props.dispatch(s())},c.__onViewportChange=function(a,b,d){if(c.props.enableTagging){var e=c.props,f=e.dispatch,g=e.isTagging;e=e.tagger;g&&e&&(e.hideTagger(),f(m()));f(q(null))}c.props.viewStore.dispatch(x(a,b,d))},c.__onInitialViewportChange=function(a,b){c.props.dispatch(p(a,b))},c.__onZoomStart=function(){c.props.dispatch(t())},c.__onMouseEnter=function(){c.props.dispatch(i())},c.__onMouseMove=function(a){if(c.props.enableTagging){var b=c.$SphericalPhotoController7(a);b?b.type!==u?c.__changeCursorStyle("pointer"):c.__changeCursorStyle("crosshair"):c.__changeCursorStyle(c.$SphericalPhotoController6());c.props.dispatch(r(c.$SphericalPhotoController7(a)))}},b)||babelHelpers.assertThisInitialized(c)}var d=c.prototype;d.UNSAFE_componentWillReceiveProps=function(b){a.prototype.UNSAFE_componentWillReceiveProps.call(this,b),b.isTagging?this.__sphericalViewportControl&&this.__sphericalViewportControl.disableKeyboard():this.__sphericalViewportControl&&this.__sphericalViewportControl.enableKeyboard(),b.enableTagging&&this.props.taggingMode!==b.taggingMode&&this.$SphericalPhotoController3(b),b.partialLimits.equals(this.props.partialLimits)||this.$SphericalPhotoController4(b)};d.shouldComponentUpdate=function(b){b=a.prototype.shouldComponentUpdate.call(this,b)||this.props.tagger!==b.tagger&&this.props.enableTagging;return b};d.componentDidMount=function(){a.prototype.componentDidMount.call(this),this.props.viewStore.subscribe(this.$SphericalPhotoController5),this.props.dispatch(o(this.__viewport)),this.props.enableTagging&&this.$SphericalPhotoController3(this.props)};d.componentDidUpdate=function(){a.prototype.componentDidUpdate.call(this),this.props.dispatch(o(this.__viewport)),this.props.enableTagging&&this.$SphericalPhotoController3(this.props)};d.componentWillUnmount=function(){a.prototype.componentWillUnmount.call(this),this.props.dispatch(o(null))};d.$SphericalPhotoController3=function(a){var c=a.tagger,d=this.__sphericalViewportControl;if(c&&d){this.$SphericalPhotoController1&&(d.removeLayer(this.$SphericalPhotoController1),this.$SphericalPhotoController1=null);this.$SphericalPhotoController2&&(d.removeLayer(this.$SphericalPhotoController2),this.$SphericalPhotoController2=null);try{var e=b("DOM").find(c.tagger,"div.faceBox");this.$SphericalPhotoController1=d.addNewLayer(e);a.taggingMode&&(this.$SphericalPhotoController2=d.addNewLayer(c.viewer.stageActions))}catch(a){}}};d.$SphericalPhotoController4=function(a){this.__sphericalViewportControl&&(this.__sphericalViewportControl.reconfigure(this.__getSphericalConfig(a)),a.viewStore.dispatch(x(a.initialYaw,a.initialPitch,a.initialFov)))};d.$SphericalPhotoController6=function(){var a="grab";b("UserAgent").isEngine("WebKit")?a="-webkit-"+a:b("UserAgent").isEngine("Gecko")&&(a="-moz-"+a);return a};d.$SphericalPhotoController7=function(a){__p&&__p();var c=this,d=this.__getViewportMousePosition(a);if(!d)return null;a=this.props;var e=a.partialLimits,f=a.showNewPhotoRenderer;a=a.tags;var g=this.props.viewStore.getState(),h=g.view;g=null;a&&a.forEach(function(a){(f&&b("SphericalMediaTaggingUtils").isPointInTagAreaInNewPhotoRenderer(d,a,h,{w:c.props.width,h:c.props.height},y({partialLeftDegrees:e.partialLeftDegrees,partialRightDegrees:e.partialRightDegrees,partialTopDegrees:e.partialTopDegrees,partialBottomDegrees:e.partialBottomDegrees}))||b("SphericalMediaTaggingUtils").isPointInTagArea(d,a,h,{w:c.props.width,h:c.props.height}))&&(g=a)});return g};d.$SphericalPhotoController8=function(a){__p&&__p();if(!this.props.tagger)return;var c=this.$SphericalPhotoController7(a),d=this.__getViewData(),e=this.props,f=e.height,g=e.partialLimits,h=e.photoSphereMetadata,i=e.showNewPhotoRenderer;e=e.width;var k,m;if(c){if(c.type!==u){this.props.dispatch(j());c.url&&b("goURI")(c.url,!0);return}if(c.type===u){var n=c.center,o=n.yaw;n=n.pitch;i?(k=b("SphericalPhotoProjectionUtils").convert3dTo2d(o,n,d,e,f,g),m=b("SphericalMediaTaggingUtils").getSpatialTagAreaInNewPhotoRenderer(c,d,{w:e,h:f},g)):(k=z(o,n,d.yaw,d.pitch,d.fov,e,f),m=b("SphericalMediaTaggingUtils").getSpatialTagArea(c,d,{w:e,h:f}));o=c.centerXY;n=b("SphericalMediaTaggingUtils").pointsToRectSize(m);m=this.$SphericalPhotoController9(c)}else return}else{k=this.__getViewportMousePosition(a);n={w:100};if(!k)return;if(i){i=b("SphericalPhotoProjectionUtils").convert2dTo3d(k.x,k.y,d,e,f,g);if(!i)return}else i=b("SphericalProjectionUtils").convert2dTo3dScaled(k.x,k.y,d.yaw,d.pitch,d.fov,e,f);o=b("SphericalMediaTaggingUtils").yawPitchToPhotoXY(b("normalizeDeltaYaw")(i.yaw),i.pitch,h);m=null}if(o.y<0||o.y>1)return;this.props.tagger.addSpatialTag({screenPos:k,photoXY:o,suggestion:m,size:n.w,fromTag:!!c,inTaggingMode:this.props.taggingMode},a);this.props.dispatch(l())};d.$SphericalPhotoController10=function(a){__p&&__p();var c=this.$SphericalPhotoController7(a);if(c)if(c.type!==u){this.props.dispatch(j());c.url&&b("goURI")(c.url,!0);return}else{if(!this.props.tagger)return;var d=this.props,e=d.height,f=d.partialLimits,g=d.showNewPhotoRenderer;d=d.width;var h=c.center,i=h.yaw;h=h.pitch;var k=this.__getViewData(),n;g?n=b("SphericalPhotoProjectionUtils").convert3dTo2d(i,h,k,d,e,f):n=z(i,h,k.yaw,k.pitch,k.fov,d,e);i=c.centerXY;g?h=b("SphericalMediaTaggingUtils").getSpatialTagAreaInNewPhotoRenderer(c,k,{w:d,h:e},f):h=b("SphericalMediaTaggingUtils").getSpatialTagArea(c,k,{w:d,h:e});g=b("SphericalMediaTaggingUtils").pointsToRectSize(h);f=this.$SphericalPhotoController9(c);this.props.tagger.addSpatialTag({screenPos:n,photoXY:i,suggestion:f,size:g.w,fromTag:!0,inTaggingMode:this.props.taggingMode},a);this.props.dispatch(l())}else this.props.isTagging&&(this.props.tagger.hideTagger(),this.props.dispatch(m()))};d.$SphericalPhotoController9=function(a){__p&&__p();if(!this.props.tagger||this.props.tagger.faceboxes.length<1)return null;var c=null,d=this.props.tagger.faceboxes;d.forEach(function(d){var e=d.rect,f=e.l,g=e.r,h=e.t;e=e.b;g={x:f+(g-f)/2,y:h+(e-h)/2};try{f=JSON.parse(d.node.getAttribute("data-recognizeduids"));b("SphericalMediaTaggingUtils").coordinatesAreClose(g,a.centerXY)&&f.length>0&&(c=d)}catch(a){c=null}});return c};d.__onUpdateViewportEnd=function(){this.props.dispatch(n({isPanning:!1}))};d.__onSignificantMove=function(a){this.props.dispatch(k(a))};d.__updateFOV=function(a){this.props.viewStore.dispatch(w(a))};d.__getViewData=function(){var a=this.props.viewStore.getState();a=a.view;return{fov:a.fov,pitch:a.pitch,yaw:a.yaw}};return c}(b("SphericalMediaController.react"));d.__subClassMethods=c;f=function(a){var c=a.base;return{aspectRatio:c.aspectRatio,caption:c.caption,enableGyro:c.enableGyro,enableRubberBanding:c.enableRubberBanding,enableTagging:c.enableTagging&&!b("SphericalPhotoTypedConfig").enable_stereograph_renderer,enableZoom:c.enableZoom,height:c.height,initialFov:c.initialFov,initialPitch:c.initialPitch,initialYaw:c.initialYaw,isActive:c.isRendererActive&&c.isRendererSetup||c.showFallbackUI,isTagging:c.isTagging,keyboardVelocityFactor:c.keyboardVelocityFactor,maxTileLevel:c.tiledSphericalConfig.maxTileLevel,panningVelocityFactor:c.panningVelocityFactor,partialLimits:c.partialLimits,photoSphereMetadata:a.base.photoSphereMetadata,tagger:c.tagger,taggingMode:c.taggingMode,tags:c.tags,showNewPhotoRenderer:c.tiledSphericalConfig.useTiledRenderer&&b("SphericalPhotoTypedConfig").show_new_renderer,viewStore:c.viewStore,width:c.width}};e.exports=a(f)(d)}),null);
__d("SphericalPhotoFallbackMiddleware",["SphericalMediaActions","SphericalMediaBaseActions"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("SphericalMediaBaseActions").disableTagging,h=b("SphericalMediaBaseActions").useFallbackUI;a=function(a){var c=a.dispatch;a.getState;return function(a){return function(d){d.type===b("SphericalMediaActions").WEBGL_INIT_FAILED&&(c(g()),c(h()));return a(d)}}};e.exports=a}),null);
__d("CubemapImageTile",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){function a(a,b){this.$1=a,this.$2=b}var b=a.prototype;b.getInfo=function(){return this.$1};b.getImg=function(){return this.$2};return a}();e.exports=a}),null);
__d("CubemapImageTileInfo",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(a,b,c,d){this.level=a,this.face=b,this.col=c,this.row=d}var b=a.prototype;b.getKey=function(){return""+this.level+"_"+this.face+"_"+this.col+"_"+this.row};b.getInfoForOffsetLevel=function(b){var c=this.level-b;if(c<0)throw new Error("Invalid level offset for getKeyForOffsetLevel: "+b+", max offset: "+this.level);var d=Math.floor(this.col/Math.pow(2,b));b=Math.floor(this.row/Math.pow(2,b));return new a(c,this.face,d,b)};return a}();e.exports=a}),null);
__d("CubemapImageTileProvider",["Bootloader","CubemapImageTile","CubemapImageTileInfo","QE2Logger","SphericalMediaConstants","SphericalPhotoConstants","SphericalPhotoTypedConfig","URI","performanceNow"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("SphericalMediaConstants").TILED_CUBE_FACES,h=b("SphericalMediaConstants").TILED_CUBE_TILE_CONTENT_SIZE,i=b("SphericalMediaConstants").TILED_CUBE_TILE_PADDING_PIXELS;b("SphericalPhotoConstants").QE_WWW_UNIVERSE;a=function(){__p&&__p();function a(a,c,d){__p&&__p();var e=this;this.$15=function(a,c,d){var f=new Image(),g=new(b("CubemapImageTile"))(a,f);f.crossOrigin="anonymous";f.onload=function(){return e.$16(g,d)};f.src=c;f.onerror=function(){return e.$17(f,a)}};this.$1=a;this.$10=0;this.$11={};this.$2=!1;this.$3=[];this.$4=[];this.$5=new Map();this.$6=new Map();this.$7=!1;this.$8=[];this.$9=new Map();this.$12=c;this.$13();d&&d.length?this.$14(d):this.$7=!0}var c=a.prototype;c.getTileContentSize=function(){return h};c.getTilePaddingPixels=function(){return i};c.getTileTotalSize=function(){return 2*i+h};c.getMaxTileLevel=function(){return this.$12};c.getTotalPixelsLoaded=function(){return this.$10*Math.pow(this.getTileTotalSize(),2)};c.getBaseLevelImageTiles=function(){return this.$5};c.getViewportImageTiles=function(){return this.$9};c.addBaseLevelReadyCallback=function(a){!this.$2?this.$3.push(a):a()};c.isBaseLevelReady=function(){return this.$2};c.isViewportReady=function(){return this.$7};c.loadTileImage=function(a,b,c){var d=this,e=a.getKey();e in this.$11?b(this.$11[e],c):this.$1.getUriForTile(a,function(a,c){d.$15(a,c,b)})};c.$13=function(){var a=this;this.$4=[new(b("CubemapImageTileInfo"))(0,g.PLUS_X,0,0),new(b("CubemapImageTileInfo"))(0,g.MINUS_X,0,0),new(b("CubemapImageTileInfo"))(0,g.PLUS_Y,0,0),new(b("CubemapImageTileInfo"))(0,g.MINUS_Y,0,0),new(b("CubemapImageTileInfo"))(0,g.PLUS_Z,0,0),new(b("CubemapImageTileInfo"))(0,g.MINUS_Z,0,0)];this.$4.forEach(function(b){return a.$1.getUriForTile(b,a.$15)})};c.$14=function(a){var c=this;a.forEach(function(a){var d=new(b("CubemapImageTileInfo"))(a.level,a.face,a.col,a.row);c.$8.push(d);c.$15(d,a.uri)})};c.$17=function(a,c){__p&&__p();var d=this;b("Bootloader").loadModules(["SphericalPhotoViewerTypedLogger","SphericalPhotoViewerLogEvents"],function(a,b){a=new a();a.setName(b.CDN_IMAGE_FAILURE).setErrorMessage(c.getKey()).log()},"CubemapImageTileProvider");this.$6.has(c.getKey())||this.$6.set(c.getKey(),0);var e=this.$6.get(c.getKey());typeof e==="number"&&!isNaN(e)&&e<10&&setTimeout(function(){var f=new(b("URI"))(a.src);a.src=f.addQueryData("time",Date.now().toString()).toString();d.$6.set(c.getKey(),e+1)},500)};c.$16=function(a,c){__p&&__p();var d=this,e=a.getInfo().getKey();this.$11[e]=a;this.$10++;if(!this.$2){e=this.$4.every(function(a){return a.getKey()in d.$11});var f=this.$8.length?this.$8.every(function(a){return a.getKey()in d.$11}):!0;a.getInfo().level===0?this.$5.set(a.getInfo().getKey(),a):this.$9.set(a.getInfo().getKey(),a);e&&f&&this.$18()}else c&&c(a,b("performanceNow")())};c.$18=function(){this.$2=!0,this.$7=!0,this.$3.forEach(function(a){return a()})};return a}();e.exports=a}),null);
__d("BaseCubemapTileUriProvider",["invariant","CubemapImageTileInfo"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){}var b=a.prototype;b.getUriForTile=function(a,b){g(0,5547)};return a}();e.exports=a}),null);
__d("XSphericalPhotoTileURIsAsyncController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/spherical_media/photo/tile/",{})}),null);
__d("EntPhotoCubemapTileUriProvider",["Promise","BaseCubemapTileUriProvider","CubemapImageTileInfo","XAsyncRequest","XSphericalPhotoTileURIsAsyncController","flattenPHPQueryData","throttle"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=200;a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c,d){__p&&__p();var e;e=a.call(this)||this;e.$EntPhotoCubemapTileUriProvider9=b("throttle")(function(){e.$EntPhotoCubemapTileUriProvider10(e.$EntPhotoCubemapTileUriProvider3),e.$EntPhotoCubemapTileUriProvider3=new Map()},g);e.$EntPhotoCubemapTileUriProvider1=c;e.$EntPhotoCubemapTileUriProvider2=new Map();e.$EntPhotoCubemapTileUriProvider3=new Map();e.$EntPhotoCubemapTileUriProvider4=new Map();e.$EntPhotoCubemapTileUriProvider5=new Map();e.$EntPhotoCubemapTileUriProvider7(d);e.$EntPhotoCubemapTileUriProvider6=0;return e}var d=c.prototype;d.getUriForTile=function(a,b){var c=a.getKey(),d=this.$EntPhotoCubemapTileUriProvider2.get(c);if(!d){if(this.$EntPhotoCubemapTileUriProvider5.has(c))return;this.$EntPhotoCubemapTileUriProvider8({tileInfo:a,onURIfetched:b})}else b(a,d)};d.$EntPhotoCubemapTileUriProvider8=function(a){var b=a.tileInfo.getKey(),c=this.$EntPhotoCubemapTileUriProvider3.get(b),d=this.$EntPhotoCubemapTileUriProvider4.get(b);!c&&!d&&(this.$EntPhotoCubemapTileUriProvider3.set(b,a),this.$EntPhotoCubemapTileUriProvider9())};d.$EntPhotoCubemapTileUriProvider10=function(a){__p&&__p();var c=this;if(a.size===0)return new(b("Promise"))(function(){});var d=[];a.forEach(function(a){a=a.tileInfo;c.$EntPhotoCubemapTileUriProvider4.set(a.getKey(),a);d.push({level:a.level,face:a.face,col:a.col,row:a.row})});var e={photo_id:this.$EntPhotoCubemapTileUriProvider1,tile_info_list:d};return this.$EntPhotoCubemapTileUriProvider11(b("XSphericalPhotoTileURIsAsyncController").getURIBuilder().getURI(),e).then(function(b){c.$EntPhotoCubemapTileUriProvider7(b.payload),a.forEach(function(a){var b=a.tileInfo;a=a.onURIfetched;var d=b.getKey(),e=c.$EntPhotoCubemapTileUriProvider2.get(d);e?a(b,e):c.$EntPhotoCubemapTileUriProvider5.set(d,!0);c.$EntPhotoCubemapTileUriProvider4["delete"](d)})},function(a){})};d.$EntPhotoCubemapTileUriProvider11=function(a,c){return new(b("Promise"))(function(d,e){return new(b("XAsyncRequest"))(a).setMethod("POST").setData(b("flattenPHPQueryData")(c)).setHandler(d).setErrorHandler(e).send()})};d.$EntPhotoCubemapTileUriProvider7=function(a){var c=this;a.forEach(function(a){var d=new(b("CubemapImageTileInfo"))(a.level,a.face,a.col,a.row);c.$EntPhotoCubemapTileUriProvider2.set(d.getKey(),a.uri)})};return c}(b("BaseCubemapTileUriProvider"));e.exports=a}),null);
__d("StaticCubemapTileUriProvider",["BaseCubemapTileUriProvider","CubemapImageTileInfo"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c){var d;d=a.call(this)||this;d.$StaticCubemapTileUriProvider1=new Map();c.forEach(function(a){var c=new(b("CubemapImageTileInfo"))(a.level,a.face,a.col,a.row);d.$StaticCubemapTileUriProvider1.set(c.getKey(),a.uri)});return d}var d=c.prototype;d.getUriForTile=function(a,b){var c=a.getKey();c=this.$StaticCubemapTileUriProvider1.get(c);c&&b(a,c)};return c}(b("BaseCubemapTileUriProvider"));e.exports=a}),null);
__d("getErrorNameFromWebGLErrorCode",[],(function(a,b,c,d,e,f){var g={0:"NO_ERROR",1280:"INVALID_ENUM",1281:"INVALID_VALUE",1282:"INVALID_OPERATION",1285:"OUT_OF_MEMORY",1286:"INVALID_FRAMEBUFFER_OPERATION",37442:"CONTEXT_LOST_WEBGL"};function a(a){return!(a in g)?"UNKNOWN_ERROR":g[a]}e.exports=a}),null);
__d("BaseRotatableWebGLRenderer",["EventEmitter","EventListener","getErrorNameFromWebGLErrorCode","gl-matrix","performanceNow","radToDeg","requestAnimationFrame"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("gl-matrix").glMatrix,h=b("gl-matrix").mat4,i=Math.max(window.devicePixelRatio||1,1),j=179;c=function(c){__p&&__p();babelHelpers.inheritsLoose(d,c);function d(a,b){__p&&__p();var d;b===void 0&&(b={});d=c.call(this)||this;d.__handleContextLost=function(a){a.preventDefault(),d.emit("renderingContextLost"),d.__contextLost=!0};d.__handleContextRestore=function(a){d.__setup(),d.emit("renderingContextRestore")};if(!d.constructor.__subClassMethods)throw new Error('Must implement "static __subClassMethods"');for(var e in d.constructor.__subClassMethods)if(typeof babelHelpers.assertThisInitialized(d)[e]!=="function")throw new Error('Must implement "'+e+'"');d.__glContextAttributes=b;d.__firstRenderTime=-1;d.__previousRenderFinishTime=-1;d.__sumOfRenderTimes=0;d.$BaseRotatableWebGLRenderer1=-1;d.__framesRenderedCount=0;d.__sumTextureScreenRatioValues=0;d.__textureScreenRatioMillisCounted=0;d.__canvas=a;d.__aspectRatio=d.__canvas.width/d.__canvas.height||1;d.__shaders=[];d.__contextLost=!1;d.__horizontalFieldOfView=0;d.__verticalFieldOfView=0;d.__perspectiveMatrix=h.create();d.__rotationMatrix=h.create();d.__shouldEnableBlend=!1;d.__useVfovAsIs=!1;d.__canvas.addEventListener("webglcontextlost",d.__handleContextLost);d.__canvas.addEventListener("webglcontextrestored",d.__handleContextRestore);return d}var e=d.prototype;e.destroy=function(){var a=this;this.__canvas.removeEventListener("webglcontextlost",this.__handleContextLost);this.__canvas.removeEventListener("webglcontextrestored",this.__handleContextRestore);this.__shaders.forEach(function(b){try{a.__gl.detachShader(a.__shaderProgram,b)}catch(a){}});this.__shaders=[];this.__clearCache();this.__destroyed=!0};e.updateFieldOfView=function(a){var b=Math.min(a,j/this.__aspectRatio);this.__useVfovAsIs&&(b=a);a=Math.min(j,b);this.__verticalFieldOfView=a;this.__updateHorizontalFieldOfView();this.__updatePerspective()};e.updateViewportDimensions=function(a,b){this.__canvas.width=a*i,this.__canvas.height=b*i,this.__aspectRatio=this.__canvas.width/this.__canvas.height||1,this.__updateHorizontalFieldOfView(),this.__updatePerspective()};e.hasRenderingContext=function(){return!this.__contextLost};e.getScreenshotDataURL=function(a,b,c){if(!this.__gl||this.__contextLost)return"";this.render(a);return this.__canvas.toDataURL(b,c)};e.getAverageFrameRenderTimeMillis=function(){return this.__framesRenderedCount===0?0:this.__sumOfRenderTimes/this.__framesRenderedCount};e.getMaxGPUMemoryUsedBytes=function(){return this.__getMaxGPUMemoryUsedBytes()};e.getAverageTextureToScreenPixelRatio=function(){return this.__textureScreenRatioMillisCounted===0?0:this.__sumTextureScreenRatioValues/this.__textureScreenRatioMillisCounted};e.getTimeSinceFirstRenderMillis=function(){return b("performanceNow")()-this.__firstRenderTime};e.renderErrorCheck=function(){this.__createTexture()};e.render=function(a){__p&&__p();if(this.__contextLost||this.__destroyed)return;this.__view=a;if(!this.__isValidView(a)){this.emit("renderingError",new Error("invalid view"),a);return}var c=b("performanceNow")();this.__firstRenderTime===-1&&(this.__firstRenderTime=c);a.fov!==this.__verticalFieldOfView&&this.updateFieldOfView(a.fov);h.identity(this.__rotationMatrix);h.rotateX(this.__rotationMatrix,this.__rotationMatrix,-g.toRadian(a.pitch));h.rotateY(this.__rotationMatrix,this.__rotationMatrix,g.toRadian(a.yaw));this.__gl.uniformMatrix4fv(this.__shaderRotMatrixUniform,!1,this.__rotationMatrix);this.__gl.uniformMatrix4fv(this.__shaderPMatrixUniform,!1,this.__perspectiveMatrix);a=this.__getPrevFrameTextureScreenRatio();this.__renderInternal();var d=b("performanceNow")();this.__sumOfRenderTimes+=d-c;this.__framesRenderedCount+=1;if(this.__previousRenderFinishTime>0){c=2e3;c=Math.min(d-this.__previousRenderFinishTime,c);this.__sumTextureScreenRatioValues+=c*a;this.__textureScreenRatioMillisCounted+=c}this.__previousRenderFinishTime=d};e.renderWithRotationMatrixForMSite=function(a){h.rotateX(a,a,g.toRadian(90)),this.renderWithRotationMatrix(a)};e.renderWithRotationMatrix=function(a){if(this.__contextLost)return;this.__rotationMatrix=a;this.__gl.uniformMatrix4fv(this.__shaderRotMatrixUniform,!1,this.__rotationMatrix);this.__gl.uniformMatrix4fv(this.__shaderPMatrixUniform,!1,this.__perspectiveMatrix);this.__renderInternal()};e.__isValidView=function(a){return!Number.isNaN(a.fov+a.pitch+a.yaw)};e.__copyTextureToGLBuffer=function(a,b,c){c===void 0&&(c=!1);b=this.__getNewGLTexObj(b);this.__gl.pixelStorei(this.__gl.UNPACK_FLIP_Y_WEBGL,c);this.__gl.bindTexture(this.__gl.TEXTURE_2D,b);this.__gl.texImage2D(this.__gl.TEXTURE_2D,0,this.__gl.RGBA,this.__gl.RGBA,this.__gl.UNSIGNED_BYTE,a.image);this.$BaseRotatableWebGLRenderer2();return b};e.__setup=function(){(!this.__gl||!this.__contextLost)&&(this.__gl=this.__getGL(),this.__contextLost=!1);this.__gl.clearColor(0,0,0,1);this.__shouldEnableBlend&&(this.__gl.enable(this.__gl.BLEND),this.__gl.blendFunc(this.__gl.SRC_ALPHA,this.__gl.ONE_MINUS_SRC_ALPHA));this.updateViewportDimensions(this.__canvas.clientWidth,this.__canvas.clientHeight);var a=this.__initShaders();if(!a.success){var c=b("getErrorNameFromWebGLErrorCode")(this.__gl.getError());throw new Error("\n        Failed to intialize shaders: "+c+"\n        Error Message: "+a.error+"\n      ")}};e.__getGL=function(){__p&&__p();if(this.__gl&&!this.__contextLost)return this.__gl;if(!a.WebGLRenderingContext)throw new Error("WebGLRenderingContext not available.");var c=["webgl","experimental-webgl","webkit-3d","moz-webgl"],d=null,e=null,f=b("EventListener").listen(this.__canvas,"webglcontextcreationerror",function(a){return e=a.statusMessage});for(var g=0;g<c.length;g++){try{d=this.__canvas.getContext(c[g],this.__glContextAttributes)}catch(a){}if(d)break}f.remove();if(!d){e=e||"Unknown error.";throw new Error("Failed to acquire 3D rendering context: "+e)}return d};e.__updatePerspective=function(){h.perspective(this.__perspectiveMatrix,g.toRadian(this.__verticalFieldOfView),this.__aspectRatio,.1,100),this.__gl.viewport(0,0,this.__gl.drawingBufferWidth,this.__gl.drawingBufferHeight)};e.__initShaders=function(){__p&&__p();this.__shaderProgram=this.__gl.createProgram();try{this.__attachShaders(this.__shaderProgram)}catch(a){return{success:!1,error:"Shader: "+a.message}}this.__gl.linkProgram(this.__shaderProgram);var a=this.__gl.getProgramParameter(this.__shaderProgram,this.__gl.LINK_STATUS);if(!a)return{success:!1,error:"No link. Could not initialize shaders"};this.__gl.useProgram(this.__shaderProgram);this.__setShaderMatrixPointers();this.__shaderProgramReady();return{success:!0,error:""}};e.__setShaderMatrixPointers=function(){this.__shaderPMatrixUniform=this.__gl.getUniformLocation(this.__shaderProgram,this.__getShaderPerspectiveMatrixUniformName()),this.__shaderRotMatrixUniform=this.__gl.getUniformLocation(this.__shaderProgram,this.__getShaderRotationMatrixUniformName())};e.__getShaderConfigs=function(){var a=new Map();a.set(this.__gl.VERTEX_SHADER,this.__getVertexShaderScript());a.set(this.__gl.FRAGMENT_SHADER,this.__getFragmentShaderScript());return a};e.__attachShaders=function(a){var b=this,c=this.__getShaderConfigs();c.forEach(function(c,d){d=b.__gl.createShader(d);b.__gl.shaderSource(d,c);b.__gl.compileShader(d);if(!b.__gl.getShaderParameter(d,b.__gl.COMPILE_STATUS))throw new Error(b.__gl.getShaderInfoLog(d));b.__gl.attachShader(a,d);b.__shaders.push(d)})};e.__getNewGLTexObj=function(a){var b=this.__gl.createTexture();this.__gl.bindTexture(a,b);this.__gl.texParameteri(a,this.__gl.TEXTURE_MAG_FILTER,this.__gl.LINEAR);this.__gl.texParameteri(a,this.__gl.TEXTURE_MIN_FILTER,this.__gl.LINEAR);this.__gl.texParameteri(a,this.__gl.TEXTURE_WRAP_S,this.__gl.CLAMP_TO_EDGE);this.__gl.texParameteri(a,this.__gl.TEXTURE_WRAP_T,this.__gl.CLAMP_TO_EDGE);this.__gl.bindTexture(a,null);return b};e.__updateHorizontalFieldOfView=function(){var a=g.toRadian(this.__verticalFieldOfView);a=2*Math.atan(Math.tan(a/2)*this.__aspectRatio);this.__horizontalFieldOfView=b("radToDeg")(a)};e.__emitRenderingError=function(a){this.emit("renderingError",new Error("WebGL Error Code: "+a))};e.$BaseRotatableWebGLRenderer2=function(){var a=this,c=b("performanceNow")()-this.$BaseRotatableWebGLRenderer1;c>1e3&&b("requestAnimationFrame")(function(){a.$BaseRotatableWebGLRenderer1=b("performanceNow")();var c=a.__gl.getError();c!==0&&a.__emitRenderingError(c)})};return d}(b("EventEmitter"));e.exports=c}),null);
__d("StereographicProjectionUtils",["gl-matrix"],(function(a,b,c,d,e,f){__p&&__p();var g=b("gl-matrix").vec2,h=b("gl-matrix").vec3,i=b("gl-matrix").mat3;b("gl-matrix").mat4;a={tiledCubeMapStereographProject:function(a,b,c,d,e,f,j,k){__p&&__p();var l=1.1;e=g.fromValues(e,f);f=g.scale(g.create(),e,.5/l);e=f[0]*f[0]+f[1]*f[1];l=h.scale(h.create(),h.fromValues(2*f[0],2*f[1],e-1),1/(e+1));f=j[b];e=i.multiply(i.create(),f,i.fromMat4(i.create(),k));j=h.transformMat3(h.create(),l,e);if(j[2]>0)return g.fromValues(NaN,NaN);b=g.fromValues(.5*j[0]/j[2]+.5,-.5*j[1]/j[2]+.5);f=Math.pow(2,a);k=g.fromValues(b[0]*f-c,b[1]*f-d);return k},tiledCubeMapStereographUnproject:function(a,b,c,d,e,f){__p&&__p();e=e[b];b=i.multiply(i.create(),e,i.fromMat4(i.create(),f));e=i.invert(i.create(),b);f=Math.pow(2,a);b=2/f;a=h.fromValues(1-b*c,-1+b*d,-1);f=h.transformMat3(h.create(),a,e);h.normalize(f,f);c=f[0]/(1-f[2]);b=f[1]/(1-f[2]);d=1.1;a=c*d/.5;e=b*d/.5;return g.fromValues(a,e)},cubeMapTileIsInView:function(a,b,c,d,e,f,g,i){__p&&__p();var j=this,k=g[1][0],l=g[1][1],m=!1,n=[];for(var o=0;o<=1;o++)for(var p=0;p<=1;p++){var q=this.tiledCubeMapStereographUnproject(a,b,c+p,d+o,e,f),r=q[0];q=q[1];n.push([r,q]);r>-k&&r<k&&q>-l&&q<l&&(m=!0)}r=function(h,g){h=j.tiledCubeMapStereographProject(a,b,c,d,h,g,e,f);g=h[0];h=h[1];g&&h&&g>0&&g<1&&h>0&&h<1&&(m=!0)};m||r(-k,-l);m||r(k,-l);m||r(-k,l);m||r(k,l);m||r(0,0);m||r(.5*-k,.5*-l);m||r(.5*k,.5*-l);m||r(.5*-k,.5*l);m||r(.5*k,.5*l);q=h.length(h.subtract(h.create(),h.fromValues(n[0][0],n[0][1],0),h.fromValues(n[1][0],n[1][1],0)));p=h.length(h.subtract(h.create(),h.fromValues(n[1][0],n[1][1],0),h.fromValues(n[3][0],n[3][1],0)));o=h.length(h.subtract(h.create(),h.fromValues(n[3][0],n[3][1],0),h.fromValues(n[2][0],n[2][1],0)));r=h.length(h.subtract(h.create(),h.fromValues(n[2][0],n[2][1],0),h.fromValues(n[0][0],n[0][1],0)));k=i.width/(2*g[1][0]);l=Math.max(Math.max(q,p),Math.max(o,r))*k;return{inlier:m,longestSide:l}}};e.exports=a}),null);
__d("TileRendererState",["CubemapImageTileInfo"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=1e3,h=1e3;a=function(){__p&&__p();function a(a,b){this.tileInfo=a,this.blendingProgress=0,this.closestCoveringTile=b,this.closestPrevTile=b,this.durationInViewMS=0,this.isInView=!0}var b=a.prototype;b.enterView=function(a){this.blendingProgress=1,this.closestCoveringTile=a,this.closestPrevTile=a,this.durationInViewMS=0,this.isInView=!0};b.exitView=function(){this.closestCoveringTile=null,this.closestPrevTile=null,this.isInView=!1};b.shouldFetch=function(a){return this.durationInViewMS<g&&this.durationInViewMS+a>=g};b.update=function(a,b){this.updateBlendingProgress(a,b),this.durationInViewMS+=a};b.updateBlendingProgress=function(a,b){if(!b||!this.closestCoveringTile)return;var c=b.level-this.closestCoveringTile.level;c>0&&(this.closestCoveringTile=b,this.blendingProgress=this.blendingProgress>=1?0:this.blendingProgress/(1*Math.pow(2,c)));this.blendingProgress<1&&(this.blendingProgress=Math.min(this.blendingProgress+1*a/h,1))};return a}();e.exports=a}),null);
__d("TiledSphericalRendererTextureCache",["TileRendererState","performanceNow"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(a,b,c,d,e){this.TEXTURE_CACHE_LIMIT=a,this.$3=b,this.$5=d,this.$4=c,this.$6=e,this.$1=new Map(),this.$2=new Map()}var c=a.prototype;c.createTexture=function(){this.$2.size===0&&this.$3.isBaseLevelReady()&&this.$7(),this.$1.size===0&&this.$3.isViewportReady()&&this.$8()};c.clearCache=function(){var a=this;this.$2.forEach(function(b){a.$5.deleteTexture(b)});this.$2.clear();this.$1.forEach(function(b){a.$5.deleteTexture(b.texture)});this.$1.clear()};c.cacheTexture=function(a){__p&&__p();var c=a.getInfo().getKey(),d=this.$1.get(c);if(!d){a=this.$6({image:a.getImg()},this.$5.TEXTURE_2D);d={texture:a,lastUsedTime:b("performanceNow")()};this.$1.set(c,d);if(this.$1.size>this.TEXTURE_CACHE_LIMIT){a=c;var e=d;this.$1.forEach(function(b,c){b.lastUsedTime<e.lastUsedTime&&(a=c,e=b)});this.$5.deleteTexture(e.texture);this.$1["delete"](a);this.$4["delete"](a)}}};c.getTextureCache=function(){return this.$1};c.getBaseLevelTexCache=function(){return this.$2};c.$7=function(){var a=this,b=this.$3.getBaseLevelImageTiles();b.forEach(function(b){var c=a.$6({image:b.getImg()},a.$5.TEXTURE_2D);a.$2.set(b.getInfo().getKey(),c)})};c.$8=function(){var a=this,c=this.$3.getViewportImageTiles();c.forEach(function(c){var d=a.$6({image:c.getImg()},a.$5.TEXTURE_2D);d={texture:d,lastUsedTime:b("performanceNow")()};a.$1.set(c.getInfo().getKey(),d)})};return a}();e.exports=a}),null);
__d("TiledSphericalRendererStats",["TiledSphericalRendererTextureCache"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(a,b,c,d){this.$1=a,this.$2=b,this.$3=c,this.$4=d}var b=a.prototype;b.getMaxGPUMemoryUsedBytes=function(){var a=this.$3.getTileTotalSize(),b=4,c=this.$2.getTextureCache().size+this.$2.getBaseLevelTexCache().size;return a*a*b*c};b.getTileToCanvasPixelRatio=function(a,b){b=this.$4.height/b;a=90/Math.pow(2,a);a=this.$3.getTileContentSize()/a;return a/b};return a}();e.exports=a}),null);
__d("TiledSphericalRendererUtils",["CubemapImageTileInfo","SphericalMediaConstants","gl-matrix"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("SphericalMediaConstants").TILED_CUBE_FACES,h=b("gl-matrix").glMatrix,i=b("gl-matrix").mat3,j=b("gl-matrix").mat4,k=b("gl-matrix").vec3;a={fetchImage:function(a,b,c,d,e,f){a=a;while(!b.has(a.getKey())&&!c.has(a.getKey()))d.loadTileImage(a,e,f),a=a.getInfoForOffsetLevel(1)},getLinePlaneIntersection:function(a,b,c,d){d=-b/(d-b);b=k.create();k.subtract(b,c,a);k.scale(b,b,d);k.add(b,b,a);return b},clipPolygon3D:function(a,b){__p&&__p();var c=b[b.length-1];for(var d=0;d<b.length;d++){var e=b[d],f=[],g=k.create();k.cross(g,c,e);var h=a[a.length-1],i=k.dot(g,h),j=i>=0;for(var l=0;l<a.length;l++){var m=a[l],n=k.dot(g,m),o=n>=0;if(o!==j){var p=this.getLinePlaneIntersection(h,i,m,n);!k.exactEquals(h,p)&&!k.exactEquals(m,p)&&f.push(p)}o&&f.push(m);h=m;i=n;j=o}a=f;if(a.length===0)break;c=e}return a},initFaceRotationMatrices:function(a){__p&&__p();var b=[],c=[],d=[],e=j.create();j.identity(e);j.rotateY(e,e,h.toRadian(-90));b[g.PLUS_X]=e;c[g.MINUS_X]=e;e=j.create();j.identity(e);j.rotateY(e,e,h.toRadian(90));b[g.MINUS_X]=e;c[g.PLUS_X]=e;e=j.create();j.identity(e);j.rotateZ(e,e,h.toRadian(-180));j.rotateX(e,e,h.toRadian(-90));b[g.PLUS_Y]=e;e=j.create();j.identity(e);j.rotateX(e,e,h.toRadian(90));c[g.PLUS_Y]=e;e=j.create();j.identity(e);j.rotateZ(e,e,h.toRadian(180));j.rotateX(e,e,h.toRadian(90));b[g.MINUS_Y]=e;e=j.create();j.identity(e);j.rotateX(e,e,h.toRadian(-90));c[g.MINUS_Y]=e;e=j.create();j.identity(e);j.rotateY(e,e,h.toRadian(180));b[g.PLUS_Z]=e;c[g.MINUS_Z]=e;e=j.create();j.identity(e);b[g.MINUS_Z]=e;c[g.PLUS_Z]=e;for(var e=0;e<6;e++)b[e]=i.fromMat4(i.create(),b[e]),c[e]=i.fromMat4(i.create(),c[e]);e=[k.fromValues(-a,a,-a),k.fromValues(a,a,-a),k.fromValues(a,-a,-a),k.fromValues(-a,-a,-a)];for(var a=0;a<6;a++){var f=b[a],l=[];for(var m=0;m<e.length;m++){var n=k.create();k.transformMat3(n,e[m],f);l.push(n)}d[a]=l}return{faceRotationMatrices:b,faceTransformMatrices:c,faceVertexLists:d}},rotateVec3s:function(a,b){for(var c=0;c<b.length;c++)k.transformMat3(b[c],b[c],a)}};e.exports=a}),null);
__d("TiledCubeMapStereoGraphRenderer",["BaseRotatableWebGLRenderer","CubemapImageTileInfo","StereographicProjectionUtils","TiledSphericalRendererStats","TiledSphericalRendererTextureCache","TiledSphericalRendererUtils","TileRendererState","gl-matrix","performanceNow","throttle"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("gl-matrix").glMatrix;b("gl-matrix").mat3;var h=b("gl-matrix").mat4,i=b("gl-matrix").vec3,j=120;a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c,d,e,f){__p&&__p();var g;g=a.call(this,c)||this;g.$TiledCubeMapStereoGraphRenderer41=function(a,b){var c=a.getInfo().getKey();g.$TiledCubeMapStereoGraphRenderer5.set(c,a);b!==g.$TiledCubeMapStereoGraphRenderer8&&(g.$TiledCubeMapStereoGraphRenderer8=g.$TiledCubeMapStereoGraphRenderer6,setTimeout(g.$TiledCubeMapStereoGraphRenderer42,0))};g.$TiledCubeMapStereoGraphRenderer37=b("throttle")(function(){return g.__renderInternal()},100);g.$TiledCubeMapStereoGraphRenderer42=b("throttle")(function(){var a=g.$TiledCubeMapStereoGraphRenderer5;g.$TiledCubeMapStereoGraphRenderer5=new Map();g.$TiledCubeMapStereoGraphRenderer32();g.$TiledCubeMapStereoGraphRenderer11.forEach(function(b){return setTimeout(function(){return g.$TiledCubeMapStereoGraphRenderer43(b,a)},0)})},100);g.$TiledCubeMapStereoGraphRenderer1=d;g.$TiledCubeMapStereoGraphRenderer2=e;g.$TiledCubeMapStereoGraphRenderer3=1;g.$TiledCubeMapStereoGraphRenderer4=0;g.$TiledCubeMapStereoGraphRenderer6=-1;g.$TiledCubeMapStereoGraphRenderer7=-1;g.$TiledCubeMapStereoGraphRenderer8=0;g.$TiledCubeMapStereoGraphRenderer5=new Map();g.$TiledCubeMapStereoGraphRenderer10=[];g.$TiledCubeMapStereoGraphRenderer11=[];g.$TiledCubeMapStereoGraphRenderer12=new Map();g.$TiledCubeMapStereoGraphRenderer13=[];g.$TiledCubeMapStereoGraphRenderer14=new Map();g.$TiledCubeMapStereoGraphRenderer15=null;g.$TiledCubeMapStereoGraphRenderer27=0;g.__shouldEnableBlend=!0;g.__useVfovAsIs=!0;g.$TiledCubeMapStereoGraphRenderer28();g.__setup();g.$TiledCubeMapStereoGraphRenderer17=new(b("TiledSphericalRendererTextureCache"))(j,g.$TiledCubeMapStereoGraphRenderer1,g.$TiledCubeMapStereoGraphRenderer14,g.__gl,g.__copyTextureToGLBuffer.bind(babelHelpers.assertThisInitialized(g)));g.$TiledCubeMapStereoGraphRenderer16=new(b("TiledSphericalRendererStats"))(e,g.$TiledCubeMapStereoGraphRenderer17,g.$TiledCubeMapStereoGraphRenderer1,g.__canvas);return g}var d=c.prototype;d.updateDebugTileGradation=function(a){this.$TiledCubeMapStereoGraphRenderer27=Math.min(Math.max(a,0),1)};d.__clearCache=function(){this.$TiledCubeMapStereoGraphRenderer29(),this.$TiledCubeMapStereoGraphRenderer13=[],this.$TiledCubeMapStereoGraphRenderer17.clearCache(),this.$TiledCubeMapStereoGraphRenderer14.clear()};d.__getShaderPerspectiveMatrixUniformName=function(){return"uPMatrix"};d.__getShaderRotationMatrixUniformName=function(){return"uRotationMatrix"};d.__shaderProgramReady=function(){__p&&__p();this.$TiledCubeMapStereoGraphRenderer19=this.__gl.getAttribLocation(this.__shaderProgram,"aVertexPosition");this.__gl.enableVertexAttribArray(this.$TiledCubeMapStereoGraphRenderer19);var a=this.__gl.getUniformLocation(this.__shaderProgram,"uContentSampler"),b=0;this.$TiledCubeMapStereoGraphRenderer20=this.__gl.TEXTURE0;this.__gl.uniform1i(a,b);this.$TiledCubeMapStereoGraphRenderer23=this.__gl.getUniformLocation(this.__shaderProgram,"tilesPerEdge");this.$TiledCubeMapStereoGraphRenderer24=this.__gl.getUniformLocation(this.__shaderProgram,"row");this.$TiledCubeMapStereoGraphRenderer25=this.__gl.getUniformLocation(this.__shaderProgram,"col");this.$TiledCubeMapStereoGraphRenderer26=this.__gl.getUniformLocation(this.__shaderProgram,"debugTileGradation");this.$TiledCubeMapStereoGraphRenderer30()};d.__getVertexShaderScript=function(){return"\n      attribute vec3 aVertexPosition;\n\n      uniform mat4 uRotationMatrix;\n      uniform mat3 uFaceTransformMatrix;\n      uniform mat4 uPMatrix;\n\n      varying highp vec3 vCurrentRay;\n      varying highp mat3 vFaceRotationMatrix;\n\n      void main(void) {\n        gl_Position = uPMatrix * vec4(aVertexPosition, 1.0);\n        vCurrentRay = aVertexPosition;\n        vFaceRotationMatrix = uFaceTransformMatrix * mat3(uRotationMatrix);\n      }\n    "};d.__getFragmentShaderScript=function(){return"\n      precision highp float;\n      const highp float DEFAULT_ZOOM = 1.1;\n\n      varying highp mat3 vFaceRotationMatrix;\n      varying highp vec3 vCurrentRay;\n\n      uniform sampler2D uContentSampler;\n\n      uniform float tilesPerEdge;\n      uniform float row;\n      uniform float col;\n      uniform float debugTileGradation;\n\n      void main(void) {\n        vec2 p = (vCurrentRay.xy * 0.5) / DEFAULT_ZOOM;\n        float pp = p.x*p.x + p.y*p.y;\n        vec3 cartesian = vec3(2.0*p, pp - 1.0) / (pp + 1.0);\n        vec3 faceVertex = vFaceRotationMatrix * cartesian;\n\n        // First compute global tex coords then convert them to local tile coords.\n        vec2 globalTexCoords = faceVertex.xy * vec2(1.0, -1.0) / faceVertex.z * 0.5 + 0.5;\n        vec2 texCoords = (globalTexCoords * tilesPerEdge - vec2(col, row)) * (510.0 / 512.0) + (1.0 / 512.0);\n\n        // If tile is behind us (+z) or outside of the tile, render transparent.\n        if (faceVertex.z > 0.0 ||\n          texCoords.s > 1.0 || texCoords.s < 0.0 || texCoords.t > 1.0 || texCoords.t < 0.0) {\n          gl_FragColor = vec4(0, 0, 0, 0);\n        } else {\n          gl_FragColor = mix(texture2D(uContentSampler, texCoords), vec4(texCoords, 1, 1), debugTileGradation);\n        }\n      }\n    "};d.__getMaxGPUMemoryUsedBytes=function(){return this.$TiledCubeMapStereoGraphRenderer16.getMaxGPUMemoryUsedBytes()};d.__getPrevFrameTextureScreenRatio=function(){return this.$TiledCubeMapStereoGraphRenderer4};d.__createTexture=function(){this.$TiledCubeMapStereoGraphRenderer17.createTexture()};d.__renderInternal=function(){__p&&__p();var a=this;if(this.__destroyed||!this.$TiledCubeMapStereoGraphRenderer1.isBaseLevelReady()&&!this.$TiledCubeMapStereoGraphRenderer1.isViewportReady())return;this.__createTexture();h.identity(this.__rotationMatrix);h.rotateX(this.__rotationMatrix,this.__rotationMatrix,g.toRadian(180));h.rotateY(this.__rotationMatrix,this.__rotationMatrix,g.toRadian(-this.__view.yaw));h.rotateX(this.__rotationMatrix,this.__rotationMatrix,g.toRadian(this.__view.pitch));this.__gl.uniformMatrix4fv(this.__shaderRotMatrixUniform,!1,this.__rotationMatrix);this.$TiledCubeMapStereoGraphRenderer31();var c=this.$TiledCubeMapStereoGraphRenderer9,d=c[1][0];c=c[1][1];var e=2;this.__perspectiveMatrix=h.create();h.ortho(this.__perspectiveMatrix,-d,d,-c,c,-e,e);this.__gl.uniformMatrix4fv(this.__shaderPMatrixUniform,!1,this.__perspectiveMatrix);this.$TiledCubeMapStereoGraphRenderer7=this.$TiledCubeMapStereoGraphRenderer6!=-1?this.$TiledCubeMapStereoGraphRenderer6:b("performanceNow")();this.$TiledCubeMapStereoGraphRenderer6=b("performanceNow")();this.$TiledCubeMapStereoGraphRenderer32();this.$TiledCubeMapStereoGraphRenderer11=this.$TiledCubeMapStereoGraphRenderer11.map(function(b){return a.$TiledCubeMapStereoGraphRenderer33(b)});this.$TiledCubeMapStereoGraphRenderer34();this.$TiledCubeMapStereoGraphRenderer11.sort(function(a,b){var c=function(a){return a.level*1e3+a.face*100+a.col*10+a.row};return c(a)-c(b)});var f=0;d=!1;this.$TiledCubeMapStereoGraphRenderer11.forEach(function(b){var c=a.$TiledCubeMapStereoGraphRenderer14.get(b.getKey());c=c?c.blendingProgress:0;c<1&&(d=!0);f+=a.$TiledCubeMapStereoGraphRenderer35(b)});c=this.$TiledCubeMapStereoGraphRenderer11.length>0?this.$TiledCubeMapStereoGraphRenderer11.length:1;f/=c;this.$TiledCubeMapStereoGraphRenderer4=f;d?this.$TiledCubeMapStereoGraphRenderer36():this.$TiledCubeMapStereoGraphRenderer29()};d.$TiledCubeMapStereoGraphRenderer36=function(){var a=this;this.$TiledCubeMapStereoGraphRenderer15===null&&(this.$TiledCubeMapStereoGraphRenderer15=setInterval(function(){return a.$TiledCubeMapStereoGraphRenderer37()},200))};d.$TiledCubeMapStereoGraphRenderer29=function(){this.$TiledCubeMapStereoGraphRenderer15!==null&&(clearInterval(this.$TiledCubeMapStereoGraphRenderer15),this.$TiledCubeMapStereoGraphRenderer15=null)};d.$TiledCubeMapStereoGraphRenderer30=function(){var a=this.__gl.getUniformLocation(this.__shaderProgram,"uHorizontalAngleBounds"),b=this.__gl.getUniformLocation(this.__shaderProgram,"uVerticleAngleBounds"),c=this.$TiledCubeMapStereoGraphRenderer2.partialLeftDegrees,d=this.$TiledCubeMapStereoGraphRenderer2.partialRightDegrees,e=this.$TiledCubeMapStereoGraphRenderer2.partialTopDegrees,f=this.$TiledCubeMapStereoGraphRenderer2.partialBottomDegrees;c=c!==void 0&&c!==null?-1*c:-181;d=d!==void 0&&d!==null?d:181;f=f!==void 0&&f!==null?-1*f:-91;e=e!==void 0&&e!==null?e:91;c=new Float32Array([g.toRadian(c),g.toRadian(d)]);d=new Float32Array([g.toRadian(f),g.toRadian(e)]);this.__gl.uniform2fv(a,c);this.__gl.uniform2fv(b,d)};d.$TiledCubeMapStereoGraphRenderer38=function(a,c,d,e){a=new(b("CubemapImageTileInfo"))(a,c,d,e);this.$TiledCubeMapStereoGraphRenderer11.push(a);this.$TiledCubeMapStereoGraphRenderer12.set(a.getKey(),!0)};d.$TiledCubeMapStereoGraphRenderer39=function(a,c,d,e){__p&&__p();c===void 0&&(c=0);d===void 0&&(d=0);e===void 0&&(e=0);var f={requireParentTile:!1};if(!this.$TiledCubeMapStereoGraphRenderer9){this.$TiledCubeMapStereoGraphRenderer38(c,a,d,e);return f}var g=b("StereographicProjectionUtils").cubeMapTileIsInView(c,a,d,e,this.$TiledCubeMapStereoGraphRenderer18,this.__rotationMatrix,this.$TiledCubeMapStereoGraphRenderer9,this.__canvas);if(g.inlier){c===0&&this.$TiledCubeMapStereoGraphRenderer38(c,a,d,e);var h=.5;if(2*h*g.longestSide<512){c>0&&(f.requireParentTile=!0);return f}else if(h*g.longestSide<512){this.$TiledCubeMapStereoGraphRenderer38(c,a,d,e);return f}if(c===this.$TiledCubeMapStereoGraphRenderer1.getMaxTileLevel()){this.$TiledCubeMapStereoGraphRenderer38(c,a,d,e);return f}h=!1;for(var g=0;g<=1;g++)for(var i=0;i<=1;i++){var j=this.$TiledCubeMapStereoGraphRenderer39(a,c+1,2*d+g,2*e+i);j.requireParentTile&&(h=!0)}h&&this.$TiledCubeMapStereoGraphRenderer38(c,a,d,e)}return f};d.$TiledCubeMapStereoGraphRenderer32=function(){__p&&__p();this.$TiledCubeMapStereoGraphRenderer11=[];this.$TiledCubeMapStereoGraphRenderer12.clear();var a=0,b=this.$TiledCubeMapStereoGraphRenderer1.getMaxTileLevel();while(this.$TiledCubeMapStereoGraphRenderer11.length===0&&a<=b){for(var c=0;c<6;c++)for(var d=0;d<=a;d++)for(var e=0;e<=a;e++)this.$TiledCubeMapStereoGraphRenderer39(c,a,d,e);a+=1}};d.$TiledCubeMapStereoGraphRenderer34=function(){__p&&__p();var a=this;this.$TiledCubeMapStereoGraphRenderer13.forEach(function(b){b=b.getKey();if(!a.$TiledCubeMapStereoGraphRenderer12.has(b)){b=a.$TiledCubeMapStereoGraphRenderer14.get(b);b&&b.exitView()}});this.$TiledCubeMapStereoGraphRenderer13=[];this.$TiledCubeMapStereoGraphRenderer11.forEach(function(c){__p&&__p();a.$TiledCubeMapStereoGraphRenderer13.push(c);var d=c.getKey(),e=a.$TiledCubeMapStereoGraphRenderer14.get(d),f=a.$TiledCubeMapStereoGraphRenderer40(c);if(!e)e=new(b("TileRendererState"))(c,f),a.$TiledCubeMapStereoGraphRenderer14.set(d,e);else if(!e.isInView)e.enterView(f);else{d=a.$TiledCubeMapStereoGraphRenderer6-a.$TiledCubeMapStereoGraphRenderer7;e.shouldFetch(d)&&b("TiledSphericalRendererUtils").fetchImage(c,a.$TiledCubeMapStereoGraphRenderer17.getBaseLevelTexCache(),a.$TiledCubeMapStereoGraphRenderer17.getTextureCache(),a.$TiledCubeMapStereoGraphRenderer1,a.$TiledCubeMapStereoGraphRenderer41,a.$TiledCubeMapStereoGraphRenderer6);e.update(d,f)}})};d.$TiledCubeMapStereoGraphRenderer31=function(){var a=g.toRadian(this.__verticalFieldOfView),b=g.toRadian(this.__horizontalFieldOfView);b=Math.tan(b/2);a=Math.tan(a/2);this.$TiledCubeMapStereoGraphRenderer9=[i.fromValues(-b,a,-1),i.fromValues(b,a,-1),i.fromValues(b,-a,-1),i.fromValues(-b,-a,-1)]};d.$TiledCubeMapStereoGraphRenderer43=function(a,b){a=a.getKey();b=b.get(a);b&&(this.$TiledCubeMapStereoGraphRenderer17.cacheTexture(b),this.$TiledCubeMapStereoGraphRenderer37())};d.$TiledCubeMapStereoGraphRenderer35=function(a){__p&&__p();var b=this,c=a.getKey();c=this.$TiledCubeMapStereoGraphRenderer14.get(c);if(!c)return 0;c=this.__gl.getUniformLocation(this.__shaderProgram,"uFaceTransformMatrix");this.__gl.uniformMatrix3fv(c,!1,this.$TiledCubeMapStereoGraphRenderer18[a.face]);c=this.$TiledCubeMapStereoGraphRenderer9;c=[c[1][0],c[1][1],-1,c[0][0],c[0][1],-1,c[2][0],c[2][1],-1,c[3][0],c[3][1],-1];this.$TiledCubeMapStereoGraphRenderer44(this.$TiledCubeMapStereoGraphRenderer19,c,3);this.__gl.activeTexture(this.$TiledCubeMapStereoGraphRenderer20);this.$TiledCubeMapStereoGraphRenderer45(a);this.__gl.uniform1f(this.$TiledCubeMapStereoGraphRenderer23,Math.pow(2,a.level));this.__gl.uniform1f(this.$TiledCubeMapStereoGraphRenderer24,a.row);this.__gl.uniform1f(this.$TiledCubeMapStereoGraphRenderer25,a.col);this.__gl.uniform1f(this.$TiledCubeMapStereoGraphRenderer26,this.$TiledCubeMapStereoGraphRenderer27);this.__gl.drawArrays(this.__gl.TRIANGLE_STRIP,0,c.length/3);this.__gl.bindTexture(this.__gl.TEXTURE_2D,null);this.$TiledCubeMapStereoGraphRenderer10.forEach(function(a){b.__gl.bindBuffer(b.__gl.ARRAY_BUFFER,a),b.__gl.bufferData(b.__gl.ARRAY_BUFFER,1,b.__gl.STATIC_DRAW),b.__gl.deleteBuffer(a)});this.$TiledCubeMapStereoGraphRenderer10=[];return this.$TiledCubeMapStereoGraphRenderer16.getTileToCanvasPixelRatio(a.level,this.__verticalFieldOfView)};d.$TiledCubeMapStereoGraphRenderer44=function(a,b,c){var d=this.__gl.createBuffer();this.$TiledCubeMapStereoGraphRenderer10.push(d);this.__gl.bindBuffer(this.__gl.ARRAY_BUFFER,d);this.__gl.bufferData(this.__gl.ARRAY_BUFFER,new Float32Array(b),this.__gl.STATIC_DRAW);this.__gl.vertexAttribPointer(a,c,this.__gl.FLOAT,!1,0,0)};d.$TiledCubeMapStereoGraphRenderer45=function(a){var b;a.level===0?b={lastUsedTime:0,texture:this.$TiledCubeMapStereoGraphRenderer17.getBaseLevelTexCache().get(a.getKey())}:b=this.$TiledCubeMapStereoGraphRenderer17.getTextureCache().get(a.getKey());if(b){this.__gl.bindTexture(this.__gl.TEXTURE_2D,b.texture);b.lastUsedTime=this.$TiledCubeMapStereoGraphRenderer6;return a}throw new Error("No possible tile for requested params: "+a.getKey())};d.$TiledCubeMapStereoGraphRenderer33=function(a){__p&&__p();var b=0;while(b<=a.level){var c=a.getInfoForOffsetLevel(b),d=c.getKey(),e;c.level===0?e={lastUsedTime:0,texture:this.$TiledCubeMapStereoGraphRenderer17.getBaseLevelTexCache().get(d)}:e=this.$TiledCubeMapStereoGraphRenderer17.getTextureCache().get(d);if(e){e.lastUsedTime=this.$TiledCubeMapStereoGraphRenderer6;return c}b===0&&this.$TiledCubeMapStereoGraphRenderer1.loadTileImage(c,this.$TiledCubeMapStereoGraphRenderer41,this.$TiledCubeMapStereoGraphRenderer6);b++}throw new Error("No possible tile for requested params: "+a.getKey())};d.$TiledCubeMapStereoGraphRenderer40=function(a){var b=0;while(b<=a.level){var c=a.getInfoForOffsetLevel(b),d=c.getKey();if(this.$TiledCubeMapStereoGraphRenderer17.getBaseLevelTexCache().has(d)||this.$TiledCubeMapStereoGraphRenderer17.getTextureCache().has(d))return c;b++}throw new Error("No possible tile for requested params: "+a.getKey())};d.$TiledCubeMapStereoGraphRenderer28=function(){var a=b("TiledSphericalRendererUtils").initFaceRotationMatrices(this.$TiledCubeMapStereoGraphRenderer3);a=a.faceTransformMatrices;this.$TiledCubeMapStereoGraphRenderer18=a};return c}(b("BaseRotatableWebGLRenderer"));a.__subClassMethods={__getFragmentShaderScript:!0,__getVertexShaderScript:!0,__getShaderPerspectiveMatrixUniformName:!0,__getShaderRotationMatrixUniformName:!0,__renderInternal:!0,__shaderProgramReady:!0,__getMaxGPUMemoryUsedBytes:!0,__getPrevFrameTextureScreenRatio:!0,__createTexture:!0,__clearCache:!0};e.exports=a}),null);
__d("TiledSphericalRenderer",["BaseRotatableWebGLRenderer","CubemapImageTileInfo","TiledSphericalRendererStats","TiledSphericalRendererTextureCache","TiledSphericalRendererUtils","TileRendererState","debounceCore","gl-matrix","performanceNow","throttle"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("gl-matrix").glMatrix,h=b("gl-matrix").mat3,i=b("gl-matrix").vec3,j=44;a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c,d,e,f){__p&&__p();var g;g=a.call(this,c)||this;g.$TiledSphericalRenderer37=function(a,b){var c=a.getInfo().getKey();g.$TiledSphericalRenderer5.set(c,a);b!==g.$TiledSphericalRenderer8&&(g.$TiledSphericalRenderer8=g.$TiledSphericalRenderer6,setTimeout(g.$TiledSphericalRenderer38,0))};g.$TiledSphericalRenderer39=b("debounceCore")(function(){return g.__renderInternal()},30);g.$TiledSphericalRenderer33=b("throttle")(function(){return g.__renderInternal()},100);g.$TiledSphericalRenderer41=b("debounceCore")(function(){var a=g.$TiledSphericalRenderer5;g.$TiledSphericalRenderer5=new Map();g.$TiledSphericalRenderer29();g.$TiledSphericalRenderer10.forEach(function(b){return setTimeout(function(){return g.$TiledSphericalRenderer40(b,a)},0)})},100);g.$TiledSphericalRenderer38=b("throttle")(function(){var a=g.$TiledSphericalRenderer5;g.$TiledSphericalRenderer5=new Map();g.$TiledSphericalRenderer29();g.$TiledSphericalRenderer10.forEach(function(b){return setTimeout(function(){return g.$TiledSphericalRenderer40(b,a)},0)})},100);g.$TiledSphericalRenderer1=d;g.$TiledSphericalRenderer2=e;g.$TiledSphericalRenderer3=1;g.$TiledSphericalRenderer4=0;g.$TiledSphericalRenderer6=-1;g.$TiledSphericalRenderer7=-1;g.$TiledSphericalRenderer8=0;g.$TiledSphericalRenderer5=new Map();g.$TiledSphericalRenderer9=[];g.$TiledSphericalRenderer10=[];g.$TiledSphericalRenderer11=new Map();g.$TiledSphericalRenderer12=[];g.$TiledSphericalRenderer13=new Map();g.$TiledSphericalRenderer14=null;g.$TiledSphericalRenderer26();g.__setup();g.$TiledSphericalRenderer16=new(b("TiledSphericalRendererTextureCache"))(j,g.$TiledSphericalRenderer1,g.$TiledSphericalRenderer13,g.__gl,g.__copyTextureToGLBuffer.bind(babelHelpers.assertThisInitialized(g)));g.$TiledSphericalRenderer15=new(b("TiledSphericalRendererStats"))(e,g.$TiledSphericalRenderer16,g.$TiledSphericalRenderer1,g.__canvas);return g}var d=c.prototype;d.__clearCache=function(){this.$TiledSphericalRenderer27(),this.$TiledSphericalRenderer12=[],this.$TiledSphericalRenderer16.clearCache(),this.$TiledSphericalRenderer13.clear()};d.__getShaderPerspectiveMatrixUniformName=function(){return"uPMatrix"};d.__getShaderRotationMatrixUniformName=function(){return"uRotationMatrix"};d.__shaderProgramReady=function(){__p&&__p();this.$TiledSphericalRenderer19=this.__gl.getAttribLocation(this.__shaderProgram,"aVertexPosition");this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer19);this.$TiledSphericalRenderer20=this.__gl.getAttribLocation(this.__shaderProgram,"aTextureCoord");this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer20);this.$TiledSphericalRenderer21=this.__gl.getAttribLocation(this.__shaderProgram,"aBGTextureCoord");this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer21);var a=this.__gl.getUniformLocation(this.__shaderProgram,"uContentSampler"),b=this.__gl.getUniformLocation(this.__shaderProgram,"uBackgroundSampler"),c=0;this.$TiledSphericalRenderer23=this.__gl.TEXTURE0;var d=1;this.$TiledSphericalRenderer24=this.__gl.TEXTURE1;this.__gl.uniform1i(a,c);this.__gl.uniform1i(b,d);this.$TiledSphericalRenderer22=this.__gl.getAttribLocation(this.__shaderProgram,"aPrevLevelTextureCoord");this.__gl.enableVertexAttribArray(this.$TiledSphericalRenderer22);a=this.__gl.getUniformLocation(this.__shaderProgram,"uPrevLevelSampler");c=2;this.$TiledSphericalRenderer25=this.__gl.TEXTURE2;this.__gl.uniform1i(a,c);this.$TiledSphericalRenderer28()};d.__getVertexShaderScript=function(){return"\n      attribute vec3 aVertexPosition;\n      attribute vec2 aTextureCoord;\n      attribute vec2 aBGTextureCoord;\n      attribute vec2 aPrevLevelTextureCoord;\n\n      uniform mat4 uRotationMatrix;\n      uniform mat4 uPMatrix;\n\n      varying highp vec3 vCurrentRay;\n      varying highp vec2 vTextureCoord;\n      varying highp vec2 vBGTextureCoord;\n      varying highp vec2 vPrevLevelTextureCoord;\n\n      void main(void) {\n        gl_Position = uPMatrix * uRotationMatrix * vec4(aVertexPosition, 1.0);\n        vCurrentRay = aVertexPosition;\n        vTextureCoord = aTextureCoord;\n        vBGTextureCoord = aBGTextureCoord;\n        vPrevLevelTextureCoord = aPrevLevelTextureCoord;\n      }\n    "};d.__getFragmentShaderScript=function(){return"\n      #define PI 3.1415926538\n\n      precision highp float;\n      // 1 degree blend zone\n      const highp float blendDist = PI / 180.0;\n\n      varying highp vec2 vTextureCoord;\n      varying highp vec2 vBGTextureCoord;\n      varying highp vec2 vPrevLevelTextureCoord;\n\n      varying highp vec3 vCurrentRay;\n      uniform highp vec2 uHorizontalAngleBounds;\n      uniform highp vec2 uVerticleAngleBounds;\n\n      uniform sampler2D uContentSampler;\n      uniform sampler2D uBackgroundSampler;\n      uniform sampler2D uPrevLevelSampler;\n\n      uniform float progress;\n\n      void main(void) {\n        highp float x = vCurrentRay[0];\n        highp float y = vCurrentRay[1];\n        highp float z = vCurrentRay[2];\n        highp float hAngle = atan(x, -1.0 * z);\n        highp float vAngle = atan(y * inversesqrt(x*x + z*z));\n\n        // if current ray is inside the content bounds, use the content sampler\n        // to set the fragment color. if it is not within the bounds, use the\n        // background sampler to set the color.*\n\n        highp float hdist = 0.0;\n        highp float vdist = 0.0;\n        if (hAngle < uHorizontalAngleBounds[0]) {\n          hdist = uHorizontalAngleBounds[0] - hAngle;\n        } else if (hAngle > uHorizontalAngleBounds[1]) {\n          hdist = hAngle - uHorizontalAngleBounds[1];\n        }\n        if (vAngle < uVerticleAngleBounds[0]) {\n          vdist = uVerticleAngleBounds[0] - vAngle;\n        } else if (vAngle > uVerticleAngleBounds[1]) {\n          vdist = vAngle - uVerticleAngleBounds[1];\n        }\n        highp float maxDist = max(hdist, vdist);\n        highp vec4 bgColor = texture2D(\n          uBackgroundSampler,\n          vec2(vBGTextureCoord.s, vBGTextureCoord.t)\n        );\n        highp vec4 contentColor = texture2D(\n          uContentSampler,\n          vec2(vTextureCoord.s, vTextureCoord.t)\n        );\n        if (maxDist > 0.0) {\n          // Inside this condition, our fragment is outside the content bounds.\n          // The distance outside the bound is represented by maxDist. It could\n          // be the horizontal or vertical distance from a bound, whichever is\n          // larger. We will use this distance to blend the content with the\n          // background, if the distance is smaller than blendDist. If it is\n          // larger than blendDist, we will use purely the background tex to\n          // set the color. If dist is within the blendDist, then we will set\n          // the color to the linearly weighted avg across the blend zone of the\n          // background and content colors.\n          //\n          if (maxDist < blendDist) {\n            highp float contentWeight = (blendDist - maxDist) / blendDist;\n            gl_FragColor = mix(bgColor, contentColor, contentWeight);\n          } else {\n            // We are outside the blend zone. Just use background.\n            gl_FragColor = bgColor;\n          }\n        } else {\n          // In this condition, we are inside the content\n          highp vec4 prevLevelColor = texture2D(\n            uPrevLevelSampler,\n            vec2(vPrevLevelTextureCoord.s, vPrevLevelTextureCoord.t)\n          );\n          gl_FragColor = mix(prevLevelColor, contentColor, progress);\n        }\n      }\n      "};d.__getMaxGPUMemoryUsedBytes=function(){return this.$TiledSphericalRenderer15.getMaxGPUMemoryUsedBytes()};d.__getPrevFrameTextureScreenRatio=function(){return this.$TiledSphericalRenderer4};d.__createTexture=function(){this.$TiledSphericalRenderer16.createTexture()};d.__renderInternal=function(){__p&&__p();var a=this;if(this.__destroyed||!this.$TiledSphericalRenderer1.isBaseLevelReady()&&!this.$TiledSphericalRenderer1.isViewportReady())return;this.__createTexture();this.$TiledSphericalRenderer7=this.$TiledSphericalRenderer6!=-1?this.$TiledSphericalRenderer6:b("performanceNow")();this.$TiledSphericalRenderer6=b("performanceNow")();this.$TiledSphericalRenderer29();this.$TiledSphericalRenderer30();var c=0,d=!1;this.$TiledSphericalRenderer10.forEach(function(b){var e=a.$TiledSphericalRenderer13.get(b.getKey());e=e?e.blendingProgress:0;e<1&&(d=!0);c+=a.$TiledSphericalRenderer31(b)});var e=this.$TiledSphericalRenderer10.length>0?this.$TiledSphericalRenderer10.length:1;c/=e;this.$TiledSphericalRenderer4=c;d?this.$TiledSphericalRenderer32():this.$TiledSphericalRenderer27()};d.$TiledSphericalRenderer32=function(){var a=this;this.$TiledSphericalRenderer14===null&&(this.$TiledSphericalRenderer14=setInterval(function(){return a.$TiledSphericalRenderer33()},200))};d.$TiledSphericalRenderer27=function(){this.$TiledSphericalRenderer14!==null&&(clearInterval(this.$TiledSphericalRenderer14),this.$TiledSphericalRenderer14=null)};d.$TiledSphericalRenderer28=function(){var a=this.__gl.getUniformLocation(this.__shaderProgram,"uHorizontalAngleBounds"),b=this.__gl.getUniformLocation(this.__shaderProgram,"uVerticleAngleBounds"),c=this.$TiledSphericalRenderer2.partialLeftDegrees,d=this.$TiledSphericalRenderer2.partialRightDegrees,e=this.$TiledSphericalRenderer2.partialTopDegrees,f=this.$TiledSphericalRenderer2.partialBottomDegrees;c=c!==void 0&&c!==null?-1*c:-181;d=d!==void 0&&d!==null?d:181;f=f!==void 0&&f!==null?-1*f:-91;e=e!==void 0&&e!==null?e:91;c=new Float32Array([g.toRadian(c),g.toRadian(d)]);d=new Float32Array([g.toRadian(f),g.toRadian(e)]);this.__gl.uniform2fv(a,c);this.__gl.uniform2fv(b,d)};d.$TiledSphericalRenderer29=function(){__p&&__p();this.$TiledSphericalRenderer10=[];this.$TiledSphericalRenderer11.clear();var a=this.$TiledSphericalRenderer34(),c=this.$TiledSphericalRenderer35(),d=Math.pow(2,a),e=2*this.$TiledSphericalRenderer3/d;for(var f=0;f<c.length;f++){var g=c[f];if(g){var h=Math.floor(g.minX/e),i=Math.min(Math.floor(g.maxX/e),d-1),j=Math.floor(g.minY/e);g=Math.min(Math.floor(g.maxY/e),d-1);for(var h=h;h<=i;h++)for(var k=j;k<=g;k++){var l=new(b("CubemapImageTileInfo"))(a,f,h,k);this.$TiledSphericalRenderer10.push(l);this.$TiledSphericalRenderer11.set(l.getKey(),!0)}}}};d.$TiledSphericalRenderer30=function(){__p&&__p();var a=this;this.$TiledSphericalRenderer12.forEach(function(b){b=b.getKey();if(!a.$TiledSphericalRenderer11.has(b)){b=a.$TiledSphericalRenderer13.get(b);b&&b.exitView()}});this.$TiledSphericalRenderer12=[];this.$TiledSphericalRenderer10.forEach(function(c){__p&&__p();a.$TiledSphericalRenderer12.push(c);var d=c.getKey(),e=a.$TiledSphericalRenderer13.get(d),f=a.$TiledSphericalRenderer36(c);if(!e)e=new(b("TileRendererState"))(c,f),a.$TiledSphericalRenderer13.set(d,e);else if(!e.isInView)e.enterView(f);else{d=a.$TiledSphericalRenderer6-a.$TiledSphericalRenderer7;e.shouldFetch(d)&&b("TiledSphericalRendererUtils").fetchImage(c,a.$TiledSphericalRenderer16.getBaseLevelTexCache(),a.$TiledSphericalRenderer16.getTextureCache(),a.$TiledSphericalRenderer1,a.$TiledSphericalRenderer37,a.$TiledSphericalRenderer6);e.update(d,f)}})};d.$TiledSphericalRenderer34=function(){var a=this.__verticalFieldOfView,b=this.__horizontalFieldOfView,c=this.__canvas.height/a,d=3400/2,e=0,f=this.$TiledSphericalRenderer1.getTileContentSize()/90,g=1.4;while(f*g<c&&f*a<d&&f*b<d)e++,f*=2;return Math.min(e,this.$TiledSphericalRenderer1.getMaxTileLevel())};d.$TiledSphericalRenderer35=function(){__p&&__p();var a=g.toRadian(this.__verticalFieldOfView),c=g.toRadian(this.__horizontalFieldOfView),d=1;c=Math.tan(c/2)*d;a=Math.tan(a/2)*d;c=[i.fromValues(-c,a,-d),i.fromValues(c,a,-d),i.fromValues(c,-a,-d),i.fromValues(-c,-a,-d)];a=h.create();h.transpose(a,h.fromMat4(h.create(),this.__rotationMatrix));b("TiledSphericalRendererUtils").rotateVec3s(a,c);d=[];for(var a=0;a<6;a++){var e=this.$TiledSphericalRenderer18[a],f=[];for(var j=0;j<e.length;j++)f.push(i.clone(e[j]));e=b("TiledSphericalRendererUtils").clipPolygon3D(f,c);if(e.length>0){j=h.create();h.transpose(j,this.$TiledSphericalRenderer17[a]);b("TiledSphericalRendererUtils").rotateVec3s(j,e);f=e[0];j=f[0];var k=f[0],l=f[1],m=f[1];for(var n=1;n<e.length;n++)f=e[n],j=Math.min(j,f[0]),k=Math.max(k,f[0]),l=Math.min(l,f[1]),m=Math.max(m,f[1]);d[a]={minX:this.$TiledSphericalRenderer3+j,maxX:this.$TiledSphericalRenderer3+k,minY:this.$TiledSphericalRenderer3-m,maxY:this.$TiledSphericalRenderer3-l}}}return d};d.$TiledSphericalRenderer40=function(a,b){a=a.getKey();b=b.get(a);b&&(this.$TiledSphericalRenderer16.cacheTexture(b),this.$TiledSphericalRenderer33())};d.$TiledSphericalRenderer31=function(a){__p&&__p();var c=this,d=a.getKey(),e,f;d=this.$TiledSphericalRenderer13.get(d);if(!d)return 0;e=d.closestCoveringTile;f=d.closestPrevTile;if(!e||!f)return 0;var g=2*this.$TiledSphericalRenderer3,h=this.$TiledSphericalRenderer3,j=Math.pow(2,a.level);g=g/j;j=a.col*g;var k=a.row*g;j=-h+j;var l=j+g;k=h-k;g=k-g;k=[[j,k,-h],[l,k,-h],[j,g,-h],[l,g,-h]];j=this.$TiledSphericalRenderer17[a.face];l=[];for(var g=0;g<k.length;g++)i.transformMat3(k[g],k[g],j),l.push(k[g][0]),l.push(k[g][1]),l.push(k[g][2]);h={};this.$TiledSphericalRenderer42(this.$TiledSphericalRenderer19,l,3);this.__gl.activeTexture(this.$TiledSphericalRenderer23);e?h=this.$TiledSphericalRenderer43(e):h=this.$TiledSphericalRenderer44(a);g=this.$TiledSphericalRenderer45(a,h);this.$TiledSphericalRenderer42(this.$TiledSphericalRenderer20,g,2);this.__gl.activeTexture(this.$TiledSphericalRenderer24);j=new(b("CubemapImageTileInfo"))(0,a.face,0,0);k=this.$TiledSphericalRenderer16.getBaseLevelTexCache().get(j.getKey());if(!k)throw new Error("[Tile] Base level should have been loaded.");this.__gl.bindTexture(this.__gl.TEXTURE_2D,k);e=this.$TiledSphericalRenderer45(a,j);this.$TiledSphericalRenderer42(this.$TiledSphericalRenderer21,e,2);if(d&&f){this.__gl.activeTexture(this.$TiledSphericalRenderer25);h=this.$TiledSphericalRenderer43(f);g=this.$TiledSphericalRenderer45(a,h);this.$TiledSphericalRenderer42(this.$TiledSphericalRenderer22,g,2);k=this.__gl.getUniformLocation(this.__shaderProgram,"progress");this.__gl.uniform1f(k,d.blendingProgress)}this.__gl.drawArrays(this.__gl.TRIANGLE_STRIP,0,l.length/3);this.__gl.bindTexture(this.__gl.TEXTURE_2D,null);this.$TiledSphericalRenderer9.forEach(function(a){c.__gl.bindBuffer(c.__gl.ARRAY_BUFFER,a),c.__gl.bufferData(c.__gl.ARRAY_BUFFER,1,c.__gl.STATIC_DRAW),c.__gl.deleteBuffer(a)});this.$TiledSphericalRenderer9=[];return this.$TiledSphericalRenderer15.getTileToCanvasPixelRatio(h.level,this.__verticalFieldOfView)};d.$TiledSphericalRenderer42=function(a,b,c){var d=this.__gl.createBuffer();this.$TiledSphericalRenderer9.push(d);this.__gl.bindBuffer(this.__gl.ARRAY_BUFFER,d);this.__gl.bufferData(this.__gl.ARRAY_BUFFER,new Float32Array(b),this.__gl.STATIC_DRAW);this.__gl.vertexAttribPointer(a,c,this.__gl.FLOAT,!1,0,0)};d.$TiledSphericalRenderer45=function(a,b){var c=this.$TiledSphericalRenderer1.getTilePaddingPixels();c=c/this.$TiledSphericalRenderer1.getTileTotalSize();var d=this.$TiledSphericalRenderer1.getTileContentSize()/this.$TiledSphericalRenderer1.getTileTotalSize(),e=Math.pow(2,a.level-b.level);d=d/e;var f=a.col-e*b.col;a=a.row-e*b.row;e=c+f*d;b=c+a*d;return[e,b,e+d,b,e,b+d,e+d,b+d]};d.$TiledSphericalRenderer43=function(a){var b;a.level===0?b={lastUsedTime:0,texture:this.$TiledSphericalRenderer16.getBaseLevelTexCache().get(a.getKey())}:b=this.$TiledSphericalRenderer16.getTextureCache().get(a.getKey());if(b){this.__gl.bindTexture(this.__gl.TEXTURE_2D,b.texture);b.lastUsedTime=this.$TiledSphericalRenderer6;return a}throw new Error("No possible tile for requested params: "+a.getKey())};d.$TiledSphericalRenderer44=function(a){__p&&__p();var b=0;while(b<=a.level){var c=a.getInfoForOffsetLevel(b),d=c.getKey(),e=void 0;c.level===0?e={lastUsedTime:0,texture:this.$TiledSphericalRenderer16.getBaseLevelTexCache().get(d)}:e=this.$TiledSphericalRenderer16.getTextureCache().get(d);if(e){this.__gl.bindTexture(this.__gl.TEXTURE_2D,e.texture);e.lastUsedTime=this.$TiledSphericalRenderer6;return c}else this.$TiledSphericalRenderer1.loadTileImage(c,this.$TiledSphericalRenderer37,this.$TiledSphericalRenderer6);b++}throw new Error("No possible tile for requested params: "+a.getKey())};d.$TiledSphericalRenderer36=function(a){var b=0;while(b<=a.level){var c=a.getInfoForOffsetLevel(b),d=c.getKey();if(this.$TiledSphericalRenderer16.getBaseLevelTexCache().has(d)||this.$TiledSphericalRenderer16.getTextureCache().has(d))return c;b++}throw new Error("No possible tile for requested params: "+a.getKey())};d.$TiledSphericalRenderer26=function(){var a=b("TiledSphericalRendererUtils").initFaceRotationMatrices(this.$TiledSphericalRenderer3),c=a.faceRotationMatrices;a=a.faceVertexLists;this.$TiledSphericalRenderer17=c;this.$TiledSphericalRenderer18=a};return c}(b("BaseRotatableWebGLRenderer"));a.__subClassMethods={__getFragmentShaderScript:!0,__getVertexShaderScript:!0,__getShaderPerspectiveMatrixUniformName:!0,__getShaderRotationMatrixUniformName:!0,__renderInternal:!0,__shaderProgramReady:!0,__getMaxGPUMemoryUsedBytes:!0,__getPrevFrameTextureScreenRatio:!0,__createTexture:!0,__clearCache:!0};e.exports=a}),null);
__d("getScaledPanoDimensions",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();function a(a,b){__p&&__p();a={croppedAreaImageHeightPixels:Number(a.CroppedAreaImageHeightPixels)||0,croppedAreaImageWidthPixels:Number(a.CroppedAreaImageWidthPixels)||0,croppedAreaLeftPixels:Number(a.CroppedAreaLeftPixels)||0,croppedAreaTopPixels:Number(a.CroppedAreaTopPixels)||0,fullPanoHeightPixels:Number(a.FullPanoHeightPixels)||0,fullPanoWidthPixels:Number(a.FullPanoWidthPixels)||0};if(a.croppedAreaImageWidthPixels&&b!==a.croppedAreaImageWidthPixels){b=b/a.croppedAreaImageWidthPixels;a.croppedAreaImageWidthPixels*=b;a.croppedAreaImageHeightPixels*=b;a.croppedAreaLeftPixels*=b;a.croppedAreaTopPixels*=b;a.fullPanoHeightPixels*=b;a.fullPanoWidthPixels*=b}return a}e.exports=a}),null);
__d("SphericalPhotoRenderer.redux",["cx","Promise","BootloadedComponent.react","Bootloader","CubemapImageTileProvider","DOM","EntPhotoCubemapTileUriProvider","Event","ImageUtils","JSResource","PhotoProjection","PhotoRendererProjection","React","ReactRedux","SphericalMediaBaseActions","SphericalMediaCanvasPool","SphericalMediaCoreActions","SphericalMediaRenderer.react","SphericalMediaViewActions","SphericalPhotoActions","SphericalPhotoPartialLimits","SphericalPhotoTypedConfig","StaticCubemapTileUriProvider","TiledCubeMapStereoGraphRenderer","TiledSphericalRenderer","getScaledPanoDimensions","joinClasses","performanceNow","uniqueID"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();a=b("ReactRedux").connect;var h=b("SphericalMediaBaseActions").setupRenderer,i=b("SphericalMediaBaseActions").sourceOnLoad,j=b("SphericalMediaBaseActions").updateBase,k=b("SphericalMediaBaseActions").viewportClicked,l=b("SphericalMediaBaseActions").webGlContextLost,m=b("SphericalMediaBaseActions").webGlInitFailed,n=b("SphericalMediaBaseActions").webGlRenderFailed,o=b("SphericalMediaCoreActions").turnOff,p=b("SphericalMediaViewActions").updateViewportAndFOV,q=b("SphericalPhotoActions").rendererStats,r=b("SphericalPhotoPartialLimits").makePartialLimits,s=2;c={__afterDraw:!0,__beforeCanvasLost:!0,__getCanvas:!0,__getRenderer:!0,__getViewData:!0,__onSetupDone:!0,__isReadyToSetup:!0,__onFallbackUIClick:!0,__showLoadingThumbnail:!0,__onWebGlContextLost:!0,__onWebGlInitFailed:!0,__onWebGlRenderFailed:!0};d=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c){var d;d=a.call(this,c)||this;d.$SphericalPhotoRenderer11=function(){d.draw(d.__getViewData())};d.__sourceElement=b("DOM").create("img");d.$SphericalPhotoRenderer1=b("uniqueID")();d.$SphericalPhotoRenderer2=0;d.$SphericalPhotoRenderer3=null;return d}var d=c.prototype;d.__afterDraw=function(){};d.__beforeCanvasLost=function(){this.$SphericalPhotoRenderer4(),this.sphericalRenderer&&this.sphericalRenderer.destroy(),this.sphericalRenderer=null,this.props.isActive&&this.props.dispatch(o())};d.__getViewData=function(){var a=this.props.viewStore.getState();a=a.view;return{fov:a.fov,pitch:a.pitch,yaw:a.yaw}};d.__getCanvas=function(){var a=this,c=this.$SphericalPhotoRenderer5();b("SphericalMediaCanvasPool").setLimit(s,c);var d={canvasAttrs:{width:this.props.width,height:this.props.height,className:b("joinClasses")(this.props.className,"_5nxw")},beforeCanvasLost:function(){return a.__beforeCanvasLost()}};return b("SphericalMediaCanvasPool").get(this.$SphericalPhotoRenderer1,d,c)};d.__onSetupDone=function(){this.$SphericalPhotoRenderer6()};d.__isReadyToSetup=function(){return this.props.isActive&&this.props.imageLoaded};d.__onFallbackUIClick=function(){this.props.dispatch(k())};d.__onWebGlRenderFailed=function(a,b){this.props.dispatch(n(a,b))};d.__onWebGlContextLost=function(){this.props.dispatch(l()),this.props.dispatch(o())};d.__onWebGlInitFailed=function(a){b("SphericalMediaCanvasPool").release(this.$SphericalPhotoRenderer1,this.props.canvasNamespace),this.props.dispatch(m(a)),this.props.dispatch(o())};d.$SphericalPhotoRenderer7=function(){var a=this.props.photoSphereMetadata,c=a.ProjectionType===b("PhotoProjection").EQUIRECTANGULAR;a=a.FullPanoWidthPixels===a.CroppedAreaImageWidthPixels&&a.FullPanoHeightPixels===a.CroppedAreaImageHeightPixels;return b("SphericalPhotoTypedConfig").enable_stereograph_renderer&&c&&a};d.__getRenderer=function(a){__p&&__p();var c=this;return new(b("Promise"))(function(d,e){__p&&__p();var f=c.props,g=f.projectionType,h=f.photoSphereMetadata;if(c.props.tiledSphericalConfig.useTiledRenderer){f=c.$SphericalPhotoRenderer7()?b("TiledCubeMapStereoGraphRenderer"):b("TiledSphericalRenderer");if(c.__cubemapImageTileProvider)d(new f(a,c.__cubemapImageTileProvider,c.props.partialLimits,h.ProjectionType===b("PhotoProjection").CYLINDRICAL));else throw new Error("No __cubemapImageTileProvider")}else{if(!c.props.imageLoaded)throw new Error("__getRenderer was called before the source has been loaded.");var i=b("getScaledPanoDimensions")(h,c.__sourceElement.width);g===b("PhotoProjection").EQUIRECTANGULAR?b("Bootloader").loadModules(["EquirectSphericalWebGLRenderer"],function(b){try{d(new b(c.__sourceElement,a,babelHelpers["extends"]({poseHeadingDegrees:Number(h.PoseHeadingDegrees)||0,posePitchDegrees:Number(h.PosePitchDegrees)||0,poseRollDegrees:Number(h.PoseRollDegrees)||0},i)))}catch(a){e(a)}},"SphericalPhotoRenderer.redux"):g===b("PhotoProjection").CYLINDRICAL?b("Bootloader").loadModules(["CylindricalSphericalWebGLRenderer"],function(b){try{d(new b(c.__sourceElement,a,i))}catch(a){e(a)}},"SphericalPhotoRenderer.redux"):b("Bootloader").loadModules(["CubestripSphericalWebGLRenderer"],function(b){try{d(new b(c.__sourceElement,a))}catch(a){e(a)}},"SphericalPhotoRenderer.redux")}})};d.__destroy=function(){this.$SphericalPhotoRenderer4(),this.$SphericalPhotoRenderer3&&this.$SphericalPhotoRenderer3(),a.prototype.__destroy.call(this),b("SphericalMediaCanvasPool").release(this.$SphericalPhotoRenderer1,this.$SphericalPhotoRenderer5()),this.__sourceElement=b("DOM").create("img"),this.__cubemapImageTileProvider=null,this.props.dispatch(j({loaded:!1}))};d.$SphericalPhotoRenderer5=function(){var a,c;this.props.tiledSphericalConfig.useTiledRenderer?a=b("PhotoProjection").TILED_CUBEMAP:this.props.photoSphereMetadata.ProjectionType?a=this.props.photoSphereMetadata.ProjectionType:a=b("PhotoProjection").CUBESTRIP;this.$SphericalPhotoRenderer7()?c=b("PhotoRendererProjection").STEREOGRAPHIC:c=b("PhotoRendererProjection").PERSPECTIVE;return a+c+this.props.canvasNamespace};d.__showLoadingThumbnail=function(){return!this.props.taggingMode};d.$SphericalPhotoRenderer4=function(){var a=this.sphericalRenderer;if(a){a={avg_frame_render_time:a.getAverageFrameRenderTimeMillis(),avg_texture_to_screen_ratio2:a.getAverageTextureToScreenPixelRatio(),device_pixel_ratio:window.devicePixelRatio||1,dt:a.getTimeSinceFirstRenderMillis(),max_gpu_memory_used:a.getMaxGPUMemoryUsedBytes(),max_tile_level:this.__cubemapImageTileProvider?this.__cubemapImageTileProvider.getMaxTileLevel():null,render_method:this.props.tiledSphericalConfig.useTiledRenderer?"tiled":"cubestrip",total_data_loaded:this.__cubemapImageTileProvider?this.__cubemapImageTileProvider.getTotalPixelsLoaded():this.$SphericalPhotoRenderer8(),viewport_height:this.props.height,viewport_width:this.props.width};this.props.dispatch(q(a))}};d.$SphericalPhotoRenderer8=function(){if(this.__sourceElement&&b("ImageUtils").hasLoaded(this.__sourceElement)){var a=this.__sourceElement,c=a.width;a=a.height;return c*a}return 0};d.$SphericalPhotoRenderer9=function(a){var c=this.props.dispatch;b("DOM").setAttributes(this.__sourceElement,{crossOrigin:"anonymous",src:a});if(b("ImageUtils").hasLoaded(this.__sourceElement))c(i());else var d=b("Event").listen(this.__sourceElement,"load",function(){c(i()),d.remove()})};d.$SphericalPhotoRenderer10=function(){var a=this.props,c=a.dispatch;a=a.tiledSphericalConfig;if(a.useTiledRenderer&&!this.__cubemapImageTileProvider){a=this.props.fbid==="0"?new(b("StaticCubemapTileUriProvider"))(this.props.tiledSphericalConfig.initialTileUris):new(b("EntPhotoCubemapTileUriProvider"))(this.props.fbid,this.props.tiledSphericalConfig.initialTileUris);a=new(b("CubemapImageTileProvider"))(a,this.props.tiledSphericalConfig.maxTileLevel,this.props.tiledSphericalConfig.viewportTileUris);a.addBaseLevelReadyCallback(function(){return c(i())});this.__cubemapImageTileProvider=a}};d.$SphericalPhotoRenderer6=function(){this.$SphericalPhotoRenderer3=this.props.viewStore.subscribe(this.$SphericalPhotoRenderer11);this.draw(this.__getViewData());var a=this.sphericalRenderer;if(a){var c=b("performanceNow")()-this.$SphericalPhotoRenderer2;this.props.dispatch(h(a,c))}};d.componentDidMount=function(){var c=this.props.tiledSphericalConfig.useTiledRenderer;c?this.$SphericalPhotoRenderer10():this.props.cubeStripImageURI&&this.$SphericalPhotoRenderer9(this.props.cubeStripImageURI);this.props.isActive&&(this.$SphericalPhotoRenderer2=b("performanceNow")());a.prototype.componentDidMount.call(this)};d.UNSAFE_componentWillReceiveProps=function(c){__p&&__p();this.shouldRender=c.isActive&&!this.props.renderer||c.isActive!==this.props.isActive||c.thumbnail!==this.props.thumbnail||c.useFallbackUI!==this.props.useFallbackUI||c.width!==this.props.width||c.height!==this.props.height||c.imageLoaded&&!this.props.imageLoaded||c.renderer!==this.props.renderer;if(this.props.fbid!==c.fbid){this.shouldRender=!1;this.__destroy();return}c.isActive&&c.isActive!==this.props.isActive&&(this.$SphericalPhotoRenderer2=b("performanceNow")());this.props.renderer&&c.projectionType!==this.props.projectionType&&this.__destroy();var d=this.props.tiledSphericalConfig.useTiledRenderer;d?this.$SphericalPhotoRenderer10():c.cubeStripImageURI&&!this.__sourceElement.src&&this.$SphericalPhotoRenderer9(c.cubeStripImageURI);a.prototype.UNSAFE_componentWillReceiveProps.call(this,c)};d.componentWillUnmount=function(){this.props.viewStore.dispatch(p(this.props.initialYaw,this.props.initialPitch,this.props.initialFov)),a.prototype.componentWillUnmount.call(this)};d.render=function(){var c=this;return this.props.useFallbackUI?b("React").createElement("div",{onClick:function(){return c.__onFallbackUIClick()},role:"link",tabIndex:"0",className:"_kp_"},b("React").createElement(b("BootloadedComponent.react"),{bootloadLoader:b("JSResource")("SphericalPhotoFallbackCanvasWrapper.redux").__setRef("SphericalPhotoRenderer.redux"),bootloadPlaceholder:b("React").createElement("span",null)})):a.prototype.render.call(this)};return c}(b("SphericalMediaRenderer.react"));d.__subClassMethods=c;f=function(a){return{className:a.base.className,expansionCoef:a.base.expansionCoef,height:a.base.height,initialFov:a.base.initialFov,initialPitch:a.base.initialPitch,initialYaw:a.base.initialYaw,isActive:a.base.isRendererActive||a.base.showFallbackUI,projectionType:a.base.projectionType,renderer:a.base.renderer,tiledSphericalConfig:a.base.tiledSphericalConfig,width:a.base.width,partialLimits:r({partialLeftDegrees:a.base.partialLimits.partialLeftDegrees,partialRightDegrees:a.base.partialLimits.partialRightDegrees,partialBottomDegrees:a.base.partialLimits.partialBottomDegrees,partialTopDegrees:a.base.partialLimits.partialTopDegrees}),fbid:a.base.fbid,isFetchingData:a.base.isFetchingData,imageLoaded:a.base.loaded,cubeStripImageURI:a.base.src,useFallbackUI:a.base.useFallbackUI,taggingMode:a.base.taggingMode,thumbnail:a.base.thumbnail,canvasNamespace:a.base.canvasNamespace,src:a.base.src,photoSphereMetadata:a.base.photoSphereMetadata,viewStore:a.base.viewStore}};e.exports=a(f)(d)}),null);
__d("SphericalPhotoStore",["SphericalMediaBaseReducer","SphericalMediaBaseStore"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.getReducers=function(){return{base:b("SphericalMediaBaseReducer")}};return c}(b("SphericalMediaBaseStore"));e.exports=a}),null);
__d("SphericalPhotoFeedEvents",[],(function(a,b,c,d,e,f){e.exports=Object.freeze({DRAG_START:0,VIEWPORT_CLICKED:1,TAP_HEADING_INDICATOR:2})}),null);
__d("SphericalPhotoViewerLoggingMiddleware",["Banzai","Bootloader","SphericalMediaActions","SphericalPhotoConstants","SphericalPhotoFeedEvents","SphericalPhotoTypedConfig","collectDataAttributes","immutable"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("SphericalPhotoConstants").FEED_TRACKING_KEY,h=Object.freeze({NEWSSTAND:"newsstand"}),i=Object.freeze({CONTENT_CLICK:175}),j=b("immutable").List(),k=function(a,c,d){var e;a=b("collectDataAttributes")(a,["ft"]);c={ft:babelHelpers["extends"]((e={},e[g]=c,e),a.ft?a.ft:{})};d&&(c.ft.evt=d);b("Banzai").post("feed_tracking",c,{})};a=function(a){__p&&__p();var c=a.getState,d,e;b("SphericalPhotoTypedConfig").www_can_viewer_tag?b("Bootloader").loadModules(["SphericalPhotoViewerLoggingUtil","SphericalPhotoTagLoggingUtil"],function(a,b){d=a,e=b,j.forEach(function(a){d&&d.log(a.action,a.base),e&&e.log(a.action,a.base)}),j=j.clear()},"SphericalPhotoViewerLoggingMiddleware"):b("Bootloader").loadModules(["SphericalPhotoViewerLoggingUtil"],function(a){d=a,j.forEach(function(a){d&&d.log(a.action,a.base)}),j=j.clear()},"SphericalPhotoViewerLoggingMiddleware");return function(a){__p&&__p();return function(f){var g=c();d?(d.log(f,g.base),e&&e.log(f,g.base)):j=j.push({action:f,base:g.base});if(g.base.surface===h.NEWSSTAND&&g.base.ctrElement)switch(f.type){case b("SphericalMediaActions").TAP_HEADING_INDICATOR:k(g.base.ctrElement,b("SphericalPhotoFeedEvents").TAP_HEADING_INDICATOR);break;case b("SphericalMediaActions").DRAG_START:k(g.base.ctrElement,b("SphericalPhotoFeedEvents").DRAG_START,i.CONTENT_CLICK);break}return a(f)}}};e.exports=a}),null);
__d("SphericalPhotoViewerWrapper.redux",["cx","BootloadedComponent.react","JSResource","React","ReactRedux"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();a=b("ReactRedux").connect;c=function(a){babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){return b("React").createElement("div",{className:"_3o6m _5nxw sphericalPhotoWrapper"},this.props.children,this.props.showFallbackUI?b("React").createElement(b("BootloadedComponent.react"),{bootloadLoader:b("JSResource")("SphericalPhotoFallbackIndicator.redux").__setRef("SphericalPhotoViewerWrapper.redux"),bootloadPlaceholder:b("React").createElement("span",null)}):null)};return c}(b("React").Component);d=function(a){return{showFallbackUI:a.base.showFallbackUI}};e.exports=a(d)(c)}),null);
__d("CubestripSphericalWebGLRenderer",["invariant","BaseRotatableWebGLRenderer","DOM"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(b,c,d,e){__p&&__p();d===void 0&&(d=[]);e===void 0&&(e={});c=a.call(this,c,e)||this;c.__source=b;c.$CubestripSphericalWebGLRenderer2=0;c.__source&&c.__source.setAttribute("crossorigin","anonymous");c.$CubestripSphericalWebGLRenderer6=null;c.$CubestripSphericalWebGLRenderer5=null;c.$CubestripSphericalWebGLRenderer4=d;c.__clearOnRender=!0;c.__setup();return c}var d=c.prototype;d.__clearCache=function(){this.$CubestripSphericalWebGLRenderer1&&(this.__gl.deleteTexture(this.$CubestripSphericalWebGLRenderer1),this.$CubestripSphericalWebGLRenderer1=null)};d.__getShaderPerspectiveMatrixUniformName=function(){return"uPMatrix"};d.__getShaderRotationMatrixUniformName=function(){return"uRotationMatrix"};d.__shaderProgramReady=function(){this.$CubestripSphericalWebGLRenderer7=this.__gl.getAttribLocation(this.__shaderProgram,"aVertexPosition");this.__gl.enableVertexAttribArray(this.$CubestripSphericalWebGLRenderer7);var a=this.__gl.getUniformLocation(this.__shaderProgram,"uSampler");this.__gl.uniform1i(a,0)};d.__getVertexShaderScript=function(){return"\n      attribute vec3 aVertexPosition;\n\n      uniform mat4 uRotationMatrix;\n      uniform mat4 uPMatrix;\n\n      varying highp vec3 vVertexDirectionVector;\n\n      void main(void) {\n        gl_Position = uPMatrix * uRotationMatrix * vec4(aVertexPosition, 1.0);\n        vVertexDirectionVector = aVertexPosition;\n      }\n    "};d.__getFragmentShaderScript=function(){return"\n      varying highp vec3 vVertexDirectionVector;\n      uniform samplerCube uSampler;\n\n      void main(void) {\n          gl_FragColor = textureCube(uSampler, vVertexDirectionVector);\n      }\n    "};d.__getMaxGPUMemoryUsedBytes=function(){return this.$CubestripSphericalWebGLRenderer2};d.__getPrevFrameTextureScreenRatio=function(){return this.$CubestripSphericalWebGLRenderer3};d.__createTexture=function(){var a=this.__source;a||g(0,12371);this.__gl.activeTexture(this.__gl.TEXTURE0);this.$CubestripSphericalWebGLRenderer1||(this.$CubestripSphericalWebGLRenderer1=this.$CubestripSphericalWebGLRenderer8(a))};d.__renderInternal=function(){__p&&__p();this.__clearOnRender&&this.__gl.clear(this.__gl.COLOR_BUFFER_BIT|this.__gl.DEPTH_BUFFER_BIT);this.__createTexture();this.__gl.bindTexture(this.__gl.TEXTURE_CUBE_MAP,this.$CubestripSphericalWebGLRenderer1);this.$CubestripSphericalWebGLRenderer6===null&&this.$CubestripSphericalWebGLRenderer9(0,0);this.__gl.bindBuffer(this.__gl.ARRAY_BUFFER,this.$CubestripSphericalWebGLRenderer6);this.$CubestripSphericalWebGLRenderer6&&this.__gl.vertexAttribPointer(this.$CubestripSphericalWebGLRenderer7,this.$CubestripSphericalWebGLRenderer6.itemSize,this.__gl.FLOAT,!1,0,0);this.__gl.bindBuffer(this.__gl.ELEMENT_ARRAY_BUFFER,this.$CubestripSphericalWebGLRenderer5);this.$CubestripSphericalWebGLRenderer5&&this.__gl.drawElements(this.__gl.TRIANGLES,this.$CubestripSphericalWebGLRenderer5.numItems,this.__gl.UNSIGNED_SHORT,0);this.__gl.bindTexture(this.__gl.TEXTURE_2D,null);var a=this.$CubestripSphericalWebGLRenderer10(),b=this.__verticalFieldOfView;b=b/90*a;this.$CubestripSphericalWebGLRenderer3=b/this.__canvas.height};d.$CubestripSphericalWebGLRenderer9=function(a,b){__p&&__p();a=[5,1,3,7,0,4,6,2,6,7,3,2,0,1,5,4,4,5,7,6,1,0,2,3];b=[];for(var c=0;c<a.length;c++){var d=a[c]>>2&1,e=a[c]>>1&1,f=a[c]>>0&1;b.push(d*2-1);b.push(e*2-1);b.push(f*2-1)}this.$CubestripSphericalWebGLRenderer6=this.__gl.createBuffer();this.__gl.bindBuffer(this.__gl.ARRAY_BUFFER,this.$CubestripSphericalWebGLRenderer6);this.__gl.bufferData(this.__gl.ARRAY_BUFFER,new Float32Array(b),this.__gl.STATIC_DRAW);this.$CubestripSphericalWebGLRenderer6&&(this.$CubestripSphericalWebGLRenderer6.itemSize=3,this.$CubestripSphericalWebGLRenderer6.numItems=b.length/3);d=[];for(var e=0;e<a.length;e+=4)d.push(e),d.push(e+2),d.push(e+1),d.push(e),d.push(e+3),d.push(e+2);this.$CubestripSphericalWebGLRenderer5=this.__gl.createBuffer();this.__gl.bindBuffer(this.__gl.ELEMENT_ARRAY_BUFFER,this.$CubestripSphericalWebGLRenderer5);this.__gl.bufferData(this.__gl.ELEMENT_ARRAY_BUFFER,new Uint16Array(d),this.__gl.STATIC_DRAW);this.$CubestripSphericalWebGLRenderer5&&(this.$CubestripSphericalWebGLRenderer5.itemSize=1,this.$CubestripSphericalWebGLRenderer5.numItems=d.length)};d.$CubestripSphericalWebGLRenderer10=function(){var a=this.__gl.getParameter(this.__gl.MAX_CUBE_MAP_TEXTURE_SIZE);return Math.min(a,this.__canvas.width)};d.$CubestripSphericalWebGLRenderer11=function(a){a=a*a*4*6;this.$CubestripSphericalWebGLRenderer2=Math.max(a,this.$CubestripSphericalWebGLRenderer2)};d.$CubestripSphericalWebGLRenderer8=function(a){__p&&__p();var c=this,d=this.__getNewGLTexObj(this.__gl.TEXTURE_CUBE_MAP),e=this.$CubestripSphericalWebGLRenderer10();this.$CubestripSphericalWebGLRenderer11(e);var f=a.naturalWidth;this.__gl.pixelStorei(this.__gl.UNPACK_FLIP_Y_WEBGL,!1);this.__gl.bindTexture(this.__gl.TEXTURE_CUBE_MAP,d);var g;if(this.$CubestripSphericalWebGLRenderer4.length===6)g=this.$CubestripSphericalWebGLRenderer4;else{g=[];for(var h=0;h<6;h++){var i=b("DOM").create("canvas",{width:e,height:e}),j=i.getContext("2d");j.drawImage(a,0,h*f,f,f,0,0,e,e);g.push(i)}this.emit("cubefaceTexturesComputed",g)}j=0;g.forEach(function(b,a){c.__gl.texImage2D(c.__gl.TEXTURE_CUBE_MAP_POSITIVE_X+a,0,c.__gl.RGBA,c.__gl.RGBA,c.__gl.UNSIGNED_BYTE,b),j=c.__gl.getError()});j!==0&&this.emit("renderingError",new Error("WebGL Error Code: "+j));this.__gl.bindTexture(this.__gl.TEXTURE_CUBE_MAP,null);return d};return c}(b("BaseRotatableWebGLRenderer"));a.__subClassMethods={__getFragmentShaderScript:!0,__getVertexShaderScript:!0,__getShaderPerspectiveMatrixUniformName:!0,__getShaderRotationMatrixUniformName:!0,__renderInternal:!0,__shaderProgramReady:!0,__getMaxGPUMemoryUsedBytes:!0,__getPrevFrameTextureScreenRatio:!0,__createTexture:!0,__clearCache:!0};e.exports=a}),null);
__d("SocialVRThreeJS",["ThreeJS.r93"],(function(a,b,c,d,e,f){e.exports=b("ThreeJS.r93")}),null);
__d("VrController",["SocialVRThreeJS"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(a,c,d){this.__hand=a,this.__controllerListener=c,this.__findGamepad(),this.$2=new(b("SocialVRThreeJS").Vector3)(),this.$1=new(b("SocialVRThreeJS").Quaternion)(),this.$4={},this.$3=d,window.addEventListener("gamepadconnected",this.__findGamepad.bind(this)),window.addEventListener("gamepaddisconnected",this.__findGamepad.bind(this))}var c=a.prototype;c.__findGamepad=function(){__p&&__p();this.__gamepadIndex=-1;if(navigator.getGamepads){var a=navigator.getGamepads();for(var b=0;b<a.length;b++){var c=a[b];if(c&&c.pose&&c.hand===this.__hand){this.__gamepadIndex=b;break}}}};c.update=function(){if(navigator.getGamepads&&this.isValid()){var a=navigator.getGamepads();a=a[this.__gamepadIndex];this.__axes=a.axes;this.__dectButtonPressed(a)}};c.axes=function(){return this.__axes};c.orientation=function(){var a=null;if(navigator.getGamepads&&this.isValid()){var b=navigator.getGamepads();b=b[this.__gamepadIndex];b=b.pose.orientation;b&&(this.$1.fromArray(b),a=this.$1)}return a};c.position=function(){var a=null;if(navigator.getGamepads&&this.isValid()){var b=navigator.getGamepads();b=b[this.__gamepadIndex];b.pose.position&&(this.$2.fromArray(b.pose.position),a=this.$2)}return a};c.hand=function(){return this.__hand};c.isValid=function(){return this.__gamepadIndex!==-1};c.hasButtonPressed=function(){if(navigator.getGamepads&&this.isValid()){var a=navigator.getGamepads();a=a[this.__gamepadIndex];return this.__hasButtonPressed(a)}return!1};c.__hasButtonPressed=function(a){a=a.buttons;for(var b=0;b<a.length;b++)if(a[b].pressed)return!0;return!1};c.__dectButtonPressed=function(a){__p&&__p();var b=this;this.$3.forEach(function(c){var d=!1;if(a.id===c.gampadId){var e=a.buttons;d=c.buttonIndex>0&&c.buttonIndex<e.length&&e[c.buttonIndex].pressed}e=b.$4[c];d&&!e&&b.__controllerListener({controller:b,eventType:c.eventType});b.$4[c]=d})};return a}();e.exports=a}),null);
__d("ThreeJsHelpers",["SocialVRThreeJS"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a={createRoundedCorneredPlane:function(a,c,d,e){__p&&__p();e=new(b("SocialVRThreeJS").Shape)();var f=-a/2,g=-c/2;e.moveTo(f,g+d);e.lineTo(f,g+c-d);e.quadraticCurveTo(f,g+c,f+d,g+c);e.lineTo(f+a-d,g+c);e.quadraticCurveTo(f+a,g+c,f+a,g+c-d);e.lineTo(f+a,g+d);e.quadraticCurveTo(f+a,g,f+a-d,g);e.lineTo(f+d,g);e.quadraticCurveTo(f,g,f,g+d);return new(b("SocialVRThreeJS").ShapeBufferGeometry)(e)},disposeModel:function(a){a.traverse(function(a){a.isMesh&&(a.geometry&&a.geometry.dispose(),a.material&&(Object.values(a.material).forEach(function(a){a instanceof b("SocialVRThreeJS").Texture&&a.dispose()}),a.material.dispose()))})},createAnimationGroup:function(a){var c=new(b("SocialVRThreeJS").AnimationObjectGroup)();a.traverse(function(a){a.isMesh&&c.add(a)});return c}};e.exports=a}),null);
__d("VrFadeAnimation",["SocialVRThreeJS"],(function(a,b,c,d,e,f){__p&&__p();var g=1;a=function(){"use strict";__p&&__p();function a(a,c){__p&&__p();this.$2=new(b("SocialVRThreeJS").Clock)();this.$1=new(b("SocialVRThreeJS").AnimationMixer)(a);var d=[];c.forEach(function(a){if(a.objectNames)a.objectNames.forEach(function(c){c=new(b("SocialVRThreeJS").NumberKeyframeTrack)(c+".material.opacity",a.times,a.opacities,b("SocialVRThreeJS").InterpolateLinear);d.push(c)});else{var c=new(b("SocialVRThreeJS").NumberKeyframeTrack)(".material.opacity",a.times,a.opacities,b("SocialVRThreeJS").InterpolateLinear);d.push(c)}});this.$3=new(b("SocialVRThreeJS").AnimationClip)("fadeAnimation",-1,d)}var c=a.prototype;c.start=function(){this.$1.clipAction(this.$3).play().setLoop(b("SocialVRThreeJS").LoopOnce,g),this.$2.start()};c.stop=function(){this.$1.clipAction(this.$3).stop(),this.$2.stop()};c.update=function(){this.$1.update(this.$2.getDelta())};c.isRunning=function(){return this.$1.clipAction(this.$3).isRunning()};return a}();e.exports=a}),null);
__d("VrHtmlToImageDataURLLoader",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(){this.$1=document.createElement("canvas")}a.getInstance=function(){a.singleVrHtmlToImageDataURLLoader||(a.singleVrHtmlToImageDataURLLoader=new a());return a.singleVrHtmlToImageDataURLLoader};var b=a.prototype;b.loadHtml=function(b,c,d,e,f){c=a.WORLD_TO_PIXELS*c;d=a.WORLD_TO_PIXELS*d;b='<svg xmlns="http://www.w3.org/2000/svg" background-color="blue" width="'+c+'" height="'+d+'"><foreignObject width="100%" height="100%"><div xmlns="http://www.w3.org/1999/xhtml" style="height:100%;width:100%; xbackground:green;">'+b+"</div></foreignObject></svg>";b=encodeURIComponent(b);e.onload=this.$2.bind(this,e,f,c,d);e.src="data:image/svg+xml,"+b};b.$2=function(a,b,c,d){var e=this.$1.getContext("2d");this.$1.width=c;this.$1.height=d;e.clearRect(0,0,this.$1.width,this.$1.height);e.drawImage(a,0,0);b(this.$1.toDataURL("image/png"))};b.loadPicture=function(a,b,c){b.crossOrigin="Anonymous",b.onload=this.$3.bind(this,b,c),b.src=a};b.$3=function(a,b){var c=this.$1.getContext("2d");this.$1.width=a.width;this.$1.height=a.height;c.clearRect(0,0,this.$1.width,this.$1.height);c.drawImage(a,0,0);b(this.$1.toDataURL("image/png"))};return a}();a.WORLD_TO_PIXELS=1024;a.singleVrHtmlToImageDataURLLoader=null;e.exports=a}),null);
__d("VrStoryHeader",["SocialVRThreeJS","VrHtmlToImageDataURLLoader"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(a,c,d){__p&&__p();var e=this;this.$1=d;this.$5=new Image();this.$6=new Image();this.$9=new Image();this.$2=a;this.$3=c*this.numberOfRows();this.$4=new(b("SocialVRThreeJS").Texture)();this.$4.image=this.$5;this.$4.wrapS=b("SocialVRThreeJS").RepeatWrapping;this.$4.wrapT=b("SocialVRThreeJS").RepeatWrapping;this.$4.repeat.x=1;this.$4.repeat.y=1;this.$7=new(b("SocialVRThreeJS").Mesh)(new(b("SocialVRThreeJS").PlaneGeometry)(this.$2,this.$3,32),new(b("SocialVRThreeJS").MeshBasicMaterial)({map:this.$4,transparent:!0,depthWrite:!1,opacity:1}));d=this.$1.owningPictureURI;d!==void 0&&d!==null&&b("VrHtmlToImageDataURLLoader").getInstance().loadPicture(d,this.$9,function(a){e.$8=a,e.$10()});this.$10()}var c=a.prototype;c.model=function(){return this.$7};c.numberOfRows=function(){var a=2;this.$1.message!==null&&(a+=1.5);return a};c.$10=function(){__p&&__p();var a=this,c=(this.$3*b("VrHtmlToImageDataURLLoader").WORLD_TO_PIXELS-8)/this.numberOfRows(),d=c-2,e='<div style="height:100%;padding:4px;font-family:Helvetica, Arial, sans-serif;white-space:nowrap;font-size:'+d+"px;line-height:"+c+'px;">';e+='<div style="height: '+c*2+'px; width: 100%;">';e+='<div style="display:block; float: left; width:'+c*2+"px; height:"+c*2+"px;";this.$8!==void 0&&this.$8!==null&&(e+="background-image: url("+this.$8+");");e+='background-size:cover;border-radius:50%;">';e+="</div>";e+='<div style="display:block; width:auto; padding-left: '+(c*2+10)+'px; ">';this.$1.title!==void 0&&this.$1.title!==null&&(e+="<div>"+this.$1.title+"</div>");this.$1.creationTime!==void 0&&this.$1.creationTime!==null&&(e+='<div style="font-size: '+d*.8+'px;">'+this.$1.creationTime+"</div>");e+="</div>";e+="</div>";this.$1.message!==void 0&&this.$1.message!==null&&(e+='<div style="height: '+c/2+'px; width: 100%;"></div>',e+='<div style="text-overflow:ellipsis;overflow:hidden;">'+this.$1.message+"</div>");e+="</div>";b("VrHtmlToImageDataURLLoader").getInstance().loadHtml(e,this.$2,this.$3,this.$6,function(b){a.$5.onload=function(){a.$4.needsUpdate=!0},a.$5.src=b})};return a}();e.exports=a}),null);
__d("VrStoryReactions",["invariant","SocialVRThreeJS","VrHtmlToImageDataURLLoader"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();a=function(){__p&&__p();function a(a,c,d){__p&&__p();var e=this;this.$8={};this.$1=d;this.$5=new Image();this.$6=new Image();this.$2=a;this.$3=c*this.numberOfRows();this.$4=new(b("SocialVRThreeJS").Texture)();this.$4.image=this.$5;this.$4.wrapS=b("SocialVRThreeJS").RepeatWrapping;this.$4.wrapT=b("SocialVRThreeJS").RepeatWrapping;this.$4.repeat.x=1;this.$4.repeat.y=1;this.$7=new(b("SocialVRThreeJS").Mesh)(new(b("SocialVRThreeJS").PlaneGeometry)(this.$2,this.$3,32),new(b("SocialVRThreeJS").MeshBasicMaterial)({map:this.$4,transparent:!0,depthWrite:!1,opacity:1}));this.$1.supportedReactions&&(this.$8={},this.$1.supportedReactions.forEach(function(a){a.URI!==void 0&&a.URI!==null&&a.count!==void 0&&a.count!==null&&a.count>0&&e.$9.bind(e,a.URI)()}));this.$10()}var c=a.prototype;c.model=function(){return this.$7};c.numberOfRows=function(){return 1};c.$9=function(a){var c=this,d=new Image();b("VrHtmlToImageDataURLLoader").getInstance().loadPicture(a,d,function(b){c.$8[a]=b,c.$10()})};c.$10=function(){__p&&__p();var a=this;this.$1.reactionsText!==void 0&&this.$1.reactionsText!==null||g(0,5802);var c=(this.$3*b("VrHtmlToImageDataURLLoader").WORLD_TO_PIXELS-8)/this.numberOfRows();c=c-2;var d='<div style="height:100%;font-family:Helvetica, Arial, sans-serif; display:flex;flex-direction:row;align-items:center">';if(this.$1.supportedReactions){d+='<div style="padding-right:20px">';var e=3,f=Object.keys(this.$8);for(var h=0;h<f.length&&h<e;h++){var i=f[h];i=this.$8[i];d+='<div style="border:2px solid white;display:inline-block;position:relative;margin-right:-10px;width:'+c+"px; height:"+c+"px;";d+="z-index: "+(f.length-h)+";";d+="background-image: url("+i+");";d+='background-size:cover;border-radius:50%;"></div>'}d+="</div>"}i=this.$1.reactionsText;i!==void 0&&i!==null&&(d+='<div style="font-size: '+c+'px; white-space: nowrap; text-overflow:ellipsis;overflow:hidden;">'+i+"</div>");d+="</div>";b("VrHtmlToImageDataURLLoader").getInstance().loadHtml(d,this.$2,this.$3,this.$6,function(b){a.$5.onload=function(){a.$4.needsUpdate=!0},a.$5.src=b})};return a}();e.exports=a}),null);
__d("VrStory",["invariant","SocialVRThreeJS","ThreeJsHelpers","VrStoryHeader","VrStoryReactions"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();a=function(){__p&&__p();function a(a,c,d,e,f,h){__p&&__p();this.$1=new(b("SocialVRThreeJS").Object3D)();this.$5=a;this.$6=d;this.$7=e;this.$8=f;d=new(b("SocialVRThreeJS").Vector3)();c.getSize(d);h.header||g(0,4805);this.$2=new(b("VrStoryHeader"))(d.x,this.$8,h.header);e=this.$2.numberOfRows()*this.$8;f=0;this.$3=null;c=h.reactions;c&&c.reactionsText!==null&&(this.$3=new(b("VrStoryReactions"))(d.x,this.$8,c),f=this.$3.numberOfRows()*this.$8);h=d.x+2*this.$6;c=d.y+3*this.$6+e+f+(f>0?this.$6:0);this.$4=d.y;h=new(b("SocialVRThreeJS").Mesh)(b("ThreeJsHelpers").createRoundedCorneredPlane(h,c,this.$7),new(b("SocialVRThreeJS").MeshBasicMaterial)({color:new(b("SocialVRThreeJS").Color)("white"),colorWrite:!0,depthWrite:!1,transparent:!0}));h.renderOrder=0;this.$1.add(h);var i=this.$2.model();i.renderOrder=2;i.position.y=0;i.translateY(c/2-this.$6-e/2);h.add(i);if(this.$3){i=this.$3.model();i.renderOrder=3;h.add(i);i.position.y=0;i.translateY(-c/2+this.$6+f/2)}this.$1.position.copy(a);h=2*this.$6+e-(c-d.y)/2;this.$1.translateY(h)}var c=a.prototype;c.model=function(){return this.$1};c.dispose=function(){b("ThreeJsHelpers").disposeModel(this.$1)};return a}();e.exports=a}),null);
__d("VrStoryUIContainer",["SocialVRThreeJS","ThreeJsHelpers","VrFadeAnimation","VrStory"],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(a){__p&&__p();this.$1=a;this.$4=new(b("SocialVRThreeJS").Object3D)();this.$1.uiScene.add(this.$4);a=this.$1.frameWidth;var c=this.$1.frameHeight;this.$3=new(b("SocialVRThreeJS").Mesh)(b("ThreeJsHelpers").createRoundedCorneredPlane(a,c,this.$1.frameBorderRadius),new(b("SocialVRThreeJS").MeshBasicMaterial)({stencilWrite:!0,colorWrite:!1,color:new(b("SocialVRThreeJS").Color)("blue"),depthWrite:!1}));this.$3.position.fromArray(this.$1.framePosition);this.$1.uiScene.add(this.$3);a=new(b("SocialVRThreeJS").Box3)().setFromObject(this.$3);this.$2=new(b("VrStory"))(this.$3.position,a,this.$1.framePadding,this.$1.frameBorderRadius,this.$1.frameRowHeight,this.$1.storyCardProps);this.$4.add(this.$2.model());c=this.$1.fade;if(c){a=b("ThreeJsHelpers").createAnimationGroup(this.$4);this.$5=new(b("VrFadeAnimation"))(a,[{times:c.times,opacities:c.opacities}]);this.$5.start()}else this.$5=null}var c=a.prototype;c.move=function(a){this.$1.uiScene.position.fromArray(a),this.$1.storyScene&&this.$1.storyScene.position.fromArray(a)};c.position=function(){return[this.$1.uiScene.position.x,this.$1.uiScene.position.y,this.$1.uiScene.position.z]};c.addUICompontent=function(a,b,c){__p&&__p();this.$4.add(a);var d=this.size(),e=this.$2.model().position.clone();switch(b){case"top":e.y+=d.y/2;break;case"bottom":e.y-=d.y/2;break;case"left":e.x-=d.x/2;break;case"right":e.x+=d.x/2;break}a.position.fromArray(c).add(e)};c.size=function(){var a=new(b("SocialVRThreeJS").Box3)().setFromObject(this.$2.model()),c=new(b("SocialVRThreeJS").Vector3)();a.getSize(c);return c};c.dispose=function(){this.$1.uiScene.remove(this.$4),this.$1.uiScene.remove(this.$3),b("ThreeJsHelpers").disposeModel(this.$4),b("ThreeJsHelpers").disposeModel(this.$3)};c.render=function(a,b){__p&&__p();this.$5&&this.$5.isRunning()&&this.$5.update();var c=a.state.buffers.stencil,d=a.state.buffers.depth,e=a.context;this.renderFrameStencil(a,b);this.$1.storyScene&&(c.setFunc(e.EQUAL,1,255),c.setOp(e.KEEP,e.KEEP,e.KEEP),a.render(this.$1.storyScene,b));this.$3.visible=!1;this.$4.visible=!0;c.setFunc(e.NOTEQUAL,1,255);c.setOp(e.KEEP,e.KEEP,e.KEEP);d.setTest(!1);a.render(this.$1.uiScene,b);a.clearStencil();a.clearDepth();c.setTest(!1)};c.renderFrameStencil=function(a,b){var c=a.state.buffers.stencil,d=a.context;this.$3.visible=!0;this.$4.visible=!1;a.clearStencil();c.setTest(!0);c.setFunc(d.ALWAYS,1,255);c.setOp(d.REPLACE,d.REPLACE,d.REPLACE);a.render(this.$1.uiScene,b);a.clearDepth()};return a}();e.exports=a}),null);
__d("VrWorldFade",["invariant","Promise","SocialVRThreeJS","VrFadeAnimation"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();a=function(){__p&&__p();function a(a){this.$1=a,this.$7=new(b("SocialVRThreeJS").Mesh)(new(b("SocialVRThreeJS").BoxGeometry)(5,5,5),new(b("SocialVRThreeJS").MeshBasicMaterial)({transparent:!0,colorWrite:!0,depthWrite:!1,opacity:1,color:new(b("SocialVRThreeJS").Color)(this.$1.color)})),this.$7.name="fadeMesh",this.$7.material.side=b("SocialVRThreeJS").BackSide,this.$8=new(b("SocialVRThreeJS").Scene)(),this.$8.add(this.$7),this.$2=new(b("VrFadeAnimation"))(this.$7,[{times:this.$1.fadeInParams.times,opacities:this.$1.fadeInParams.opacities}]),this.$3=new(b("VrFadeAnimation"))(this.$7,[{times:this.$1.fadeOutParams.times,opacities:this.$1.fadeOutParams.opacities}]),this.$4=null,this.$6=null}var c=a.prototype;c.setFade=function(a){!this.$2.isRunning()&&!this.$3.isRunning()&&(this.$7.material.opacity=a)};c.startFadeIn=function(){var a=this;this.isAnimationRunning()&&g(0,13092);this.$4===null||g(0,13098);var c=new(b("Promise"))(function(b,c){a.$2.start(),a.$4=b});return c};c.stopFadeIn=function(){this.$2.stop(),this.$4&&(this.$4(),this.$4=null)};c.startFadeOut=function(){var a=this;this.isAnimationRunning()&&g(0,13092);this.$6===null||g(0,13099);var c=new(b("Promise"))(function(b,c){a.$3.start(),a.$6=b});return c};c.stopFadeOut=function(){this.$3.stop(),this.$6&&(this.$6(),this.$6=null)};c.isAnimationRunning=function(){return this.$2.isRunning()||this.$3.isRunning()};c.isFadedIn=function(){return this.$7.material.opacity===1};c.onRender=function(a,b){__p&&__p();var c=this.$2.isRunning(),d=this.$3.isRunning();c&&this.$2.update();d&&this.$3.update();if(c&&!this.$2.isRunning()){this.$2.stop();this.$7.material.opacity=1;c=this.$4;this.$4=null;c||g(0,13100);c()}if(d&&!this.$3.isRunning()){this.$6||g(0,13101);this.$3.stop();this.$7.material.opacity=0;c=this.$6;this.$6=null;c||g(0,13100);c()}if(this.$7.material.opacity!==0){d=a.gammaOutput;a.gammaOutput=!1;a.render(this.$8,b);a.gammaOutput=d}};return a}();e.exports=a}),null);
__d("WebVrTimeTracker",[],(function(a,b,c,d,e,f){"use strict";__p&&__p();a=function(){__p&&__p();function a(){var a=this;this.$2=0;window.addEventListener("vrdisplayblur",function(){a.stopTime()});window.addEventListener("vrdisplayfocus",function(){a.startTime()})}var b=a.prototype;b.reset=function(){this.$1=null,this.$2=0};b.startTime=function(){this.$1===null&&(this.$1=Date.now())};b.stopTime=function(){var a=this.$1;a=a!==null&&a!==void 0?Date.now()-a:0;this.$1=null;this.$2+=a;return this.$2};return a}();e.exports=a}),null);
__d("WebVrDeviceManager",["invariant","Promise","WebVrTimeTracker","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();a=function(){__p&&__p();a.getInstance=function(){a.$1==null&&(a.$1=new a());return a.$1};function a(){__p&&__p();var c=this;this.$4=[];this.$13=function(){if(c.inVr()){var a=c.$2;a||g(0,10939);a=a.onVrRender;a||g(0,11325);c.$8=c.$3.requestAnimationFrame(c.$13);a()}};a.$1===null||g(0,11125);this.$8=null;this.$6=!1;this.$3=null;this.$5=new(b("WebVrTimeTracker"))();this.$9();window.addEventListener("vrdisplayconnect",function(){c.$9()});window.addEventListener("vrdisplaydisconnect",function(){c.$9()});document.addEventListener("visibilitychange",function(){document.visibilityState!=="visible"&&(c.$10(),b("promiseDone")(c.exitVr()))});window.addEventListener("vrdisplaypresentchange",function(){c.$3.isPresenting?c.$11():c.$10()});window.addEventListener("vrdisplayblur",function(){c.$2&&c.$2.onVrFocusChange&&c.$2.onVrFocusChange()});window.addEventListener("vrdisplayfocus",function(){c.$2&&c.$2.onVrFocusChange&&c.$2.onVrFocusChange()});window.addEventListener("vrdisplayactivate",function(a){c.$2&&c.$2.onVrFocusChange&&c.$2.onVrFocusChange();var b=c.$7;if(b&&!c.$3.isPresenting){a={onVrEnter:function(){c.$6=!0,b.onVrDeepLink()},onVrExit:function(){},vrAttributes:b.vrAttributes,vrCanvas:b.vrCanvas};c.enterVr(a)}});window.addEventListener("vrdisplaydeactivate",function(a){c.$2&&c.$2.onVrFocusChange&&c.$2.onVrFocusChange()})}var c=a.prototype;c.setDeeplinkProps=function(a){this.$7=a};c.isDeepLink=function(){return this.$6};c.addDeviceReadyListner=function(a){this.$4.push(a),a(this.$3)};c.removeDeviceReadyListner=function(a){a=this.$4.indexOf(a);a>=0&&this.$4.splice(a,1)};c.$12=function(){var a=this;this.$4.forEach(function(b){b(a.$3)})};c.$9=function(){var a=this;navigator.getVRDisplays?b("promiseDone")(b("Promise").resolve(navigator.getVRDisplays().then(function(b){b.length>0?a.$3=b[0]:a.$3=null,a.$12()}))):this.$3=null};c.enterVr=function(a){__p&&__p();if(this.$3){if(this.$3.isPresenting){this.$10();this.$2=a;this.$11();return b("Promise").resolve()}this.$2=a;return b("Promise").all([this.$3.requestPresent([{source:this.$2.vrCanvas,attributes:this.$2.vrAttributes}])])}return b("Promise").resolve()};c.$11=function(){var a=this.$2;a||g(0,10938);this.$5.reset();this.$5.startTime();a.onVrEnter();a.onVrRender&&(this.$8=this.$3.requestAnimationFrame(this.$13))};c.exitVr=function(){return this.$3&&this.$3.isPresenting?b("Promise").all([this.$3.exitPresent()]):b("Promise").resolve()};c.$10=function(){__p&&__p();this.$6=!1;var a=this.$2;if(a){var b=this.$5.stopTime();this.$5.reset();this.$8!==null&&this.$3.cancelAnimationFrame(this.$8);this.$8=null;a.onVrExit(b);this.$2=null}};c.inVr=function(){return this.$3&&this.$3.isPresenting};return a}();a.$1=null;e.exports=a}),null);
__d("SphericalPhotoVrUIRenderer",["invariant","SocialVRThreeJS","VrController","VrStoryUIContainer","VrWorldFade","WebVrDeviceManager","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=2.5,i=3.25,j=.1,k=.05,l=[0,0,-4],m=.125,n=5592405;a=function(){__p&&__p();function a(a,c,d){__p&&__p();this.$3=null;this.$4=new(b("SocialVRThreeJS").Scene)();this.$1=new(b("SocialVRThreeJS").WebGLRenderer)({canvas:c,context:d});this.$1.autoClear=!1;this.$1.setClearColor(new(b("SocialVRThreeJS").Color)("blue"),1);this.$1.setPixelRatio(window.devicePixelRatio);this.$1.vr.setDevice(a);this.$1.vr.enabled=!0;this.$1.vr.autoSubmitFrame=!1;this.$1.gammaOutput=!0;this.$5=new(b("VrWorldFade"))({color:n,fadeInParams:{times:[0,3],opacities:[1,0]},fadeOutParams:{times:[0,3],opacities:[0,1]}});this.$2=new(b("SocialVRThreeJS").PerspectiveCamera)(75,1,.1,2e3);c=[{gampadId:"Oculus Touch (Right)",buttonIndex:4,eventType:"quit"},{gampadId:"Oculus Touch",buttonIndex:4,eventType:"quit"}];this.$6=new(b("VrController"))("left",this.$8.bind(this),c);this.$7=new(b("VrController"))("right",this.$8.bind(this),c)}var c=a.prototype;c.enterVr=function(a){this.$3==null||g(0,12452),this.$3=new(b("VrStoryUIContainer"))({frameWidth:h,frameHeight:i,framePadding:j,frameBorderRadius:k,framePosition:l,frameClearColor:n,frameRowHeight:m,storyScene:null,storyCardProps:a,uiScene:this.$4,fade:{times:[3,4],opacities:[1,0]}}),this.$5.startFadeIn()};c.exitVr=function(){var a=this.$3;a&&(a.dispose(),this.$3=null);this.$5.stopFadeIn()};c.renderVr=function(){__p&&__p();var a=this.$3;a||g(0,12465);this.$6.update();this.$7.update();if(this.$5.isAnimationRunning()){var b=this.$1.state.buffers.stencil,c=this.$1.context;a.renderFrameStencil(this.$1,this.$2);b.setFunc(c.NOTEQUAL,1,255);b.setOp(c.KEEP,c.KEEP,c.KEEP);this.$5.onRender(this.$1,this.$2);this.$1.clearStencil();this.$1.clearDepth();b.setTest(!1)}a.render(this.$1,this.$2);this.$1.state.reset()};c.$8=function(a){switch(a.eventType){case"quit":b("promiseDone")(b("WebVrDeviceManager").getInstance().exitVr());break}};return a}();e.exports=a}),null);
__d("SphericalPhotoVrWebGLRenderer",["invariant","CubestripSphericalWebGLRenderer","DOM","SphericalPhotoVrUIRenderer","gl-matrix"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=b("gl-matrix").glMatrix,i=b("gl-matrix").mat4,j=100;a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);c.getInstance=function(a){c.$SphericalPhotoVrWebGLRenderer1!=null&&c.$SphericalPhotoVrWebGLRenderer1.vrDevice()!=a&&(c.$SphericalPhotoVrWebGLRenderer1=null);if(c.$SphericalPhotoVrWebGLRenderer1==null){var d=b("DOM").create("canvas");c.$SphericalPhotoVrWebGLRenderer1=new c(a,d,{preserveDrawingBuffer:a.capabilities&&a.capabilities.hasExternalDisplay,stencil:!0})}return c.$SphericalPhotoVrWebGLRenderer1};function c(d,e,f){__p&&__p();e=a.call(this,null,e,[],f)||this;c.$SphericalPhotoVrWebGLRenderer1===null||g(0,11125);e.__clearOnRender=!1;e.__verticalFieldOfView=j;e.__horizontalFieldOfView=j;e.__vrDevice=d;e.__vrFrameData=new window.VRFrameData();e.__initialMatrix=i.create();d.depthNear=.1;d.depthFar=2e3;f=d.getEyeParameters("left");e.__canvas.width=f.renderWidth*2;e.__canvas.height=f.renderHeight;e.__sphericalPhotoVrUIRenderer=new(b("SphericalPhotoVrUIRenderer"))(e.__vrDevice,e.__canvas,e.__gl);return e}var d=c.prototype;d.vrDevice=function(){return this.__vrDevice};d.canvas=function(){return this.__canvas};d.enterVr=function(a,b,c,d){this.__source=d,this.__source.setAttribute("crossorigin","anonymous"),this.__clearCache(),this.__createTexture(),this.__sphericalPhotoVrUIRenderer.enterVr(c),i.identity(this.__initialMatrix),i.rotateX(this.__initialMatrix,this.__initialMatrix,-h.toRadian(b)),i.rotateY(this.__initialMatrix,this.__initialMatrix,h.toRadian(a))};d.exitVr=function(){this.__source=null,this.__gl.clear(this.__gl.COLOR_BUFFER_BIT|this.__gl.DEPTH_BUFFER_BIT),this.__sphericalPhotoVrUIRenderer.exitVr()};d.renderVr=function(){if(this.__contextLost||this.__destroyed)return;this.__gl.clear(this.__gl.COLOR_BUFFER_BIT|this.__gl.DEPTH_BUFFER_BIT|this.__gl.STENCIL_BUFFER_BIT);this.$SphericalPhotoVrWebGLRenderer2();this.$SphericalPhotoVrWebGLRenderer3()};d.$SphericalPhotoVrWebGLRenderer2=function(){this.__gl.disable(this.__gl.DEPTH_TEST),this.__gl.disable(this.__gl.CULL_FACE),this.__gl.useProgram(this.__shaderProgram),this.__setShaderMatrixPointers(),this.__shaderProgramReady(),this.vrDevice().getFrameData(this.__vrFrameData),i.fromQuat(this.__rotationMatrix,this.__vrFrameData.pose.orientation),i.invert(this.__rotationMatrix,this.__rotationMatrix),i.multiply(this.__rotationMatrix,this.__rotationMatrix,this.__initialMatrix),this.__gl.uniformMatrix4fv(this.__shaderRotMatrixUniform,!1,this.__rotationMatrix),this.__gl.viewport(0,0,this.__canvas.width*.5,this.__canvas.height),this.__gl.uniformMatrix4fv(this.__shaderPMatrixUniform,!1,this.__vrFrameData.leftProjectionMatrix),this.__renderInternal(),this.__gl.viewport(this.__canvas.width*.5,0,this.__canvas.width*.5,this.__canvas.height),this.__gl.uniformMatrix4fv(this.__shaderPMatrixUniform,!1,this.__vrFrameData.rightProjectionMatrix),this.__renderInternal()};d.$SphericalPhotoVrWebGLRenderer3=function(){this.__sphericalPhotoVrUIRenderer.renderVr()};return c}(b("CubestripSphericalWebGLRenderer"));a.$SphericalPhotoVrWebGLRenderer1=null;e.exports=a}),null);
__d("EnterVrButton.react",["ix","cx","fbt","invariant","AbstractButton.react","Image.react","React","SUIBusinessTheme","SUITooltip.react","asset"],(function(a,b,c,d,e,f,g,h,i,j){"use strict";__p&&__p();a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(){return a.apply(this,arguments)||this}var d=c.prototype;d.render=function(){var a=this,c=b("React").createElement(b("Image.react"),{src:g("556058")}),d="",e="",f;this.props.inVr?(d=b("React").createElement("div",{className:"_6ydz"},i._("VR mode on")),e=i._("Exit VR")):this.props.isLoading?d=b("React").createElement("div",{className:"_6ydz"},i._("Loading")):e=i._("Enter VR");this.props.needsOverlay&&(f=b("React").createElement("div",{className:"_6yd-"}));d=b("React").createElement("div",null,f,b("React").createElement("div",{className:"_6yd_"},d,b("React").createElement(b("SUITooltip.react"),{ref:function(b){return a.$1=b},theme:b("SUIBusinessTheme"),tooltip:e,tooltipDelay:500},b("React").createElement(b("AbstractButton.react"),{disabled:this.props.isLoading,label:e,labelIsHidden:!0,className:"_6ye0",image:c,onClick:function(){a.props.onClickCallback(),a.__hideToolTip()}}))));return d};d.__hideToolTip=function(){this.$1||j(0,5e3),this.$1.hide()};return c}(b("React").PureComponent);e.exports=a}),null);
__d("WebVrContainer.react",["cx","invariant","EnterVrButton.react","React","Spotlight.react"],(function(a,b,c,d,e,f,g,h){"use strict";__p&&__p();a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.state={inVr:!1,isVrDeviceReady:!1,isClientReady:!1,vrCanvas:null,vrRenderWidth:0,vrRenderHeight:0},b)||babelHelpers.assertThisInitialized(c)}var d=c.prototype;d.setDeviceReady=function(a,b,c){this.setState({isVrDeviceReady:a,vrRenderWidth:b,vrRenderHeight:c})};d.setIsClientReady=function(a){this.setState({isClientReady:a})};d.setVrOn=function(a){this.state.inVr||(this.state.vrCanvas===null||h(0,10946),a.parentElement===null||h(0,10947),this.setState({inVr:!0,vrCanvas:a}))};d.setVrOff=function(){if(this.state.inVr){var a=this.$1;a!==null&&a!==void 0||h(0,10943);var b=this.state.vrCanvas;b!==null&&b!==void 0||h(0,10944);b.parentElement===a||h(0,10945);a.removeChild(b);this.setState({inVr:!1,vrCanvas:null})}};d.componentDidUpdate=function(){if(this.state.inVr){var a=this.$1;a!==null&&a!==void 0||h(0,11040);var b=this.state.vrCanvas;b!==null&&b!==void 0||h(0,11039);a.appendChild(b)}};d.render=function(){__p&&__p();var a=this,c;if(!this.state.isVrDeviceReady)c=b("React").createElement("div",null);else{var d=b("React").createElement(b("EnterVrButton.react"),{onClickCallback:function(){a.state.inVr?a.props.exitVrCallback():a.props.enterVrCallback()},needsOverlay:this.props.needsOverlay,inVr:this.state.inVr,isLoading:!this.state.isClientReady});if(this.state.inVr){var e={width:this.state.vrRenderWidth,maxWidth:"80vw",height:this.state.vrRenderHeight,maxHeight:"90vh",overflow:"hidden",position:"relative"};e=b("React").createElement(b("Spotlight.react"),{onHide:function(){a.props.exitVrCallback()},shown:this.state.inVr,rootClassName:"_6_ca"},b("React").createElement("div",{className:"_n3",style:e},b("React").createElement("div",{ref:function(b){return a.$1=b}}),d));c=b("React").createElement("div",null,e)}else c=b("React").createElement("div",null,d)}return c};return c}(b("React").Component);e.exports=a}),null);
__d("SphericalPhotoWebVrContianer.redux",["invariant","Bootloader","React","ReactRedux","SphericalMediaBaseActions","SphericalPhotoViewerLogEvents","SphericalPhotoVrWebGLRenderer","UserAgent","WebVrContainer.react","WebVrDeviceManager","promiseDone"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();a=b("ReactRedux").connect;var h=b("SphericalMediaBaseActions").setVrDevice,i=b("SphericalMediaBaseActions").setVrIsPresenting;c=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.$3={},c.state={},b)||babelHelpers.assertThisInitialized(c)}var d=c.prototype;d.componentDidUpdate=function(a,c){b("UserAgent").isBrowser("Oculus Browser")&&(this.$3={caCorrection:!0,highRefreshRate:!0}),this.$1&&this.$1.setIsClientReady(this.props.vrRendererIsReady),this.props.vrRenderingSupported&&(this.$2||(this.$2=this.$4.bind(this)),this.$1&&(this.props.visibility?b("WebVrDeviceManager").getInstance().addDeviceReadyListner(this.$2):b("WebVrDeviceManager").getInstance().removeDeviceReadyListner(this.$2)))};d.$4=function(a){var b=this.$1;b||g(0,11296);if(a!==null){var c=a.getEyeParameters("left");b.setDeviceReady(!0,c.renderWidth,c.renderHeight)}else b.setDeviceReady(!1,0,0);this.props.dispatch(h(a))};d.render=function(){__p&&__p();var a=this;return b("React").createElement(b("WebVrContainer.react"),{enterVrCallback:function(){__p&&__p();var c=b("SphericalPhotoVrWebGLRenderer").getInstance(a.props.vrDevice).canvas(),d={onVrEnter:function(){a.$5(b("SphericalPhotoViewerLogEvents").WEB_VR_START,0);var d=a.$1;d||g(0,11297);d.setVrOn(c);a.props.dispatch(i(!0))},onVrExit:function(c){a.$5(b("SphericalPhotoViewerLogEvents").WEB_VR_END,c);c=a.$1;c||g(0,11298);c.setVrOff();a.props.dispatch(i(!1))},vrAttributes:a.$3,vrCanvas:c};b("promiseDone")(b("WebVrDeviceManager").getInstance().enterVr(d))},exitVrCallback:function(){b("promiseDone")(b("WebVrDeviceManager").getInstance().exitVr())},needsOverlay:!0,ref:function(b){return a.$1=b}})};d.$5=function(a,c){var d=this;b("Bootloader").loadModules(["SphericalPhotoViewerTypedLogger"],function(b){new b().setName(a).setRenderMethod("tiled").setDt(c).setPhotoID(d.props.fbid).logImmediately()},"SphericalPhotoWebVrContianer.redux")};return c}(b("React").Component);d=function(a){return{fbid:a.base.fbid,visibility:a.base.visibility,vrDevice:a.base.vrDevice,vrRenderingSupported:a.base.vrRenderingSupported,vrRendererIsReady:a.base.vrRendererIsReady}};e.exports=a(d)(c)}),null);
__d("SphericalMediaVrDriver",["invariant","FBLogger"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();a=function(){__p&&__p();function a(a){__p&&__p();var c=this;this.$4=function(){__p&&__p();var a=c.vrDevice();a||g(0,11293);if(a&&a.isPresenting){c.$2=a.requestAnimationFrame(c.$4);try{c.$1.renderVr()}catch(a){var d=b("FBLogger")("SphericalMediaVrRender");a!=null&&(d=d.catching(a));d.warn(a)}a.submitFrame()}};this.$1=a;this.$3=!1;this.$2=null}var c=a.prototype;c.vrDevice=function(){return this.$1.vrDevice()};c.enterVr=function(a,b,c,d){this.$3&&g(0,12378);var e=this.vrDevice();e||g(0,11294);this.$1.enterVr(a,b,c,d);this.$3=!0;this.$2=e.requestAnimationFrame(this.$4)};c.exitVr=function(){this.$3||g(0,12379);var a=this.vrDevice();a||g(0,11295);a.cancelAnimationFrame(this.$4);this.$2=null;this.$3=!1;this.$1.exitVr()};return a}();e.exports=a}),null);
__d("SphericalPhotoWebVrRenderer.redux",["invariant","DOM","Event","ImageUtils","React","ReactRedux","SphericalMediaBaseActions","SphericalMediaVrDriver","SphericalPhotoVrWebGLRenderer"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();a=b("ReactRedux").connect;var h=b("SphericalMediaBaseActions").setVrRendererIsReady,i=b("SphericalMediaBaseActions").setVrRenderingSupported;c=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c){c=a.call(this,c)||this;c.state={};c.$2=b("DOM").create("img");c.$1=null;return c}var d=c.prototype;d.componentDidMount=function(){this.$3(),this.$4()};d.componentDidUpdate=function(a){__p&&__p();a.fullscreenCubeImageURI!=this.props.fullscreenCubeImageURI&&this.$3();a.vrDevice!=this.props.vrDevice&&this.$4();if(this.props.vrIsPresenting===!0&&a.vrIsPresenting===!1){b("ImageUtils").hasLoaded(this.$2)||g(0,12381);var c=this.props.vrStoryProps;c||g(0,12751);var d=this.$1;d||g(0,12380);d.enterVr(this.props.initialYaw,0,c,this.$2)}else this.props.vrIsPresenting===!1&&a.vrIsPresenting===!0&&(this.$1||g(0,12380),this.$1.exitVr())};d.$3=function(){var a=this,c=this.props,d=c.fullscreenCubeImageURI,e=c.dispatch;if(d&&!this.$2.src){b("DOM").setAttributes(this.$2,{crossOrigin:"anonymous",src:d});if(!b("ImageUtils").hasLoaded(this.$2))var f=b("Event").listen(this.$2,"load",function(){a.$5(),f.remove(),e(h(!0))})}e(i(d!=null))};d.$5=function(){!this.$1&&this.props.vrDevice&&b("ImageUtils").hasLoaded(this.$2)&&(this.$1=new(b("SphericalMediaVrDriver"))(b("SphericalPhotoVrWebGLRenderer").getInstance(this.props.vrDevice)))};d.$4=function(){var a=this.props.vrDevice;this.$1!=null&&this.$1.vrDevice()!=a&&(this.$1=null);this.$1||this.$5()};d.render=function(){return b("React").createElement("div",null)};return c}(b("React").Component);d=function(a){return{vrDevice:a.base.vrDevice,vrIsPresenting:a.base.vrIsPresenting,initialYaw:a.base.initialYaw,fullscreenCubeImageURI:a.base.fullscreenCubeImageURI,vrStoryProps:a.base.vrStoryProps}};e.exports=a(d)(c)}),null);
__d("SphericalPhotoViewer.react",["BootloadedComponent.react","ImmersiveMediaOverlay.react","JSResource","PhotoProjection","React","ReactRedux","SphericalMediaBaseActions","SphericalMediaCoreActions","SphericalMediaViewActions","SphericalPhotoController.redux","SphericalPhotoFallbackMiddleware","SphericalPhotoPartialLimits","SphericalPhotoRenderer.redux","SphericalPhotoStore","SphericalPhotoTypedConfig","SphericalPhotoViewerLoggingMiddleware","SphericalPhotoViewerWrapper.redux","SphericalPhotoWebVrContianer.redux","SphericalPhotoWebVrRenderer.redux","gkx"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("ReactRedux").Provider,h=b("SphericalMediaBaseActions").updateBase,i=b("SphericalMediaBaseActions").updateDimension,j=b("SphericalMediaCoreActions").turnOff,k=b("SphericalMediaCoreActions").turnOn,l=b("SphericalMediaViewActions").updateView,m=b("SphericalPhotoPartialLimits").makePartialLimits;a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c){c=a.call(this,c)||this;c.__store=new(b("SphericalPhotoStore"))(c.__getMiddleware()).getStore();return c}var d=c.prototype;d.shouldComponentUpdate=function(a){return this.props.caption!==a.caption||this.props.cubeImageURI!==a.cubeImageURI||this.props.enableTagging!==a.enableTagging||this.props.height!==a.height||this.props.initialImageURI!==a.initialImageURI||this.props.photoID!==a.photoID||this.props.surface!==a.surface||this.props.fullscreenCubeImageURI!==a.fullscreenCubeImageURI||this.props.vrStoryProps!==a.vrStoryProps||this.props.width!==a.width};d.componentWillUnmount=function(){this.__store.dispatch(j())};d.UNSAFE_componentWillMount=function(){this.__updateState(),this.__store.dispatch(k())};d.componentDidUpdate=function(){this.__updateState(this.props)};d.UNSAFE_componentWillReceiveProps=function(a){a.photoID!==this.__store.getState().base.fbid&&this.__updateState(a)};d.__getMiddleware=function(){var a=this.props.middlewares||[];return a.concat([b("SphericalPhotoViewerLoggingMiddleware"),b("SphericalPhotoFallbackMiddleware")])};d.__updateState=function(a){a===void 0&&(a=this.props);var c={enableGyro:a.enableGyro,enableZoom:a.enableZoom,enableRubberBanding:a.enableRubberBanding,visibility:!0},d,e,f,g;a.partialLimits&&(d=a.partialLimits.partialLeftDegrees,e=a.partialLimits.partialRightDegrees,f=a.partialLimits.partialBottomDegrees,g=a.partialLimits.partialTopDegrees);this.__store.dispatch(h(babelHelpers["extends"]({ambientAudio:a.ambientAudio||[],enableTagging:b("SphericalPhotoTypedConfig").www_can_viewer_tag&&a.enableTagging,initialYaw:a.initialView.yaw,initialPitch:a.initialView.pitch,initialFov:a.initialView.fov,tiledSphericalConfig:a.tiledSphericalConfig,caption:a.caption,canvasNamespace:a.canvasNamespace,fallback:a.fallback,fbid:a.photoID,partialLimits:m({partialLeftDegrees:d,partialRightDegrees:e,partialBottomDegrees:f,partialTopDegrees:g}),projectionType:a.projectionType,photoSphereMetadata:a.photoSphereMetadata||{},src:a.cubeImageURI,surface:a.surface,thumbnail:a.initialImageURI||"",useLargeHeadingIndicator:a.useLargeHeadingIndicator||!1,useLargeVolumeIcon:a.useLargeVolumeIcon||!1,fullscreenCubeImageURI:a.fullscreenCubeImageURI,vrStoryProps:a.vrStoryProps},c)));this.__store.dispatch(i(a.width,a.height));c=this.__store.getState().base.viewStore;c.dispatch(l({yaw:a.initialView.yaw,pitch:a.initialView.pitch,fov:a.initialView.fov}))};d.render=function(){var a=b("gkx")("728105")&&b("gkx")("818257"),c=a?b("React").createElement(b("SphericalPhotoWebVrContianer.redux"),null):null;a=a?b("React").createElement(b("SphericalPhotoWebVrRenderer.redux"),null):null;return b("React").createElement(g,{store:this.__store},b("React").createElement(b("SphericalPhotoViewerWrapper.redux"),null,c,a,b("React").createElement(b("SphericalPhotoRenderer.redux"),null),this.__store.getState().base.enableTagging?b("React").createElement(b("BootloadedComponent.react"),{bootloadLoader:b("JSResource")("SphericalPhotoTagging.redux").__setRef("SphericalPhotoViewer.react"),bootloadPlaceholder:b("React").createElement("span",null)}):null,b("React").createElement(b("SphericalPhotoController.redux"),null),b("gkx")("764274")&&b("React").createElement(b("ImmersiveMediaOverlay.react"),{graphQLID:this.props.graphQLID}),b("React").createElement(b("BootloadedComponent.react"),{bootloadLoader:b("JSResource")("SphericalPhotoHeadingIndicator.redux").__setRef("SphericalPhotoViewer.react"),bootloadPlaceholder:b("React").createElement("span",null)}),this.props.ambientAudio&&this.props.ambientAudio.length>0?b("React").createElement(b("BootloadedComponent.react"),{bootloadLoader:b("JSResource")("SphericalPhotoVolumeControl.redux").__setRef("SphericalPhotoViewer.react"),bootloadPlaceholder:b("React").createElement("span",null)}):null,this.props.showMouseAnimation?b("React").createElement(b("BootloadedComponent.react"),{bootloadLoader:b("JSResource")("SphericalMediaMouseOverlay.redux").__setRef("SphericalPhotoViewer.react"),bootloadPlaceholder:b("React").createElement("span",null)}):null,this.props.showGyroAnimation?b("React").createElement(b("BootloadedComponent.react"),{bootloadLoader:b("JSResource")("SphericalMediaGyroOverlay.redux").__setRef("SphericalPhotoViewer.react"),bootloadPlaceholder:b("React").createElement("span",null)}):null,this.props.showManager?b("React").createElement(b("BootloadedComponent.react"),{bootloadLoader:b("JSResource")("SphericalPhotoManagerLoader").__setRef("SphericalPhotoViewer.react"),bootloadPlaceholder:b("React").createElement("span",null)}):null))};return c}(b("React").Component);a.defaultProps={canvasNamespace:"PhotoViewer",enableGyro:!1,enableRubberBanding:!1,enablevisibilityObserver:!1,enableZoom:!1,projectionType:b("PhotoProjection").CUBESTRIP,showGyroAnimation:!1,showManager:!1,showMouseAnimation:!0,useLargeHeadingIndicator:!1,useLargeVolumeIcon:!1};e.exports=a}),null);
__d("SphericalPhotoViewerInFeed.react",["cx","Arbiter","Bootloader","CSS","DataStore","Event","ReactDOM","SphericalMediaActions","SphericalMediaBaseActions","SphericalMediaCoreActions","SphericalMediaViewActions","SphericalParallaxUtils","SphericalPhotoTypedConfig","SphericalPhotoViewer.react","SubscriptionsHandler","debounce","getElementRect","getViewportDimensions","onViewportChanged"],(function(a,b,c,d,e,f,g){"use strict";__p&&__p();var h=b("SphericalMediaBaseActions").updateFeedRootElement,i=b("SphericalMediaBaseActions").visibilityChanged,j=b("SphericalMediaCoreActions").turnOff,k=b("SphericalMediaCoreActions").turnOn,l=b("SphericalMediaViewActions").updateYaw,m=b("SphericalParallaxUtils").calculateNewYaw,n=5e3,o=50;a=function(a){__p&&__p();babelHelpers.inheritsLoose(c,a);function c(c){__p&&__p();var d;d=a.call(this,c)||this;d.$SphericalPhotoViewerInFeed16=function(){if(d.$SphericalPhotoViewerInFeed20())return;if(d.$SphericalPhotoViewerInFeed7&&d.$SphericalPhotoViewerInFeed7.isOpen)return;var a=b("getViewportDimensions").withoutScrollbars();a=a.height;d.$SphericalPhotoViewerInFeed21(a,0);d.$SphericalPhotoViewerInFeed17();d.__store.dispatch(k())};d.$SphericalPhotoViewerInFeed15=b("debounce")(function(a){if(!d.$SphericalPhotoViewerInFeed5)return;var c=b("getElementRect")(d.$SphericalPhotoViewerInFeed5),e=a.bottom-a.top,f=c.bottom-c.top;e=(e-f)/3;f=a.top+e;a=a.bottom-e;e=c.top>f&&c.top<a||c.bottom>f&&c.bottom<a||f>c.top&&a<c.bottom;d.$SphericalPhotoViewerInFeed3!==e&&(d.$SphericalPhotoViewerInFeed3=e,e?d.$SphericalPhotoViewerInFeed22():d.$SphericalPhotoViewerInFeed23())},o);d.$SphericalPhotoViewerInFeed18=function(a){d.$SphericalPhotoViewerInFeed21(a.bottom,a.top)};if(c.initialViewElement&&b("SphericalPhotoTypedConfig").reuse_dom_data_in_snowlift){c=c.initialViewElement.children[0];c&&c instanceof HTMLImageElement&&b("DataStore").set(c,"sphericalPhotoData",{url:c.src,smallurl:c.src,cubeImageURI:d.props.cubeImageURI,fullscreenCubeImageURI:d.props.fullscreenCubeImageURI,tiledSphericalConfig:d.props.tiledSphericalConfig,initialView:d.props.initialView,dimensions:{x:d.props.width,y:d.props.height},partialLimits:d.props.partialLimits,fbid:d.props.photoID,photoSphereMetadata:d.props.photoSphereMetadata,fallback:d.props.fallback,ambientAudio:d.props.ambientAudio,vrStoryProps:d.props.vrStoryProps})}return d}var d=c.prototype;d.__getMiddleware=function(){__p&&__p();var c=this,d=a.prototype.__getMiddleware.call(this),e=function(){return function(a){return function(d){if(d.type===b("SphericalMediaActions").VIEWPORT_CLICKED){var e=c.props.externalLinkElement||c.props.theaterLinkElement;e&&e.click()}return a(d)}}},f=function(a){var d=a.getState;return function(a){return function(e){var f=d().base.showFallbackUI;f||(e.type===b("SphericalMediaActions").TURN_ON&&c.$SphericalPhotoViewerInFeed12(),(e.type===b("SphericalMediaActions").SETUP_RENDERER||e.type===b("SphericalMediaActions").SHOW_FALLBACK)&&(c.$SphericalPhotoViewerInFeed13(),c.props.initialViewElement&&b("CSS").hide(c.props.initialViewElement)));return a(e)}}},g=function(a){var d=a.getState;return function(a){return function(e){var f=d().base.showFallbackUI;f||e.type===b("SphericalMediaActions").TURN_OFF&&(c.$SphericalPhotoViewerInFeed3=!1,b("CSS").show(c.props.loadingElement),c.$SphericalPhotoViewerInFeed14(),c.props.initialViewElement&&b("CSS").show(c.props.initialViewElement));return a(e)}}};return d.concat([e,f,g])};d.componentDidMount=function(){__p&&__p();var a=this;this.__updateState();this.__store.dispatch(i(!1));this.$SphericalPhotoViewerInFeed14();var c=b("onViewportChanged")(this.$SphericalPhotoViewerInFeed15);this.$SphericalPhotoViewerInFeed1=b("Arbiter").subscribe("PhotoSnowlift.CLOSE",function(){a.$SphericalPhotoViewerInFeed3=!1,c.scheduleCheck()});this.$SphericalPhotoViewerInFeed2=b("Arbiter").subscribe("PhotoSnowlift.OPEN",function(){a.__store.dispatch(i(!1)),b("Bootloader").loadModules(["PhotoSnowlift"],function(b){a.$SphericalPhotoViewerInFeed7=b.getInstance()},"SphericalPhotoViewerInFeed.react")});this.$SphericalPhotoViewerInFeed3=!1;var d=new(b("SubscriptionsHandler"))(),e=b("ReactDOM").findDOMNode(this);this.__store.dispatch(h(e));d.addSubscriptions(b("Event").listen(e,"mouseenter",this.$SphericalPhotoViewerInFeed16),b("Event").listen(e,"touchstart",this.$SphericalPhotoViewerInFeed16));c.scheduleCheck();this.$SphericalPhotoViewerInFeed4=c;this.$SphericalPhotoViewerInFeed6=d;this.$SphericalPhotoViewerInFeed5=e;this.$SphericalPhotoViewerInFeed9=50;this.$SphericalPhotoViewerInFeed10=0;this.$SphericalPhotoViewerInFeed17();b("onViewportChanged")(this.$SphericalPhotoViewerInFeed18)};d.UNSAFE_componentWillMount=function(){this.__updateState()};d.componentWillUnmount=function(){this.$SphericalPhotoViewerInFeed19(),this.$SphericalPhotoViewerInFeed5=null,a.prototype.componentWillUnmount.call(this)};d.$SphericalPhotoViewerInFeed19=function(){this.$SphericalPhotoViewerInFeed1&&(b("Arbiter").unsubscribe(this.$SphericalPhotoViewerInFeed1),this.$SphericalPhotoViewerInFeed1=null),this.$SphericalPhotoViewerInFeed2&&(b("Arbiter").unsubscribe(this.$SphericalPhotoViewerInFeed2),this.$SphericalPhotoViewerInFeed2=null),this.$SphericalPhotoViewerInFeed4&&this.$SphericalPhotoViewerInFeed4.remove(),this.$SphericalPhotoViewerInFeed4=null,this.$SphericalPhotoViewerInFeed6&&this.$SphericalPhotoViewerInFeed6.release(),this.$SphericalPhotoViewerInFeed6=null};d.$SphericalPhotoViewerInFeed12=function(){b("CSS").addClass(this.props.loadingElement,"_2dz7"),b("CSS").removeClass(this.props.loadingElement,"_3s0i")};d.$SphericalPhotoViewerInFeed14=function(){b("CSS").removeClass(this.props.loadingElement,"_2dz7"),b("CSS").addClass(this.props.loadingElement,"_3s0i")};d.$SphericalPhotoViewerInFeed13=function(){var a=this;b("CSS").removeClass(this.props.loadingElement,"_2dz7");window.setTimeout(function(){b("CSS").hide(a.props.loadingElement)},300)};d.$SphericalPhotoViewerInFeed20=function(){return this.__store.getState().base.isRendererActive};d.$SphericalPhotoViewerInFeed21=function(a,c){if(this.$SphericalPhotoViewerInFeed3){if(!this.$SphericalPhotoViewerInFeed5)return;var d=b("getElementRect")(this.$SphericalPhotoViewerInFeed5);d=d.top+d.bottom/2;this.$SphericalPhotoViewerInFeed8=d/(a-c)*100;this.$SphericalPhotoViewerInFeed11||this.$SphericalPhotoViewerInFeed17()}};d.$SphericalPhotoViewerInFeed17=function(){__p&&__p();var a=this;if(this.$SphericalPhotoViewerInFeed7&&this.$SphericalPhotoViewerInFeed7.isOpen)return;if(this.$SphericalPhotoViewerInFeed8!==void 0){this.$SphericalPhotoViewerInFeed11=!0;var b=this.__store.getState().base,c=b.viewStore,d=b.aspectRatio;b=b.partialLimits;var e=c.getState().view,f=e.fov;e=e.centeredYaw;if(e!==this.$SphericalPhotoViewerInFeed10){this.$SphericalPhotoViewerInFeed9=this.$SphericalPhotoViewerInFeed8;this.$SphericalPhotoViewerInFeed10=e;this.$SphericalPhotoViewerInFeed11=!1;return}window.requestAnimationFrame(function(){return a.$SphericalPhotoViewerInFeed17()});(this.$SphericalPhotoViewerInFeed8<-100||this.$SphericalPhotoViewerInFeed8>200)&&(this.$SphericalPhotoViewerInFeed9=50);e=f*d/2;f=m(this.$SphericalPhotoViewerInFeed8,this.$SphericalPhotoViewerInFeed9,this.$SphericalPhotoViewerInFeed10,b.partialLeftDegrees,b.partialRightDegrees,e);d=f.yaw;b=f.success;if(b){e=c.getState().view.yaw;d!==e&&c.dispatch(l(d))}}};d.$SphericalPhotoViewerInFeed23=function(){var a=this;this.$SphericalPhotoViewerInFeed14();window.setTimeout(function(){!a.$SphericalPhotoViewerInFeed3&&a.$SphericalPhotoViewerInFeed20()&&a.__store.dispatch(j())},n);this.__store.dispatch(i(!1))};d.$SphericalPhotoViewerInFeed22=function(){this.$SphericalPhotoViewerInFeed16(),this.__store.dispatch(i(!0))};return c}(b("SphericalPhotoViewer.react"));e.exports=a}),null);